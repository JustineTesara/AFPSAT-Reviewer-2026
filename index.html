<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"
    />
    <title>AFP Exam Reviewer 2026</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
      }

      ::selection {
        background: var(--primary-light);
        color: white;
      }

      :root {
        /* Navy Green Theme */
        --primary: #1a4d2e;
        --primary-dark: #0f2818;
        --primary-light: #2d6a4f;
        --secondary: #4a7c59;
        --secondary-light: #74b38c;
        --accent: #d4af37;
        --danger: #c1121f;
        --success: #2d6a4f;
        --bg-light: #f1f8f4;
        --bg-cream: #faf8f3;
        --text-dark: #1a2e1a;
        --text-light: #5a6c5a;
        --border: #d1e3d1;
        --hover-glow: rgba(26, 77, 46, 0.15);
        --shadow-soft: rgba(26, 77, 46, 0.08);
        --white: #ffffff;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        background: linear-gradient(
          135deg,
          #1a4d2e 0%,
          #2d6a4f 50%,
          #4a7c59 100%
        );
        min-height: 100vh;
        color: var(--text-dark);
        padding-bottom: 80px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      /* ========================================
         RESPONSIVE DESIGN - MEDIA QUERIES
         ======================================== */

      /* Tablet styles (768px and below) */
      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        body {
          padding-bottom: 60px;
        }

        .header {
          padding: 20px;
          margin-bottom: 20px;
          border-radius: 12px;
        }

        .header h1 {
          font-size: 1.5rem;
          gap: 10px;
          flex-wrap: wrap;
        }

        .header-badge {
          font-size: 0.8rem;
          padding: 6px 15px;
        }

        .nav-tabs {
          gap: 8px;
          padding: 8px;
          margin-bottom: 15px;
          -webkit-overflow-scrolling: touch;
          scrollbar-width: thin;
        }

        .nav-tabs::-webkit-scrollbar {
          height: 6px;
        }

        .nav-tab {
          padding: 10px 20px;
          font-size: 0.95rem;
          min-height: 44px;
          flex-shrink: 0;
        }

        .nav-tab:hover {
          transform: none;
        }

        .nav-tab:active {
          transform: scale(0.98);
        }

        .content-section {
          padding: 20px;
          border-radius: 12px;
        }

        .section-header {
          gap: 12px;
          margin-bottom: 20px;
          padding-bottom: 12px;
          flex-wrap: wrap;
        }

        .section-header h2 {
          font-size: 1.5rem;
        }

        .section-header .emoji {
          font-size: 1.8rem;
        }

        .card-grid {
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 15px;
          margin-top: 15px;
        }

        .card {
          padding: 20px;
        }

        .card h3 {
          font-size: 1.2rem;
          margin-bottom: 10px;
        }

        .card .emoji {
          font-size: 2.2rem;
          margin-bottom: 12px;
        }

        .card:hover {
          transform: none;
        }

        .card:active {
          transform: scale(0.98);
        }

        .stats-grid {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
          gap: 15px;
          margin: 20px 0;
        }

        .stat-card {
          padding: 15px;
        }

        .stat-value {
          font-size: 2rem;
        }

        .stat-card:hover {
          transform: none;
        }

        .question-card {
          padding: 20px;
          margin: 15px 0;
        }

        .question-text {
          font-size: 1.1rem;
          margin-bottom: 20px;
        }

        .option {
          padding: 14px 18px;
          min-height: 44px;
        }

        .option:hover {
          transform: translateX(4px);
        }

        .btn {
          padding: 12px 24px;
          font-size: 0.95rem;
          min-height: 44px;
        }

        .btn-primary:hover,
        .btn-secondary:hover,
        .btn-success:hover,
        .btn-danger:hover {
          transform: none;
        }

        .btn:active {
          transform: scale(0.98);
        }

        .progress-container {
          margin: 20px 0;
          padding: 20px;
        }

        .achievement-grid {
          grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
          gap: 12px;
          margin: 20px 0;
        }

        .achievement-icon {
          font-size: 2rem;
          margin-bottom: 6px;
        }

        .score-circle {
          width: 150px;
          height: 150px;
          margin: 20px auto;
        }

        .score {
          font-size: 3rem;
        }

        .notification {
          top: 10px;
          right: 10px;
          left: 10px;
          max-width: calc(100% - 20px);
          padding: 15px 20px;
        }

        .timer {
          top: 10px;
          padding: 10px 20px;
          font-size: 0.95rem;
        }

        .info-box,
        .warning-box,
        .success-box {
          padding: 15px;
          margin: 15px 0;
        }

        .switch {
          width: 52px;
          height: 30px;
        }

        .slider:before {
          height: 22px;
          width: 22px;
        }

        input:checked + .slider:before {
          transform: translateX(22px);
        }

        h1 {
          font-size: 1.75rem;
        }

        h2 {
          font-size: 1.5rem;
        }

        h3 {
          font-size: 1.3rem;
        }

        ::-webkit-scrollbar {
          width: 6px;
          height: 6px;
        }
      }

      /* Mobile styles (600px and below) */
      @media (max-width: 600px) {
        .card-grid {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .stats-grid {
          grid-template-columns: 1fr 1fr;
        }
      }

      /* Small mobile styles (480px and below) */
      @media (max-width: 480px) {
        .container {
          padding: 10px;
        }

        body {
          padding-bottom: 50px;
        }

        .header {
          padding: 15px;
          margin-bottom: 15px;
        }

        .header h1 {
          font-size: 1.25rem;
          gap: 8px;
        }

        .header-badge {
          padding: 6px 12px;
          font-size: 0.75rem;
        }

        .nav-tabs {
          gap: 6px;
          padding: 6px;
          border-radius: 8px;
        }

        .nav-tab {
          padding: 10px 16px;
          font-size: 0.9rem;
          min-height: 44px;
        }

        .content-section {
          padding: 15px;
        }

        .section-header {
          gap: 10px;
          margin-bottom: 15px;
        }

        .section-header h2 {
          font-size: 1.3rem;
        }

        .section-header .emoji {
          font-size: 1.5rem;
        }

        .card {
          padding: 15px;
        }

        .card h3 {
          font-size: 1.1rem;
        }

        .card p {
          font-size: 0.95rem;
          line-height: 1.5;
        }

        .card .emoji {
          font-size: 2rem;
          margin-bottom: 10px;
        }

        .stats-grid {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .stat-card {
          padding: 12px;
        }

        .stat-value {
          font-size: 1.8rem;
        }

        .stat-label {
          font-size: 0.85rem;
        }

        .question-card {
          padding: 15px;
          margin: 12px 0;
        }

        .question-text {
          font-size: 1rem;
          margin-bottom: 15px;
          line-height: 1.5;
        }

        .options {
          gap: 10px;
        }

        .option {
          padding: 12px 15px;
          font-size: 0.95rem;
          gap: 10px;
        }

        .btn {
          padding: 12px 20px;
          font-size: 0.9rem;
          width: 100%;
          max-width: 100%;
        }

        .button-group {
          gap: 8px;
          margin: 15px 0;
          display: flex;
          flex-direction: column; /* ADDED: Stack buttons vertically */
        }

        .button-group .btn {
          width: 100%; /* ADDED: Full width buttons */
          min-width: 0;
          margin: 5px 0; /* ADDED: Spacing between stacked buttons */
        }

        .progress-container {
          margin: 15px 0;
          padding: 15px;
        }

        .progress-bar {
          height: 10px;
        }

        .achievement-grid {
          grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
          gap: 10px;
        }

        .achievement {
          padding: 10px;
          border-radius: 10px;
        }

        .achievement-icon {
          font-size: 1.5rem;
          margin-bottom: 4px;
        }

        .achievement-name {
          font-size: 0.7rem;
        }

        .score-circle {
          width: 130px;
          height: 130px;
        }

        .score {
          font-size: 2.5rem;
        }

        .total {
          font-size: 1rem;
        }

        .badge {
          padding: 5px 12px;
          font-size: 0.8rem;
          margin: 3px;
        }

        .notification {
          padding: 12px 16px;
          font-size: 0.9rem;
          bottom: 10px;
          right: 10px;
          left: 10px;
          max-width: calc(100% - 20px);
        }

        .timer {
          padding: 8px 16px;
          font-size: 0.85rem;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
          padding: 12px 14px;
          font-size: 16px; /* Prevents zoom on iOS */
          min-height: 44px;
        }
        /* Math game input fixes */
        input[type="number"]#mathAnswer {
          width: 100% !important; /* Full width on mobile */
          max-width: 280px;
          font-size: 1.8rem !important; /* Larger text */
          padding: 18px !important; /* More touch area */
          margin: 15px auto;
          display: block;
        }
        .form-group {
          margin-bottom: 15px;
        }

        .form-label {
          font-size: 0.95rem;
          margin-bottom: 6px;
        }

        .info-box,
        .warning-box,
        .success-box {
          padding: 12px;
          margin: 12px 0;
          font-size: 0.95rem;
        }

        .modal {
          padding: 10px;
        }

        .modal-content {
          padding: 25px 15px;
          border-radius: 12px;
          max-height: 95vh; /* ADDED: More screen space */
          overflow-y: auto;
          overflow-x: hidden; /* ADDED: Prevent horizontal scroll */
          -webkit-overflow-scrolling: touch; /* ✅ ADD this for iOS smooth scroll */
        }
        /* ADD this new rule: */
        @media (max-width: 480px) {
          .modal-content {
            max-height: 85vh; /* Shorter on mobile to account for keyboard */
          }
        }

        .modal-content * {
          max-width: 100%; /* ADDED: Force all children to respect container */
        }
        h1 {
          font-size: 1.5rem;
        }

        h2 {
          font-size: 1.3rem;
        }

        h3 {
          font-size: 1.1rem;
        }

        p {
          line-height: 1.5;
          font-size: 0.95rem;
        }

        .mt-1 {
          margin-top: 0.375rem;
        }
        .mt-2 {
          margin-top: 0.75rem;
        }
        .mt-3 {
          margin-top: 1.125rem;
        }
        .mb-1 {
          margin-bottom: 0.375rem;
        }
        .mb-2 {
          margin-bottom: 0.75rem;
        }
        .mb-3 {
          margin-bottom: 1.125rem;
        }
      }

      /* Landscape mode adjustments for mobile */
      @media (max-width: 768px) and (orientation: landscape) {
        .header {
          padding: 15px;
        }

        .header h1 {
          font-size: 1.3rem;
        }

        .content-section {
          padding: 15px;
        }

        .score-circle {
          width: 120px;
          height: 120px;
        }

        .score {
          font-size: 2rem;
        }
      }

      /* Smooth scrolling for navigation tabs */
      .nav-tabs {
        scrollbar-color: var(--primary-light) transparent;
      }

      .nav-tabs::-webkit-scrollbar-thumb {
        background: var(--primary-light);
        border-radius: 3px;
      }

      /* Touch-friendly tap targets */
      @media (hover: none) and (pointer: coarse) {
        .card,
        .option,
        .nav-tab,
        .btn {
          min-height: 44px;
        }
      }

      /* Prevent text selection on interactive elements */
      .btn,
      .nav-tab,
      .option {
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
        user-select: none;
      }

      /* Safe area insets for notched devices */
      @supports (padding: max(0px)) {
        body {
          padding-left: max(0px, env(safe-area-inset-left));
          padding-right: max(0px, env(safe-area-inset-right));
        }

        .container {
          padding-left: max(20px, env(safe-area-inset-left));
          padding-right: max(20px, env(safe-area-inset-right));
        }
      }

      /* Utility classes */
      .hide-mobile {
        display: block;
      }

      .show-mobile {
        display: none;
      }

      @media (max-width: 768px) {
        .hide-mobile {
          display: none;
        }
        .show-mobile {
          display: block;
        }

        .header:hover {
          transform: none;
        }

        .nav-tab.active {
          transform: none;
        }

        .card:hover::after {
          width: 0;
          height: 0;
        }

        .card:active::after {
          width: 300px;
          height: 300px;
        }
      }

      /* Image responsiveness */
      img {
        max-width: 100%;
        height: auto;
        display: block;
      }

      /* Table responsiveness */
      table {
        width: 100%;
        border-collapse: collapse;
        overflow-x: auto;
        display: block;
      }

      @media (max-width: 768px) {
        table {
          font-size: 0.9rem;
        }
      }

      @media (max-width: 480px) {
        table {
          font-size: 0.85rem;
        }
      }

      .header {
        background: linear-gradient(
          135deg,
          var(--white) 0%,
          var(--bg-cream) 100%
        );
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px var(--shadow-soft);
        text-align: center;
        border: 1px solid var(--border);
        transition: all 0.3s ease;
      }

      .header:hover {
        box-shadow: 0 15px 40px rgba(26, 77, 46, 0.12);
        transform: translateY(-2px);
      }

      .header h1 {
        color: var(--primary);
        font-size: 2rem;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        text-shadow: 0 2px 4px rgba(26, 77, 46, 0.1);
        flex-wrap: wrap; /* ADDED: Prevents text overflow */
        text-align: center; /* ADDED: Centers wrapped text */
      }

      .header-badge {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 8px 20px;
        border-radius: 25px;
        font-size: 0.85rem;
        font-weight: 600;
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.3);
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }
      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      .nav-tabs {
        display: flex;
        gap: 10px;
        background: linear-gradient(
          135deg,
          var(--white) 0%,
          var(--bg-light) 100%
        );
        padding: 10px;
        border-radius: 12px;
        margin-bottom: 20px;
        overflow-x: auto;
        box-shadow: 0 4px 12px var(--shadow-soft);
        border: 1px solid var(--border);
      }

      .nav-tab {
        padding: 12px 24px;
        border: none;
        background: var(--bg-cream);
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        white-space: nowrap;
        transition: all 0.3s ease;
        color: var(--text-dark);
        position: relative;
        overflow: hidden;
      }

      .nav-tab::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          var(--hover-glow),
          transparent
        );
        transition: left 0.5s ease;
      }

      .nav-tab:hover::before {
        left: 100%;
      }

      .nav-tab:hover {
        background: var(--primary);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(26, 77, 46, 0.3);
      }

      .nav-tab.active {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-light)
        );
        color: white;
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.4);
        transform: translateY(-1px);
      }

      .content-section {
        display: none;
        background: linear-gradient(
          135deg,
          var(--white) 0%,
          var(--bg-cream) 100%
        );
        border-radius: 16px;
        padding: 30px;
        box-shadow: 0 10px 30px var(--shadow-soft);
        animation: fadeInSlide 0.4s ease;
        border: 1px solid var(--border);
      }

      .content-section.active {
        display: block;
      }

      @keyframes fadeInSlide {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      @media (max-width: 768px) and (min-width: 481px) {
        /* Tablet: 2 columns */
        .card-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 480px) {
        /* Mobile: 1 column */
        .card-grid {
          grid-template-columns: 1fr;
        }
      }
      @media (max-width: 380px) {
        .score-circle {
          width: 110px;
          height: 110px;
        }

        .score {
          font-size: 2rem;
        }
      }
      .card {
        background: linear-gradient(
          135deg,
          var(--bg-light) 0%,
          var(--white) 100%
        );
        border-radius: 12px;
        padding: 25px;
        border: 2px solid var(--border);
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(
          90deg,
          var(--primary),
          var(--secondary),
          var(--secondary-light)
        );
        transition: height 0.3s ease;
      }

      .card::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: var(--hover-glow);
        transform: translate(-50%, -50%);
        transition:
          width 0.5s ease,
          height 0.5s ease;
      }

      .card:hover::after {
        width: 300px;
        height: 300px;
      }

      .card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 15px 35px rgba(26, 77, 46, 0.2);
        border-color: var(--primary);
      }

      .card:hover::before {
        height: 6px;
      }

      .card:active {
        transform: translateY(-4px) scale(1.01);
      }

      .card h3 {
        color: var(--primary);
        margin-bottom: 12px;
        font-size: 1.2rem;
        position: relative;
        z-index: 1;
        transition: color 0.3s ease;
      }

      .card:hover h3 {
        color: var(--primary-dark);
      }

      .card p {
        color: var(--text-light);
        line-height: 1.6;
        position: relative;
        z-index: 1;
        word-wrap: break-word; /* ADDED: Breaks long words */
        overflow-wrap: break-word; /* ADDED: Modern browsers */
        hyphens: auto; /* ADDED: Hyphenates long text */
      }

      .btn {
        padding: 12px 28px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 1rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: inline-block;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .btn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition:
          width 0.6s ease,
          height 0.6s ease;
      }

      .btn:hover::before {
        width: 300px;
        height: 300px;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-light)
        );
        color: white;
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.3);
      }

      .btn-primary:hover {
        background: linear-gradient(
          135deg,
          var(--primary-dark),
          var(--primary)
        );
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(26, 77, 46, 0.4);
      }
      /* Force hover effects inside modals even on touch devices */
      .modal-content .btn:hover,
      .modal-content .btn:focus {
        transform: translateY(-3px) !important;
        box-shadow: 0 8px 20px rgba(26, 77, 46, 0.4) !important;
      }

      .modal-content .btn-primary:hover,
      .modal-content .btn-primary:focus {
        background: linear-gradient(
          135deg,
          var(--primary-dark),
          var(--primary)
        ) !important;
      }

      .modal-content .btn-success:hover,
      .modal-content .btn-success:focus {
        background: linear-gradient(
          135deg,
          var(--secondary),
          var(--success)
        ) !important;
      }

      .modal-content .btn-secondary:hover,
      .modal-content .btn-secondary:focus {
        background: linear-gradient(
          135deg,
          var(--secondary-light),
          var(--secondary)
        ) !important;
      }
      .btn-primary:active {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.3);
      }

      .btn-success {
        background: linear-gradient(
          135deg,
          var(--success),
          var(--secondary-light)
        );
        color: white;
        box-shadow: 0 4px 12px rgba(45, 106, 79, 0.3);
      }

      .btn-success:hover {
        background: linear-gradient(135deg, var(--secondary), var(--success));
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(45, 106, 79, 0.4);
      }

      .btn-danger {
        background: var(--danger);
        color: white;
        box-shadow: 0 4px 12px rgba(193, 18, 31, 0.3);
      }

      .btn-danger:hover {
        background: #9a0e1a;
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(193, 18, 31, 0.4);
      }
      .btn-secondary {
        background: linear-gradient(
          135deg,
          var(--secondary),
          var(--secondary-light)
        );
        color: white;
        box-shadow: 0 4px 12px rgba(74, 124, 89, 0.3);
      }

      .btn-secondary:hover {
        background: linear-gradient(
          135deg,
          var(--secondary-light),
          var(--secondary)
        );
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(74, 124, 89, 0.4);
      }
      .question-card {
        background: linear-gradient(
          135deg,
          var(--bg-light) 0%,
          var(--bg-cream) 100%
        );
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 20px;
        border-left: 4px solid var(--primary);
        box-shadow: 0 4px 12px var(--shadow-soft);
        transition: all 0.3s ease;
      }

      .question-card:hover {
        box-shadow: 0 6px 16px rgba(26, 77, 46, 0.12);
        transform: translateX(2px);
      }

      .options {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 20px;
      }

      .option {
        padding: 15px 20px;
        background: var(--white);
        border: 2px solid var(--border);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 500;
        position: relative;
        overflow: hidden;
      }

      .option::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 0;
        background: var(--hover-glow);
        transition: width 0.3s ease;
      }

      .option:hover::before {
        width: 100%;
      }

      .option:hover {
        border-color: var(--primary);
        background: var(--bg-light);
        transform: translateX(5px);
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.15);
      }

      .option.selected {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-light)
        );
        color: white;
        border-color: var(--primary);
        transform: translateX(5px);
        box-shadow: 0 4px 16px rgba(26, 77, 46, 0.3);
      }

      .option.selected::before {
        display: none;
      }

      .option.correct {
        background: linear-gradient(
          135deg,
          var(--success),
          var(--secondary-light)
        );
        color: white;
        border-color: var(--success);
        animation: correctPulse 0.5s ease;
      }

      .option.incorrect {
        background: var(--danger);
        color: white;
        border-color: var(--danger);
        animation: shake 0.5s ease;
      }

      @keyframes correctPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.03);
        }
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }

      .explanation {
        margin-top: 20px;
        padding: 20px;
        background: linear-gradient(135deg, #fef8e7 0%, #fdf3d7 100%);
        border-radius: 8px;
        border-left: 4px solid var(--accent);
        box-shadow: 0 4px 12px rgba(212, 175, 55, 0.2);
        animation: fadeInSlide 0.4s ease;
      }

      .progress-bar {
        height: 30px;
        background: var(--bg-light);
        border-radius: 15px;
        overflow: hidden;
        margin: 20px 0;
        position: relative;
        border: 2px solid var(--border);
        box-shadow: inset 0 2px 4px rgba(26, 77, 46, 0.1);
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--primary),
          var(--secondary),
          var(--secondary-light)
        );
        transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        position: relative;
        overflow: hidden;
      }

      .progress-fill::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          left: -100%;
        }
        100% {
          left: 100%;
        }
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .stat-card {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 25px;
        border-radius: 12px;
        text-align: center;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.3);
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 70%
        );
        opacity: 0;
        transition: opacity 0.5s ease;
      }

      .stat-card:hover::before {
        opacity: 1;
      }

      .stat-card:hover {
        transform: translateY(-5px) scale(1.03);
        box-shadow: 0 8px 24px rgba(26, 77, 46, 0.4);
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        margin: 10px 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
      }

      .timer {
        background: linear-gradient(135deg, var(--accent), #c49930);
        color: white;
        padding: 15px 30px;
        border-radius: 12px;
        font-size: 1.5rem;
        font-weight: 700;
        text-align: center;
        margin: 20px 0;
        box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
        border: 2px solid rgba(255, 255, 255, 0.3);
        animation: timerPulse 2s ease-in-out infinite;
      }

      @keyframes timerPulse {
        0%,
        100% {
          box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
        }
        50% {
          box-shadow: 0 4px 20px rgba(212, 175, 55, 0.6);
        }
      }

      .tip-box {
        background: linear-gradient(
          135deg,
          var(--bg-light) 0%,
          var(--bg-cream) 100%
        );
        padding: 20px;
        border-radius: 12px;
        margin: 15px 0;
        border-left: 4px solid var(--primary);
        box-shadow: 0 2px 8px var(--shadow-soft);
        transition: all 0.3s ease;
      }

      .tip-box:hover {
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.15);
        transform: translateX(2px);
      }

      .tip-box strong {
        color: var(--primary);
      }

      .game-container {
        background: var(--bg-light);
        padding: 30px;
        border-radius: 12px;
        text-align: center;
      }
      /* Game Modal Responsive Fixes */
      @media (max-width: 768px) {
        #gameModal .modal-content {
          padding: 25px 15px;
          max-width: 95%;
        }

        /* Game completion screen */
        .score-circle {
          width: 140px !important;
          height: 140px !important;
        }

        .score-circle .score {
          font-size: 2.8rem !important;
        }

        /* Game buttons - stack vertically on mobile */
        #gameModalContent > div > div:last-child {
          flex-direction: column !important;
          gap: 10px !important;
        }

        #gameModalContent .btn {
          width: 100% !important;
          max-width: 280px !important;
          margin: 5px auto !important;
        }
      }

      @media (max-width: 480px) {
        #gameModal .modal-content {
          padding: 20px 12px;
        }

        .score-circle {
          width: 120px !important;
          height: 120px !important;
        }

        .score-circle .score {
          font-size: 2.2rem !important;
        }

        .score-circle .total {
          font-size: 0.9rem !important;
        }

        /* Smaller fonts for mobile */
        #gameModalContent h2 {
          font-size: 1.3rem !important;
        }

        #gameModalContent h3 {
          font-size: 1.1rem !important;
        }

        #gameModalContent p {
          font-size: 0.95rem !important;
        }
      }
      .pattern-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin: 20px auto;
        max-width: 400px;
      }

      /* Add these responsive rules */
      @media (max-width: 480px) {
        .pattern-grid {
          max-width: 100%;
          gap: 10px;
          margin: 15px auto;
        }
      }
      /* Flash Memory Game Responsive Fixes */
      @media (max-width: 768px) {
        /* Symbol grid - 3 columns on tablet */
        #gameModalContent div[style*="grid-template-columns: repeat(4"] {
          grid-template-columns: repeat(3, 1fr) !important;
          gap: 10px !important;
          max-width: 100% !important;
        }

        /* Smaller emoji size on tablet */
        #gameModalContent button[onclick*="selectSymbol"] {
          font-size: 2.2rem !important;
          padding: 15px !important;
          min-height: 70px !important;
        }

        /* Sequence display */
        #sequenceDisplay {
          font-size: 3rem !important;
          padding: 30px !important;
          min-height: 120px !important;
        }

        /* User sequence display */
        #userSequenceDisplay {
          font-size: 1.6rem !important;
          padding: 15px !important;
        }
      }

      @media (max-width: 480px) {
        /* Symbol grid - 2 columns on mobile */
        #gameModalContent div[style*="grid-template-columns: repeat(4"] {
          grid-template-columns: repeat(2, 1fr) !important;
          gap: 8px !important;
          padding: 0 5px !important;
        }

        /* Even smaller emoji on mobile */
        #gameModalContent button[onclick*="selectSymbol"] {
          font-size: 2rem !important;
          padding: 12px !important;
          min-height: 60px !important;
        }

        /* Sequence display mobile */
        #sequenceDisplay {
          font-size: 2.5rem !important;
          padding: 25px !important;
          min-height: 100px !important;
        }

        /* User sequence mobile */
        #userSequenceDisplay {
          font-size: 1.4rem !important;
          padding: 12px !important;
          min-height: 60px !important;
        }

        /* Stack Clear/Submit buttons on mobile */
        #gameModalContent div[style*="flex"] > .btn {
          width: 100% !important;
          max-width: 240px !important;
        }
      }
      .pattern-box {
        aspect-ratio: 1;
        background: var(--white);
        border: 3px solid var(--border);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .pattern-box:hover {
        transform: scale(1.1);
        border-color: var(--primary);
        box-shadow: 0 6px 16px rgba(26, 77, 46, 0.2);
        background: var(--bg-light);
      }

      .pattern-box:active {
        transform: scale(0.95);
      }

      .memory-card {
        aspect-ratio: 1;
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-light)
        );
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: white;
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.3);
      }

      .memory-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(26, 77, 46, 0.4);
      }

      .memory-card.flipped {
        background: var(--white);
        border: 3px solid var(--primary);
        color: var(--primary);
        transform: rotateY(180deg);
      }

      .memory-card.matched {
        background: linear-gradient(
          135deg,
          var(--success),
          var(--secondary-light)
        );
        color: white;
        animation: matchPulse 0.5s ease;
      }

      @keyframes matchPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      .notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: linear-gradient(
          135deg,
          var(--white) 0%,
          var(--bg-cream) 100%
        );
        padding: 20px 30px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(26, 77, 46, 0.3);
        display: none;
        animation: slideInBounce 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        z-index: 1000;
        border-left: 4px solid var(--primary);
        border: 2px solid var(--border);
        max-width: 350px;
      }

      @keyframes slideInBounce {
        0% {
          transform: translateX(400px);
          opacity: 0;
        }
        60% {
          transform: translateX(-20px);
          opacity: 1;
        }
        100% {
          transform: translateX(0);
        }
      }
      @media (max-width: 768px) {
        .modal {
          padding: 10px;
        }

        .modal-content {
          padding: 30px 20px;
          max-height: 90vh;
          width: 95%;
        }

        #practiceModal .modal-content {
          max-width: 100%;
        }

        .modal-content button[onclick*="close"] {
          top: 10px;
          right: 10px;
          width: 35px;
          height: 35px;
          font-size: 1.3rem;
        }
      }

      @media (max-width: 480px) {
        .modal-content {
          padding: 25px 15px;
          border-radius: 12px;
        }
      }
      /* ===== ENHANCED MODAL SYSTEM ===== */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(26, 77, 46, 0.9);
        backdrop-filter: blur(8px);
        z-index: 2000;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.3s ease;
        overflow-y: auto;
        padding: 20px;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: linear-gradient(
          135deg,
          var(--white) 0%,
          var(--bg-cream) 100%
        );
        padding: 40px;
        border-radius: 20px;
        max-width: 900px;
        width: 95%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
        border: 2px solid var(--border);
        animation: modalSlideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        position: relative;
        margin: auto;
      }

      /* Modal close button */
      .modal-close-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, var(--danger), #9a0e1a);
        color: white;
        border: none;
        width: 44px;
        height: 44px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.8rem;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 12px rgba(193, 18, 31, 0.3);
        line-height: 1;
        font-weight: 300;
      }

      .modal-close-btn:hover {
        background: linear-gradient(135deg, #9a0e1a, #7a0b15);
        transform: rotate(90deg) scale(1.1);
        box-shadow: 0 6px 20px rgba(193, 18, 31, 0.5);
      }

      .modal-close-btn:active {
        transform: rotate(90deg) scale(0.95);
      }

      /* Modal header styles */
      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 2px solid var(--border);
      }

      .modal-title {
        color: var(--primary);
        font-size: 1.8rem;
        font-weight: 700;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .modal-body {
        position: relative;
        z-index: 1;
      }

      /* Smooth scrollbar for modal */
      .modal-content::-webkit-scrollbar {
        width: 10px;
      }

      .modal-content::-webkit-scrollbar-track {
        background: var(--bg-light);
        border-radius: 5px;
      }

      .modal-content::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border-radius: 5px;
      }

      .modal-content::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(
          135deg,
          var(--primary-dark),
          var(--primary)
        );
      }

      /* Animation keyframes */
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      @keyframes modalSlideIn {
        0% {
          transform: scale(0.8) translateY(-60px);
          opacity: 0;
        }
        100% {
          transform: scale(1) translateY(0);
          opacity: 1;
        }
      }

      @keyframes modalSlideOut {
        0% {
          transform: scale(1) translateY(0);
          opacity: 1;
        }
        100% {
          transform: scale(0.8) translateY(-60px);
          opacity: 0;
        }
      }

      /* Responsive Modal Styles */
      @media (max-width: 768px) {
        .modal {
          padding: 10px;
        }

        .modal-content {
          padding: 30px 20px;
          max-height: 92vh;
          width: 98%;
          border-radius: 16px;
        }

        .modal-close-btn {
          top: 12px;
          right: 12px;
          width: 38px;
          height: 38px;
          font-size: 1.5rem;
        }

        .modal-title {
          font-size: 1.4rem;
          padding-right: 50px;
        }

        .modal-header {
          margin-bottom: 20px;
          padding-bottom: 15px;
        }
      }

      @media (max-width: 480px) {
        .modal-content {
          padding: 25px 15px;
          border-radius: 12px;
        }

        .modal-close-btn {
          width: 36px;
          height: 36px;
          font-size: 1.3rem;
        }

        .modal-title {
          font-size: 1.2rem;
        }
      }
      .topic-list {
        list-style: none;
      }

      .topic-item {
        padding: 15px;
        background: var(--bg-light);
        margin: 10px 0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid var(--border); /* ✅ General border first */
        border-left: 4px solid var(--primary); /* ✅ Then specific override */
      }

      .topic-item:hover {
        background: linear-gradient(
          135deg,
          var(--bg-light) 0%,
          var(--bg-cream) 100%
        );
        transform: translateX(5px);
        border-left-color: var(--secondary);
        box-shadow: 0 4px 12px var(--shadow-soft);
      }

      .lesson-content {
        line-height: 1.8;
        color: var(--text-dark);
      }

      .lesson-content h3 {
        color: var(--primary);
        margin: 20px 0 10px;
      }

      .lesson-content ul {
        margin-left: 20px;
        margin-bottom: 15px;
      }

      .lesson-content li {
        margin: 8px 0;
      }

      .score-summary {
        text-align: center;
        padding: 30px;
      }

      .score-circle {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--secondary),
          var(--secondary-light)
        );
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        margin: 30px auto;
        box-shadow: 0 10px 30px rgba(26, 77, 46, 0.3);
        position: relative;
        animation: scoreAppear 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        border: 4px solid rgba(255, 255, 255, 0.3);
      }

      .score-circle::before {
        content: "";
        position: absolute;
        inset: -5px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--accent),
          var(--secondary-light)
        );
        z-index: -1;
        opacity: 0.3;
        animation: rotateBorder 3s linear infinite;
      }

      @keyframes scoreAppear {
        0% {
          transform: scale(0) rotate(-180deg);
          opacity: 0;
        }
        100% {
          transform: scale(1) rotate(0deg);
          opacity: 1;
        }
      }

      @keyframes rotateBorder {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .score-circle .score {
        font-size: 4rem;
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .score-circle .total {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 1.5rem;
          flex-direction: column;
        }

        .nav-tabs {
          flex-wrap: nowrap;
          overflow-x: auto;
        }

        .card-grid {
          grid-template-columns: 1fr;
        }

        .container {
          padding: 10px;
        }

        .content-section {
          padding: 20px;
        }
      }

      .offline-indicator {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 10px 20px;
        background: var(--accent);
        color: white;
        border-radius: 8px;
        font-weight: 600;
        display: none;
        z-index: 1000;
      }

      .chart-container {
        margin: 30px 0;
        padding: 20px;
        background: var(--bg-light);
        border-radius: 12px;
      }

      .weak-area {
        background: #fee2e2;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border-left: 4px solid var(--danger);
      }

      .strong-area {
        background: #dcfce7;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border-left: 4px solid var(--success);
      }
      .strict-mode-container {
        background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 20px;
        border: 2px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      @media (max-width: 600px) {
        .strict-mode-container {
          flex-direction: column;
          align-items: flex-start;
          gap: 20px;
        }

        .strict-mode-container > div {
          width: 100%;
        }

        .strict-mode-container label {
          align-self: flex-end;
        }
      }

      /* =============================================
   FLASHCARD DRILL - MODERN DESIGN
   ============================================= */

      #flashcards {
        padding: 30px;
      }

      /* Section Header */
      .fc-header {
        display: flex;
        align-items: center;
        gap: 14px;
        margin-bottom: 10px;
      }

      .fc-header h2 {
        color: var(--primary);
        margin: 0;
        font-size: 1.8rem;
      }

      .fc-subtitle {
        color: var(--text-light);
        margin-bottom: 28px;
        font-size: 0.98rem;
      }

      /* Progress Area */
      .fc-progress-wrapper {
        background: white;
        border-radius: 12px;
        padding: 16px 20px;
        margin-bottom: 22px;
        border: 1px solid var(--border);
        box-shadow: 0 2px 8px var(--shadow-soft);
      }

      .fc-progress-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        flex-wrap: wrap;
        gap: 8px;
      }

      .fc-progress-label {
        font-weight: 700;
        color: var(--primary);
        font-size: 0.95rem;
      }

      .fc-progress-count {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-light)
        );
        color: white;
        padding: 4px 14px;
        border-radius: 20px;
        font-size: 0.82rem;
        font-weight: 600;
      }

      .fc-progress-bar-track {
        background: var(--bg-light);
        border-radius: 10px;
        height: 10px;
        overflow: hidden;
        border: 1px solid var(--border);
      }

      .fc-progress-bar-fill {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--primary),
          var(--secondary),
          var(--secondary-light)
        );
        border-radius: 10px;
        transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .fc-progress-bar-fill::after {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.4),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      /* Card Counter Badge */
      .fc-counter {
        text-align: center;
        margin-bottom: 18px;
      }

      .fc-counter-badge {
        display: inline-block;
        background: var(--bg-light);
        border: 1px solid var(--border);
        color: var(--text-light);
        padding: 5px 18px;
        border-radius: 20px;
        font-size: 0.88rem;
        font-weight: 600;
      }

      /* ---- 3D FLIP CARD ---- */
      .fc-card-wrapper {
        perspective: 1200px;
        width: 100%;
        max-width: 680px;
        margin: 0 auto 28px auto;
        cursor: pointer;
      }

      .fc-card-inner {
        position: relative;
        width: 100%;
        min-height: 240px;
        transform-style: preserve-3d;
        transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 20px;
      }

      .fc-card-wrapper:hover .fc-card-inner:not(.is-flipped) {
        transform: translateY(-6px) rotateX(2deg);
        filter: drop-shadow(0 16px 32px rgba(26, 77, 46, 0.22));
      }

      .fc-card-inner.is-flipped {
        transform: rotateY(180deg);
      }

      .fc-card-wrapper:hover .fc-card-inner.is-flipped {
        transform: rotateY(180deg) translateY(-6px);
        filter: drop-shadow(0 16px 32px rgba(74, 124, 89, 0.22));
      }

      /* Front and Back share the same base */
      .fc-card-front,
      .fc-card-back {
        position: absolute;
        width: 100%;
        min-height: 240px;
        border-radius: 20px;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 50px 40px;
        box-shadow: 0 8px 28px rgba(26, 77, 46, 0.18);
        text-align: center;
      }

      /* Front face — word side */
      .fc-card-front {
        background: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--primary-light) 100%
        );
        color: white;
      }

      /* Back face — meaning side */
      .fc-card-back {
        background: linear-gradient(
          135deg,
          var(--secondary) 0%,
          var(--secondary-light) 100%
        );
        color: white;
        transform: rotateY(180deg);
      }

      .fc-side-label {
        font-size: 0.75rem;
        font-weight: 700;
        letter-spacing: 2.5px;
        text-transform: uppercase;
        opacity: 0.7;
        margin-bottom: 14px;
      }

      .fc-word-text {
        font-size: 2.2rem;
        font-weight: 800;
        margin: 0 0 12px 0;
        line-height: 1.2;
        text-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      }

      .fc-meaning-text {
        font-size: 1.08rem;
        line-height: 1.75;
        opacity: 0.97;
        max-width: 500px;
      }

      .fc-flip-hint {
        font-size: 0.78rem;
        opacity: 0.55;
        margin-top: 18px;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      /* Controls */
      .fc-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 24px;
      }

      .fc-btn {
        padding: 11px 24px;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        font-weight: 700;
        font-size: 0.92rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: inline-flex;
        align-items: center;
        gap: 6px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        -webkit-tap-highlight-color: transparent;
        user-select: none;
      }

      .fc-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 7px 18px rgba(0, 0, 0, 0.15);
      }

      .fc-btn:active {
        transform: translateY(-1px);
      }

      .fc-btn-prev,
      .fc-btn-next {
        background: white;
        color: var(--primary);
        border: 2px solid var(--border);
      }

      .fc-btn-prev:hover,
      .fc-btn-next:hover {
        background: var(--bg-light);
        border-color: var(--primary);
      }

      .fc-btn-flip {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-light)
        );
        color: white;
      }

      .fc-btn-shuffle {
        background: linear-gradient(
          135deg,
          var(--secondary),
          var(--secondary-light)
        );
        color: white;
      }

      .fc-btn-reset {
        background: linear-gradient(135deg, var(--danger), #9a0e1a);
        color: white;
      }

      /* Tip box inside flashcards */
      .fc-tip {
        background: linear-gradient(135deg, var(--bg-light), var(--bg-cream));
        border-left: 4px solid var(--primary);
        border-radius: 10px;
        padding: 16px 20px;
        font-size: 0.93rem;
        color: var(--text-dark);
        max-width: 680px;
        margin: 0 auto;
        line-height: 1.65;
      }

      /* Responsive - Tablet */
      @media (max-width: 768px) {
        .fc-card-front,
        .fc-card-back {
          padding: 40px 28px;
          min-height: 210px;
        }

        .fc-word-text {
          font-size: 1.8rem;
        }

        .fc-meaning-text {
          font-size: 1rem;
        }

        .fc-btn {
          padding: 10px 18px;
          font-size: 0.88rem;
        }
      }

      /* Responsive - Mobile */
      @media (max-width: 480px) {
        #flashcards {
          padding: 15px;
        }

        .fc-header h2 {
          font-size: 1.3rem;
        }

        .fc-card-front,
        .fc-card-back {
          padding: 35px 20px;
          min-height: 200px;
        }

        .fc-word-text {
          font-size: 1.5rem;
        }

        .fc-meaning-text {
          font-size: 0.95rem;
        }

        .fc-controls {
          gap: 8px;
        }

        .fc-btn {
          padding: 10px 14px;
          font-size: 0.85rem;
          border-radius: 40px;
        }

        .fc-card-wrapper {
          margin-bottom: 20px;
        }
      }
      /* =============================================
   COLOR VISION TEST
   ============================================= */
      .cvt-plate {
        background: white;
        border-radius: 16px;
        padding: 20px;
        border: 2px solid var(--border);
        text-align: center;
        box-shadow: 0 4px 12px var(--shadow-soft);
        transition: all 0.3s ease;
      }

      .cvt-plate:hover {
        border-color: var(--primary);
        box-shadow: 0 6px 18px rgba(26, 77, 46, 0.15);
      }

      .cvt-canvas {
        border-radius: 50%;
        display: block;
        margin: 0 auto 15px auto;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .cvt-input {
        width: 80px;
        padding: 10px;
        font-size: 1.4rem;
        font-weight: 700;
        text-align: center;
        border: 2px solid var(--border);
        border-radius: 8px;
        color: var(--primary);
        transition: border-color 0.3s;
      }

      .cvt-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(26, 77, 46, 0.15);
      }

      .cvt-plate-label {
        font-size: 0.85rem;
        color: var(--text-light);
        margin-bottom: 10px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      @media (max-width: 480px) {
        #cvtPlates {
          grid-template-columns: repeat(2, 1fr) !important;
          gap: 15px !important;
        }
        .cvt-img {
          width: 120px !important;
          height: 120px !important;
        }
      }
      /* Footer Styles */
      .footer {
        background: linear-gradient(
          135deg,
          var(--primary-dark),
          var(--primary)
        );
        color: var(--white);
        padding: 30px 20px;
        text-align: center;
        margin-top: 50px;
        box-shadow: 0 -4px 20px rgba(26, 77, 46, 0.2);
        position: relative;
      }

      .footer::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(
          90deg,
          var(--accent),
          var(--secondary-light),
          var(--accent)
        );
      }

      .footer-content {
        max-width: 1200px;
        margin: 0 auto;
      }

      .footer-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        color: var(--white);
      }

      .footer-credits {
        font-size: 1rem;
        margin: 15px 0;
        opacity: 0.95;
      }

      .footer-credits a {
        color: var(--accent);
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .footer-credits a:hover {
        color: var(--secondary-light);
        text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
      }

      .footer-motto {
        font-size: 0.95rem;
        font-style: italic;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
        opacity: 0.9;
      }

      .footer-year {
        font-size: 0.85rem;
        margin-top: 10px;
        opacity: 0.8;
      }

      .footer-divider {
        width: 60px;
        height: 3px;
        background: var(--accent);
        margin: 15px auto;
        border-radius: 2px;
      }
    </style>
  </head>
  <body>
    <div class="offline-indicator" id="offlineIndicator">📡 Offline Mode</div>

    <div class="container">
      <div class="header">
        <h1>
          🎖️ AFP Exam Reviewer 2026
          <span class="header-badge">AFPSAT & Neuro-Psych</span>
        </h1>
        <p style="color: var(--text-light); margin-top: 10px">
          Your Complete Guide to Passing the Armed Forces of the Philippines
          Examinations
        </p>
      </div>

      <div class="nav-tabs">
        <button
          class="nav-tab active"
          onclick="showSection('dashboard', event)"
        >
          📊 Dashboard
        </button>
        <button class="nav-tab" onclick="showSection('tutorials', event)">
          📚 Tutorials
        </button>
        <button class="nav-tab" onclick="showSection('practice', event)">
          ✍️ Practice
        </button>
        <button class="nav-tab" onclick="showSection('mockExam', event)">
          ⏱️ Mock Exams
        </button>
        <button class="nav-tab" onclick="showSection('stats', event)">
          📈 Performance
        </button>
        <button class="nav-tab" onclick="showSection('tips', event)">
          💡 Tips
        </button>
        <button class="nav-tab" onclick="showSection('games', event)">
          🎮 Games
        </button>
        <button class="nav-tab" onclick="showSection('resources', event)">
          📚 Resources
        </button>
        <button class="nav-tab" onclick="showSection('flashcards', event)">
          🃏 Flashcards
        </button>
        <button class="nav-tab" onclick="showSection('medicalTest', event)">
          👁️ Medical Test
        </button>
        <button class="nav-tab" onclick="showSection('checklist', event)">
          ✅ AFP Checklist
        </button>
        <button class="nav-tab" onclick="showSection('studyPlan', event)">
          📅 Study Plan
        </button>
      </div>

      <!-- Dashboard Section -->
      <div id="dashboard" class="content-section active">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          Welcome to Your Study Dashboard
        </h2>

        <!-- Strict Exam Mode Toggle -->
        <div class="strict-mode-container">
          <div style="flex: 1; min-width: 250px">
            <h3
              style="
                color: var(--primary);
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                gap: 10px;
                flex-wrap: wrap;
              "
            >
              ⚔️ Strict Exam Mode
              <span
                id="strictModeBadge"
                style="
                  font-size: 0.7rem;
                  padding: 4px 12px;
                  border-radius: 12px;
                  background: var(--danger);
                  color: white;
                  font-weight: 600;
                "
                >OFF</span
              >
            </h3>
            <p style="color: var(--text-light); font-size: 0.95rem; margin: 0">
              <strong>No feedback during exams.</strong> Answers revealed only
              at the end. Simulates real AFPSAT conditions.
            </p>
          </div>
          <label style="display: flex; align-items: center; cursor: pointer">
            <input
              type="checkbox"
              id="strictModeToggle"
              onchange="toggleStrictMode(this.checked)"
              style="width: 50px; height: 26px; cursor: pointer"
            />
          </label>
        </div>

        <!-- Passing Probability Card -->
        <div
          id="passingProbability"
          style="
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid var(--border);
          "
        ></div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Questions Completed</div>
            <div class="stat-value" id="totalQuestions">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Average Score</div>
            <div class="stat-value" id="avgScore">0%</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Study Streak</div>
            <div class="stat-value" id="studyStreak">0</div>
            <div class="stat-label">days</div>
          </div>
        </div>
        <!-- RESET PROGRESS CARD -->
        <div
          style="
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            border-radius: 12px;
            border: 2px solid #f87171;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
          "
        >
          <div>
            <h3 style="color: var(--danger); margin-bottom: 6px">
              🗑️ Reset All Progress
            </h3>
            <p style="color: #7f1d1d; font-size: 0.95rem; margin: 0">
              Clear all scores, streaks, and statistics. This cannot be undone.
            </p>
          </div>
          <button class="btn btn-danger" onclick="confirmResetProgress()">
            Reset Progress
          </button>
        </div>
        <div class="card-grid">
          <div class="card" onclick="showSection('tutorials')">
            <h3>📚 Start Learning</h3>
            <p>
              Begin with comprehensive tutorials covering all AFPSAT and
              Neuro-Psych topics
            </p>
          </div>
          <div class="card" onclick="showSection('practice')">
            <h3>✍️ Practice Questions</h3>
            <p>
              Test your knowledge with practice questions and instant feedback
            </p>
          </div>
          <div class="card" onclick="showSection('mockExam')">
            <h3>⏱️ Take Mock Exam</h3>
            <p>Simulate real exam conditions with timed mock tests</p>
          </div>
          <div class="card" onclick="showSection('games')">
            <h3>🎮 Brain Games</h3>
            <p>Sharpen your logic and memory with interactive exercises</p>
          </div>
        </div>

        <div class="tip-box" style="margin-top: 30px">
          <strong>📅 Daily Study Reminder:</strong> Consistency is key! Set
          aside 30-60 minutes daily for focused study. The AFPSAT requires raw
          score of 71 or higher to qualify.
        </div>
      </div>

      <!-- Tutorials Section -->
      <div id="tutorials" class="content-section">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          📚 Tutorial Topics
        </h2>

        <div class="card-grid">
          <div class="card" onclick="showTutorial('afpsatVerbal')">
            <h3>Verbal Ability</h3>
            <p>
              Grammar, vocabulary, reading comprehension - 65 items, 30 minutes
            </p>
          </div>
          <div class="card" onclick="showTutorial('afpsatNumerical')">
            <h3>Numerical Ability</h3>
            <p>Math, algebra, word problems - 35 items, 35 minutes</p>
          </div>
          <div class="card" onclick="showTutorial('afpsatAbstract')">
            <h3>Abstract Reasoning</h3>
            <p>Patterns, sequences, logic - 50 items, 12 minutes</p>
          </div>
          <div class="card" onclick="showTutorial('neuroPsychPersonality')">
            <h3>Personality Assessment</h3>
            <p>Behavior, attitude, emotional stability evaluation</p>
          </div>
          <div class="card" onclick="showTutorial('neuroPsychLogic')">
            <h3>Logical Thinking</h3>
            <p>Decision making and critical thinking skills</p>
          </div>
          <div class="card" onclick="showTutorial('neuroPsychStress')">
            <h3>Stress Tolerance</h3>
            <p>Emotional control and pressure management</p>
          </div>
        </div>
      </div>

      <!-- Practice Section -->
      <div id="practice" class="content-section">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          ✍️ Practice Questions
        </h2>

        <div class="card-grid">
          <div class="card" onclick="startPractice('afpsatVerbal')">
            <h3>AFPSAT: Verbal Practice</h3>
            <p>15 practice questions with explanations</p>
          </div>
          <div class="card" onclick="startPractice('afpsatNumerical')">
            <h3>AFPSAT: Numerical Practice</h3>
            <p>15 practice questions with solutions</p>
          </div>
          <div class="card" onclick="startPractice('afpsatAbstract')">
            <h3>AFPSAT: Abstract Practice</h3>
            <p>15 pattern recognition questions</p>
          </div>
          <div class="card" onclick="startPractice('neuroPsych')">
            <h3>Neuro-Psych Practice</h3>
            <p>Situational and personality assessment questions</p>
          </div>
        </div>

        <div
          id="practiceQuestions"
          style="margin-top: 30px"
          display="none"
        ></div>
      </div>

      <!-- Mock Exam Section -->
      <div id="mockExam" class="content-section">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          ⏱️ Mock Examinations
        </h2>

        <div class="card-grid">
          <div class="card" onclick="startMockExam('afpsat')">
            <h3>AFPSAT Full Mock Exam</h3>
            <p>150 items - Timed simulation of actual exam</p>
            <p style="color: var(--accent); font-weight: 600; margin-top: 10px">
              77 minutes total
            </p>
          </div>
          <div class="card" onclick="startMockExam('neuroPsych')">
            <h3>Neuro-Psych Simulation</h3>
            <p>Comprehensive psychological assessment simulation</p>
            <p style="color: var(--accent); font-weight: 600; margin-top: 10px">
              60 minutes
            </p>
          </div>
        </div>

        <div id="mockExamContent" style="display: none"></div>
      </div>

      <!-- Stats Section -->
      <div id="stats" class="content-section">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          📈 Performance Statistics
        </h2>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">AFPSAT Practice Score</div>
            <div class="stat-value" id="afpsatAvg">0%</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Neuro-Psych Score</div>
            <div class="stat-value" id="neuroPsychAvg">0%</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Mock Exams Taken</div>
            <div class="stat-value" id="mocksTaken">0</div>
          </div>
        </div>

        <div class="chart-container">
          <h3 style="color: var(--primary); margin-bottom: 15px">
            Progress Over Time
          </h3>
          <div id="progressChart"></div>
        </div>

        <!-- ADD THIS NEW SECTION -->
        <div id="verbalAnalysis" style="margin: 30px 0">
          <h3 style="color: var(--primary); margin: 30px 0 15px">
            📖 Verbal Ability Deep Dive
          </h3>

          <div
            style="
              background: linear-gradient(
                135deg,
                var(--bg-light) 0%,
                var(--bg-cream) 100%
              );
              padding: 25px;
              border-radius: 16px;
              border: 2px solid var(--border);
            "
          >
            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
              "
            >
              <div
                style="
                  background: white;
                  padding: 20px;
                  border-radius: 12px;
                  border-left: 4px solid var(--primary);
                "
              >
                <h4
                  style="
                    color: var(--primary);
                    margin-bottom: 10px;
                    font-size: 0.95rem;
                  "
                >
                  Word Analogies
                </h4>
                <div
                  id="analogiesPerf"
                  style="
                    font-size: 1.8rem;
                    font-weight: 700;
                    color: var(--primary);
                    margin: 10px 0;
                  "
                >
                  0%
                </div>
                <div class="progress-bar" style="height: 8px; margin-top: 10px">
                  <div
                    id="analogiesBar"
                    class="progress-fill"
                    style="width: 0%"
                  ></div>
                </div>
                <p
                  id="analogiesText"
                  style="
                    margin-top: 8px;
                    font-size: 0.85rem;
                    color: var(--text-light);
                  "
                >
                  No attempts yet
                </p>
              </div>

              <div
                style="
                  background: white;
                  padding: 20px;
                  border-radius: 12px;
                  border-left: 4px solid var(--secondary);
                "
              >
                <h4
                  style="
                    color: var(--secondary);
                    margin-bottom: 10px;
                    font-size: 0.95rem;
                  "
                >
                  Vocabulary
                </h4>
                <div
                  id="vocabPerf"
                  style="
                    font-size: 1.8rem;
                    font-weight: 700;
                    color: var(--secondary);
                    margin: 10px 0;
                  "
                >
                  0%
                </div>
                <div class="progress-bar" style="height: 8px; margin-top: 10px">
                  <div
                    id="vocabBar"
                    class="progress-fill"
                    style="width: 0%; background: var(--secondary)"
                  ></div>
                </div>
                <p
                  id="vocabText"
                  style="
                    margin-top: 8px;
                    font-size: 0.85rem;
                    color: var(--text-light);
                  "
                >
                  No attempts yet
                </p>
              </div>

              <div
                style="
                  background: white;
                  padding: 20px;
                  border-radius: 12px;
                  border-left: 4px solid var(--secondary-light);
                "
              >
                <h4
                  style="
                    color: var(--secondary-light);
                    margin-bottom: 10px;
                    font-size: 0.95rem;
                  "
                >
                  Reading Comprehension
                </h4>
                <div
                  id="comprehensionPerf"
                  style="
                    font-size: 1.8rem;
                    font-weight: 700;
                    color: var(--secondary-light);
                    margin: 10px 0;
                  "
                >
                  0%
                </div>
                <div class="progress-bar" style="height: 8px; margin-top: 10px">
                  <div
                    id="comprehensionBar"
                    class="progress-fill"
                    style="width: 0%; background: var(--secondary-light)"
                  ></div>
                </div>
                <p
                  id="comprehensionText"
                  style="
                    margin-top: 8px;
                    font-size: 0.85rem;
                    color: var(--text-light);
                  "
                >
                  No attempts yet
                </p>
              </div>

              <div
                style="
                  background: white;
                  padding: 20px;
                  border-radius: 12px;
                  border-left: 4px solid var(--accent);
                "
              >
                <h4
                  style="
                    color: var(--accent);
                    margin-bottom: 10px;
                    font-size: 0.95rem;
                  "
                >
                  Grammar
                </h4>
                <div
                  id="grammarPerf"
                  style="
                    font-size: 1.8rem;
                    font-weight: 700;
                    color: var(--accent);
                    margin: 10px 0;
                  "
                >
                  0%
                </div>
                <div class="progress-bar" style="height: 8px; margin-top: 10px">
                  <div
                    id="grammarBar"
                    class="progress-fill"
                    style="width: 0%; background: var(--accent)"
                  ></div>
                </div>
                <p
                  id="grammarText"
                  style="
                    margin-top: 8px;
                    font-size: 0.85rem;
                    color: var(--text-light);
                  "
                >
                  No attempts yet
                </p>
              </div>
            </div>

            <div
              id="verbalRecommendation"
              style="
                margin-top: 20px;
                padding: 15px;
                background: #fef3c7;
                border-radius: 8px;
                border-left: 4px solid var(--accent);
              "
            >
              <strong>💡 Recommendation:</strong>
              <span id="verbalRecText"
                >Complete verbal practice to get personalized
                recommendations</span
              >
            </div>
          </div>
        </div>

        <h3 style="color: var(--primary); margin: 30px 0 15px">
          Areas for Improvement
        </h3>
        <div id="weakAreas"></div>

        <h3 style="color: var(--primary); margin: 30px 0 15px">Strong Areas</h3>
        <div id="strongAreas"></div>
      </div>

      <!-- Tips Section -->
      <div id="tips" class="content-section">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          💡 Exam Tips & Strategies
        </h2>

        <h3 style="color: var(--secondary); margin: 25px 0 15px">
          AFPSAT Exam Tips (10 Essential Strategies)
        </h3>
        <div class="tip-box">
          <strong>1. Master Time Management:</strong> You have limited time per
          question (1.5 minutes avg). Practice answering quickly but accurately.
          For Abstract Reasoning, you only have 14.4 seconds per item!
        </div>
        <div class="tip-box">
          <strong>2. Read Questions Carefully:</strong> Don't rush through
          questions. Misreading is a common mistake that costs points.
        </div>
        <div class="tip-box">
          <strong>3. Answer Easy Questions First:</strong> Skip difficult
          questions and return to them later. Secure easy points first.
        </div>
        <div class="tip-box">
          <strong>4. Process of Elimination:</strong> If unsure, eliminate
          obviously wrong answers to increase your chances.
        </div>
        <div class="tip-box">
          <strong>5. Strengthen Vocabulary:</strong> Study common Filipino and
          English words, synonyms, antonyms, and analogies.
        </div>
        <div class="tip-box">
          <strong>6. Practice Mental Math:</strong> Calculator isn't allowed.
          Practice basic operations, percentages, and fractions mentally.
        </div>
        <div class="tip-box">
          <strong>7. Recognize Patterns Quickly:</strong> For Abstract
          Reasoning, train your eyes to spot patterns in shapes, rotations, and
          sequences.
        </div>
        <div class="tip-box">
          <strong>8. Review Grammar Rules:</strong> Subject-verb agreement,
          tenses, and sentence structure are frequently tested.
        </div>
        <div class="tip-box">
          <strong>9. Don't Leave Blanks:</strong> There's no penalty for wrong
          answers. Make educated guesses if needed.
        </div>
        <div class="tip-box">
          <strong>10. Sleep Well Before Exam:</strong> Mental sharpness is
          crucial. Get 7-8 hours of sleep the night before.
        </div>
        <h3 style="color: var(--secondary); margin: 40px 0 15px">
          📖 AFPSAT Verbal Ability - Pro Strategies
        </h3>

        <div
          class="tip-box"
          style="
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            border-left-color: var(--primary);
          "
        >
          <strong>🎯 Golden Rule:</strong> "For Verbal, SPEED + ACCURACY =
          Success. You have 27.7 seconds per question — practice until it
          becomes automatic!"
        </div>

        <div class="tip-box">
          <strong>1. Word Analogies - Identify the Relationship FIRST:</strong>
          <ul style="margin: 10px 0 0 20px; line-height: 1.8">
            <li>
              <strong>Types to memorize:</strong> Synonyms, Antonyms,
              Part-to-Whole, Cause-Effect, Function, Location
            </li>
            <li>
              <strong>Example:</strong> DOCTOR : HOSPITAL → "person to
              workplace" → TEACHER : SCHOOL
            </li>
            <li>
              <strong>Common trap:</strong> Don't just pick words that "sound
              related" - the RELATIONSHIP must match exactly
            </li>
            <li>
              <strong>Speed tip:</strong> Eliminate 2 obviously wrong answers
              first, then choose from remaining 2
            </li>
          </ul>
        </div>

        <div class="tip-box">
          <strong>2. Vocabulary - Build Your Word Bank Daily:</strong>
          <ul style="margin: 10px 0 0 20px; line-height: 1.8">
            <li>
              <strong>Learn 10 new words every day</strong> (both English and
              Filipino)
            </li>
            <li>
              <strong>Focus on military/government terms:</strong> discipline,
              hierarchy, protocol, allegiance, resilience
            </li>
            <li>
              <strong>Use context clues:</strong> Read the sentence carefully -
              surrounding words often hint at meaning
            </li>
            <li>
              <strong>Synonyms practice:</strong> For every new word, learn 2-3
              synonyms and 1-2 antonyms
            </li>
            <li>
              <strong>💡 Pro Tip:</strong> "If you don't know a word, use
              process of elimination. Wrong answers are usually too extreme or
              unrelated."
            </li>
          </ul>
        </div>

        <div class="tip-box">
          <strong>3. Reading Comprehension - The "3-Step Attack":</strong>
          <ul style="margin: 10px 0 0 20px; line-height: 1.8">
            <li>
              <strong>Step 1 - Read the QUESTION first</strong> (before the
              passage) to know what to look for
            </li>
            <li>
              <strong>Step 2 - Skim the passage</strong> for keywords related to
              the question (don't read every word)
            </li>
            <li>
              <strong>Step 3 - Eliminate obviously wrong answers</strong> before
              choosing
            </li>
            <li>
              <strong>Main idea questions:</strong> Answer is usually in the
              FIRST or LAST sentence
            </li>
            <li>
              <strong>Inference questions:</strong> Choose the answer that's
              implied but NOT directly stated
            </li>
            <li>
              <strong>Detail questions:</strong> Go back and find the EXACT
              sentence that answers it
            </li>
          </ul>
        </div>

        <div class="tip-box">
          <strong>4. Grammar & Sentence Construction:</strong>
          <ul style="margin: 10px 0 0 20px; line-height: 1.8">
            <li>
              <strong>Subject-Verb Agreement:</strong> Singular subjects =
              singular verbs (The soldier IS, The soldiers ARE)
            </li>
            <li>
              <strong>Common errors to watch:</strong> Wrong tense, incorrect
              prepositions, misplaced modifiers
            </li>
            <li>
              <strong>Read it aloud mentally:</strong> Does it "sound right"?
              Trust your ear for obvious errors
            </li>
            <li>
              <strong>💡 Pro Tip:</strong> "Cover the answer choices first, try
              to spot the error yourself, THEN look at options"
            </li>
          </ul>
        </div>

        <div class="tip-box">
          <strong>5. Time Management for Verbal Section:</strong>
          <ul style="margin: 10px 0 0 20px; line-height: 1.8">
            <li>
              <strong>65 questions in 30 minutes</strong> = ~27 seconds per
              question
            </li>
            <li>
              <strong>Strategy:</strong> Spend 15 seconds reading, 10 seconds
              answering, 2 seconds marking
            </li>
            <li>
              <strong>If stuck beyond 30 seconds:</strong> Make your best guess,
              mark it, and move on
            </li>
            <li>
              <strong>Save 3-5 minutes</strong> at the end to review marked
              questions
            </li>
            <li>
              <strong>💡 Pro Tip:</strong> "Easy questions are worth the same
              points as hard ones - grab the easy points first!"
            </li>
          </ul>
        </div>

        <div
          class="tip-box"
          style="
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left-color: var(--accent);
          "
        >
          <strong>⚡ Final Verbal Speed Hacks:</strong>
          <ul style="margin: 10px 0 0 20px; line-height: 1.8">
            <li>
              Practice reading Filipino newspapers/articles daily to improve
              comprehension speed
            </li>
            <li>
              Make flashcards for word analogies you get wrong - review daily
            </li>
            <li>Never leave blanks - always guess if time is running out</li>
            <li>
              <strong>💡 Pro Tip:</strong> "For comprehension, if 2 answers seem
              correct, pick the MORE SPECIFIC one"
            </li>
          </ul>
        </div>
        <h3 style="color: var(--secondary); margin: 40px 0 15px">
          Neuro-Psychological Exam Tips (10 Key Guidelines)
        </h3>
        <div class="tip-box">
          <strong>1. Answer Honestly and Consistently:</strong> The test is
          designed to detect inconsistencies. Don't try to game the system.
        </div>
        <div class="tip-box">
          <strong>2. Don't Overthink Personality Questions:</strong> Your first
          instinct is usually right. Overthinking leads to inconsistent answers.
        </div>
        <div class="tip-box">
          <strong>3. Stay Calm During Situational Tests:</strong> Read scenarios
          carefully and think about what a good soldier would do.
        </div>
        <div class="tip-box">
          <strong>4. Read Scenarios Thoroughly:</strong> Don't rush. Understand
          the context before selecting your response.
        </div>
        <div class="tip-box">
          <strong>5. Avoid Extreme Answers Unless True:</strong> Don't always
          pick "strongly agree" or "strongly disagree" unless it genuinely
          reflects you.
        </div>
        <div class="tip-box">
          <strong>6. Manage Stress Before the Exam:</strong> Practice relaxation
          techniques. Anxiety can affect your performance.
        </div>
        <div class="tip-box">
          <strong>7. Get Enough Sleep:</strong> Mental clarity is essential for
          psychological assessments. Rest well.
        </div>
        <div class="tip-box">
          <strong>8. Practice Focus and Attention:</strong> Some tests measure
          concentration. Train your ability to maintain focus.
        </div>
        <div class="tip-box">
          <strong>9. Be Confident But Realistic:</strong> Show self-assurance
          without arrogance. Military values both confidence and humility.
        </div>
        <div class="tip-box">
          <strong>10. Follow Instructions Carefully:</strong> Each section may
          have specific instructions. Read them fully before starting.
        </div>

        <div
          class="tip-box"
          style="
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            margin-top: 30px;
          "
        >
          <strong>🎯 Final Reminder:</strong> The AFPSAT passing score is 71 or
          higher (raw score). Results are valid for 3 years, but retakes are
          only allowed once after 6 months. Make your preparation count!
        </div>
      </div>

      <!-- Games Section -->
      <div id="games" class="content-section">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          🎮 Interactive Brain Games
        </h2>

        <p style="margin-bottom: 30px; color: var(--text-light)">
          Train your cognitive skills with these quick games designed to improve
          pattern recognition, mental math speed, and memory - all critical for
          AFPSAT success.
        </p>

        <div class="card-grid">
          <div class="card" onclick="startGame('patternSpeed')">
            <h3>⚡ Pattern Speed Challenge</h3>
            <p>
              Identify patterns as fast as possible. Trains Abstract Reasoning
              speed.
            </p>
            <div
              style="
                margin-top: 15px;
                padding: 10px;
                background: var(--bg-light);
                border-radius: 8px;
              "
            >
              <strong>High Score:</strong>
              <span id="patternHighScore">0</span> points
            </div>
          </div>

          <div class="card" onclick="startGame('mathBlitz')">
            <h3>🔢 Math Blitz</h3>
            <p>
              Solve 10 math problems as fast as you can. Trains Numerical speed
              and accuracy.
            </p>
            <div
              style="
                margin-top: 15px;
                padding: 10px;
                background: var(--bg-light);
                border-radius: 8px;
              "
            >
              <strong>High Score:</strong>
              <span id="mathHighScore">0</span> points
            </div>
          </div>

          <div class="card" onclick="startGame('memoryMatch')">
            <h3>🧠 Flash Memory</h3>
            <p>
              Remember a sequence of symbols. Trains concentration and recall.
            </p>
            <div
              style="
                margin-top: 15px;
                padding: 10px;
                background: var(--bg-light);
                border-radius: 8px;
              "
            >
              <strong>Best Time:</strong> <span id="memoryBestTime">--</span>s
            </div>
          </div>
        </div>

        <div id="gameContent" style="margin-top: 30px; display: none"></div>
      </div>

      <!-- Study Resources Section -->
      <div id="resources" class="content-section">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          📚 Study Resources
        </h2>

        <p style="margin-bottom: 30px; color: var(--text-light)">
          Curated free and premium resources to supplement your AFPSAT
          preparation. All links open in a new tab.
        </p>

        <div id="weakAreaSuggestions" style="margin-bottom: 30px"></div>

        <div
          class="tip-box"
          style="
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            margin-bottom: 30px;
          "
        >
          <strong>💡 Study Tip:</strong> Use these resources alongside your
          practice sessions. Focus on weak areas first, then reinforce strong
          areas.
        </div>

        <!-- Verbal Resources -->
        <h3
          style="
            color: var(--secondary);
            margin: 30px 0 15px 0;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
          "
        >
          📖 Verbal Ability Resources
        </h3>
        <div class="card-grid" id="verbalResources"></div>

        <!-- Numerical Resources -->
        <h3
          style="
            color: var(--secondary);
            margin: 30px 0 15px 0;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
          "
        >
          🔢 Numerical Ability Resources
        </h3>
        <div class="card-grid" id="numericalResources"></div>

        <!-- Abstract Resources -->
        <h3
          style="
            color: var(--secondary);
            margin: 30px 0 15px 0;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
          "
        >
          🧩 Abstract Reasoning Resources
        </h3>
        <div class="card-grid" id="abstractResources"></div>

        <!-- Neuro-Psych Resources -->
        <h3
          style="
            color: var(--secondary);
            margin: 30px 0 15px 0;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
          "
        >
          🧠 Neuro-Psychological Resources
        </h3>
        <div class="card-grid" id="neuroPsychResources"></div>

        <!-- General Resources -->
        <h3
          style="
            color: var(--secondary);
            margin: 30px 0 15px 0;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
          "
        >
          🌐 General AFPSAT Resources
        </h3>
        <div class="card-grid" id="generalResources"></div>
      </div>

      <!-- Flashcard Section -->
      <div id="flashcards" class="content-section">
        <!-- Header -->
        <div class="fc-header">
          <span style="font-size: 2.2rem">🃏</span>
          <h2>Vocabulary Flashcard Drill</h2>
        </div>
        <p class="fc-subtitle">
          Review key military and exam vocabulary. Click a card to reveal its
          meaning.
        </p>

        <!-- Progress -->
        <div class="fc-progress-wrapper">
          <div class="fc-progress-top">
            <span class="fc-progress-label">📊 Cards Reviewed</span>
            <span id="fcProgressText" class="fc-progress-count"
              >0 of 0 reviewed</span
            >
          </div>
          <div class="fc-progress-bar-track">
            <div
              id="fcProgressBar"
              class="fc-progress-bar-fill"
              style="width: 0%"
            ></div>
          </div>
        </div>

        <!-- Card Counter -->
        <div class="fc-counter">
          <span class="fc-counter-badge">
            Card <span id="fcCurrentIndex">1</span> of
            <span id="fcTotalCards">0</span>
          </span>
        </div>

        <!-- 3D Flip Card -->
        <div class="fc-card-wrapper" onclick="flipCard()">
          <div class="fc-card-inner" id="fcCardInner">
            <!-- Front: Word -->
            <div class="fc-card-front">
              <div class="fc-side-label">✦ Word ✦</div>
              <h2 class="fc-word-text" id="fcWord">Loading...</h2>
              <div class="fc-flip-hint">👆 Click to reveal meaning</div>
            </div>

            <!-- Back: Meaning -->
            <div class="fc-card-back">
              <div class="fc-side-label">✦ Meaning ✦</div>
              <p class="fc-meaning-text" id="fcMeaning"></p>
              <div class="fc-flip-hint">👆 Click to flip back</div>
            </div>
          </div>
        </div>

        <!-- Controls -->
        <div class="fc-controls">
          <button class="fc-btn fc-btn-prev" onclick="fcPrevious()">
            ← Prev
          </button>
          <button class="fc-btn fc-btn-flip" onclick="flipCard()">
            🔄 Flip
          </button>
          <button class="fc-btn fc-btn-next" onclick="fcNext()">Next →</button>
          <button class="fc-btn fc-btn-shuffle" onclick="fcShuffle()">
            🔀 Shuffle
          </button>
          <button class="fc-btn fc-btn-reset" onclick="fcReset()">
            ↺ Reset
          </button>
        </div>

        <!-- Tip -->
        <div class="fc-tip">
          <strong>💡 How to use:</strong> Click the card or press
          <strong>Flip</strong> to see the meaning. Use
          <strong>Next / Previous</strong> to navigate cards.
          <strong>Shuffle</strong> randomizes the order. Your progress resets
          when you press <strong>Reset</strong>.
        </div>
      </div>

      <!-- Medical Test Section -->
      <div id="medicalTest" class="content-section">
        <div
          style="
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 10px;
          "
        >
          <span style="font-size: 2.2rem">👁️</span>
          <h2 style="color: var(--primary); margin: 0">
            Color Vision Test (Ishihara-Style)
          </h2>
        </div>
        <p style="color: var(--text-light); margin-bottom: 28px">
          This is a basic screening test to check for red-green color vision
          deficiency. It does not replace an official medical examination.
        </p>

        <!-- Instructions -->
        <div class="tip-box" style="margin-bottom: 25px">
          <strong>📋 Instructions:</strong> Look at each circle below and type
          the number you see inside it. If you cannot see a number, type
          <strong>0</strong>. Take the test in good lighting.
        </div>

        <!-- Test Plates -->
        <div
          id="cvtPlates"
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
          "
        ></div>

        <!-- Submit Button -->
        <div style="text-align: center; margin: 20px 0">
          <button
            class="btn btn-primary"
            onclick="submitColorTest()"
            style="padding: 15px 50px; font-size: 1.1rem"
          >
            Submit Answers
          </button>
          <button
            class="btn btn-secondary"
            onclick="resetColorTest()"
            style="padding: 15px 30px; font-size: 1.1rem; margin-left: 10px"
          >
            Reset
          </button>
        </div>

        <!-- Results -->
        <div id="cvtResults" style="display: none"></div>

        <!-- Disclaimer -->
        <div
          class="tip-box"
          style="
            margin-top: 30px;
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left-color: var(--accent);
          "
        >
          <strong>⚠️ Disclaimer:</strong> This is a simplified digital screening
          only. The AFP requires an official Ishihara test administered by a
          licensed medical officer. Digital screens may affect color accuracy.
          Consult a doctor for official results.
        </div>
      </div>

      <!-- AFP Application Checklist Section -->
      <div id="checklist" class="content-section">
        <div
          style="
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 10px;
          "
        >
          <span style="font-size: 2.2rem">✅</span>
          <h2 style="color: var(--primary); margin: 0">
            AFP Application Checklist
          </h2>
        </div>
        <p style="color: var(--text-light); margin-bottom: 28px">
          Check off each requirement as you prepare. Progress is saved
          automatically.
        </p>

        <div
          style="
            background: white;
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 22px;
            border: 1px solid var(--border);
          "
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              margin-bottom: 8px;
            "
          >
            <strong style="color: var(--primary)">Overall Readiness</strong>
            <span
              id="checklistPercent"
              style="
                background: var(--primary);
                color: white;
                padding: 3px 12px;
                border-radius: 20px;
                font-size: 0.85rem;
              "
              >0%</span
            >
          </div>
          <div class="progress-bar" style="height: 12px">
            <div
              id="checklistBar"
              class="progress-fill"
              style="width: 0%"
            ></div>
          </div>
        </div>

        <div id="checklistItems"></div>

        <button
          class="btn btn-danger"
          onclick="resetChecklist()"
          style="margin-top: 20px"
        >
          🔄 Reset Checklist
        </button>

        <div
          class="tip-box"
          style="
            margin-top: 20px;
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left-color: var(--accent);
          "
        >
          <strong>⚠️ Note:</strong> This is for guidance only. Always verify
          current requirements with the AFP Recruiting Unit in your area.
        </div>
      </div>

      <!-- 30-Day Study Plan Section -->
      <div id="studyPlan" class="content-section">
        <div
          style="
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 10px;
          "
        >
          <span style="font-size: 2.2rem">📅</span>
          <h2 style="color: var(--primary); margin: 0">
            30-Day AFPSAT Study Plan
          </h2>
        </div>
        <p style="color: var(--text-light); margin-bottom: 28px">
          A structured daily plan to prepare effectively for your AFPSAT exam.
        </p>

        <div
          class="tip-box"
          style="
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            border-left-color: var(--primary);
            margin-bottom: 25px;
          "
        >
          <strong>💡 How to use:</strong> Spend 30–60 minutes per day. Check off
          each day as you complete it. If you miss a day, just continue — don't
          restart from zero.
        </div>

        <div id="studyPlanDays"></div>

        <button
          class="btn btn-danger"
          onclick="resetStudyPlan()"
          style="margin-top: 20px"
        >
          🔄 Reset Study Plan
        </button>
      </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <div id="modalContent"></div>
        <button
          class="btn btn-primary"
          onclick="closeModal()"
          style="margin-top: 20px; width: 100%"
        >
          Close
        </button>
      </div>
    </div>

    <!-- Practice Questions Modal -->
    <div id="practiceModal" class="modal">
      <div class="modal-content" style="max-width: 900px">
        <button
          onclick="closePracticeModal()"
          style="
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--danger);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.3s;
          "
        >
          ×
        </button>
        <div id="practiceModalContent"></div>
      </div>
    </div>

    <!-- Game Modal -->
    <div id="gameModal" class="modal">
      <div class="modal-content" style="max-width: 1000px">
        <button onclick="closeGameModal()" class="modal-close-btn">×</button>
        <div id="gameModalContent"></div>
      </div>
    </div>

    <!-- Mock Exam Modal -->
    <div id="mockExamModal" class="modal">
      <div class="modal-content" style="max-width: 1100px">
        <button onclick="closeMockExamModal()" class="modal-close-btn">
          ×
        </button>
        <div id="mockExamModalContent"></div>
      </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-content">
        <div class="footer-title">🎖️ AFPSAT Reviewer 2026</div>
        <div class="footer-divider"></div>
        <div class="footer-credits">
          Developed with 💚 by
          <a href="#" onclick="return false;">Justine Tesara</a>
        </div>
        <div class="footer-motto">
          "Excellence is not a destination, it is a continuous journey that
          never ends."
          <br />
          <strong>Mabuhay ang mga Sundalo ng Pilipinas! 🇵🇭</strong>
        </div>
        <div class="footer-year">
          © 2026 AFPSAT Reviewer System. All rights reserved.
        </div>
      </div>
    </footer>

    <script>
      // AFPSAT Official Timing Configuration
      const AFPSAT_TIMING = {
        abstractReasoning: {
          questions: 50,
          timeLimit: 720, // 12 minutes = 720 seconds
          perQuestion: 14.4, // 14.4 seconds per question
          warningAt: 600, // Warning at 10 minutes
          section: "Abstract Reasoning",
        },
        verbalAbility: {
          questions: 65,
          timeLimit: 1800, // 30 minutes
          perQuestion: 27.7,
          warningAt: 1500, // Warning at 25 minutes
          section: "Verbal Ability",
        },
        numericalAbility: {
          questions: 35,
          timeLimit: 2100, // 35 minutes
          perQuestion: 60,
          warningAt: 1800, // Warning at 30 minutes
          section: "Numerical Ability",
        },
      };

      // Timer State
      let timerState = {
        active: false,
        remaining: 0,
        total: 0,
        mode: "practice", // 'practice', 'timed', 'exam'
        intervalId: null,
        section: null,
      };

      // Data Storage
      let userData = {
        totalQuestions: 0,
        correctAnswers: 0,
        afpsatScores: [],
        neuroPsychScores: [],
        mockExams: [],
        studyStreak: 0,
        lastStudyDate: null,
        weakAreas: {},
        strongAreas: {},
        // ADD THIS NEW FIELD:
        verbalSubTopicPerformance: {
          analogies: { correct: 0, total: 0 },
          vocabulary: { correct: 0, total: 0 },
          comprehension: { correct: 0, total: 0 },
          grammar: { correct: 0, total: 0 },
        },
        // New tracking fields
        questionsAnsweredOnTime: 0,
        questionsTotalTimed: 0,
        sectionPerformance: {
          abstract: [],
          verbal: [],
          numerical: [],
          neuroPsych: [],
        },
        preferences: {
          strictExamMode: false, // Toggle for strict exam simulation
          lastUpdated: null,
        },
        gamesProgress: {
          patternSpeed: { highScore: 0, attempts: 0, lastPlayed: null },
          mathBlitz: { highScore: 0, attempts: 0, lastPlayed: null },
          memoryMatch: {
            highScore: 0,
            bestTime: 999999,
            attempts: 0,
            lastPlayed: null,
          },
        },
      };

      // Timer Functions
      function startTimer(seconds, section, mode = "practice") {
        timerState.active = true;
        timerState.remaining = seconds;
        timerState.total = seconds;
        timerState.section = section;
        timerState.mode = mode;

        updateTimerDisplay();

        timerState.intervalId = setInterval(() => {
          timerState.remaining--;
          updateTimerDisplay();

          // Warning at specific time
          const config = Object.values(AFPSAT_TIMING).find(
            (c) => c.section === section,
          );
          if (
            config &&
            timerState.remaining ===
              config.warningAt - config.timeLimit + timerState.total
          ) {
            showNotification(
              `⚠️ Warning: ${Math.floor(timerState.remaining / 60)} minutes remaining!`,
            );
          }

          // Time's up
          if (timerState.remaining <= 0) {
            stopTimer();
            if (timerState.mode === "exam") {
              autoSubmitSection();
            } else {
              showNotification(
                "⏰ Time is up! In the real exam, this section would be auto-submitted.",
              );
            }
          }
        }, 1000);
      }

      function stopTimer() {
        if (timerState.intervalId) {
          clearInterval(timerState.intervalId);
          timerState.intervalId = null;
        }
        timerState.active = false;
      }

      function updateTimerDisplay() {
        const minutes = Math.floor(timerState.remaining / 60);
        const seconds = timerState.remaining % 60;
        const display = `${minutes}:${seconds.toString().padStart(2, "0")}`;

        const timerElement = document.getElementById("sectionTimer");
        if (timerElement) {
          timerElement.textContent = display;

          // Color coding based on time remaining
          const percentRemaining =
            (timerState.remaining / timerState.total) * 100;
          if (percentRemaining < 20) {
            timerElement.style.background = "var(--danger)";
          } else if (percentRemaining < 50) {
            timerElement.style.background = "var(--accent)";
          } else {
            timerElement.style.background = "var(--success)";
          }
        }
      }

      function autoSubmitSection() {
        showNotification("⏰ TIME EXPIRED - Section auto-submitted");

        // Auto-click submit button if it exists
        const submitBtn = document.querySelector(
          'button[onclick*="submitAnswer"]',
        );
        if (submitBtn) {
          submitBtn.click();
        } else {
          // If in practice, force show results
          if (typeof showPracticeResults === "function") {
            // Call with current state
            closePracticeModal();
            showNotification("⏰ Time's up! Practice ended.");
          }
        }
      }

      // Load saved data
      function loadUserData() {
        const saved = localStorage.getItem("afpExamData");
        if (saved) {
          userData = JSON.parse(saved);

          // Ensure preferences object exists (backward compatibility)
          if (!userData.preferences) {
            userData.preferences = {
              strictExamMode: false,
              lastUpdated: null,
            };
          }

          // ✅ FIX: Ensure verbalSubTopicPerformance exists (backward compatibility)
          if (!userData.verbalSubTopicPerformance) {
            userData.verbalSubTopicPerformance = {
              analogies: { correct: 0, total: 0 },
              vocabulary: { correct: 0, total: 0 },
              comprehension: { correct: 0, total: 0 },
              grammar: { correct: 0, total: 0 },
            };
          }

          // ✅ FIX: Ensure all 4 topics exist even if partially saved
          const requiredTopics = [
            "analogies",
            "vocabulary",
            "comprehension",
            "grammar",
          ];
          requiredTopics.forEach((topic) => {
            if (!userData.verbalSubTopicPerformance[topic]) {
              userData.verbalSubTopicPerformance[topic] = {
                correct: 0,
                total: 0,
              };
            }
          });

          updateDashboard();
          updateStats();

          setTimeout(() => {
            updateGameScores();
          }, 100);

          setTimeout(() => {
            initializeStrictMode();
          }, 100);
        }
      }

      // Passing Probability Calculator
      class AFPSATPredictor {
        calculatePassingProbability(userData) {
          const weights = {
            mockExamAverage: 0.4,
            practiceConsistency: 0.25,
            timeManagement: 0.2,
            weakAreaCoverage: 0.15,
          };

          // 1. Mock Exam Performance
          const mockScores = userData.mockExams.map((m) => m.score);
          const mockAvg =
            mockScores.length > 0
              ? mockScores.reduce((a, b) => a + b, 0) / mockScores.length
              : 0;

          let mockScore = 0;
          if (mockScores.length === 0) {
            mockScore = 0; // ✅ No exams taken = show 0, not 15
          } else if (mockAvg >= 80) mockScore = 100;
          else if (mockAvg >= 75) mockScore = 90;
          else if (mockAvg >= 71) mockScore = 75;
          else if (mockAvg >= 65) mockScore = 55;
          else if (mockAvg >= 55) mockScore = 35;
          else mockScore = 15;

          // 2. Practice Consistency (lower variance = better)
          const allScores = [
            ...(userData.sectionPerformance.abstract || []),
            ...(userData.sectionPerformance.verbal || []),
            ...(userData.sectionPerformance.numerical || []),
          ].map((s) => s.score);

          const variance = this.calculateVariance(allScores);
          const consistencyScore =
            allScores.length === 0
              ? 50
              : variance < 10
                ? 100
                : variance < 15
                  ? 80
                  : variance < 20
                    ? 60
                    : 40;

          // 3. Time Management
          const timeScore =
            userData.questionsTotalTimed > 0
              ? (userData.questionsAnsweredOnTime /
                  userData.questionsTotalTimed) *
                100
              : 50;

          // 4. Weak Area Coverage
          const topics = Object.keys(userData.weakAreas);
          const masteredTopics = topics.filter((topic) => {
            const data = userData.weakAreas[topic];
            return data.total > 0 && data.correct / data.total >= 0.7;
          });

          const weakScore =
            topics.length > 0
              ? (masteredTopics.length / topics.length) * 100
              : 0;

          // Calculate weighted total
          const totalScore =
            mockScore * weights.mockExamAverage +
            consistencyScore * weights.practiceConsistency +
            timeScore * weights.timeManagement +
            weakScore * weights.weakAreaCoverage;

          return {
            ...this.getConfidenceBand(totalScore),
            breakdown: {
              mockAverage: Math.round(mockAvg),
              mockScore: mockScore,
              consistency: Math.round(consistencyScore),
              timeManagement: Math.round(timeScore),
              weakAreaCoverage: Math.round(weakScore),
              totalScore: Math.round(totalScore),
            },
          };
        }

        calculateVariance(scores) {
          if (scores.length === 0) return 0;
          const mean = scores.reduce((a, b) => a + b, 0) / scores.length;
          const squaredDiffs = scores.map((score) => Math.pow(score - mean, 2));
          return Math.sqrt(
            squaredDiffs.reduce((a, b) => a + b, 0) / scores.length,
          );
        }

        getConfidenceBand(score) {
          if (score >= 85)
            return {
              band: "HIGH CONFIDENCE",
              emoji: "🎯",
              message: "You're very likely to pass the AFPSAT exam.",
              color: "var(--success)",
              probability: "85-95%",
              recommendation:
                "You're ready! Schedule your exam within 1-2 weeks. Continue light review to stay sharp.",
            };
          else if (score >= 70)
            return {
              band: "GOOD CHANCE",
              emoji: "✅",
              message:
                "You have a good chance of passing, but continued practice is recommended.",
              color: "var(--primary)",
              probability: "70-84%",
              recommendation:
                "Take 2-3 more full mock exams. Focus on your weakest section. Schedule exam in 2-3 weeks.",
            };
          else if (score >= 55)
            return {
              band: "BORDERLINE",
              emoji: "⚠️",
              message:
                "You're on the edge. More focused preparation is needed.",
              color: "var(--accent)",
              probability: "50-69%",
              recommendation:
                "NOT ready yet. Delay exam scheduling. Focus on weak areas for 3-4 weeks. Aim for 75%+ on mock exams.",
            };
          else
            return {
              band: "HIGH RISK",
              emoji: "❌",
              message: "Significant risk of failing. Intensive study required.",
              color: "var(--danger)",
              probability: "Below 50%",
              recommendation:
                "DO NOT schedule exam. Complete all tutorials, practice extensively, and retake mock exams. Minimum 4-6 weeks of study needed.",
            };
        }

        getSectionReadiness() {
          const sections = ["abstract", "verbal", "numerical"];
          const readiness = {};

          sections.forEach((section) => {
            const scores = (userData.sectionPerformance[section] || []).map(
              (s) => s.score,
            );
            const avg =
              scores.length > 0
                ? scores.reduce((a, b) => a + b, 0) / scores.length
                : 0;

            readiness[section] = {
              average: Math.round(avg),
              attempts: scores.length,
              status:
                avg >= 75
                  ? "✅ Ready"
                  : avg >= 65
                    ? "⚠️ Almost Ready"
                    : "❌ Needs Work",
            };
          });

          return readiness;
        }
      }

      const afpsatPredictor = new AFPSATPredictor();

      // Save data
      function saveUserData() {
        // Update study streak
        const today = new Date().toDateString();
        if (userData.lastStudyDate !== today) {
          const yesterday = new Date();
          yesterday.setDate(yesterday.getDate() - 1);
          if (userData.lastStudyDate === yesterday.toDateString()) {
            userData.studyStreak = (userData.studyStreak || 0) + 1;
          } else if (userData.lastStudyDate !== today) {
            userData.studyStreak = 1; // Reset streak if gap > 1 day
          }
          userData.lastStudyDate = today;
        }
        localStorage.setItem("afpExamData", JSON.stringify(userData));
      }

      // === SHUFFLE UTILITIES ===

      // Generic array shuffle (Fisher-Yates)
      function shuffleArray(array) {
        const shuffled = [...array]; // Create copy to avoid mutating original
        for (let i = shuffled.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
      }

      // Shuffle question options and update correct answer index
      function shuffleQuestion(question) {
        const originalCorrect = question.options[question.correct];
        const shuffledOptions = shuffleArray(question.options);
        const newCorrectIndex = shuffledOptions.indexOf(originalCorrect);

        return {
          ...question,
          options: shuffledOptions,
          correct: newCorrectIndex,
        };
      }

      // Shuffle array of questions
      function shuffleQuestions(questions) {
        return shuffleArray(questions).map((q) => shuffleQuestion(q));
      }

      // Toggle strict exam mode
      function toggleStrictMode(enabled) {
        userData.preferences.strictExamMode = enabled;
        userData.preferences.lastUpdated = new Date().toISOString();
        saveUserData();

        // Update UI
        const badge = document.getElementById("strictModeBadge");
        const toggle = document.getElementById("strictModeToggle");

        if (enabled) {
          badge.textContent = "ON";
          badge.style.background = "var(--success)";
          showNotification(
            "⚔️ Strict Exam Mode ENABLED - No feedback during exams",
          );
        } else {
          badge.textContent = "OFF";
          badge.style.background = "var(--danger)";
          showNotification(
            "🔓 Strict Exam Mode DISABLED - Feedback will be shown",
          );
        }

        toggle.checked = enabled;
      }

      // Initialize strict mode toggle on page load
      function initializeStrictMode() {
        const toggle = document.getElementById("strictModeToggle");
        const badge = document.getElementById("strictModeBadge");

        if (toggle && userData.preferences) {
          toggle.checked = userData.preferences.strictExamMode || false;

          if (userData.preferences.strictExamMode) {
            badge.textContent = "ON";
            badge.style.background = "var(--success)";
          }
        }
      }

      // Tutorial Data
      const tutorials = {
        afpsatVerbal: {
          title: "AFPSAT: Verbal Ability - Complete Guide",
          content: `
            <h3>Overview (Based on AFPSAT 2025-2026 Format)</h3>
            <p>The Verbal Reasoning section measures your ability to understand and reason using concepts framed in words. This is your chance to demonstrate language mastery.</p>
            
            <p><strong>Format:</strong> 65 items in 30 minutes (approximately 27.7 seconds per question)</p>
            <p><strong>Passing Score Contribution:</strong> ~43% of total AFPSAT score</p>
            
            <div style="background: var(--bg-light); padding: 20px; border-radius: 12px; margin: 20px 0;">
              <h4 style="color: var(--primary); margin-bottom: 10px;">Question Type Breakdown:</h4>
              <ul style="margin-left: 20px;">
                <li><strong>Word Analogies:</strong> ~25 questions (38%)</li>
                <li><strong>Vocabulary:</strong> ~20 questions (31%)</li>
                <li><strong>Reading Comprehension:</strong> ~15 questions (23%)</li>
                <li><strong>Grammar/Sentence Construction:</strong> ~5 questions (8%)</li>
              </ul>
            </div>
            
            <h3>1. Word Analogies - Master the Relationships</h3>
            <p>Analogies test your ability to see relationships between word pairs. The key is identifying the TYPE of relationship first.</p>
            
            <div style="background: #e0f2fe; padding: 15px; border-radius: 8px; margin: 15px 0;">
              <strong>Common Relationship Types:</strong>
              <ul style="margin: 10px 0 0 20px;">
                <li><strong>Synonyms:</strong> HAPPY : JOYFUL</li>
                <li><strong>Antonyms:</strong> HOT : COLD</li>
                <li><strong>Part to Whole:</strong> WHEEL : CAR</li>
                <li><strong>Function:</strong> PEN : WRITE</li>
                <li><strong>Location:</strong> DOCTOR : HOSPITAL</li>
                <li><strong>Degree:</strong> WARM : HOT (intensity)</li>
                <li><strong>Cause & Effect:</strong> TRAINING : SKILL</li>
              </ul>
            </div>
            
            <p><strong>Strategy:</strong></p>
            <ol style="margin-left: 20px;">
              <li>Read the first pair and create a sentence: "A DOCTOR works in a HOSPITAL"</li>
              <li>Apply that same sentence structure to answer choices</li>
              <li>Eliminate answers that don't fit the exact relationship</li>
            </ol>
            
            <h3>2. Vocabulary - Synonyms, Antonyms, Context Clues</h3>
            <p>Vocabulary questions test your word knowledge. Even if you don't know a word, you can often figure it out.</p>
            
            <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin: 15px 0;">
              <strong>High-Frequency AFPSAT Words to Memorize:</strong>
              <ul style="margin: 10px 0 0 20px; columns: 2; -webkit-columns: 2; -moz-columns: 2;">
                <li>Resilient, Adaptable</li>
                <li>Discipline, Authority</li>
                <li>Integrity, Honor</li>
                <li>Strategy, Tactics</li>
                <li>Allegiance, Loyalty</li>
                <li>Hierarchy, Rank</li>
                <li>Protocol, Procedure</li>
                <li>Deploy, Mobilize</li>
                <li>Fortify, Reinforce</li>
                <li>Reconnaissance, Surveillance</li>
              </ul>
            </div>
            
            <p><strong>Context Clues Technique:</strong></p>
            <ul style="margin-left: 20px;">
              <li>Look for signal words: "but" (antonym), "like" (synonym)</li>
              <li>Check if the sentence gives examples or definitions</li>
              <li>Consider the overall tone (positive/negative)</li>
            </ul>
            
            <h3>3. Reading Comprehension - Speed Reading Skills</h3>
            <p>You don't have time to read every word carefully. Learn to skim effectively.</p>
            
            <div style="background: #dcfce7; padding: 15px; border-radius: 8px; margin: 15px 0;">
              <strong>The AFPSAT Reading Formula:</strong>
              <ol style="margin: 10px 0 0 20px;">
                <li><strong>Question First:</strong> Read what's being asked BEFORE reading passage</li>
                <li><strong>Skim for Keywords:</strong> Look for names, dates, numbers, topic sentences</li>
                <li><strong>First & Last Sentences:</strong> These usually contain main ideas</li>
                <li><strong>Eliminate 2 Wrong Answers:</strong> Then choose from remaining options</li>
              </ol>
            </div>
            
            <p><strong>Question Types You'll See:</strong></p>
            <ul style="margin-left: 20px;">
              <li><strong>Main Idea:</strong> "What is this passage mainly about?"</li>
              <li><strong>Detail:</strong> "According to the passage, when did...?"</li>
              <li><strong>Inference:</strong> "The author implies that..."</li>
              <li><strong>Vocabulary in Context:</strong> "The word 'X' most nearly means..."</li>
            </ul>
            
            <h3>4. Grammar & Sentence Structure</h3>
            <p>Review these common grammar rules tested on AFPSAT:</p>
            
            <ul style="margin-left: 20px;">
              <li><strong>Subject-Verb Agreement:</strong> The soldier runs (singular) / The soldiers run (plural)</li>
              <li><strong>Verb Tenses:</strong> Maintain consistency (past, present, future)</li>
              <li><strong>Pronouns:</strong> Ensure pronouns match their antecedents</li>
              <li><strong>Sentence Fragments:</strong> Identify incomplete sentences</li>
            </ul>
            
            <h3>Study Plan (4-Week Preparation)</h3>
            <div style="background: var(--bg-light); padding: 20px; border-radius: 12px; margin: 15px 0;">
              <p><strong>Week 1:</strong> Learn 50 vocabulary words + 20 analogy types</p>
              <p><strong>Week 2:</strong> Practice 100 verbal questions (mixed difficulty)</p>
              <p><strong>Week 3:</strong> Focus on weak areas + speed drills (timed practice)</p>
              <p><strong>Week 4:</strong> Take 3 full mock exams under real conditions</p>
            </div>
            
            <div class="tip-box" style="margin-top: 20px;">
              <strong>🎯 Pro Tip from Cathy Castillo:</strong> "Practice with a timer ALWAYS. Your brain needs to get used to making decisions in 27 seconds. Slow practice = slow exam performance!"
            </div>
          `,
        },
        afpsatNumerical: {
          title: "AFPSAT: Numerical Ability",
          content: `
                    <h3>Overview</h3>
                    <p>The Numerical Reasoning section assesses your ability to reason and solve problems using numbers and mathematical concepts. No calculators allowed!</p>
                    
                    <p><strong>Format:</strong> 35 items in 35 minutes (1 minute per question)</p>
                    
                    <h3>Key Topics Covered:</h3>
                    <ul>
                        <li><strong>Basic Arithmetic:</strong> Addition, subtraction, multiplication, division</li>
                        <li><strong>Fractions and Decimals:</strong> Operations and conversions</li>
                        <li><strong>Percentages:</strong> Calculating percentages, increases, decreases</li>
                        <li><strong>Ratios and Proportions:</strong> Understanding relationships between quantities</li>
                        <li><strong>Word Problems:</strong> Translating real-world scenarios into math equations</li>
                        <li><strong>Basic Algebra:</strong> Solving for unknowns, simple equations</li>
                        <li><strong>Number Series:</strong> Identifying patterns in sequences</li>
                    </ul>
                    
                    <h3>Study Tips:</h3>
                    <ul>
                        <li>Practice mental math daily - no calculator allowed in exam</li>
                        <li>Memorize multiplication tables up to 20</li>
                        <li>Learn shortcuts for common calculations</li>
                        <li>Practice word problems extensively</li>
                        <li>Review basic formulas (area, perimeter, percentage, etc.)</li>
                    </ul>
                    
                    <h3>Example Problems:</h3>
                    <p><strong>1. Basic Math:</strong> If a soldier runs 5km in 30 minutes, what is his speed in km/h?<br>
                    Answer: 10 km/h (5km × 2 = 10km in 60 minutes)</p>
                    
                    <p><strong>2. Percentage:</strong> A unit has 200 soldiers. If 15% are officers, how many officers are there?<br>
                    Answer: 30 officers (200 × 0.15 = 30)</p>
                    
                    <p><strong>3. Ratio:</strong> If the ratio of men to women in a platoon is 4:1 and there are 50 soldiers total, how many are women?<br>
                    Answer: 10 women (50 ÷ 5 = 10, then 10 × 1 = 10)</p>
                `,
        },
        afpsatAbstract: {
          title: "AFPSAT: Abstract Reasoning",
          content: `
                    <h3>Overview</h3>
                    <p>Abstract Reasoning is a nonverbal, non-numerical measure of reasoning power. It tests your ability to see relationships among objects, patterns, and designs.</p>
                    
                    <p><strong>Format:</strong> 50 items in 12 minutes (only 14.4 seconds per question!)</p>
                    
                    <h3>What is Tested:</h3>
                    <ul>
                        <li><strong>Pattern Recognition:</strong> Identifying sequences and patterns in shapes</li>
                        <li><strong>Spatial Reasoning:</strong> Understanding how objects relate in space</li>
                        <li><strong>Visual Logic:</strong> Finding the logic behind visual arrangements</li>
                        <li><strong>Shape Relationships:</strong> Understanding transformations (rotation, reflection, size changes)</li>
                    </ul>
                    
                    <h3>Common Pattern Types:</h3>
                    <ul>
                        <li><strong>Rotation:</strong> Shapes rotating clockwise or counterclockwise</li>
                        <li><strong>Reflection:</strong> Shapes being mirrored or flipped</li>
                        <li><strong>Progression:</strong> Elements increasing or decreasing in number</li>
                        <li><strong>Alternation:</strong> Elements alternating between two states</li>
                        <li><strong>Addition/Subtraction:</strong> Elements being added or removed</li>
                        <li><strong>Color/Shading:</strong> Changes in shading or color patterns</li>
                    </ul>
                    
                    <h3>Strategy Tips:</h3>
                    <ul>
                        <li>Look for the most obvious pattern first</li>
                        <li>Check each element systematically (shape, size, position, color)</li>
                        <li>Don't spend more than 15 seconds on one question</li>
                        <li>Practice recognizing patterns quickly</li>
                        <li>Use the process of elimination</li>
                        <li>Trust your visual instinct - your first impression is often correct</li>
                    </ul>
                    
                    <h3>Practice Approach:</h3>
                    <p>This is the fastest-paced section of AFPSAT. Speed is crucial! Practice with pattern puzzles, IQ test questions, and abstract reasoning apps. The more patterns you see, the faster you'll recognize them during the exam.</p>
                `,
        },
        neuroPsychPersonality: {
          title: "Neuro-Psych: Personality Assessment",
          content: `
                    <h3>Overview</h3>
                    <p>The Personality Assessment evaluates your behavioral patterns, attitudes, and emotional stability to determine suitability for military service.</p>
                    
                    <h3>What is Assessed:</h3>
                    <ul>
                        <li><strong>Emotional Stability:</strong> How well you handle stress and pressure</li>
                        <li><strong>Interpersonal Relations:</strong> How you work with others in a team</li>
                        <li><strong>Leadership Qualities:</strong> Your potential to lead and make decisions</li>
                        <li><strong>Discipline and Self-Control:</strong> Your ability to follow rules and regulations</li>
                        <li><strong>Motivation and Drive:</strong> Your commitment and dedication</li>
                        <li><strong>Honesty and Integrity:</strong> Your truthfulness and moral character</li>
                    </ul>
                    
                    <h3>Common Test Components:</h3>
                    <ul>
                        <li><strong>Guilford-Zimmerman Temperament Survey:</strong> Measures personality traits</li>
                        <li><strong>Applicant Risk Profiler:</strong> Identifies potential behavioral risks</li>
                        <li><strong>Sentence Completion Tests:</strong> Reveals thoughts and attitudes</li>
                        <li><strong>Work Environment Preference:</strong> Determines work style compatibility</li>
                    </ul>
                    
                    <h3>How to Approach:</h3>
                    <ul>
                        <li><strong>Be Yourself:</strong> Don't try to fake answers - tests detect inconsistency</li>
                        <li><strong>Answer Honestly:</strong> There are no "right" or "wrong" answers in personality tests</li>
                        <li><strong>Stay Consistent:</strong> Similar questions appear multiple times to check consistency</li>
                        <li><strong>Don't Overthink:</strong> Your first response is usually most accurate</li>
                        <li><strong>Show Military Values:</strong> Demonstrate discipline, teamwork, and integrity</li>
                    </ul>
                    
                    <h3>Red Flags to Avoid:</h3>
                    <ul>
                        <li>Showing extreme aggression or violence tendencies</li>
                        <li>Demonstrating inability to work in teams</li>
                        <li>Exhibiting signs of emotional instability</li>
                        <li>Inconsistent answers across similar questions</li>
                        <li>Showing lack of discipline or rule-following</li>
                    </ul>
                    
                    <h3>Military Values to Demonstrate:</h3>
                    <p>Show that you value: Honor, Duty, Loyalty, Service, Integrity, Courage, Commitment, and Respect for others.</p>
                `,
        },
        neuroPsychLogic: {
          title: "Neuro-Psych: Logical Thinking & Decision Making",
          content: `
                    <h3>Overview</h3>
                    <p>This section evaluates your ability to think critically, make sound decisions under pressure, and solve problems logically.</p>
                    
                    <h3>What is Tested:</h3>
                    <ul>
                        <li><strong>Critical Thinking:</strong> Analyzing situations objectively</li>
                        <li><strong>Problem-Solving:</strong> Finding effective solutions to challenges</li>
                        <li><strong>Decision-Making:</strong> Making appropriate choices in various scenarios</li>
                        <li><strong>Judgment:</strong> Evaluating situations and determining best course of action</li>
                        <li><strong>Adaptability:</strong> Adjusting to new or unexpected situations</li>
                    </ul>
                    
                    <h3>Common Question Types:</h3>
                    <ul>
                        <li><strong>Situational Judgment:</strong> "What would you do if..." scenarios</li>
                        <li><strong>Ethical Dilemmas:</strong> Choosing between difficult moral options</li>
                        <li><strong>Priority Setting:</strong> Determining what to do first in complex situations</li>
                        <li><strong>Cause and Effect:</strong> Understanding consequences of actions</li>
                    </ul>
                    
                    <h3>Decision-Making Framework:</h3>
                    <ol>
                        <li><strong>Assess the Situation:</strong> Understand all facts and context</li>
                        <li><strong>Identify Options:</strong> Consider all possible courses of action</li>
                        <li><strong>Evaluate Consequences:</strong> Think through outcomes of each option</li>
                        <li><strong>Choose Based on Values:</strong> Select option aligned with military values</li>
                        <li><strong>Consider Safety:</strong> Prioritize safety of yourself and others</li>
                    </ol>
                    
                    <h3>Example Scenario:</h3>
                    <p><em>"You notice a fellow soldier violating safety protocols. What do you do?"</em></p>
                    
                    <p><strong>Good Response:</strong> "I would politely remind the soldier about the safety protocols and explain why they're important. If the behavior continues, I would report it to my superior officer."</p>
                    
                    <p><strong>Why It's Good:</strong> Shows concern for safety, respect for colleagues, and proper chain of command.</p>
                    
                    <h3>Key Principles:</h3>
                    <ul>
                        <li>Safety always comes first</li>
                        <li>Follow chain of command</li>
                        <li>Think of the team, not just yourself</li>
                        <li>Act with integrity</li>
                        <li>Stay calm under pressure</li>
                    </ul>
                `,
        },
        neuroPsychStress: {
          title: "Neuro-Psych: Stress Tolerance & Emotional Control",
          content: `
                    <h3>Overview</h3>
                    <p>Military service involves high-stress situations. This assessment evaluates how well you manage stress, control emotions, and maintain composure under pressure.</p>
                    
                    <h3>What is Measured:</h3>
                    <ul>
                        <li><strong>Stress Management:</strong> Your ability to handle pressure</li>
                        <li><strong>Emotional Regulation:</strong> Controlling emotional responses</li>
                        <li><strong>Resilience:</strong> Bouncing back from setbacks</li>
                        <li><strong>Composure:</strong> Staying calm in difficult situations</li>
                        <li><strong>Coping Mechanisms:</strong> How you deal with challenges</li>
                    </ul>
                    
                    <h3>Assessment Methods:</h3>
                    <ul>
                        <li><strong>Timed Tests:</strong> Performance under time pressure</li>
                        <li><strong>Attention Tasks:</strong> Maintaining focus despite distractions</li>
                        <li><strong>Stress Scenarios:</strong> How you respond to stressful situations</li>
                        <li><strong>Frustration Tolerance:</strong> Dealing with difficult or repetitive tasks</li>
                    </ul>
                    
                    <h3>Healthy Coping Strategies:</h3>
                    <ul>
                        <li><strong>Deep Breathing:</strong> Calms nervous system</li>
                        <li><strong>Positive Self-Talk:</strong> Encourages confidence</li>
                        <li><strong>Breaking Down Problems:</strong> Makes challenges manageable</li>
                        <li><strong>Seeking Support:</strong> Asking for help when needed</li>
                        <li><strong>Physical Exercise:</strong> Releases stress through activity</li>
                        <li><strong>Time Management:</strong> Organizing tasks to reduce pressure</li>
                    </ul>
                    
                    <h3>Preparation Tips:</h3>
                    <ul>
                        <li>Get adequate sleep (7-8 hours) before the exam</li>
                        <li>Practice relaxation techniques regularly</li>
                        <li>Exercise regularly to build stress resilience</li>
                        <li>Avoid caffeine overload on exam day</li>
                        <li>Arrive early to reduce time pressure</li>
                        <li>Accept that some stress is normal</li>
                    </ul>
                    
                    <h3>During the Exam:</h3>
                    <ul>
                        <li>Take slow, deep breaths if you feel overwhelmed</li>
                        <li>Focus on one question at a time</li>
                        <li>Don't panic if something seems difficult</li>
                        <li>Use brief mental breaks between sections</li>
                        <li>Maintain positive attitude throughout</li>
                    </ul>
                    
                    <h3>What NOT to Do:</h3>
                    <ul>
                        <li>Don't show signs of giving up easily</li>
                        <li>Avoid displaying anger or frustration</li>
                        <li>Don't make impulsive decisions</li>
                        <li>Avoid negative self-talk</li>
                        <li>Don't let one difficult question derail you</li>
                    </ul>
                `,
        },
      };

      // Study Resources Database
      const studyResources = {
        verbal: [
          {
            title: "Free Filipino-English Vocabulary Builder",
            url: "https://quizlet.com/subject/filipino-vocabulary/",
            description: "Practice 1000+ Filipino-English word pairs",
            type: "Practice",
          },
          {
            title: "Grammar Bytes! (Free Grammar Exercises)",
            url: "https://www.chompchomp.com/",
            description: "Interactive grammar exercises with instant feedback",
            type: "Tutorial",
          },
          {
            title: "ReadTheory - Reading Comprehension",
            url: "https://readtheory.org/",
            description: "Adaptive reading comprehension practice (Free)",
            type: "Practice",
          },
          {
            title: "Vocabulary.com - Word Learning",
            url: "https://www.vocabulary.com/",
            description: "Personalized vocabulary learning with games",
            type: "Practice",
          },
        ],
        numerical: [
          {
            title: "Khan Academy - Math (Free)",
            url: "https://www.khanacademy.org/math",
            description: "Complete math courses from basics to advanced",
            type: "Tutorial",
          },
          {
            title: "Mental Math Tricks",
            url: "https://www.mathsisfun.com/numbers/mental-math.html",
            description: "Learn shortcuts for fast mental calculations",
            type: "Tutorial",
          },
          {
            title: "Math Playground - Speed Math",
            url: "https://www.mathplayground.com/",
            description: "Fun math games to improve calculation speed",
            type: "Practice",
          },
          {
            title: "Brilliant.org - Problem Solving",
            url: "https://brilliant.org/courses/problem-solving/",
            description: "Interactive problem-solving challenges (Free intro)",
            type: "Practice",
          },
        ],
        abstract: [
          {
            title: "Pattern Recognition Practice",
            url: "https://www.psychometric-success.com/aptitude-tests/test-types/abstract-reasoning-tests",
            description: "Free abstract reasoning practice tests",
            type: "Practice",
          },
          {
            title: "IQ Test Prep - Abstract Reasoning",
            url: "https://www.123test.com/abstract-reasoning-test/",
            description: "Pattern and sequence practice with explanations",
            type: "Practice",
          },
          {
            title: "Lumosity - Pattern Games (Free Trial)",
            url: "https://www.lumosity.com/",
            description: "Brain training games for pattern recognition",
            type: "Practice",
          },
          {
            title: "AssessmentDay - Abstract Tests",
            url: "https://www.assessmentday.co.uk/abstract-reasoning.htm",
            description: "Practice tests with detailed solutions",
            type: "Practice",
          },
        ],
        neuroPsych: [
          {
            title: "Practice Aptitude Tests - Situational Judgment",
            url: "https://www.practiceaptitudetests.com/situational-judgement-tests/",
            description: "Free situational judgment practice",
            type: "Practice",
          },
          {
            title: "Understanding Personality Tests",
            url: "https://www.verywellmind.com/personality-tests-4157179",
            description: "Guide to common personality assessment types",
            type: "Tutorial",
          },
          {
            title: "Military.com - Preparing for Psychological Tests",
            url: "https://www.military.com/",
            description: "Tips for military psychological assessments",
            type: "Tutorial",
          },
        ],
        general: [
          {
            title: "Civil Service Exam PH - Free Reviewer",
            url: "https://www.civilserviceexam.com.ph/",
            description: "Similar format to AFPSAT, good practice source",
            type: "Practice",
          },
          {
            title: "YouTube: AFPSAT Review Channels",
            url: "https://www.youtube.com/results?search_query=afpsat+reviewer+2024",
            description: "Video tutorials and walkthroughs",
            type: "Tutorial",
          },
        ],
      };

      // Practice Questions Database - EXPANDED & DIFFICULTY-STRATIFIED
      const practiceQuestions = {
        afpsatVerbal: {
          easy: [
            // WORD ANALOGIES - Easy
            {
              question:
                "Choose the word pair that has the same relationship: DOCTOR : HOSPITAL",
              options: [
                "Teacher : School",
                "Farmer : Market",
                "Student : Library",
                "Chef : Restaurant",
              ],
              correct: 0,
              explanation:
                "A doctor works in a hospital just as a teacher works in a school. This is a 'person to workplace' relationship.",
              topic: "analogies",
              subTopic: "workplace",
            },
            {
              question: "Complete the analogy: PEN : WRITE :: KNIFE : ___",
              options: ["Cut", "Sharp", "Kitchen", "Metal"],
              correct: 0,
              explanation:
                "A pen is used to write; a knife is used to cut. This is a 'tool to function' relationship.",
              topic: "analogies",
              subTopic: "function",
            },
            {
              question: "WHEEL : BICYCLE :: PROPELLER : ___",
              options: ["Airplane", "Engine", "Speed", "Metal"],
              correct: 0,
              explanation:
                "A wheel is part of a bicycle; a propeller is part of an airplane. This is a 'part to whole' relationship.",
              topic: "analogies",
              subTopic: "partToWhole",
            },

            // VOCABULARY - Easy
            {
              question: "Choose the word most similar in meaning to 'BRAVE':",
              options: ["Cowardly", "Courageous", "Timid", "Fearful"],
              correct: 1,
              explanation:
                "Courageous means showing courage, which is a synonym of brave.",
              topic: "vocabulary",
              subTopic: "synonyms",
            },
            {
              question: "What is the opposite of 'VICTORY'?",
              options: ["Success", "Defeat", "Win", "Triumph"],
              correct: 1,
              explanation:
                "Defeat is the antonym of victory. Victory means winning, while defeat means losing.",
              topic: "vocabulary",
              subTopic: "antonyms",
            },
            {
              question:
                "The officer gave a ____ speech that motivated all soldiers.",
              options: ["boring", "inspiring", "confusing", "lengthy"],
              correct: 1,
              explanation:
                "Context clue: 'motivated' suggests the speech was inspiring.",
              topic: "vocabulary",
              subTopic: "contextClues",
            },

            // READING COMPREHENSION - Easy
            {
              question:
                "Read: 'The Philippine Army values discipline, honor, and service to the nation.' What is the MAIN idea?",
              options: [
                "The army needs more soldiers",
                "Core values of the Philippine Army",
                "Discipline is most important",
                "The army serves the government",
              ],
              correct: 1,
              explanation:
                "The sentence lists core values, making option B the main idea.",
              topic: "comprehension",
              subTopic: "mainIdea",
            },
            {
              question:
                "Read: 'Military training builds physical strength and mental toughness.' This sentence suggests training affects:",
              options: [
                "Only the body",
                "Only the mind",
                "Both body and mind",
                "Neither body nor mind",
              ],
              correct: 2,
              explanation:
                "The sentence mentions both 'physical strength' and 'mental toughness'.",
              topic: "comprehension",
              subTopic: "inference",
            },
          ],

          medium: [
            // WORD ANALOGIES - Medium
            {
              question: "GENERAL : ARMY :: CAPTAIN : ___",
              options: ["Navy", "Ship", "Soldier", "Officer"],
              correct: 1,
              explanation:
                "A general leads an army; a captain commands a ship. This is a 'leader to domain' relationship.",
              topic: "analogies",
              subTopic: "leadership",
            },
            {
              question: "RIFLE : INFANTRY :: ARTILLERY : ___",
              options: ["Army", "Cannon", "Battle", "Defense"],
              correct: 1,
              explanation:
                "A rifle is the primary weapon of infantry; a cannon is the primary weapon of artillery units.",
              topic: "analogies",
              subTopic: "military",
            },
            {
              question: "STRATEGY : GENERAL :: DIAGNOSIS : ___",
              options: ["Disease", "Doctor", "Hospital", "Patient"],
              correct: 1,
              explanation:
                "A general creates strategy; a doctor makes diagnoses. Professional function relationship.",
              topic: "analogies",
              subTopic: "profession",
            },

            // VOCABULARY - Medium
            {
              question: "Select the word closest in meaning to 'RESILIENT':",
              options: ["Fragile", "Flexible", "Rigid", "Delicate"],
              correct: 1,
              explanation:
                "Resilient means able to recover quickly, similar to flexible or adaptable.",
              topic: "vocabulary",
              subTopic: "synonyms",
            },
            {
              question:
                "The commander's STOIC expression during the crisis inspired confidence. STOIC means:",
              options: [
                "Emotional",
                "Calm and unemotional",
                "Worried",
                "Aggressive",
              ],
              correct: 1,
              explanation:
                "Stoic means showing no emotion, remaining calm under pressure.",
              topic: "vocabulary",
              subTopic: "contextClues",
            },
            {
              question: "Which word is the ANTONYM of 'ASCEND'?",
              options: ["Rise", "Climb", "Descend", "Elevate"],
              correct: 2,
              explanation: "Ascend means to go up; descend means to go down.",
              topic: "vocabulary",
              subTopic: "antonyms",
            },

            // READING COMPREHENSION - Medium
            {
              question:
                "Read: 'The battalion prepared for deployment by conducting intensive training exercises, ensuring all equipment was functional, and reviewing mission protocols.' The MAIN purpose of these activities was to:",
              options: [
                "Impress superior officers",
                "Ensure readiness for deployment",
                "Test new equipment",
                "Train new recruits",
              ],
              correct: 1,
              explanation:
                "All activities mentioned are preparation steps, indicating the purpose is ensuring readiness.",
              topic: "comprehension",
              subTopic: "purpose",
            },
            {
              question:
                "Read: 'Despite facing numerous obstacles, the platoon successfully completed their mission through teamwork and determination.' What can be INFERRED?",
              options: [
                "The mission was easy",
                "Teamwork was not important",
                "They encountered difficulties but persevered",
                "They received external help",
              ],
              correct: 2,
              explanation:
                "'Despite obstacles' implies difficulties, 'successfully completed' implies perseverance.",
              topic: "comprehension",
              subTopic: "inference",
            },
          ],

          hard: [
            // WORD ANALOGIES - Hard
            {
              question: "REGIMENTED : DISCIPLINE :: CHAOTIC : ___",
              options: ["Order", "Disorder", "Control", "Structure"],
              correct: 1,
              explanation:
                "Regimented leads to discipline; chaotic leads to disorder. Cause-effect relationship.",
              topic: "analogies",
              subTopic: "causeEffect",
            },
            {
              question: "CAMOUFLAGE : CONCEALMENT :: FORTIFICATION : ___",
              options: ["Building", "Protection", "Attack", "Visibility"],
              correct: 1,
              explanation:
                "Camouflage provides concealment; fortification provides protection. Purpose relationship.",
              topic: "analogies",
              subTopic: "purpose",
            },
            {
              question: "HIERARCHY : ORGANIZATION :: PROTOCOL : ___",
              options: ["Chaos", "Procedure", "Confusion", "Disorder"],
              correct: 1,
              explanation:
                "Hierarchy provides structure to organization; protocol provides structure to procedure.",
              topic: "analogies",
              subTopic: "structure",
            },

            // VOCABULARY - Hard
            {
              question: "Choose the word most nearly OPPOSITE to 'AMBIGUOUS':",
              options: ["Clear", "Uncertain", "Vague", "Obscure"],
              correct: 0,
              explanation:
                "Ambiguous means unclear; clear is the direct opposite.",
              topic: "vocabulary",
              subTopic: "antonyms",
            },
            {
              question:
                "The soldier's INTREPID actions under fire earned him a medal. INTREPID most nearly means:",
              options: ["Fearful", "Courageous", "Reckless", "Cautious"],
              correct: 1,
              explanation:
                "Intrepid means fearless and adventurous, showing courage in dangerous situations.",
              topic: "vocabulary",
              subTopic: "contextClues",
            },
            {
              question: "Select the word that means 'to make less severe':",
              options: ["Aggravate", "Mitigate", "Intensify", "Amplify"],
              correct: 1,
              explanation: "Mitigate means to make less severe or serious.",
              topic: "vocabulary",
              subTopic: "definitions",
            },

            // READING COMPREHENSION - Hard
            {
              question:
                "Read: 'The implementation of new combat strategies required not only technical proficiency but also adaptability, as soldiers needed to adjust tactics based on real-time battlefield conditions while maintaining coordination with allied forces.' The passage emphasizes that successful strategy implementation depends PRIMARILY on:",
              options: [
                "Technical skill alone",
                "Flexibility and coordination",
                "Superior weaponry",
                "Individual heroism",
              ],
              correct: 1,
              explanation:
                "The passage highlights both 'adaptability' and 'maintaining coordination', making flexibility and coordination the primary factors.",
              topic: "comprehension",
              subTopic: "analysis",
            },
            {
              question:
                "Read: 'While courage in combat is universally admired, true military excellence encompasses strategic thinking, ethical decision-making, and the ability to lead others effectively under pressure.' The author would MOST LIKELY agree that:",
              options: [
                "Courage is the only important military quality",
                "Military excellence requires multiple competencies",
                "Strategic thinking is more important than courage",
                "Ethical decisions are rarely necessary in combat",
              ],
              correct: 1,
              explanation:
                "The passage states excellence 'encompasses' multiple qualities, indicating agreement with option B.",
              topic: "comprehension",
              subTopic: "authorIntent",
            },
            // GRAMMAR ERROR-SPOTTING (real AFPSAT format)
            {
              question:
                "Find the error: 'My supply officer and me went to the commissary this morning.'",
              options: ["supply officer", "me", "commissary", "No error"],
              correct: 1,
              explanation:
                "The subject of the verb should be 'I', not 'me'. Correct: 'My supply officer and I went...' Use 'I' when it is the subject of the sentence.",
              topic: "grammar",
              subTopic: "pronouns",
            },
            {
              question:
                "Find the error: 'This children are the hope of tomorrow.'",
              options: ["This", "are", "hope", "No error"],
              correct: 0,
              explanation:
                "'This' is singular and cannot modify the plural noun 'children'. The correct word is 'These children are the hope of tomorrow.'",
              topic: "grammar",
              subTopic: "demonstratives",
            },
            {
              question:
                "Find the error: 'She made a mistake of putting her trust at someone she does not know.'",
              options: ["made", "putting", "at", "No error"],
              correct: 2,
              explanation:
                "The correct preposition is 'in', not 'at'. We say 'put your trust IN someone', not 'at someone'.",
              topic: "grammar",
              subTopic: "prepositions",
            },

            // IDIOM / MEANING (real AFPSAT format)
            {
              question:
                "His explanation is 'as clear as mud.' What does this idiom mean?",
              options: [
                "Very dirty",
                "Extremely clear",
                "Not understandable at all",
                "Somewhat confusing",
              ],
              correct: 2,
              explanation:
                "'As clear as mud' is an ironic idiom meaning the opposite of clear — it means completely confusing or impossible to understand.",
              topic: "vocabulary",
              subTopic: "idioms",
            },
            {
              question: "Choose the word most similar to 'BENEVOLENT':",
              options: ["Cruel", "Kind", "Strict", "Indifferent"],
              correct: 1,
              explanation:
                "Benevolent means well-meaning and kind. Its synonym is 'kind' or 'generous'.",
              topic: "vocabulary",
              subTopic: "synonyms",
            },
            {
              question: "The opposite of 'VAGUE' is:",
              options: ["Obscure", "Unclear", "Definite", "Uncertain"],
              correct: 2,
              explanation:
                "Vague means unclear or not specific. Its antonym (opposite) is 'definite' or 'clear'.",
              topic: "vocabulary",
              subTopic: "antonyms",
            },

            // READING COMPREHENSION - Military context passage (real AFPSAT style)
            {
              question:
                "Read: 'Neuro and psychological disorders are disqualifying conditions for military service. Such individuals are likely to break down under the stress of military life and are an additional burden to the AFP.' Based on the passage, which statement is NOT true?",
              options: [
                "They are an additional expense to the AFP",
                "They are disqualified from military service",
                "They are likely to breakdown under stress",
                "They can be identified just by looking at them",
              ],
              correct: 3,
              explanation:
                "Option D is NOT stated in the passage. The passage says they breakdown under stress and are disqualified — but nowhere does it say they can be identified by appearance alone.",
              topic: "comprehension",
              subTopic: "notTrue",
            },
          ],
        },
        afpsatNumerical: {
          easy: [
            {
              question: "What is 25% of 80?",
              options: ["15", "20", "25", "30"],
              correct: 1,
              explanation: "25% of 80 = 0.25 × 80 = 20",
              topic: "percentages",
            },
            {
              question: "If 3 apples cost ₱45, how much do 5 apples cost?",
              options: ["₱60", "₱65", "₱70", "₱75"],
              correct: 3,
              explanation:
                "Each apple costs ₱15 (45÷3). So 5 apples = 5 × 15 = ₱75",
              topic: "ratios",
            },
            {
              question: "What is 3/4 of 80?",
              options: ["50", "55", "60", "65"],
              correct: 2,
              explanation: "3/4 × 80 = (3 × 80) ÷ 4 = 240 ÷ 4 = 60",
              topic: "fractions",
            },
            {
              question:
                "A soldier runs 6 kilometers in 30 minutes. What is his speed in km/h?",
              options: ["10 km/h", "11 km/h", "12 km/h", "13 km/h"],
              correct: 2,
              explanation:
                "In 30 minutes (0.5 hour), he runs 6km. Speed = 6 ÷ 0.5 = 12 km/h",
              topic: "wordProblems",
            },
            {
              question: "What is 15 + 23 × 2?",
              options: ["61", "76", "38", "46"],
              correct: 0,
              explanation:
                "Order of operations: 23 × 2 = 46, then 15 + 46 = 61",
              topic: "basic",
            },
          ],
          medium: [
            {
              question:
                "A platoon has 120 soldiers. If 25% are officers, how many enlisted personnel are there?",
              options: ["70", "80", "90", "100"],
              correct: 2,
              explanation: "25% are officers = 30. Enlisted = 120 - 30 = 90",
              topic: "percentages",
            },
            {
              question:
                "If the ratio of rifles to pistols is 5:2 and there are 70 firearms total, how many pistols?",
              options: ["10", "20", "30", "40"],
              correct: 1,
              explanation:
                "Total parts = 5 + 2 = 7. Each part = 70 ÷ 7 = 10. Pistols = 2 parts = 2 × 10 = 20",
              topic: "ratios",
            },
            {
              question:
                "A convoy travels 180km in 3 hours, then 240km in 4 hours. What is the average speed?",
              options: ["55 km/h", "60 km/h", "65 km/h", "70 km/h"],
              correct: 1,
              explanation:
                "Total distance = 420km. Total time = 7 hours. Average speed = 420 ÷ 7 = 60 km/h",
              topic: "wordProblems",
            },
            {
              question:
                "A base increased personnel by 20%. If there were originally 500, how many now?",
              options: ["550", "600", "620", "650"],
              correct: 1,
              explanation: "20% of 500 = 100. New total = 500 + 100 = 600",
              topic: "percentages",
            },
            {
              question:
                "If 8 workers complete a task in 12 days, how many workers are needed to complete it in 6 days?",
              options: ["12", "14", "16", "18"],
              correct: 2,
              explanation:
                "Total work = 8 × 12 = 96 worker-days. For 6 days: 96 ÷ 6 = 16 workers needed",
              topic: "ratios",
            },
          ],
          hard: [
            {
              question:
                "In a battalion, the ratio of officers to enlisted is 1:9. If 15% of officers and 8% of enlisted are female, and there are 45 female soldiers total, how many soldiers are in the battalion?",
              options: ["400", "450", "500", "550"],
              correct: 2,
              explanation:
                "Let officers = x, enlisted = 9x. Total = 10x. Female officers = 0.15x. Female enlisted = 0.08 × 9x = 0.72x. Total females = 0.87x = 45. So x = 45 ÷ 0.87 = 51.7 ≈ 52 officers. Total soldiers = 10x = 517 ≈ 500 (closest answer). Correct answer: 500.",
              topic: "ratios",
            },
            {
              question:
                "A soldier invests ₱5000 at 6% annual interest compounded annually. How much after 2 years?",
              options: ["₱5600", "₱5618", "₱5700", "₱5800"],
              correct: 1,
              explanation:
                "Year 1: 5000 × 1.06 = 5300. Year 2: 5300 × 1.06 = 5618",
              topic: "percentages",
            },
            {
              question:
                "Two trucks leave base at same time. One travels at 60 km/h, other at 80 km/h in opposite directions. How far apart after 2.5 hours?",
              options: ["300 km", "325 km", "350 km", "375 km"],
              correct: 2,
              explanation:
                "Combined speed = 60 + 80 = 140 km/h. Distance = 140 × 2.5 = 350 km",
              topic: "wordProblems",
            },
            {
              question:
                "A tank is 3/5 full. After adding 40 liters, it becomes 4/5 full. What is the tank's capacity?",
              options: ["150 L", "175 L", "200 L", "225 L"],
              correct: 2,
              explanation:
                "Difference: 4/5 - 3/5 = 1/5 of tank = 40L. Full tank = 40 × 5 = 200L",
              topic: "fractions",
            },
            {
              question:
                "A number is increased by 25%, then decreased by 20%. The final result is:",
              options: [
                "Equal to original",
                "5% more",
                "5% less",
                "Equal to 1",
              ],
              correct: 0,
              explanation:
                "Start with 100. After +25%: 125. After -20%: 125 × 0.8 = 100. Equal to original!",
              topic: "percentages",
            },
            // AGE PROBLEMS (real AFPSAT format)
            {
              question:
                "James' dad is 5 times older than James, and James is twice as old as his sister Sara. In two years, the sum of their ages will be 58. How old is James now?",
              options: [
                "6 years old",
                "7 years old",
                "8 years old",
                "9 years old",
              ],
              correct: 2,
              explanation:
                "Let James = J, Dad = 5J, Sara = J/2. In 2 years: (J+2) + (5J+2) + (J/2+2) = 58 → 6.5J + 6 = 58 → 6.5J = 52 → J = 8. James is 8 years old.",
              topic: "wordProblems",
              subTopic: "ageProblems",
            },
            {
              question:
                "A barangay population of 95,000 decreased by 5%. What is the remaining population?",
              options: ["90,000", "90,025", "90,250", "89,500"],
              correct: 2,
              explanation:
                "5% of 95,000 = 4,750. Remaining = 95,000 − 4,750 = 90,250. Or: 95,000 × 0.95 = 90,250.",
              topic: "percentages",
              subTopic: "population",
            },

            // WORK-RATE PROBLEMS
            {
              question:
                "A basketball team won 80% of its games and won 20 games. How many total games did they play?",
              options: ["20", "22", "25", "28"],
              correct: 2,
              explanation:
                "80% of total = 20 games. Total = 20 ÷ 0.80 = 25 games.",
              topic: "percentages",
              subTopic: "backCalculation",
            },
            {
              question:
                "A mason uses 2 bags of cement to finish a 9 sqm wall. How many bags does he need for a 40 sqm wall?",
              options: ["7 bags", "8 bags", "9 bags", "10 bags"],
              correct: 2,
              explanation:
                "Rate = 2 bags / 9 sqm. For 40 sqm: (2/9) × 40 = 8.88 ≈ 9 bags (you must round up since partial bags are needed).",
              topic: "ratios",
              subTopic: "workRate",
            },
            {
              question:
                "Maria wrote down numbers from 20 to 80 on flash cards, one number per card. How many cards did she have?",
              options: ["59", "60", "61", "62"],
              correct: 2,
              explanation:
                "Count: 80 - 20 + 1 = 61 cards. The +1 is because both endpoints (20 and 80) are included.",
              topic: "basic",
              subTopic: "counting",
            },

            // MULTI-STEP WORD PROBLEM
            {
              question:
                "In an examination, 300 competitors passed the first part and 500 passed the second part. The total number of competitors who passed BOTH parts cannot exceed:",
              options: ["800", "500", "400", "300"],
              correct: 3,
              explanation:
                "The maximum who could have passed both is limited by the smaller group — 300 (those who passed Part 1). So the number who passed both cannot be more than 300.",
              topic: "wordProblems",
              subTopic: "setLogic",
            },
          ],
        },
        afpsatAbstract: {
          easy: [
            {
              question: "Pattern: ◯ △ □ ◯ △ __ What comes next?",
              options: ["◯", "△", "□", "◇"],
              correct: 2,
              explanation:
                "The pattern repeats every 3 symbols: circle, triangle, square. After triangle comes square.",
              topic: "sequences",
            },
            {
              question: "Number sequence: 2, 4, 8, 16, __ What is next?",
              options: ["24", "28", "32", "36"],
              correct: 2,
              explanation: "Each number is multiplied by 2. 16 × 2 = 32",
              topic: "sequences",
            },
            {
              question: "Pattern: ★ ★★ ★★★ ★★★★ __ What comes next?",
              options: ["★★★★", "★★★★★", "★★★", "★★"],
              correct: 1,
              explanation:
                "Each step adds one more star. After 4 stars comes 5 stars.",
              topic: "progression",
            },
            {
              question: "If ▲ is rotated 180 degrees, what results?",
              options: ["▲", "▼", "◀", "▶"],
              correct: 1,
              explanation:
                "Rotating a triangle 180 degrees flips it upside down, resulting in ▼",
              topic: "rotation",
            },
            {
              question: "Pattern: 1, 4, 9, 16, __ Continue the sequence:",
              options: ["20", "23", "25", "30"],
              correct: 2,
              explanation: "Perfect squares: 1²=1, 2²=4, 3²=9, 4²=16, 5²=25",
              topic: "sequences",
            },
          ],
          medium: [
            {
              question: "Pattern: 3, 6, 12, 24, __ What continues?",
              options: ["36", "42", "48", "54"],
              correct: 2,
              explanation: "Each number is multiplied by 2. 24 × 2 = 48",
              topic: "sequences",
            },
            {
              question:
                "If a square is rotated 90° clockwise repeatedly, after 4 rotations it will be:",
              options: [
                "Same as original",
                "Upside down",
                "On its side",
                "Invisible",
              ],
              correct: 0,
              explanation:
                "After 4×90° = 360°, the square returns to original position",
              topic: "rotation",
            },
            {
              question: "Pattern: 2, 5, 10, 17, 26, __ Continue:",
              options: ["35", "37", "39", "41"],
              correct: 1,
              explanation:
                "Differences: +3, +5, +7, +9, +11. Next is 26 + 11 = 37",
              topic: "sequences",
            },
            {
              question: "Which shape is different? ■ ● ▲ ◆",
              options: ["■", "●", "▲", "◆"],
              correct: 1,
              explanation:
                "● is the only curved shape; others are all polygons",
              topic: "oddOneOut",
            },
            {
              question: "Pattern: A1, C3, E5, G7, __ Continue:",
              options: ["H8", "I9", "J10", "K11"],
              correct: 1,
              explanation:
                "Letters skip one (A,C,E,G,I), numbers increase by 2 (1,3,5,7,9)",
              topic: "sequences",
            },
          ],
          hard: [
            {
              question:
                "A pattern shows: rotating 45° + growing 10% + changing color each step. After 4 steps from ●, what happens?",
              options: [
                "Rotated 180°, 40% larger, same color",
                "Rotated 180°, 46% larger, 4th color",
                "Rotated 135°, 44% larger, 4th color",
                "Original position, 40% larger, same color",
              ],
              correct: 1,
              explanation:
                "4 rotations of 45° = 180°. Growth: 1.1^4 = 1.4641 (46% larger). Color changes 4 times.",
              topic: "combined",
            },
            {
              question:
                "Sequence: 1, 1, 2, 3, 5, 8, 13, __ (Fibonacci) Continue:",
              options: ["18", "19", "20", "21"],
              correct: 3,
              explanation: "Each number is sum of previous two: 8 + 13 = 21",
              topic: "sequences",
            },
            {
              question:
                "Pattern involves simultaneous: vertical flip + horizontal shift right + element addition. After 3 cycles:",
              options: [
                "All transformations compound",
                "Returns to original",
                "Only last transformation applies",
                "Undefined",
              ],
              correct: 0,
              explanation:
                "All transformations compound: 3 flips, 3 shifts right, 3 elements added",
              topic: "combined",
            },
            {
              question:
                "If a hexagon rotates 60° each step, how many rotations until original position?",
              options: ["4", "5", "6", "8"],
              correct: 2,
              explanation: "360° ÷ 60° = 6 rotations to return to original",
              topic: "rotation",
            },
            {
              question:
                "Sequence: 2, 6, 12, 20, 30, __ Pattern: n(n+1). Continue:",
              options: ["40", "42", "44", "46"],
              correct: 1,
              explanation:
                "Pattern is n(n+1): 1×2=2, 2×3=6, 3×4=12, 4×5=20, 5×6=30, 6×7=42",
              topic: "sequences",
            },
            // LETTER-NUMBER COMBINED SERIES (real AFPSAT format)
            {
              question: "Series: Z25, Y24, X23, W22, __ What comes next?",
              options: ["U21", "V21", "V22", "U20"],
              correct: 1,
              explanation:
                "Letters go backward (Z, Y, X, W, V) and numbers decrease by 1 (25, 24, 23, 22, 21). Answer: V21.",
              topic: "sequences",
              subTopic: "letterNumber",
            },
            {
              question: "Series: 1, 3, 7, 15, 31, __ What comes next?",
              options: ["47", "55", "63", "71"],
              correct: 2,
              explanation:
                "Each number = previous × 2 + 1: (1×2+1=3), (3×2+1=7), (7×2+1=15), (15×2+1=31), (31×2+1=63).",
              topic: "sequences",
              subTopic: "doublingPlusOne",
            },
            {
              question:
                "Series: 2, 3, 5, 8, 13, 21, __ (Fibonacci variant +1) What comes next?",
              options: ["32", "33", "34", "35"],
              correct: 2,
              explanation:
                "Each number = sum of the two before it: 13+21 = 34. This is the Fibonacci sequence.",
              topic: "sequences",
              subTopic: "fibonacci",
            },
            {
              question: "Odd one out: 144, 169, 196, 216, 225",
              options: ["144", "169", "196", "216"],
              correct: 3,
              explanation:
                "144=12², 169=13², 196=14², 225=15² — all are perfect squares. But 216=6³ (a perfect cube, NOT a perfect square). So 216 is the odd one out.",
              topic: "oddOneOut",
              subTopic: "perfectSquares",
            },
            {
              question: "Series: AZ, BY, CX, DW, __ What comes next?",
              options: ["EU", "EV", "FV", "FU"],
              correct: 1,
              explanation:
                "First letter goes forward (A,B,C,D,E). Second letter goes backward (Z,Y,X,W,V). Answer: EV.",
              topic: "sequences",
              subTopic: "dualAlphabet",
            },
          ],
        },
        neuroPsych: {
          easy: [
            {
              question: "When working on a team project, I prefer to:",
              options: [
                "Take charge and lead the group",
                "Contribute equally with others",
                "Work independently on my portion",
                "Let others make all decisions",
              ],
              correct: 1,
              explanation:
                "Military values teamwork and collaboration. Contributing equally shows good team dynamics.",
              topic: "teamwork",
              consistency: "teamwork_1",
            },
            {
              question: "How often do you feel stressed or anxious?",
              options: ["Never", "Rarely", "Sometimes", "Often"],
              correct: 2,
              explanation:
                "Honest self-awareness is valued. 'Sometimes' is realistic and shows you can manage stress.",
              topic: "stress",
              consistency: "stress_1",
            },
            {
              question:
                "You notice a fellow soldier taking supplies without permission. What do you do?",
              options: [
                "Ignore it as it's not your business",
                "Report it to your superior officer",
                "Confront the soldier aggressively",
                "Take supplies yourself since others are doing it",
              ],
              correct: 1,
              explanation:
                "Reporting to superiors shows integrity and respect for chain of command.",
              topic: "integrity",
              consistency: "integrity_1",
            },
            {
              question: "I consider myself to be:",
              options: [
                "Very organized and structured",
                "Somewhat organized",
                "Flexible and adaptable",
                "Spontaneous and unplanned",
              ],
              correct: 0,
              explanation: "Military life requires organization and structure.",
              topic: "discipline",
              consistency: "discipline_1",
            },
            {
              question: "When facing a difficult challenge, I typically:",
              options: [
                "Give up if it's too hard",
                "Ask for help immediately",
                "Try my best and seek help if needed",
                "Refuse to admit I need help",
              ],
              correct: 2,
              explanation:
                "Shows problem-solving with appropriate help-seeking behavior.",
              topic: "resilience",
              consistency: "resilience_1",
            },
          ],
          medium: [
            {
              question:
                "During training, you receive harsh criticism from a superior. How do you respond?",
              options: [
                "Get defensive and argue back",
                "Listen respectfully and work to improve",
                "Ignore the feedback completely",
                "Feel personally attacked and lose motivation",
              ],
              correct: 1,
              explanation:
                "Accepting feedback constructively shows maturity and coachability.",
              topic: "feedback",
              consistency: "resilience_2",
            },
            {
              question: "In high-pressure situations, I usually:",
              options: [
                "Panic and freeze",
                "Stay calm and focused",
                "Get angry or frustrated",
                "Avoid the situation",
              ],
              correct: 1,
              explanation:
                "Staying calm under pressure is essential in military service.",
              topic: "stress",
              consistency: "stress_2",
            },
            {
              question: "How do you handle disagreements with teammates?",
              options: [
                "Avoid confrontation at all costs",
                "Discuss calmly to find solution",
                "Insist my way is always right",
                "Let them have their way even if wrong",
              ],
              correct: 1,
              explanation:
                "Calm discussion shows conflict resolution skills and respect.",
              topic: "teamwork",
              consistency: "teamwork_2",
            },
            {
              question: "When given an order I disagree with, I:",
              options: [
                "Refuse to follow it",
                "Follow it but complain constantly",
                "Follow it and voice concerns through proper channels",
                "Follow it and never question authority",
              ],
              correct: 2,
              explanation:
                "Shows respect for chain of command while maintaining appropriate communication.",
              topic: "discipline",
              consistency: "discipline_2",
            },
            {
              question:
                "You notice a safety hazard during an exercise. What do you do?",
              options: [
                "Continue as planned - someone else will notice",
                "Immediately alert your team and superior",
                "Only mention it if someone asks",
                "Worry about it but say nothing",
              ],
              correct: 1,
              explanation:
                "Safety is paramount. Alerting others shows responsibility and concern for team welfare.",
              topic: "integrity",
              consistency: "integrity_2",
            },
            // === CONSISTENCY TRAP PAIR 1 ===
            // (Tests same trait as easy Q1 — teamwork — but from the opposite angle)
            {
              question:
                "You are assigned to a group project, but you believe your teammates are taking the wrong approach. What is your FIRST action?",
              options: [
                "Immediately take over the project leadership",
                "Do your assigned part and stay quiet",
                "Bring up your concerns calmly in the group discussion",
                "Report the situation to your superior before discussing with the team",
              ],
              correct: 2,
              explanation:
                "The best first action is to raise your concern within the team. Taking over shows poor teamwork. Staying quiet shows passivity. Reporting to superiors before even discussing with teammates skips the proper first step.",
              topic: "teamwork",
              consistency: "teamwork_4",
            },

            // === IMPULSE CONTROL SCENARIO ===
            {
              question:
                "During a heated argument, a fellow soldier personally insults you in front of others. What do you do?",
              options: [
                "Insult them back immediately to defend your honor",
                "Stay calm, ignore it for now, and address it privately later",
                "Report it directly to the commanding officer during the argument",
                "Physically confront them to make a point",
              ],
              correct: 1,
              explanation:
                "Staying calm and addressing it privately shows emotional maturity and impulse control — a critical military trait. Physical or verbal retaliation is unacceptable conduct. Reporting mid-argument escalates instead of de-escalates.",
              topic: "stress",
              consistency: "stress_4",
            },

            // === AUTHORITY VS. ETHICS (mid-level) ===
            {
              question:
                "Your commanding officer gives you an order you find unnecessary and time-consuming. You:",
              options: [
                "Ignore the order and do what you think is better",
                "Follow the order but complain loudly to your peers",
                "Follow the order without complaint",
                "Ask permission to discuss the order after completing it",
              ],
              correct: 3,
              explanation:
                "The ideal response is to follow the order and then seek clarification afterward through proper channels. Ignoring orders undermines discipline. Complaining to peers damages team morale. Simply following without ever seeking to understand is also less ideal than asking afterward.",
              topic: "discipline",
              consistency: "discipline_4",
            },

            // === GZTS-STYLE SELF-REFLECTION ===
            {
              question:
                "Which statement best describes how you handle boredom during long, repetitive tasks?",
              options: [
                "I find ways to entertain myself even if it slows my work",
                "I push through, maintain pace, and stay focused on the goal",
                "I ask to be reassigned to something more challenging",
                "I frequently lose focus and need reminders to continue",
              ],
              correct: 1,
              explanation:
                "Military service involves sustained effort through routine tasks. Staying focused without complaint or distraction reflects the discipline and endurance the AFP values.",
              topic: "discipline",
              consistency: "discipline_5",
            },

            // === PEER PRESSURE SCENARIO ===
            {
              question:
                "Several of your peers routinely skip a non-mandatory but recommended unit activity. They pressure you to skip too. You:",
              options: [
                "Skip it to maintain good relations with your peers",
                "Attend and encourage others to come, without lecturing them",
                "Report all of them to the commanding officer",
                "Attend but avoid interacting with those who skipped",
              ],
              correct: 1,
              explanation:
                "Attending while positively encouraging peers reflects integrity and leadership without being confrontational or punitive. Skipping shows poor values. Over-reporting minor issues is disproportionate. Avoiding teammates damages unit cohesion.",
              topic: "integrity",
              consistency: "integrity_5",
            },

            // === EMOTIONAL CONTROL UNDER PRESSURE ===
            {
              question:
                "You fail an important evaluation despite studying hard. You feel devastated. Your healthiest immediate response is to:",
              options: [
                "Blame the evaluators for unfair testing",
                "Withdraw from your peers and isolate yourself",
                "Accept the result, identify what went wrong, and plan how to improve",
                "Immediately demand a re-evaluation",
              ],
              correct: 2,
              explanation:
                "Resilience means processing failure constructively. Blaming others and demanding re-evaluation shows poor accountability. Isolation is a sign of poor coping. The AFP values individuals who bounce back with a plan.",
              topic: "resilience",
              consistency: "resilience_3",
            },
          ],
          hard: [
            {
              question:
                "Your unit is preparing for deployment. A close friend confides they're considering deserting. What do you do?",
              options: [
                "Help them desert to protect friendship",
                "Report them immediately without talking first",
                "Listen, encourage them to reconsider, and suggest they speak to a counselor",
                "Ignore their concerns completely",
              ],
              correct: 2,
              explanation:
                "Shows empathy while maintaining integrity. Encouraging proper help-seeking is appropriate.",
              topic: "integrity",
              consistency: "integrity_3",
            },
            {
              question:
                "You're ordered to lead a mission you believe is poorly planned. You:",
              options: [
                "Refuse the order outright",
                "Accept but sabotage to prove your point",
                "Express concerns to superior, then execute to best of ability",
                "Follow blindly without question",
              ],
              correct: 2,
              explanation:
                "Appropriate to voice professional concerns, then execute orders faithfully.",
              topic: "leadership",
              consistency: "discipline_3",
            },
            {
              question: "Under extreme stress, I have (honestly):",
              options: [
                "Never felt overwhelmed",
                "Occasionally felt overwhelmed but recovered",
                "Often felt overwhelmed",
                "Always feel overwhelmed",
              ],
              correct: 1,
              explanation:
                "Honest self-assessment. Everyone feels overwhelmed sometimes; recovery is key.",
              topic: "stress",
              consistency: "stress_3",
            },
            {
              question:
                "A teammate is struggling with a task you've mastered. Your response:",
              options: [
                "Let them figure it out on their own",
                "Do it for them to save time",
                "Teach them patiently while encouraging independence",
                "Report them as incompetent",
              ],
              correct: 2,
              explanation:
                "Shows leadership, patience, and commitment to team development.",
              topic: "leadership",
              consistency: "teamwork_3",
            },
            {
              question:
                "You witness discrimination against a fellow soldier. You:",
              options: [
                "Stay silent to avoid trouble",
                "Join in to fit in with the group",
                "Intervene and report through proper channels",
                "Privately sympathize but take no action",
              ],
              correct: 2,
              explanation:
                "Military values dignity and respect. Intervention shows moral courage and integrity.",
              topic: "integrity",
              consistency: "integrity_4",
            },
            // === ETHICAL DILEMMA — CHAIN OF COMMAND CONFLICT ===
            {
              question:
                "You discover that your commanding officer has been falsifying equipment inventory reports. The officer is well-liked and has protected your unit. What do you do?",
              options: [
                "Ignore it — loyalty to your officer comes first",
                "Confront the officer privately and give them a chance to correct it",
                "Report it immediately to a higher authority through proper channels",
                "Tell your peers so the group can decide together",
              ],
              correct: 2,
              explanation:
                "Falsifying official reports is a serious violation regardless of personal loyalty. Integrity requires reporting it. Ignoring it makes you complicit. A private confrontation without escalating is insufficient for fraud. Group decisions on reporting bypass the chain of command.",
              topic: "integrity",
              consistency: "integrity_6",
            },

            // === CONSISTENCY TRAP — STRESS (paired with medium stress Q) ===
            {
              question:
                "You are given three urgent tasks simultaneously with no way to complete all three on time. No superior is available to ask. You:",
              options: [
                "Panic and attempt all three at once, completing none properly",
                "Choose the task you personally prefer and finish only that one",
                "Prioritize by mission impact, complete the most critical, and document why",
                "Wait until a superior is available before doing anything",
              ],
              correct: 2,
              explanation:
                "This tests decision-making under pressure without supervision. Prioritizing by impact and documenting the reasoning shows analytical thinking and accountability — a critical officer-level trait. Waiting indefinitely or acting randomly are both disqualifying behaviors.",
              topic: "stress",
              consistency: "stress_5",
            },

            // === GZTS CONSISTENCY TRAP — SOCIAL AGGRESSION ===
            {
              question:
                "You strongly disagree with a policy your unit has adopted. The majority of your peers support it. You:",
              options: [
                "Openly criticize the policy and rally others against it",
                "Accept it silently and comply, suppressing your view permanently",
                "Express your disagreement once through proper channels, then comply with the decision",
                "Comply publicly but undermine the policy in private",
              ],
              correct: 2,
              explanation:
                "Expressing disagreement once formally and then complying reflects mature professionalism. Open rebellion damages unit cohesion. Permanent silent compliance with no feedback loop is also unhealthy. Undermining in private is a form of insubordination and deception.",
              topic: "discipline",
              consistency: "discipline_6",
            },

            // === COMPLEX LOYALTY DILEMMA ===
            {
              question:
                "You witness a close friend and fellow soldier using their position to get preferential treatment for a family member's business contract with the AFP. No one else seems to notice. You:",
              options: [
                "Stay silent — it's not your business and they're your friend",
                "Participate and benefit from the arrangement to maintain the friendship",
                "Confront your friend privately and insist they stop, then report if they refuse",
                "Immediately report it without giving your friend a chance to explain",
              ],
              correct: 2,
              explanation:
                "This tests integrity under social pressure. The AFP prohibits conflict of interest. The right path is private confrontation first (giving benefit of the doubt), followed by reporting if the behavior continues. Pure silence or participation makes you complicit. Skipping confrontation and reporting immediately, while technically correct, shows a lack of mature judgment.",
              topic: "integrity",
              consistency: "integrity_7",
            },

            // === APPLICANT RISK PROFILER STYLE ===
            {
              question:
                "When you are under extreme pressure and feel you cannot cope, what is your TYPICAL real behavior? (Answer honestly — there is no trick here.)",
              options: [
                "I talk to someone I trust about it",
                "I handle it alone and never show weakness to others",
                "I engage in physical activity to release tension",
                "I tend to become irritable or short-tempered with others",
              ],
              correct: 0,
              explanation:
                "This question mirrors the Applicant Risk Profiler style — it is testing for HELP-SEEKING BEHAVIOR, which is a protective factor. Seeking support is the healthiest coping mechanism. Isolating, bottling up stress, or taking it out on others are risk indicators the AFP screens for.",
              topic: "stress",
              consistency: "stress_6",
            },

            // === LEADERSHIP UNDER AMBIGUITY ===
            {
              question:
                "Your unit receives an order with unclear instructions during a field exercise. Your superior is unreachable. Junior soldiers are looking to you for direction. You:",
              options: [
                "Tell everyone to stand by and do nothing until orders are clarified",
                "Make a reasonable interpretation of the order, proceed cautiously, and document your decision",
                "Let the most senior soldier by age decide",
                "Ask every team member to vote on the best interpretation",
              ],
              correct: 1,
              explanation:
                "Military environments require initiative and sound judgment under ambiguity. Making a reasonable, documented decision demonstrates leadership confidence. Doing nothing risks mission failure. Age-based hierarchy ignores rank. Voting decisions in a combat environment is unrealistic and dangerous.",
              topic: "leadership",
              consistency: "teamwork_5",
            },

            // === GZTS-STYLE SELF-AWARENESS TRAP ===
            {
              question:
                "You have been described by others as 'too sensitive' when receiving criticism. When you reflect on this honestly, you:",
              options: [
                "Disagree — you handle criticism perfectly and others are wrong",
                "Somewhat agree — you may react defensively at first but you recover",
                "Fully agree — criticism often ruins your focus for the rest of the day",
                "Disagree — you simply have high standards for how criticism should be delivered",
              ],
              correct: 1,
              explanation:
                "This is a self-awareness question. Option B shows honest self-reflection AND resilience — you acknowledge the tendency but demonstrate it doesn't permanently affect you. Flat denial (A or D) signals poor self-awareness. Full agreement (C) signals vulnerability to sustained performance degradation under criticism.",
              topic: "resilience",
              consistency: "resilience_4",
            },
          ],
        },
      };

      // Show section
      function showSection(sectionId, event) {
        // ✅ ADD event parameter
        document.querySelectorAll(".content-section").forEach((section) => {
          section.classList.remove("active");
        });
        document.querySelectorAll(".nav-tab").forEach((tab) => {
          tab.classList.remove("active");
        });

        document.getElementById(sectionId).classList.add("active");
        if (event && event.target) {
          event.target.classList.add("active");
        } else {
          // Called from a card — highlight the matching nav tab
          document.querySelectorAll(".nav-tab").forEach((tab) => {
            if (
              tab.getAttribute("onclick") &&
              tab.getAttribute("onclick").includes(sectionId)
            ) {
              tab.classList.add("active");
            }
          });
        }

        if (sectionId === "stats") {
          updateStats();
        }

        // Render resources if resources section
        if (sectionId === "resources") {
          renderResources();
        }
        if (sectionId === "flashcards") {
          fcRenderCard();
        }
        if (sectionId === "medicalTest") {
          if (!document.querySelector("#cvtPlates .cvt-plate")) {
            renderColorTestPlates();
          }
        }
        if (sectionId === "checklist") {
          renderChecklist();
        }
        if (sectionId === "studyPlan") {
          renderStudyPlan();
        }
        // Update game scores if games section
        if (sectionId === "games") {
          updateGameScores();
        }
      }

      // Show tutorial
      function showTutorial(tutorialId) {
        const tutorial = tutorials[tutorialId];
        const modalContent = document.getElementById("modalContent");
        modalContent.innerHTML = `
                <h2 style="color: var(--primary); margin-bottom: 20px;">${tutorial.title}</h2>
                <div class="lesson-content">${tutorial.content}</div>
            `;
        document.getElementById("modal").classList.add("active");
      }

      // Start practice with difficulty selection
      function startPractice(type) {
        const html = `
    <div style="text-align: center; padding: 30px;">
      <h2 style="color: var(--primary); margin-bottom: 20px;">Select Difficulty Level</h2>
      <p style="margin-bottom: 30px;">Choose your practice difficulty. Start with Easy and progress to Hard.</p>
      
      <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
        <button class="btn btn-success" onclick="startPracticeSession('${type}', 'easy')" style="padding: 20px 40px;">
          <div style="font-size: 1.2rem; margin-bottom: 5px;">🟢 EASY</div>
          <div style="font-size: 0.9rem;">Build confidence</div>
        </button>
        <button class="btn btn-primary" onclick="startPracticeSession('${type}', 'medium')" style="padding: 20px 40px;">
          <div style="font-size: 1.2rem; margin-bottom: 5px;">🟡 MEDIUM</div>
          <div style="font-size: 0.9rem;">Realistic difficulty</div>
        </button>
        <button class="btn btn-danger" onclick="startPracticeSession('${type}', 'hard')" style="padding: 20px 40px;">
          <div style="font-size: 1.2rem; margin-bottom: 5px;">🔴 HARD</div>
          <div style="font-size: 0.9rem;">Challenge yourself</div>
        </button>
      </div>
      
      <div class="tip-box" style="max-width: 600px; margin: 30px auto;">
        <strong>💡 Tip:</strong> Master Easy level (80%+ accuracy) before attempting Medium. 
        Achieve 75%+ on Hard to be exam-ready.
      </div>
    </div>
  `;

        // Open in modal instead of inline
        document.getElementById("practiceModalContent").innerHTML = html;
        document.getElementById("practiceModal").classList.add("active");
        document.body.style.overflow = "hidden"; // Prevent background scroll
      }
      // ===== UNIVERSAL MODAL SYSTEM =====

      // Generic modal opener
      function openModal(modalId, title, content, showCloseButton = true) {
        const modal = document.getElementById(modalId);
        const modalContent = document.getElementById(modalId + "Content");

        if (!modal || !modalContent) {
          console.error(`Modal ${modalId} not found`);
          return;
        }

        // Build modal structure with optional header
        let html = "";

        if (title) {
          html += `
      <div class="modal-header">
        <h2 class="modal-title">${title}</h2>
      </div>
    `;
        }

        html += `<div class="modal-body">${content}</div>`;

        modalContent.innerHTML = html;
        modal.classList.add("active");
        document.body.style.overflow = "hidden";
      }

      // Generic modal closer with animation
      function closeModalAnimated(modalId) {
        const modal = document.getElementById(modalId);
        if (!modal) return;

        // Add fade out animation
        modal.style.animation = "fadeOut 0.3s ease";
        const modalContent = modal.querySelector(".modal-content");
        if (modalContent) {
          modalContent.style.animation = "modalSlideOut 0.3s ease";
        }

        setTimeout(() => {
          modal.classList.remove("active");
          modal.style.animation = "";
          if (modalContent) {
            modalContent.style.animation = "";
          }
          document.body.style.overflow = "";

          // Stop any active timers
          stopTimer();
        }, 300);
      }

      // Enhanced close practice modal (update existing function)
      function closePracticeModal() {
        closeModalAnimated("practiceModal");
      }

      // Close game modal
      function closeGameModal() {
        closeModalAnimated("gameModal");
      }

      // Close mock exam modal
      function closeMockExamModal() {
        closeModalAnimated("mockExamModal");
      }

      // Click outside to close - update existing listener
      document.addEventListener("click", function (event) {
        const modals = ["practiceModal", "gameModal", "mockExamModal", "modal"];

        modals.forEach((modalId) => {
          const modal = document.getElementById(modalId);
          if (event.target === modal) {
            if (modalId === "practiceModal") closePracticeModal();
            else if (modalId === "gameModal") closeGameModal();
            else if (modalId === "mockExamModal") closeMockExamModal();
            else closeModal();
          }
        });
      });

      // ESC key to close modals
      document.addEventListener("keydown", function (event) {
        const practiceModal = document.getElementById("practiceModal");

        // Keyboard shortcuts (only when practice modal is open)
        if (practiceModal && practiceModal.classList.contains("active")) {
          if (
            event.target.tagName !== "INPUT" &&
            event.target.tagName !== "TEXTAREA"
          ) {
            if (["1", "2", "3", "4"].includes(event.key)) {
              const optionIndex = parseInt(event.key) - 1;
              const options = document.querySelectorAll(".option");
              if (options[optionIndex]) {
                options.forEach((opt) => opt.classList.remove("selected"));
                options[optionIndex].classList.add("selected");
                window.selectedAnswer = optionIndex;
                showNotification(`Option ${event.key} selected`);
              }
            }
            if (event.key === "Enter") {
              const submitBtn = document.querySelector(
                'button[onclick="submitAnswer()"]',
              );
              const nextBtn = document.querySelector(
                'button[onclick="nextQuestion()"]',
              );
              if (nextBtn && !nextBtn.disabled) {
                nextBtn.click();
              } else if (submitBtn && !submitBtn.disabled) {
                submitBtn.click();
              }
            }
          }
        }

        // ESC key to close modals
        if (event.key === "Escape") {
          if (
            document
              .getElementById("practiceModal")
              .classList.contains("active")
          ) {
            closePracticeModal();
          } else if (
            document.getElementById("gameModal").classList.contains("active")
          ) {
            closeGameModal();
          } else if (
            document
              .getElementById("mockExamModal")
              .classList.contains("active")
          ) {
            closeMockExamModal();
          } else if (
            document.getElementById("modal").classList.contains("active")
          ) {
            closeModal();
          }
        }
      });

      // Start practice session with selected difficulty
      window.startPracticeSession = function (type, difficulty) {
        // ✅ ADD loading state
        document.getElementById("practiceModalContent").innerHTML = `
          <div style="text-align: center; padding: 60px;">
            <div style="font-size: 3rem; animation: spin 1s linear infinite;">⚙️</div>
            <p style="margin-top: 20px; color: var(--text-light);">Preparing questions...</p>
          </div>
        `;

        const questionSet =
          type === "neuroPsych"
            ? [
                ...practiceQuestions.neuroPsych.easy,
                ...practiceQuestions.neuroPsych.medium,
                ...practiceQuestions.neuroPsych.hard,
              ]
            : practiceQuestions[type][difficulty];

        // SHUFFLE: Randomize question order and option order
        const shuffledQuestions = shuffleQuestions([...questionSet]); // Create copy first

        let currentQuestion = 0;
        let score = 0;
        let timeStarted;
        let answeredOnTime = 0;
        let reviewLog = []; // ← ADD THIS LINE

        // Determine time limit per question based on type
        const timeLimits = {
          afpsatVerbal: 28, // 27.7 seconds
          afpsatNumerical: 60, // 60 seconds
          afpsatAbstract: 15, // 14.4 seconds
          neuroPsych: 0, // No time limit for psych
        };

        const timeLimit = timeLimits[type] || 0;

        function showQuestion() {
          if (currentQuestion >= shuffledQuestions.length) {
            showPracticeResults(
              score,
              shuffledQuestions.length,
              answeredOnTime,
              type,
              difficulty,
            );
            return;
          }

          const q = shuffledQuestions[currentQuestion];
          timeStarted = Date.now(); // Reset timer for each question

          const timerHTML =
            timeLimit > 0
              ? `
                    <div id="sectionTimer" class="timer" style="display: inline-block; padding: 10px 20px; margin: 10px 0;">
                        ${timeLimit}s
                    </div>
                `
              : "";

          const html = `
                    <div class="question-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="color: var(--primary); margin: 0;">
                                Question ${currentQuestion + 1} of ${shuffledQuestions.length}
                            </h3>
                            ${timerHTML}
                        </div>
                        <div style="background: var(--bg-light); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <strong>Difficulty:</strong> 
                            <span style="color: ${difficulty === "easy" ? "var(--success)" : difficulty === "medium" ? "var(--accent)" : "var(--danger)"}; text-transform: uppercase;">
                                ${difficulty}
                            </span>
                        </div>
                        <p style="margin: 20px 0; font-size: 1.1rem; line-height: 1.6;">${q.question}</p>
                        <div class="options">
                            ${q.options
                              .map(
                                (opt, i) => `
                                <div class="option" onclick="selectAnswer(${i})">${opt}</div>
                            `,
                              )
                              .join("")}
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="submitAnswer()" style="margin-top: 20px;">Submit Answer</button>
                `;

          document.getElementById("practiceModalContent").innerHTML = html;

          // Start question timer if applicable
          if (timeLimit > 0) {
            startTimer(timeLimit, type, "practice");
          }
        }

        window.selectAnswer = function (optionIndex) {
          document
            .querySelectorAll(".option")
            .forEach((opt) => opt.classList.remove("selected"));
          document
            .querySelectorAll(".option")
            [optionIndex].classList.add("selected");
          window.selectedAnswer = optionIndex;
        };

        window.submitAnswer = function () {
          if (window.selectedAnswer === undefined) {
            showNotification("Please select an answer!");
            return;
          }

          // ✅ FIX 1: Prevent multiple submissions
          const submitBtn = document.querySelector(
            'button[onclick="submitAnswer()"]',
          );
          if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.style.opacity = "0.5";
            submitBtn.style.cursor = "not-allowed";
          }

          stopTimer();
          const questionTime = Date.now() - timeStarted;
          const onTime = timeLimit === 0 || questionTime / 1000 <= timeLimit;

          if (onTime) answeredOnTime++;

          const q = shuffledQuestions[currentQuestion];
          const correct = window.selectedAnswer === q.correct;

          if (correct) {
            score++;
            userData.correctAnswers++;
          }
          userData.totalQuestions++;

          // Track by topic (your existing code)
          if (!userData.weakAreas[q.topic]) {
            userData.weakAreas[q.topic] = { correct: 0, total: 0 };
            userData.strongAreas[q.topic] = { correct: 0, total: 0 };
          }

          // Track verbal sub-topics (your existing code)
          const verbalTopics = [
            "analogies",
            "vocabulary",
            "comprehension",
            "grammar",
          ];
          if (verbalTopics.includes(q.topic)) {
            if (!userData.verbalSubTopicPerformance) {
              userData.verbalSubTopicPerformance = {
                analogies: { correct: 0, total: 0 },
                vocabulary: { correct: 0, total: 0 },
                comprehension: { correct: 0, total: 0 },
                grammar: { correct: 0, total: 0 },
              };
            }

            if (!userData.verbalSubTopicPerformance[q.topic]) {
              userData.verbalSubTopicPerformance[q.topic] = {
                correct: 0,
                total: 0,
              };
            }

            userData.verbalSubTopicPerformance[q.topic].total++;
            if (correct) {
              userData.verbalSubTopicPerformance[q.topic].correct++;
            }
          }

          userData.weakAreas[q.topic].total++;
          userData.strongAreas[q.topic].total++;

          if (correct) {
            userData.strongAreas[q.topic].correct++;
            userData.weakAreas[q.topic].correct++;
          }

          // Check strict mode
          if (userData.preferences.strictExamMode) {
            currentQuestion++;
            showQuestion();
            return;
          }

          // ✅ FIX 2: Mark correct answer visually
          const options = document.querySelectorAll(".option");
          options[q.correct].classList.add("correct");

          // ✅ FIX 3: If user was wrong, mark their selection
          if (!correct && window.selectedAnswer !== undefined) {
            options[window.selectedAnswer].classList.add("incorrect");
          }

          // Time feedback
          const timeFeedback =
            timeLimit > 0
              ? `
        <p style="margin-top: 10px;">
            <strong>Time taken:</strong> ${Math.round(questionTime / 1000)}s 
            ${onTime ? "✅ On time" : "⚠️ Over time - practice speed!"}
        </p>
    `
              : "";

          // ✅ FIX 4: Create explanation HTML with null-safe access
          const explanation = `
    <div class="explanation">
        <strong>${correct ? "✅ Correct!" : "❌ Incorrect"}</strong>
        <p style="margin-top: 10px;">${q.explanation || "No explanation available."}</p>
        ${timeFeedback}
    </div>
    <button class="btn btn-primary" onclick="nextQuestion()" style="margin-top: 20px;">
        ${currentQuestion < shuffledQuestions.length - 1 ? "Next Question" : "See Results"}
    </button>
  `;

          // ✅ FIX 5: Remove existing explanation and next button FIRST
          const existingExplanation = document.querySelector(".explanation");
          const existingNextBtn = document.querySelector(
            'button[onclick="nextQuestion()"]',
          );

          if (existingExplanation) {
            existingExplanation.remove();
          }
          if (existingNextBtn) {
            existingNextBtn.remove();
          }

          // ✅ FIX 6: Now insert the NEW explanation (not duplicate)
          const questionCard = document.querySelector(".question-card");
          if (questionCard) {
            // Insert after the question card
            questionCard.insertAdjacentHTML("afterend", explanation);
          } else {
            // Fallback: append to modal content
            document
              .getElementById("practiceModalContent")
              .insertAdjacentHTML("beforeend", explanation);
          }

          // Save to review log for post-session review
          reviewLog.push({
            question: q.question,
            options: q.options,
            correct: q.correct,
            userAnswer: window.selectedAnswer,
            explanation: q.explanation || "No explanation available.",
          });

          saveUserData();
          window.selectedAnswer = undefined;
        };
        window.nextQuestion = function () {
          // ✅ Prevent double-clicking
          const nextBtn = document.querySelector(
            'button[onclick="nextQuestion()"]',
          );
          if (nextBtn) {
            nextBtn.disabled = true;
          }
          currentQuestion++;
          showQuestion();
        };

        showQuestion();
      };

      function showAnswerReview() {
        let html = `
          <div style="padding: 10px;">
            <h2 style="color: var(--primary); margin-bottom: 5px;">📋 Answer Review</h2>
            <p style="color: var(--text-light); margin-bottom: 20px; font-size: 0.95rem;">
              Review every question from this session. Learn from your mistakes!
            </p>
        `;

        reviewLog.forEach((entry, index) => {
          const isCorrect = entry.userAnswer === entry.correct;
          const userDidNotAnswer = entry.userAnswer === undefined;

          html += `
            <div style="
              background: ${isCorrect ? "#f0fdf4" : "#fff1f2"};
              border: 2px solid ${isCorrect ? "#86efac" : "#fca5a5"};
              border-radius: 12px;
              padding: 18px;
              margin-bottom: 16px;
            ">
              <div style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 12px;">
                <span style="
                  font-size: 1.3rem;
                  flex-shrink: 0;
                  margin-top: 2px;
                ">${isCorrect ? "✅" : "❌"}</span>
                <p style="font-weight: 600; font-size: 1rem; line-height: 1.5; color: var(--text-dark);">
                  Q${index + 1}. ${entry.question}
                </p>
              </div>

              <div style="margin-left: 32px;">
                ${entry.options
                  .map((opt, i) => {
                    let bg = "var(--bg-light)";
                    let border = "1px solid var(--border)";
                    let label = "";

                    if (i === entry.correct) {
                      bg = "#dcfce7";
                      border = "2px solid #16a34a";
                      label =
                        '<span style="color:#16a34a; font-weight:700; margin-left:8px;">✓ Correct</span>';
                    }
                    if (i === entry.userAnswer && !isCorrect) {
                      bg = "#fee2e2";
                      border = "2px solid #dc2626";
                      label =
                        '<span style="color:#dc2626; font-weight:700; margin-left:8px;">✗ Your answer</span>';
                    }
                    if (i === entry.userAnswer && isCorrect) {
                      label =
                        '<span style="color:#16a34a; font-weight:700; margin-left:8px;">✓ Your answer</span>';
                    }

                    return `
                    <div style="
                      background: ${bg};
                      border: ${border};
                      border-radius: 8px;
                      padding: 10px 14px;
                      margin-bottom: 8px;
                      font-size: 0.93rem;
                      display: flex;
                      align-items: center;
                    ">
                      <span style="font-weight: 600; margin-right: 8px; color: var(--primary);">
                        ${String.fromCharCode(65 + i)}.
                      </span>
                      ${opt}${label}
                    </div>
                  `;
                  })
                  .join("")}

                ${
                  userDidNotAnswer
                    ? `
                  <p style="color: var(--accent); font-size: 0.9rem; margin: 6px 0;">
                    ⚠️ You did not answer this question.
                  </p>
                `
                    : ""
                }

                <div style="
                  background: white;
                  border-left: 4px solid var(--primary);
                  border-radius: 6px;
                  padding: 12px 14px;
                  margin-top: 10px;
                  font-size: 0.92rem;
                  color: var(--text-dark);
                  line-height: 1.6;
                ">
                  <strong style="color: var(--primary);">💡 Explanation:</strong><br/>
                  ${entry.explanation}
                </div>
              </div>
            </div>
          `;
        });

        html += `
            <div style="text-align: center; margin-top: 20px; padding-bottom: 10px;">
              <button class="btn btn-primary" onclick="closePracticeModal(); showSection('practice')">
                ✅ Done — Practice Again
              </button>
            </div>
          </div>
        `;

        document.getElementById("practiceModalContent").innerHTML = html;

        // Scroll to top of modal
        const modal = document.getElementById("practiceModal");
        if (modal) modal.scrollTop = 0;
        const modalContent = document.querySelector(
          "#practiceModal .modal-content",
        );
        if (modalContent) modalContent.scrollTop = 0;
      }

      function showPracticeResults(
        score,
        total,
        answeredOnTime,
        type,
        difficulty,
      ) {
        const percentage = Math.round((score / total) * 100);
        const onTimePercentage = answeredOnTime
          ? Math.round((answeredOnTime / total) * 100)
          : 0;

        // Track performance
        const sectionKey = type.replace("afpsat", "").toLowerCase();
        if (userData.sectionPerformance[sectionKey]) {
          userData.sectionPerformance[sectionKey].push({
            score: percentage,
            difficulty: difficulty,
            date: new Date().toISOString(),
          });
        }
        // ✅ ADD: Save to overall scores
        if (type === "neuroPsych") {
          userData.neuroPsychScores.push(percentage);
        } else {
          // It's AFPSAT (verbal, numerical, or abstract)
          userData.afpsatScores.push(percentage);
        }
        // Update time management tracking
        if (answeredOnTime !== undefined) {
          userData.questionsAnsweredOnTime += answeredOnTime;
          userData.questionsTotalTimed += total;
        }

        saveUserData();

        const performanceLevel =
          percentage >= 85
            ? {
                level: "Excellent",
                color: "var(--success)",
                message: "Outstanding! You're ready for harder challenges.",
              }
            : percentage >= 75
              ? {
                  level: "Very Good",
                  color: "var(--primary)",
                  message: "Great work! This is exam-passing level.",
                }
              : percentage >= 65
                ? {
                    level: "Good",
                    color: "var(--accent)",
                    message: "Good progress! Keep practicing to reach 75%+.",
                  }
                : percentage >= 50
                  ? {
                      level: "Fair",
                      color: "var(--accent)",
                      message: "You're improving. Review topics and try again.",
                    }
                  : {
                      level: "Needs Work",
                      color: "var(--danger)",
                      message: "More study needed. Review tutorials first.",
                    };

        const timeManagementMessage =
          onTimePercentage >= 90
            ? "✅ Excellent time management!"
            : onTimePercentage >= 70
              ? "⚠️ Good timing, but practice speed more"
              : onTimePercentage >= 50
                ? "⚠️ Time pressure is affecting you - speed drills needed"
                : "❌ Critical: You must improve speed for the real exam";

        const html = `
                <div class="score-summary">
                    <h2 style="color: var(--primary);">Practice Complete!</h2>
                    
                    <div class="score-circle">
                        <div class="score">${score}</div>
                        <div class="total">out of ${total}</div>
                    </div>
                    
                    <h3 style="color: ${performanceLevel.color}; margin: 20px 0;">
                        Score: ${percentage}% - ${performanceLevel.level}
                    </h3>
                    
                    <div style="background: var(--bg-light); padding: 20px; border-radius: 12px; margin: 20px 0; text-align: left;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">Performance Breakdown</h4>
                        
                        <div style="margin: 10px 0;">
                            <strong>Difficulty Level:</strong> 
                            <span style="color: ${difficulty === "easy" ? "var(--success)" : difficulty === "medium" ? "var(--accent)" : "var(--danger)"}; text-transform: uppercase;">
                                ${difficulty}
                            </span>
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <strong>Accuracy:</strong> ${score}/${total} correct (${percentage}%)
                            <div class="progress-bar" style="height: 20px; margin-top: 5px;">
                                <div class="progress-fill" style="width: ${percentage}%;">${percentage}%</div>
                            </div>
                        </div>
                        
                        ${
                          answeredOnTime !== undefined
                            ? `
                            <div style="margin: 10px 0;">
                                <strong>Time Management:</strong> ${answeredOnTime}/${total} answered on time (${onTimePercentage}%)
                                <div class="progress-bar" style="height: 20px; margin-top: 5px;">
                                    <div class="progress-fill" style="width: ${onTimePercentage}%; background: ${onTimePercentage >= 80 ? "var(--success)" : "var(--accent)"};">
                                        ${onTimePercentage}%
                                    </div>
                                </div>
                                <p style="margin-top: 5px; font-size: 0.9rem;">${timeManagementMessage}</p>
                            </div>
                        `
                            : ""
                        }
                        
                    </div>
                    
                    <div class="tip-box" style="margin: 20px 0;">
                        <strong>${performanceLevel.level}:</strong> ${performanceLevel.message}
                    </div>
                    
                    ${
                      percentage >= 80 && difficulty === "easy"
                        ? `
                        <div class="tip-box" style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border-left-color: var(--success);">
                            <strong>🎯 Ready for Next Level!</strong> You've mastered Easy difficulty. 
                            Try Medium difficulty to continue improving.
                        </div>
                    `
                        : ""
                    }
                    
                    ${
                      percentage >= 75 && difficulty === "medium"
                        ? `
                        <div class="tip-box" style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border-left-color: var(--success);">
                            <strong>🎯 Ready for Hard Level!</strong> You're performing at passing level. 
                            Challenge yourself with Hard difficulty.
                        </div>
                    `
                        : ""
                    }
                    
                    ${
                      percentage >= 75 && difficulty === "hard"
                        ? `
                        <div class="tip-box" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-left-color: var(--accent);">
                            <strong>⭐ EXAM READY!</strong> Scoring 75%+ on Hard difficulty means you're well-prepared. 
                            Take a full mock exam when ready!
                        </div>
                    `
                        : ""
                    }
                    
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="showAnswerReview()">📋 Review Answers</button>
                        <button class="btn btn-primary" onclick="showSection('practice')">Practice Again</button>
                        <button class="btn btn-success" onclick="showSection('stats')">View Full Stats</button>
                        <button class="btn" style="background: var(--accent); color: white;" onclick="showSection('dashboard')">Dashboard</button>
                    </div>
                </div>
            `;
        document.getElementById("practiceModalContent").innerHTML = html;
        updateDashboard();
        updateStats(); // ✅ ADD: Force stats update
      }

      // Start mock exam - now opens in modal
      function startMockExam(examType) {
        let title = "";
        let html = "";

        if (examType === "afpsat") {
          title = "⏱️ AFPSAT Full Mock Exam";
          html = `
      <div style="text-align: center; padding: 20px;">
        <div style="background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-cream) 100%); padding: 30px; border-radius: 16px; margin-bottom: 30px;">
          <h3 style="color: var(--primary); margin-bottom: 20px; font-size: 1.5rem;">
            Simulate Real AFPSAT Test Conditions
          </h3>
          <p style="margin: 15px 0; color: var(--text-dark); font-size: 1.1rem;">
            This mock exam replicates the actual AFPSAT structure:
          </p>
        </div>
        
        <div style="background: white; padding: 25px; border-radius: 12px; margin: 20px auto; max-width: 600px; text-align: left; box-shadow: 0 4px 12px var(--shadow-soft);">
          <ul style="list-style: none; padding: 0;">
            <li style="padding: 12px; margin: 8px 0; background: var(--bg-light); border-radius: 8px; border-left: 4px solid var(--primary);">
              <strong>📐 Abstract Reasoning:</strong> 50 questions (12 minutes)
            </li>
            <li style="padding: 12px; margin: 8px 0; background: var(--bg-light); border-radius: 8px; border-left: 4px solid var(--secondary);">
              <strong>📖 Verbal Ability:</strong> 65 questions (30 minutes)
            </li>
            <li style="padding: 12px; margin: 8px 0; background: var(--bg-light); border-radius: 8px; border-left: 4px solid var(--secondary-light);">
              <strong>🔢 Numerical Ability:</strong> 35 questions (35 minutes)
            </li>
            <li style="padding: 12px; margin: 8px 0; background: var(--accent); color: white; border-radius: 8px; font-weight: 600;">
              <strong>⏱️ Total:</strong> 150 questions in 77 minutes
            </li>
          </ul>
        </div>
        
        <div class="tip-box" style="max-width: 700px; margin: 30px auto; text-align: left;">
          <strong>⚠️ Important Rules:</strong>
          <ul style="margin: 15px 0 0 20px;">
            <li>Timer cannot be paused once started</li>
            <li>You must complete all sections in one sitting</li>
            <li>Ensure 90+ minutes of uninterrupted time</li>
            <li>Use headphones to minimize distractions</li>
          </ul>
        </div>
        
        <button class="btn btn-success" onclick="launchMockExam('afpsat')" 
                style="padding: 18px 50px; font-size: 1.3rem; margin-top: 20px;">
          🚀 Start AFPSAT Mock Exam
        </button>
      </div>
    `;
        } else {
          title = "🧠 Neuro-Psychological Mock Exam";
          html = `
      <div style="text-align: center; padding: 20px;">
        <div style="background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-cream) 100%); padding: 30px; border-radius: 16px; margin-bottom: 30px;">
          <h3 style="color: var(--primary); margin-bottom: 20px; font-size: 1.5rem;">
            Comprehensive Psychological Assessment
          </h3>
          <p style="margin: 15px 0; color: var(--text-dark); font-size: 1.1rem;">
            This simulation evaluates your psychological readiness for military service:
          </p>
        </div>
        
        <div style="background: white; padding: 25px; border-radius: 12px; margin: 20px auto; max-width: 600px; text-align: left; box-shadow: 0 4px 12px var(--shadow-soft);">
          <ul style="list-style: none; padding: 0;">
            <li style="padding: 12px; margin: 8px 0; background: var(--bg-light); border-radius: 8px; border-left: 4px solid var(--primary);">
              <strong>👤 Personality Assessment:</strong> Behavioral patterns & attitudes
            </li>
            <li style="padding: 12px; margin: 8px 0; background: var(--bg-light); border-radius: 8px; border-left: 4px solid var(--secondary);">
              <strong>🎯 Situational Judgment:</strong> Decision-making scenarios
            </li>
            <li style="padding: 12px; margin: 8px 0; background: var(--bg-light); border-radius: 8px; border-left: 4px solid var(--secondary-light);">
              <strong>🧩 Logical Thinking:</strong> Critical reasoning problems
            </li>
            <li style="padding: 12px; margin: 8px 0; background: var(--bg-light); border-radius: 8px; border-left: 4px solid var(--accent);">
              <strong>💪 Stress Tolerance:</strong> Emotional control evaluation
            </li>
            <li style="padding: 12px; margin: 8px 0; background: var(--accent); color: white; border-radius: 8px; font-weight: 600;">
              <strong>⏱️ Estimated Time:</strong> 60 minutes
            </li>
          </ul>
        </div>
        
        <div class="tip-box" style="max-width: 700px; margin: 30px auto; text-align: left; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);">
          <strong>💡 Remember:</strong>
          <ul style="margin: 15px 0 0 20px;">
            <li>Answer honestly and consistently</li>
            <li>No "right" or "wrong" answers exist</li>
            <li>Test detects inconsistencies automatically</li>
            <li>First instinct is usually most accurate</li>
          </ul>
        </div>
        
        <button class="btn btn-success" onclick="launchMockExam('neuroPsych')" 
                style="padding: 18px 50px; font-size: 1.3rem; margin-top: 20px;">
          🧠 Start Neuro-Psych Mock Exam
        </button>
      </div>
    `;
        }

        // Open in modal
        const modalContent = document.getElementById("mockExamModalContent");
        modalContent.innerHTML = `
    <div class="modal-header">
      <h2 class="modal-title">${title}</h2>
    </div>
    <div class="modal-body">${html}</div>
  `;

        document.getElementById("mockExamModal").classList.add("active");
        document.body.style.overflow = "hidden";
      }

      // REPLACE with actual implementation:
      function launchMockExam(type) {
        closeMockExamModal();

        if (type === "afpsat") {
          startFullAFPSATMock();
        } else {
          startFullNeuroPsychMock();
        }
      }

      // ADD these new functions after launchMockExam:
      function startFullAFPSATMock() {
        // Helper to repeat a question pool until we hit the target count
        function fillToCount(pool, targetCount) {
          const result = [];
          while (result.length < targetCount) {
            const shuffled = shuffleQuestions([...pool]);
            result.push(...shuffled);
          }
          return result.slice(0, targetCount);
        }

        // Abstract: 50 questions (12 min)
        const abstractPool = [
          ...practiceQuestions.afpsatAbstract.easy,
          ...practiceQuestions.afpsatAbstract.medium,
          ...practiceQuestions.afpsatAbstract.hard,
        ];
        const abstractQuestions = fillToCount(abstractPool, 50).map((q) => ({
          ...q,
          _section: "Abstract Reasoning",
        }));

        // Verbal: 65 questions (30 min)
        const verbalPool = [
          ...practiceQuestions.afpsatVerbal.easy,
          ...practiceQuestions.afpsatVerbal.medium,
          ...practiceQuestions.afpsatVerbal.hard,
        ];
        const verbalQuestions = fillToCount(verbalPool, 65).map((q) => ({
          ...q,
          _section: "Verbal Ability",
        }));

        // Numerical: 35 questions (35 min)
        const numericalPool = [
          ...practiceQuestions.afpsatNumerical.easy,
          ...practiceQuestions.afpsatNumerical.medium,
          ...practiceQuestions.afpsatNumerical.hard,
        ];
        const numericalQuestions = fillToCount(numericalPool, 35).map((q) => ({
          ...q,
          _section: "Numerical Ability",
        }));

        // Combine: 50 + 65 + 35 = 150 total, in section order
        const allQuestions = [
          ...abstractQuestions,
          ...verbalQuestions,
          ...numericalQuestions,
        ];

        startTimedExam(allQuestions, 4620, "AFPSAT Full Mock"); // 77 minutes
      }
      function startFullNeuroPsychMock() {
        // Pull from all difficulty levels
        const allQuestions = [
          ...practiceQuestions.neuroPsych.easy,
          ...practiceQuestions.neuroPsych.medium,
          ...practiceQuestions.neuroPsych.hard,
        ];

        // Shuffle and select 45 questions for a harder, longer simulation
        const shuffled = shuffleQuestions(allQuestions);

        // Separate by topic to ensure balanced coverage
        const byTopic = {};
        shuffled.forEach((q) => {
          if (!byTopic[q.topic]) byTopic[q.topic] = [];
          byTopic[q.topic].push(q);
        });

        // Build balanced set — pull up to 8 from each major topic
        const topics = [
          "integrity",
          "stress",
          "teamwork",
          "discipline",
          "leadership",
          "resilience",
          "feedback",
        ];
        let balanced = [];
        topics.forEach((topic) => {
          if (byTopic[topic]) {
            balanced.push(...byTopic[topic].slice(0, 8));
          }
        });

        // Fill to 45 if needed with remaining questions
        const used = new Set(balanced.map((q) => q.question));
        shuffled.forEach((q) => {
          if (!used.has(q.question) && balanced.length < 45) {
            balanced.push(q);
          }
        });

        // Final shuffle of the balanced set
        const finalSet = shuffleQuestions(balanced).slice(0, 45);

        // Start with 60 minutes (harder — original was same time but fewer questions)
        startTimedExam(finalSet, 3600, "Neuro-Psych Mock");
      }

      function startTimedExam(questions, timeLimit, examName) {
        // Open practice modal for exam
        document.getElementById("practiceModal").classList.add("active");
        document.body.style.overflow = "hidden";

        // Show loading
        document.getElementById("practiceModalContent").innerHTML = `
    <div style="text-align: center; padding: 60px;">
      <div style="font-size: 3rem; animation: spin 1s linear infinite;">⚙️</div>
      <p style="margin-top: 20px; color: var(--text-light);">Loading ${examName}...</p>
    </div>
  `;

        setTimeout(() => {
          let currentQuestion = 0;
          let score = 0;
          let answers = []; // Store all answers for strict mode
          const totalQuestions = questions.length;

          // Start exam timer
          startTimer(timeLimit, examName, "exam");

          function showExamQuestion() {
            if (currentQuestion >= totalQuestions) {
              // Exam complete - show all results
              showExamResults();
              return;
            }

            const q = questions[currentQuestion];
            const progress = Math.round(
              ((currentQuestion + 1) / totalQuestions) * 100,
            );

            const html = `
        <div class="question-card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
            <h3 style="color: var(--primary); margin: 0;">
              ${examName} - Question ${currentQuestion + 1} of ${totalQuestions}
            </h3>
            ${q._section ? `<span style="background: var(--accent); color: white; padding: 4px 14px; border-radius: 12px; font-size: 0.85rem; font-weight: 600;">${q._section}</span>` : ""}
            <div id="sectionTimer" class="timer" style="display: inline-block; padding: 10px 20px; margin: 0;">
              ${Math.floor(timeLimit / 60)}:00
            </div>
          </div>
          
          <div class="progress-bar" style="height: 15px; margin-bottom: 20px;">
            <div class="progress-fill" style="width: ${progress}%;">${progress}%</div>
          </div>
          
          <p style="margin: 20px 0; font-size: 1.1rem; line-height: 1.6;">${q.question}</p>
          
          <div class="options">
            ${q.options
              .map(
                (opt, i) => `
              <div class="option" onclick="selectExamAnswer(${i})">${opt}</div>
            `,
              )
              .join("")}
          </div>
        </div>
        
        <div style="display: flex; gap: 15px; justify-content: space-between; margin-top: 20px; flex-wrap: wrap;">
          <button class="btn btn-secondary" onclick="previousExamQuestion()" 
                  ${currentQuestion === 0 ? 'disabled style="opacity: 0.5; cursor: not-allowed;"' : ""}>
            ← Previous
          </button>
          <button class="btn btn-primary" onclick="submitExamAnswer()">
            ${currentQuestion === totalQuestions - 1 ? "Finish Exam" : "Next Question →"}
          </button>
        </div>
        
        <div class="tip-box" style="margin-top: 20px;">
          <strong>⚠️ Exam Mode:</strong> You can review and change answers. 
          Timer continues - answers will be revealed only at the end.
        </div>
      `;

            document.getElementById("practiceModalContent").innerHTML = html;

            // Restore previously selected answer if user goes back
            if (answers[currentQuestion] !== undefined) {
              window.selectedAnswer = answers[currentQuestion];
              document
                .querySelectorAll(".option")
                [answers[currentQuestion]].classList.add("selected");
            } else {
              window.selectedAnswer = undefined;
            }
          }

          window.selectExamAnswer = function (optionIndex) {
            document
              .querySelectorAll(".option")
              .forEach((opt) => opt.classList.remove("selected"));
            document
              .querySelectorAll(".option")
              [optionIndex].classList.add("selected");
            window.selectedAnswer = optionIndex;
          };

          window.submitExamAnswer = function () {
            if (window.selectedAnswer === undefined) {
              showNotification("Please select an answer!");
              return;
            }

            // Save answer
            answers[currentQuestion] = window.selectedAnswer;
            currentQuestion++;
            window.selectedAnswer = undefined;

            showExamQuestion();
          };

          window.previousExamQuestion = function () {
            if (currentQuestion > 0) {
              currentQuestion--;
              showExamQuestion();
            }
          };

          function showExamResults() {
            stopTimer();

            // Calculate score
            let correct = 0;
            questions.forEach((q, i) => {
              if (answers[i] === q.correct) correct++;
            });

            const percentage = Math.round((correct / totalQuestions) * 100);

            userData.mockExams.push({
              type: examName,
              score: percentage,
              date: new Date().toISOString(),
              questionsTotal: totalQuestions,
              questionsCorrect: correct,
            });

            // Route score to the correct tracker
            if (examName.toLowerCase().includes("neuro")) {
              userData.neuroPsychScores.push(percentage);
            } else {
              userData.afpsatScores.push(percentage);
            }

            saveUserData();

            const html = `
        <div class="score-summary">
          <h2 style="color: var(--primary);">${examName} Complete!</h2>
          
          <div class="score-circle">
            <div class="score">${correct}</div>
            <div class="total">out of ${totalQuestions}</div>
          </div>
          
          <h3 style="color: ${percentage >= 71 ? "var(--success)" : "var(--danger)"}; margin: 20px 0;">
            Final Score: ${percentage}% ${percentage >= 71 ? "✅ PASSING" : "❌ BELOW PASSING"}
          </h3>
          ${
            examName.toLowerCase().includes("neuro")
              ? `
            <div style="background: white; padding: 25px; border-radius: 12px; margin: 20px 0; text-align: left;">
              <h4 style="color: var(--primary); margin-bottom: 15px;">🧠 Psychological Trait Breakdown</h4>
              <p style="color: var(--text-light); font-size: 0.95rem; margin-bottom: 15px;">
                Remember: The real Neuro-Psych exam checks CONSISTENCY across similar questions. 
                A perfect score here doesn't guarantee passing if your answers were inconsistent.
              </p>
              <div style="background: var(--bg-light); padding: 15px; border-radius: 8px; border-left: 4px solid var(--accent);">
                <strong>💡 What the real exam detects:</strong><br>
                Contradiction between how you answer teamwork questions early vs. late in the exam.
                Answer all similar questions the same way — the test is designed to catch inconsistency.
              </div>
            </div>
          `
              : ""
          }
          
          <div class="tip-box" style="margin: 20px 0; background: ${percentage >= 71 ? "#dcfce7" : "#fee2e2"};">
            <strong>${percentage >= 71 ? "🎉 Congratulations!" : "📖 Keep Studying"}</strong>
            ${
              percentage >= 71
                ? "You achieved a passing score! You're ready for the real exam."
                : "AFPSAT requires 71+ to pass. Review weak areas and try again."
            }
          </div>
          
          <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 30px;">
            <button class="btn btn-primary" onclick="closePracticeModal(); showSection('mockExam')">
              Back to Mock Exams
            </button>
            <button class="btn btn-success" onclick="closePracticeModal(); showSection('stats')">
              View Stats
            </button>
          </div>
        </div>
      `;

            document.getElementById("practiceModalContent").innerHTML = html;
            updateDashboard();
          }

          showExamQuestion();
          showNotification(
            `⏱️ ${examName} started! ${Math.floor(timeLimit / 60)} minutes`,
          );
        }, 300);
      }
      // Start game - now opens in modal
      function startGame(gameType) {
        // Ensure games progress exists
        if (!userData.gamesProgress) {
          userData.gamesProgress = {
            patternSpeed: { highScore: 0, attempts: 0, lastPlayed: null },
            mathBlitz: { highScore: 0, attempts: 0, lastPlayed: null },
            memoryMatch: {
              highScore: 0,
              bestTime: 999999,
              attempts: 0,
              lastPlayed: null,
            },
          };
        }

        // Open modal FIRST
        const modal = document.getElementById("gameModal");
        modal.classList.add("active");
        document.body.style.overflow = "hidden";

        // Wait for modal to be visible, THEN launch game
        setTimeout(() => {
          if (gameType === "patternSpeed") {
            startPatternSpeedGame();
          } else if (gameType === "mathBlitz") {
            startMathBlitzGame();
          } else if (gameType === "memoryMatch") {
            startMemoryMatchGame();
          }
        }, 100); // Small delay ensures modal DOM is ready
      }

      // === GAME 2: MATH BLITZ ===
      function startMathBlitzGame() {
        let score = 0;
        let round = 1;
        const maxRounds = 10;
        let startTime = Date.now();

        function generateProblem() {
          const type = Math.floor(Math.random() * 4);
          let question, answer;

          switch (type) {
            case 0:
              const a1 = Math.floor(Math.random() * 50) + 10;
              const b1 = Math.floor(Math.random() * 50) + 10;
              question = `${a1} + ${b1}`;
              answer = a1 + b1;
              break;
            case 1:
              const a2 = Math.floor(Math.random() * 80) + 20;
              const b2 = Math.floor(Math.random() * 40) + 10;
              question = `${a2} - ${b2}`;
              answer = a2 - b2;
              break;
            case 2:
              const a3 = Math.floor(Math.random() * 12) + 3;
              const b3 = Math.floor(Math.random() * 12) + 3;
              question = `${a3} × ${b3}`;
              answer = a3 * b3;
              break;
            case 3:
              const b4 = Math.floor(Math.random() * 9) + 2;
              const a4 = b4 * (Math.floor(Math.random() * 12) + 2);
              question = `${a4} ÷ ${b4}`;
              answer = a4 / b4;
              break;
          }

          return { question, answer };
        }

        function showRound() {
          if (round > maxRounds) {
            endGame();
            return;
          }

          const problem = generateProblem();
          const roundStart = Date.now();

          const html = `
            <div style="background: white; padding: 40px; border-radius: 16px; text-align: center;">
              <h3 style="color: var(--primary); margin-bottom: 20px;">
                Problem ${round} of ${maxRounds}
              </h3>
              <div style="background: var(--bg-light); padding: 50px; border-radius: 12px; margin: 20px 0;">
                <div style="font-size: 3rem; font-weight: 700; color: var(--primary);">
                  ${problem.question} = ?
                </div>
              </div>
              <input type="number" id="mathAnswer" placeholder="Your answer" 
                     style="width: 200px; padding: 15px; font-size: 1.5rem; text-align: center; border: 2px solid var(--border); border-radius: 8px;"
                     onkeypress="if(event.key==='Enter') checkMathAnswer(${problem.answer}, ${roundStart})">
              <br>
              <button class="btn btn-success" onclick="checkMathAnswer(${problem.answer}, ${roundStart})" 
                      style="margin-top: 20px; padding: 15px 40px; font-size: 1.2rem;">
                Submit
              </button>
              <div style="margin-top: 30px; padding: 20px; background: var(--bg-light); border-radius: 8px;">
                <strong>Score:</strong> ${score} points | <strong>Time:</strong> ${Math.floor((Date.now() - startTime) / 1000)}s
              </div>
            </div>
          `;

          document.getElementById("gameModalContent").innerHTML = html;
          document.getElementById("mathAnswer").focus();

          setTimeout(() => {
            document.getElementById("mathAnswer").focus();
          }, 100); // Small delay ensures DOM is ready
        }

        window.checkMathAnswer = function (correct, roundStart) {
          const inputElem = document.getElementById("mathAnswer");
          if (!inputElem || inputElem.value.trim() === "") {
            showNotification("⚠️ Please enter an answer!");
            return;
          }
          const userAnswer = parseInt(inputElem.value);
          const responseTime = Date.now() - roundStart;
          const timeBonus = Math.max(0, 5000 - responseTime);

          if (userAnswer === correct) {
            const points = Math.floor(100 + timeBonus / 50);
            score += points;
            showNotification("✅ Correct! +" + points + " points");
          } else {
            showNotification("❌ Incorrect. Answer was: " + correct);
          }

          round++;
          setTimeout(showRound, 800);
        };

        function endGame() {
          const totalTime = Math.floor((Date.now() - startTime) / 1000);

          if (!userData.gamesProgress.mathBlitz) {
            userData.gamesProgress.mathBlitz = { highScore: 0, attempts: 0 };
          }

          userData.gamesProgress.mathBlitz.attempts++;
          const isNewHigh = score > userData.gamesProgress.mathBlitz.highScore;
          if (isNewHigh) {
            userData.gamesProgress.mathBlitz.highScore = score;
            userData.gamesProgress.mathBlitz.lastPlayed =
              new Date().toISOString();
          }
          saveUserData();

          const html = `
            <div style="background: white; padding: 40px; border-radius: 16px; text-align: center;">
              <h2 style="color: var(--success); margin-bottom: 20px;">🎉 Math Blitz Complete!</h2>
              <div class="score-circle" style="margin: 30px auto;">
                <div class="score">${score}</div>
                <div class="total">points</div>
              </div>
              <p style="font-size: 1.2rem; margin: 20px 0;">Completed in ${totalTime} seconds</p>
              <p style="color: var(--text-light);">
                ${score > userData.gamesProgress.mathBlitz.highScore ? "🏆 New High Score!" : "High Score: " + userData.gamesProgress.mathBlitz.highScore}
              </p>
              <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="startGame('mathBlitz')" 
                        style="min-width: 140px; padding: 14px 30px;">
                  Play Again
                </button>
                <button class="btn btn-secondary" onclick="closeGameModal()" 
                        style="min-width: 140px; padding: 14px 30px;">
                  Back to Games
                </button>
              </div>
            </div>
          `;

          document.getElementById("gameModalContent").innerHTML = html;
          updateGameScores();
        }

        showRound();
      }

      // === GAME 3: FLASH MEMORY ===
      function startMemoryMatchGame() {
        const symbols = ["🎖️", "⭐", "🎯", "🏆", "🔥", "💎", "🎪", "🎭"];
        let sequence = [];
        let userSequence = [];
        let level = 1;
        let startTime = Date.now();

        function showSequence() {
          sequence = [];
          for (let i = 0; i < level + 2; i++) {
            sequence.push(symbols[Math.floor(Math.random() * symbols.length)]);
          }

          let html = `
            <div style="background: white; padding: 40px; border-radius: 16px; text-align: center;">
              <h3 style="color: var(--primary); margin-bottom: 20px;">Level ${level}</h3>
              <p style="margin: 20px 0;">Memorize this sequence:</p>
              <div id="sequenceDisplay" style="font-size: 4rem; padding: 40px; background: var(--bg-light); border-radius: 12px; margin: 20px 0;">
              </div>
              <p style="color: var(--text-light);">Watch carefully...</p>
            </div>
          `;

          document.getElementById("gameModalContent").innerHTML = html;

          let index = 0;
          const displayInterval = setInterval(() => {
            if (index < sequence.length) {
              document.getElementById("sequenceDisplay").textContent =
                sequence[index];
              index++;
            } else {
              clearInterval(displayInterval);
              setTimeout(askForRecall, 1000);
            }
          }, 800);
        }

        function askForRecall() {
          userSequence = [];

          const html = `
            <div style="background: white; padding: 40px; border-radius: 16px; text-align: center;">
              <h3 style="color: var(--primary); margin-bottom: 20px;">Recall the Sequence</h3>
              <p style="margin: 20px 0;">Click the symbols in the correct order:</p>
              <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; max-width: 500px; margin: 30px auto;">
                ${symbols
                  .map(
                    (symbol) => `
                  <button onclick="selectSymbol('${symbol}')" 
                          style="font-size: 3rem; padding: 20px; background: white; border: 3px solid var(--border); border-radius: 12px; cursor: pointer; transition: all 0.3s;"
                          onmouseover="this.style.borderColor='var(--primary)'" 
                          onmouseout="this.style.borderColor='var(--border)'">
                    ${symbol}
                  </button>
                `,
                  )
                  .join("")}
              </div>
              <div id="userSequenceDisplay" style="font-size: 1.8rem; margin: 25px 0; min-height: 70px; padding: 18px; background: var(--bg-light); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 8px;">
                <em style="color: var(--text-light); font-size: 0.9rem;">Your sequence will appear here...</em>
              </div>
              <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
                <button class="btn btn-danger" onclick="clearMemorySequence()" style="min-width: 120px; padding: 12px 24px;">Clear</button>
                <button class="btn btn-success" onclick="checkMemorySequence()" style="min-width: 120px; padding: 12px 24px;">Submit</button>
              </div>
            </div>
          `;

          document.getElementById("gameModalContent").innerHTML = html;
        }

        window.selectSymbol = function (symbol) {
          userSequence.push(symbol);
          document.getElementById("userSequenceDisplay").textContent =
            userSequence.join(" ");
        };

        window.clearMemorySequence = function () {
          userSequence = [];
          document.getElementById("userSequenceDisplay").innerHTML =
            '<em style="color: var(--text-light);">Your sequence will appear here...</em>';
        };

        window.checkMemorySequence = function () {
          if (userSequence.length !== sequence.length) {
            showNotification("⚠️ Sequence length doesn't match!");
            return;
          }

          const correct = userSequence.every(
            (symbol, index) => symbol === sequence[index],
          );

          if (correct) {
            level++;
            showNotification("✅ Correct! Moving to level " + level);
            setTimeout(showSequence, 1000);
          } else {
            endMemoryGame();
          }
        };

        function endMemoryGame() {
          const totalTime = Math.floor((Date.now() - startTime) / 1000);
          const finalLevel = level - 1;

          if (!userData.gamesProgress.memoryMatch) {
            userData.gamesProgress.memoryMatch = {
              highScore: 0,
              bestTime: 999999,
              attempts: 0,
            };
          }

          userData.gamesProgress.memoryMatch.attempts++;
          const isNewHigh =
            finalLevel > userData.gamesProgress.memoryMatch.highScore;
          if (isNewHigh) {
            userData.gamesProgress.memoryMatch.highScore = finalLevel;
            userData.gamesProgress.memoryMatch.lastPlayed =
              new Date().toISOString();
          }
          if (totalTime < userData.gamesProgress.memoryMatch.bestTime) {
            userData.gamesProgress.memoryMatch.bestTime = totalTime;
          }
          saveUserData();

          const html = `
            <div style="background: white; padding: 40px; border-radius: 16px; text-align: center;">
              <h2 style="color: ${finalLevel >= 5 ? "var(--success)" : "var(--primary)"}; margin-bottom: 20px;">
                ${finalLevel >= 5 ? "🎉 Excellent Memory!" : "🧠 Good Try!"}
              </h2>
              <div class="score-circle" style="margin: 30px auto;">
                <div class="score">${finalLevel}</div>
                <div class="total">levels</div>
              </div>
              <p style="font-size: 1.2rem; margin: 20px 0;">Time: ${totalTime} seconds</p>
              <p style="color: var(--text-light);">
                Best: Level ${userData.gamesProgress.memoryMatch.highScore} in ${userData.gamesProgress.memoryMatch.bestTime}s
              </p>
              <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="startGame('memoryMatch')" 
                        style="min-width: 140px; padding: 14px 30px;">
                  Play Again
                </button>
                <button class="btn btn-secondary" onclick="closeGameModal()" 
                        style="min-width: 140px; padding: 14px 30px;">
                  Back to Games
                </button>
              </div>
            </div>
          `;

          document.getElementById("gameModalContent").innerHTML = html;
          updateGameScores();
        }

        showSequence();
      }

      // Update game scores display
      function updateGameScores() {
        if (userData.gamesProgress) {
          if (userData.gamesProgress.patternSpeed) {
            const elem = document.getElementById("patternHighScore");
            if (elem)
              elem.textContent =
                userData.gamesProgress.patternSpeed.highScore || 0;
          }
          if (userData.gamesProgress.mathBlitz) {
            const elem = document.getElementById("mathHighScore");
            if (elem)
              elem.textContent =
                userData.gamesProgress.mathBlitz.highScore || 0;
          }
          if (userData.gamesProgress.memoryMatch) {
            const elem = document.getElementById("memoryBestTime");
            if (elem) {
              const time = userData.gamesProgress.memoryMatch.bestTime;
              elem.textContent = time < 999999 ? time : "--";
            }
          }
        }
      }

      // Update dashboard
      function updateDashboard() {
        document.getElementById("totalQuestions").textContent =
          userData.totalQuestions;

        if (userData.totalQuestions > 0) {
          const avgScore = Math.round(
            (userData.correctAnswers / userData.totalQuestions) * 100,
          );
          document.getElementById("avgScore").textContent = avgScore + "%";
        } else {
          document.getElementById("avgScore").textContent = "0%"; // ✅ Always reset to 0%
        }

        document.getElementById("studyStreak").textContent =
          userData.studyStreak;

        // Update passing probability
        updatePassingProbability();

        // Update game scores if on games page
        updateGameScores();
      }

      function updatePassingProbability() {
        const prediction =
          afpsatPredictor.calculatePassingProbability(userData);
        const sectionReadiness = afpsatPredictor.getSectionReadiness();

        const probabilityHTML = `
                <div style="text-align: center;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">
                        ${prediction.emoji} AFPSAT Exam Readiness Assessment
                    </h3>
                    
                    <div style="display: inline-block; padding: 30px; background: ${prediction.color}; color: white; border-radius: 16px; margin: 20px 0; min-width: 300px;">
                        <div style="font-size: 2rem; font-weight: 700; margin-bottom: 10px;">
                            ${prediction.band}
                        </div>
                        <div style="font-size: 1.2rem; opacity: 0.95;">
                            Passing Probability: ${prediction.probability}
                        </div>
                    </div>
                    
                    <p style="font-size: 1.1rem; margin: 20px 0; color: var(--text-dark);">
                        ${prediction.message}
                    </p>
                    
                    <div style="background: var(--bg-light); padding: 20px; border-radius: 12px; margin: 20px 0; text-align: left;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">📊 Performance Breakdown</h4>
                        
                        <div style="margin: 10px 0;">
                            <strong>Mock Exam Performance (40%):</strong> ${prediction.breakdown.mockScore}/100
                            <div class="progress-bar" style="height: 20px; margin-top: 5px;">
                                <div class="progress-fill" style="width: ${prediction.breakdown.mockScore}%;"></div>
                            </div>
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <strong>Practice Consistency (25%):</strong> ${prediction.breakdown.consistency}/100
                            <div class="progress-bar" style="height: 20px; margin-top: 5px;">
                                <div class="progress-fill" style="width: ${prediction.breakdown.consistency}%;"></div>
                            </div>
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <strong>Time Management (20%):</strong> ${prediction.breakdown.timeManagement}/100
                            <div class="progress-bar" style="height: 20px; margin-top: 5px;">
                                <div class="progress-fill" style="width: ${prediction.breakdown.timeManagement}%;"></div>
                            </div>
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <strong>Topic Coverage (15%):</strong> ${prediction.breakdown.weakAreaCoverage}/100
                            <div class="progress-bar" style="height: 20px; margin-top: 5px;">
                                <div class="progress-fill" style="width: ${prediction.breakdown.weakAreaCoverage}%;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-light); padding: 20px; border-radius: 12px; margin: 20px 0; text-align: left;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">📝 Section Readiness</h4>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div style="padding: 15px; background: white; border-radius: 8px;">
                                <strong>Abstract Reasoning</strong><br>
                                ${sectionReadiness.abstract.status}<br>
                                <span style="color: var(--text-light);">${sectionReadiness.abstract.average}% avg (${sectionReadiness.abstract.attempts} attempts)</span>
                            </div>
                            <div style="padding: 15px; background: white; border-radius: 8px;">
                                <strong>Verbal Ability</strong><br>
                                ${sectionReadiness.verbal.status}<br>
                                <span style="color: var(--text-light);">${sectionReadiness.verbal.average}% avg (${sectionReadiness.verbal.attempts} attempts)</span>
                            </div>
                            <div style="padding: 15px; background: white; border-radius: 8px;">
                                <strong>Numerical Ability</strong><br>
                                ${sectionReadiness.numerical.status}<br>
                                <span style="color: var(--text-light);">${sectionReadiness.numerical.average}% avg (${sectionReadiness.numerical.attempts} attempts)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tip-box" style="border-left-color: ${prediction.color};">
                        <strong>📋 Recommendation:</strong><br>
                        ${prediction.recommendation}
                    </div>
                </div>
            `;

        document.getElementById("passingProbability").innerHTML =
          probabilityHTML;
      }

      // Update stats
      function updateStats() {
        // ✅ CALCULATE AVERAGES FIRST
        const afpsatAvg =
          userData.afpsatScores.length > 0
            ? Math.round(
                userData.afpsatScores.reduce((a, b) => a + b, 0) /
                  userData.afpsatScores.length,
              )
            : 0;
        const neuroPsychAvg =
          userData.neuroPsychScores.length > 0
            ? Math.round(
                userData.neuroPsychScores.reduce((a, b) => a + b, 0) /
                  userData.neuroPsychScores.length,
              )
            : 0;

        // ✅ UPDATE THE DISPLAY
        document.getElementById("afpsatAvg").textContent = afpsatAvg + "%";
        document.getElementById("neuroPsychAvg").textContent =
          neuroPsychAvg + "%";

        // ✅ ADD: Render Progress Chart
        function renderProgressChart() {
          const chartDiv = document.getElementById("progressChart");
          if (!chartDiv) return;

          // Combine all section performance
          const allAttempts = [];

          ["abstract", "verbal", "numerical", "neuroPsych"].forEach(
            (section) => {
              if (userData.sectionPerformance[section]) {
                userData.sectionPerformance[section].forEach((attempt) => {
                  allAttempts.push({
                    date: new Date(attempt.date),
                    score: attempt.score,
                    section: section,
                    difficulty: attempt.difficulty,
                  });
                });
              }
            },
          );

          // Sort by date
          allAttempts.sort((a, b) => a.date - b.date);

          if (allAttempts.length === 0) {
            chartDiv.innerHTML =
              '<p style="text-align: center; color: var(--text-light); padding: 40px;">No practice data yet. Complete some practice sessions to see your progress!</p>';
            return;
          }

          // Create simple text-based chart
          let chartHTML =
            '<div style="background: white; padding: 20px; border-radius: 8px;">';

          allAttempts.slice(-10).forEach((attempt, index) => {
            const dateStr = attempt.date.toLocaleDateString();
            const barWidth = attempt.score;
            const color =
              attempt.score >= 75
                ? "var(--success)"
                : attempt.score >= 60
                  ? "var(--accent)"
                  : "var(--danger)";

            chartHTML += `
      <div style="margin: 10px 0;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9rem;">
          <span><strong>${attempt.section}</strong> - ${dateStr}</span>
          <span style="color: ${color}; font-weight: 600;">${attempt.score}%</span>
        </div>
        <div style="background: var(--bg-light); border-radius: 4px; height: 25px; overflow: hidden;">
          <div style="background: ${color}; height: 100%; width: ${barWidth}%; transition: width 0.5s; display: flex; align-items: center; padding: 0 10px; color: white; font-size: 0.85rem; font-weight: 600;">
            ${attempt.score}%
          </div>
        </div>
      </div>
    `;
          });

          chartHTML += "</div>";
          chartDiv.innerHTML = chartHTML;
        }

        renderProgressChart(); // ✅ Call it

        document.getElementById("mocksTaken").textContent =
          userData.mockExams.length;

        // Show weak areas
        const weakAreasHtml =
          Object.keys(userData.weakAreas).length > 0
            ? Object.entries(userData.weakAreas)
                .filter(([area, data]) => data.correct / data.total < 0.6)
                .map(
                  ([area, data]) => `
                        <div class="weak-area">
                            <strong>${area}</strong>: ${Math.round((data.correct / data.total) * 100)}% accuracy
                            <br>Practice more to improve!
                        </div>
                    `,
                )
                .join("")
            : "<p>No weak areas yet - keep practicing!</p>";

        document.getElementById("weakAreas").innerHTML = weakAreasHtml;

        // Show strong areas
        const strongAreasHtml =
          Object.keys(userData.weakAreas).length > 0
            ? Object.entries(userData.weakAreas)
                .filter(([area, data]) => data.correct / data.total >= 0.8)
                .map(
                  ([area, data]) => `
                        <div class="strong-area">
                            <strong>${area}</strong>: ${Math.round((data.correct / data.total) * 100)}% accuracy
                            <br>Excellent work!
                        </div>
                    `,
                )
                .join("")
            : "<p>Complete more practices to identify your strong areas!</p>";
        updateVerbalAnalysis();
        document.getElementById("strongAreas").innerHTML = strongAreasHtml;
      }

      // Close modal
      function closeModal() {
        document.getElementById("modal").classList.remove("active");
      }

      // Show notification
      function showNotification(message) {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.style.display = "block";
        setTimeout(() => {
          notification.style.display = "none";
        }, 3000);
      }

      // Check online/offline status
      window.addEventListener("online", () => {
        document.getElementById("offlineIndicator").style.display = "none";
      });

      window.addEventListener("offline", () => {
        document.getElementById("offlineIndicator").style.display = "block";
      });
      // === GAME 1: PATTERN SPEED CHALLENGE ===
      function startPatternSpeedGame() {
        let score = 0;
        let round = 1;
        const maxRounds = 10;
        let startTime = Date.now();

        const patterns = [
          { sequence: ["🔴", "🔵", "🔴", "🔵", "🔴"], next: "🔵" },
          {
            sequence: ["⭐", "⭐⭐", "⭐⭐⭐", "⭐⭐⭐⭐"],
            next: "⭐⭐⭐⭐⭐",
          },
          { sequence: ["▲", "▼", "▲", "▼"], next: "▲" },
          { sequence: ["1", "2", "4", "8"], next: "16" },
          { sequence: ["A", "C", "E", "G"], next: "I" },
          { sequence: ["🟢", "🟡", "🔴", "🟢", "🟡"], next: "🔴" },
          { sequence: ["■", "●", "▲", "■", "●"], next: "▲" },
        ];

        function showRound() {
          if (round > maxRounds) {
            endGame();
            return;
          }

          const pattern = patterns[Math.floor(Math.random() * patterns.length)];
          const roundStart = Date.now();

          const options = [pattern.next];
          // Add 3 wrong options
          const wrongOptions = [
            "🟠",
            "🟣",
            "⬛",
            "◆",
            "◇",
            "▶",
            "◀",
            "B",
            "J",
            "32",
          ];
          while (options.length < 4) {
            const wrong =
              wrongOptions[Math.floor(Math.random() * wrongOptions.length)];
            if (!options.includes(wrong) && wrong !== pattern.next) {
              options.push(wrong);
            }
          }
          const shuffledOptions = shuffleArray([...options]); // Create shuffled copy

          const html = `
      <div style="background: white; padding: 40px; border-radius: 16px; text-align: center;">
        <h3 style="color: var(--primary); margin-bottom: 20px;">
          Round ${round} of ${maxRounds}
        </h3>
        <div style="background: var(--bg-light); padding: 30px; border-radius: 12px; margin: 20px 0;">
          <div style="font-size: 3rem; margin-bottom: 20px;">
            ${pattern.sequence.join(" → ")} → ?
          </div>
        </div>
        <p style="margin: 20px 0; color: var(--text-light);">What comes next?</p>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; max-width: 400px; margin: 0 auto; padding: 0 10px;">
          ${shuffledOptions
            .map(
              (opt) => `
                  <button class="btn btn-primary" onclick="checkPatternAnswer('${opt}', '${pattern.next}', ${roundStart})" 
                          style="font-size: 1.8rem; padding: 25px; min-height: 90px; display: flex; align-items: center; justify-content: center;">
                    ${opt}
                  </button>
            `,
            )
            .join("")}
        </div>
        <div style="margin-top: 30px; padding: 20px; background: var(--bg-light); border-radius: 8px;">
          <strong>Score:</strong> ${score} points | <strong>Time:</strong> ${Math.floor((Date.now() - startTime) / 1000)}s
        </div>
      </div>
    `;

          document.getElementById("gameModalContent").innerHTML = html;
        }

        window.checkPatternAnswer = function (selected, correct, roundStart) {
          const responseTime = Date.now() - roundStart;
          const timeBonus = Math.max(0, 1000 - responseTime);

          if (selected === correct) {
            score += Math.floor(100 + timeBonus / 10);
            showNotification(
              "✅ Correct! +" + Math.floor(100 + timeBonus / 10) + " points",
            );
          } else {
            showNotification(
              `❌ Incorrect. You selected: ${selected} | Correct: ${correct}`,
            );
          }

          round++;
          setTimeout(showRound, 800);
        };

        function endGame() {
          const totalTime = Math.floor((Date.now() - startTime) / 1000);

          // Update high score
          if (!userData.gamesProgress.patternSpeed) {
            userData.gamesProgress.patternSpeed = { highScore: 0, attempts: 0 };
          }

          // SAVE THE OLD HIGH SCORE FIRST
          const oldHighScore = userData.gamesProgress.patternSpeed.highScore;
          const isNewHighScore = score > oldHighScore;

          userData.gamesProgress.patternSpeed.attempts++;
          if (isNewHighScore) {
            userData.gamesProgress.patternSpeed.highScore = score;
            userData.gamesProgress.patternSpeed.lastPlayed =
              new Date().toISOString();
          }

          saveUserData();

          const html = `
      <div style="background: white; padding: 40px; border-radius: 16px; text-align: center;">
        <h2 style="color: var(--success); margin-bottom: 20px;">🎉 Game Complete!</h2>
        <div class="score-circle" style="margin: 30px auto;">
          <div class="score">${score}</div>
          <div class="total">points</div>
        </div>
        <p style="font-size: 1.2rem; margin: 20px 0;">Completed in ${totalTime} seconds</p>
        <p style="color: var(--text-light);">
            ${isNewHighScore ? "🏆 New High Score!" : "High Score: " + oldHighScore}        </p>
        <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
          <button class="btn btn-primary" onclick="startGame('patternSpeed')" 
                  style="min-width: 140px; padding: 14px 30px;">
            Play Again
          </button>
          <button class="btn btn-secondary" onclick="closeGameModal()" 
                  style="min-width: 140px; padding: 14px 30px;">
            Back to Games
          </button>
        </div>
      </div>
    `;

          document.getElementById("gameModalContent").innerHTML = html;
          updateGameScores();
        }

        showRound();
      }

      // Update game scores display
      function updateGameScores() {
        if (userData.gamesProgress) {
          if (userData.gamesProgress.patternSpeed) {
            const elem = document.getElementById("patternHighScore");
            if (elem)
              elem.textContent =
                userData.gamesProgress.patternSpeed.highScore || 0;
          }
          if (userData.gamesProgress.mathBlitz) {
            const elem = document.getElementById("mathHighScore");
            if (elem)
              elem.textContent =
                userData.gamesProgress.mathBlitz.highScore || 0;
          }
          if (userData.gamesProgress.memoryMatch) {
            const elem = document.getElementById("memoryBestTime");
            if (elem) {
              const time = userData.gamesProgress.memoryMatch.bestTime;
              elem.textContent = time < 999999 ? time : "--";
            }
          }
        }
      }

      // Render study resources
      function renderResources() {
        const categories = [
          "verbal",
          "numerical",
          "abstract",
          "neuroPsych",
          "general",
        ];

        categories.forEach((category) => {
          const container = document.getElementById(`${category}Resources`);
          if (!container) return;

          const resources = studyResources[category] || [];

          container.innerHTML = resources
            .map(
              (resource) => `
            <div class="card" onclick="window.open('${resource.url}', '_blank')" 
                 style="cursor: pointer; transition: all 0.3s;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                <h3 style="flex: 1;">${resource.title}</h3>
                <span style="background: var(--accent); color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; white-space: nowrap; margin-left: 10px;">
                  ${resource.type}
                </span>
              </div>
              <p style="color: var(--text-light); margin-bottom: 15px;">${resource.description}</p>
              <div style="display: flex; align-items: center; color: var(--primary); font-weight: 600; font-size: 0.9rem;">
                Open Resource →
              </div>
            </div>
          `,
            )
            .join("");
        });

        // Show weak area suggestions
        renderWeakAreaSuggestions();
      }

      // Smart suggestions based on weak areas
      function renderWeakAreaSuggestions() {
        const container = document.getElementById("weakAreaSuggestions");
        if (!container || !userData.weakAreas) return;

        const weakTopics = Object.entries(userData.weakAreas)
          .filter(
            ([topic, data]) =>
              data.total > 5 && data.correct / data.total < 0.6,
          )
          .map(([topic]) => topic);

        if (weakTopics.length === 0) {
          container.innerHTML = "";
          return;
        }

        const suggestions = weakTopics
          .map((topic) => {
            const category = ["vocabulary", "grammar", "analogies"].includes(
              topic,
            )
              ? "verbal"
              : [
                    "percentages",
                    "ratios",
                    "wordProblems",
                    "fractions",
                    "basic",
                  ].includes(topic)
                ? "numerical"
                : [
                      "sequences",
                      "rotation",
                      "patterns",
                      "progression",
                      "oddOneOut",
                      "combined",
                    ].includes(topic)
                  ? "abstract"
                  : null;

            return category ? { topic, category } : null;
          })
          .filter(Boolean);

        if (suggestions.length === 0) {
          container.innerHTML = "";
          return;
        }

        container.innerHTML = `
          <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 25px; border-radius: 12px; border-left: 4px solid var(--accent);">
            <h3 style="color: var(--accent); margin-bottom: 15px;">🎯 Recommended for You</h3>
            <p style="margin-bottom: 15px;">Based on your performance, focus on these resources:</p>
            <ul style="margin-left: 20px;">
              ${suggestions
                .map(
                  (s) => `
                <li style="margin: 8px 0;">
                  <strong>${s.topic}:</strong> Check out 
                  <a href="#${s.category}Resources" 
                    onclick="
                      event.preventDefault(); 
                      const target = document.getElementById('${s.category}Resources');
                      const offset = 100; // Account for header
                      const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - offset;
                      window.scrollTo({top: targetPosition, behavior: 'smooth'});
                    " 
                    style="color: var(--primary); font-weight: 600; text-decoration: underline;">
                    ${s.category} resources
                  </a>
                </li>
              `,
                )
                .join("")}
            </ul>
          </div>
        `;
      }
      // Initialize
      loadUserData();

      // Ensure strict mode toggle reflects current state
      document.addEventListener("DOMContentLoaded", () => {
        initializeStrictMode();
      });

      // Service Worker for offline capability
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register(
            "data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZnVuY3Rpb24oZSkge2NvbnNvbGUubG9nKCdTZXJ2aWNlIFdvcmtlciBJbnN0YWxsZWQnKX0p",
          )
          .then(() => console.log("Offline mode enabled"))
          .catch((err) => console.log("Offline mode not available", err));
      }

      // Daily reminder
      function checkDailyReminder() {
        const now = new Date();
        const hour = now.getHours();

        if (hour === 9 && !sessionStorage.getItem("reminderShown")) {
          showNotification(
            "📚 Good morning! Time for your daily study session!",
          );
          sessionStorage.setItem("reminderShown", "true");
        }
      }

      setInterval(checkDailyReminder, 60000); // Check every minute

      // =============================================
      // COLOR VISION TEST (Ishihara-Style)
      // =============================================

      const cvtPlates = [
        {
          number: 1,
          normalSee: 12,
          cvdSee: 12,
          img: "https://www.colour-blindness.com/CBTests/ishihara/Plate1.gif",
          label: "Plate 1 (Demo — everyone sees 12)",
        },
        {
          number: 2,
          normalSee: 8,
          cvdSee: 3,
          img: "https://www.colour-blindness.com/CBTests/ishihara/Plate2.gif",
          label: "Plate 2",
        },
        {
          number: 3,
          normalSee: 29,
          cvdSee: 70,
          img: "https://www.colour-blindness.com/CBTests/ishihara/Plate3.gif",
          label: "Plate 3",
        },
        {
          number: 4,
          normalSee: 5,
          cvdSee: 2,
          img: "https://www.colour-blindness.com/CBTests/ishihara/Plate4.gif",
          label: "Plate 4",
        },
        {
          number: 5,
          normalSee: 3,
          cvdSee: 5,
          img: "https://www.colour-blindness.com/CBTests/ishihara/Plate5.gif",
          label: "Plate 5",
        },
        {
          number: 6,
          normalSee: 15,
          cvdSee: 17,
          img: "https://www.colour-blindness.com/CBTests/ishihara/Plate6.gif",
          label: "Plate 6",
        },
        {
          number: 7,
          normalSee: 74,
          cvdSee: 21,
          img: "https://www.colour-blindness.com/CBTests/ishihara/Plate7.gif",
          label: "Plate 7",
        },
        {
          number: 8,
          normalSee: 6,
          cvdSee: null,
          img: "https://www.colour-blindness.com/CBTests/ishihara/Plate8.gif",
          label: "Plate 8",
        },
      ];

      function renderColorTestPlates() {
        const container = document.getElementById("cvtPlates");
        if (!container) return;
        container.innerHTML = "";

        cvtPlates.forEach((plate, idx) => {
          const div = document.createElement("div");
          div.className = "cvt-plate";
          div.innerHTML = `
      <div class="cvt-plate-label">${plate.label || "Plate " + (idx + 1)}</div>

      <img
        src="${plate.img}"
        alt="Ishihara Plate ${idx + 1}"
        class="cvt-img"
        style="
          width: 160px;
          height: 160px;
          border-radius: 50%;
          display: block;
          margin: 0 auto 15px auto;
          box-shadow: 0 2px 8px rgba(0,0,0,0.12);
          object-fit: cover;
        "
        onerror="this.style.background='#fee2e2'; this.alt='Image failed to load — check connection';"
      />

      <div style="margin-top: 12px;">
        <label style="font-size: 0.9rem; color: var(--text-light); display: block; margin-bottom: 6px;">
          What number do you see?
        </label>
        <input
          type="number"
          class="cvt-input"
          id="cvtAnswer${idx}"
          placeholder="?"
          min="0"
          max="99"
        />
      </div>
    `;
          container.appendChild(div);
        });
      }

      function submitColorTest() {
        let correct = 0;
        let missed = 0;
        let details = [];

        cvtPlates.forEach((plate, idx) => {
          const input = document.getElementById(`cvtAnswer${idx}`);
          const userAnswer = parseInt(input?.value || "0") || 0;
          const isCorrect = userAnswer === plate.normalSee;

          if (isCorrect) {
            correct++;
          } else {
            missed++;
          }

          details.push({
            plate: idx + 1,
            correct: plate.normalSee,
            user: userAnswer,
            pass: isCorrect,
          });

          // Color-code the input
          if (input) {
            input.style.background = isCorrect ? "#dcfce7" : "#fee2e2";
            input.style.borderColor = isCorrect
              ? "var(--success)"
              : "var(--danger)";
          }
        });

        const total = cvtPlates.length;
        const passRate = Math.round((correct / total) * 100);

        let resultLevel, resultColor, resultMessage, resultAdvice;

        if (correct >= total - 1) {
          resultLevel = "✅ Normal Color Vision";
          resultColor = "var(--success)";
          resultMessage = `You correctly identified ${correct} out of ${total} plates.`;
          resultAdvice =
            "Your color vision appears normal based on this screening. You are unlikely to have color vision deficiency.";
        } else if (correct >= Math.floor(total * 0.6)) {
          resultLevel = "⚠️ Possible Mild Deficiency";
          resultColor = "var(--accent)";
          resultMessage = `You correctly identified ${correct} out of ${total} plates.`;
          resultAdvice =
            "You may have a mild color vision deficiency. We strongly recommend an official Ishihara test with a licensed physician before your AFP medical exam.";
        } else {
          resultLevel = "❌ Possible Color Vision Deficiency";
          resultColor = "var(--danger)";
          resultMessage = `You correctly identified ${correct} out of ${total} plates.`;
          resultAdvice =
            "This screening suggests a possible significant color vision deficiency. Please see an ophthalmologist or licensed physician for an official diagnosis before your AFP medical examination.";
        }

        const resultsDiv = document.getElementById("cvtResults");
        resultsDiv.style.display = "block";
        resultsDiv.innerHTML = `
    <div style="background: white; border-radius: 16px; padding: 30px; border: 2px solid var(--border); margin-top: 20px;">
      <h3 style="color: ${resultColor}; margin-bottom: 15px; font-size: 1.5rem;">${resultLevel}</h3>
      <p style="font-size: 1.1rem; margin-bottom: 10px;">${resultMessage}</p>
      
      <div class="progress-bar" style="margin: 20px 0;">
        <div class="progress-fill" style="width: ${passRate}%;">${passRate}%</div>
      </div>
      
      <div class="tip-box" style="margin: 20px 0; border-left-color: ${resultColor};">
        <strong>Assessment:</strong> ${resultAdvice}
      </div>
      
      <h4 style="color: var(--primary); margin: 20px 0 12px;">Plate-by-Plate Breakdown:</h4>
      <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px;">
        ${details
          .map(
            (d) => `
          <div style="padding: 12px; background: ${d.pass ? "#dcfce7" : "#fee2e2"}; 
                      border-radius: 8px; text-align: center; font-size: 0.9rem;">
            <div style="font-weight: 700; color: ${d.pass ? "var(--success)" : "var(--danger)"};">
              Plate ${d.plate}: ${d.pass ? "✅" : "❌"}
            </div>
            <div>Your answer: <strong>${d.user || "—"}</strong></div>
            <div style="color: var(--text-light);">Correct: ${d.correct}</div>
          </div>
        `,
          )
          .join("")}
      </div>
    </div>
  `;

        // Scroll to results
        resultsDiv.scrollIntoView({ behavior: "smooth", block: "start" });
      }

      function resetColorTest() {
        cvtPlates.forEach((_, idx) => {
          const input = document.getElementById(`cvtAnswer${idx}`);
          if (input) {
            input.value = "";
            input.style.background = "";
            input.style.borderColor = "";
          }
        });
        document
          .getElementById("medicalTest")
          .scrollIntoView({ behavior: "smooth" });
      }

      // =============================================
      // FLASHCARD VOCABULARY DRILL
      // =============================================

      const flashcardData = [
        {
          word: "Resilient",
          meaning:
            "Able to recover quickly from difficulties; tough and adaptable under pressure.",
        },
        {
          word: "Allegiance",
          meaning:
            "Loyal commitment to a person, group, or cause (e.g., allegiance to the flag).",
        },
        {
          word: "Hierarchy",
          meaning:
            "A system where members are ranked one above another by authority or status.",
        },
        {
          word: "Protocol",
          meaning:
            "The official rules and procedures for formal or military situations.",
        },
        {
          word: "Reconnaissance",
          meaning:
            "A military survey of an area to gather information about the enemy.",
        },
        {
          word: "Fortify",
          meaning:
            "To strengthen a place against attack; to make more resistant or secure.",
        },
        {
          word: "Deploy",
          meaning:
            "To move troops or equipment into a position ready for action.",
        },
        {
          word: "Integrity",
          meaning:
            "The quality of being honest and having strong moral principles.",
        },
        {
          word: "Discipline",
          meaning:
            "Training that enforces rules and order; controlled behavior and habits.",
        },
        {
          word: "Mobilize",
          meaning:
            "To organize and prepare troops or resources for active service.",
        },
        {
          word: "Surveillance",
          meaning:
            "Close observation, especially of a suspected area or person.",
        },
        {
          word: "Tactics",
          meaning:
            "Specific actions or plans used to achieve a short-term goal in battle.",
        },
        {
          word: "Strategy",
          meaning:
            "A long-term plan designed to achieve a major goal or objective.",
        },
        {
          word: "Morale",
          meaning:
            "The confidence, enthusiasm, and discipline of a person or group at a given time.",
        },
        {
          word: "Valor",
          meaning: "Great courage in the face of danger, especially in battle.",
        },
        {
          word: "Insubordination",
          meaning:
            "Defiance or refusal to obey orders from a superior officer.",
        },
        {
          word: "Commendation",
          meaning:
            "Formal praise or an award given for outstanding performance or bravery.",
        },
        {
          word: "Covert",
          meaning:
            "Not openly acknowledged or displayed; secret or hidden (e.g., covert operation).",
        },
        {
          word: "Jurisdiction",
          meaning:
            "The official power to make legal decisions; the territory it applies to.",
        },
        {
          word: "Perseverance",
          meaning:
            "Continued effort and determination despite difficulty or delay.",
        },
      ];

      let fcDeck = [...flashcardData];
      let fcIndex = parseInt(localStorage.getItem("fcIndex") || "0");
      let fcFlipped = false;
      let fcReviewed = new Set(
        JSON.parse(localStorage.getItem("fcReviewed") || "[]"),
      );

      function fcRenderCard() {
        const card = fcDeck[fcIndex];
        const cardInner = document.getElementById("fcCardInner");

        // Reset flip state
        fcFlipped = false;
        cardInner.classList.remove("is-flipped");

        // Update content
        document.getElementById("fcWord").textContent = card.word;
        document.getElementById("fcMeaning").textContent = card.meaning;
        document.getElementById("fcCurrentIndex").textContent = fcIndex + 1;
        document.getElementById("fcTotalCards").textContent = fcDeck.length;

        fcUpdateProgress();
      }

      function flipCard() {
        const cardInner = document.getElementById("fcCardInner");
        fcFlipped = !fcFlipped;
        if (fcFlipped) {
          cardInner.classList.add("is-flipped");
          fcReviewed.add(fcIndex);
          localStorage.setItem("fcReviewed", JSON.stringify([...fcReviewed]));
          fcUpdateProgress();
        } else {
          cardInner.classList.remove("is-flipped");
        }
      }

      function fcNext() {
        fcIndex = (fcIndex + 1) % fcDeck.length;
        localStorage.setItem("fcIndex", fcIndex);
        fcRenderCard();
      }

      function fcPrevious() {
        fcIndex = (fcIndex - 1 + fcDeck.length) % fcDeck.length;
        localStorage.setItem("fcIndex", fcIndex);
        fcRenderCard();
      }

      function fcShuffle() {
        fcDeck = shuffleArray([...flashcardData]);
        fcIndex = 0;
        fcReviewed.clear();
        fcRenderCard();
        showNotification("🔀 Cards shuffled!");
      }

      function fcReset() {
        fcDeck = [...flashcardData];
        fcIndex = 0;
        fcReviewed.clear();
        localStorage.removeItem("fcIndex");
        localStorage.removeItem("fcReviewed");
        fcRenderCard();
        showNotification("↺ Flashcards reset!");
      }

      function fcUpdateProgress() {
        const total = fcDeck.length;
        const reviewed = fcReviewed.size;
        const percent = Math.round((reviewed / total) * 100);

        document.getElementById("fcProgressBar").style.width = percent + "%";
        document.getElementById("fcProgressText").textContent =
          reviewed + " of " + total + " reviewed (" + percent + "%)";
      }
      // Update Verbal Analysis Dashboard
      function updateVerbalAnalysis() {
        // ✅ ADD: Reset all display elements first before recalculating
        const topics = ["analogies", "vocabulary", "comprehension", "grammar"];
        topics.forEach((topic) => {
          const perfElem = document.getElementById(`${topic}Perf`);
          const barElem = document.getElementById(`${topic}Bar`);
          const textElem = document.getElementById(`${topic}Text`);
          if (perfElem) perfElem.textContent = "0%";
          if (barElem) barElem.style.width = "0%";
          if (textElem) textElem.textContent = "No attempts yet";
        });

        // ✅ Safety check: Ensure the object exists
        if (!userData.verbalSubTopicPerformance) {
          console.warn(
            "⚠️ verbalSubTopicPerformance not initialized, creating now...",
          );
          userData.verbalSubTopicPerformance = {
            analogies: { correct: 0, total: 0 },
            vocabulary: { correct: 0, total: 0 },
            comprehension: { correct: 0, total: 0 },
            grammar: { correct: 0, total: 0 },
          };
        }

        let weakestTopic = null;
        let lowestScore = 100;

        topics.forEach((topic) => {
          const data = userData.verbalSubTopicPerformance[topic];

          // ✅ Extra safety: ensure topic exists
          if (!data) {
            userData.verbalSubTopicPerformance[topic] = {
              correct: 0,
              total: 0,
            };
            return; // Skip this iteration
          }

          if (data.total > 0) {
            const percentage = Math.round((data.correct / data.total) * 100);

            // Update display
            const perfElem = document.getElementById(`${topic}Perf`);
            const barElem = document.getElementById(`${topic}Bar`);
            const textElem = document.getElementById(`${topic}Text`);

            if (perfElem) perfElem.textContent = percentage + "%";
            if (barElem) barElem.style.width = percentage + "%";

            const status =
              percentage >= 80
                ? "✅ Strong"
                : percentage >= 60
                  ? "⚠️ Improving"
                  : "❌ Needs Work";

            if (textElem) {
              textElem.textContent = `${data.correct}/${data.total} correct - ${status}`;
            }

            // Track weakest
            if (percentage < lowestScore) {
              lowestScore = percentage;
              weakestTopic = topic;
            }
          }
        });

        // Show recommendation
        const recTextElem = document.getElementById("verbalRecText");
        if (!recTextElem) return;

        if (weakestTopic && lowestScore < 70) {
          const topicNames = {
            analogies: "Word Analogies",
            vocabulary: "Vocabulary",
            comprehension: "Reading Comprehension",
            grammar: "Grammar",
          };

          recTextElem.innerHTML = `
            Focus on <strong>${topicNames[weakestTopic]}</strong> (${lowestScore}%). 
            Review the tutorial section and practice 20+ questions in this area.
        `;
        } else if (lowestScore >= 70) {
          recTextElem.textContent =
            "🎉 Great work! All verbal sub-topics are strong. Keep practicing to maintain proficiency.";
        }
      }
      function confirmResetProgress() {
        // Show a confirmation modal before deleting
        const modalContent = document.getElementById("modalContent");
        modalContent.innerHTML = `
    <div style="text-align: center; padding: 20px;">
      <div style="font-size: 4rem; margin-bottom: 20px;">⚠️</div>
      <h2 style="color: var(--danger); margin-bottom: 15px;">Reset All Progress?</h2>
      <p style="color: var(--text-dark); margin-bottom: 10px; font-size: 1.1rem;">
        This will permanently delete:
      </p>
      <ul style="text-align: left; display: inline-block; margin: 15px 0; line-height: 2;">
        <li>📊 All practice scores and statistics</li>
        <li>🎮 All game high scores</li>
        <li>🔥 Your study streak</li>
        <li>📈 Performance history</li>
        <li>⚙️ All preferences</li>
      </ul>
      <p style="color: var(--danger); font-weight: 700; margin: 20px 0;">
        This action CANNOT be undone!
      </p>
      <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 25px;">
        <button class="btn btn-danger" onclick="executeResetProgress()" style="padding: 14px 35px; font-size: 1.1rem;">
          Yes, Reset Everything
        </button>
        <button class="btn btn-secondary" onclick="closeModal()" style="padding: 14px 35px; font-size: 1.1rem;">
          Cancel
        </button>
      </div>
    </div>
  `;
        document.getElementById("modal").classList.add("active");
      }

      function executeResetProgress() {
        // Clear localStorage
        localStorage.removeItem("afpExamData");

        // Reset userData to defaults
        userData = {
          totalQuestions: 0,
          correctAnswers: 0,
          afpsatScores: [],
          neuroPsychScores: [],
          mockExams: [],
          studyStreak: 0,
          lastStudyDate: null,
          weakAreas: {},
          strongAreas: {},
          verbalSubTopicPerformance: {
            analogies: { correct: 0, total: 0 },
            vocabulary: { correct: 0, total: 0 },
            comprehension: { correct: 0, total: 0 },
            grammar: { correct: 0, total: 0 },
          },
          questionsAnsweredOnTime: 0,
          questionsTotalTimed: 0,
          sectionPerformance: {
            abstract: [],
            verbal: [],
            numerical: [],
            neuroPsych: [],
          },
          preferences: {
            strictExamMode: false,
            lastUpdated: null,
          },
          gamesProgress: {
            patternSpeed: { highScore: 0, attempts: 0, lastPlayed: null },
            mathBlitz: { highScore: 0, attempts: 0, lastPlayed: null },
            memoryMatch: {
              highScore: 0,
              bestTime: 999999,
              attempts: 0,
              lastPlayed: null,
            },
          },
        };

        closeModal();
        updateDashboard();
        updateStats();
        initializeStrictMode();
        showNotification("✅ All progress has been reset successfully!");
      }
      // =============================================
      // AFP APPLICATION CHECKLIST
      // =============================================
      const checklistCategories = [
        {
          category: "📄 Required Documents",
          items: [
            "Birth Certificate (PSA authenticated)",
            "Transcript of Records / Diploma",
            "NBI Clearance (recent, within 6 months)",
            "Police Clearance (recent)",
            "Barangay Certificate of Good Moral Character",
            "2×2 and 1×1 ID photos (white background)",
            "Medical Certificate from government hospital",
            "AFPSAT Examination Permit",
          ],
        },
        {
          category: "📏 Physical Requirements",
          items: [
            "Age requirement met (check branch-specific age limit)",
            "Height: Males 5'2\" minimum / Females 5'0\" minimum (most branches)",
            "Weight proportional to height (within AFP BMI range)",
            "No visible tattoos on face, neck, or hands",
            "No disqualifying physical deformities",
          ],
        },
        {
          category: "🏃 Physical Fitness Test (PFT)",
          items: [
            "Push-ups: Males 30+ reps / Females 15+ reps",
            "Sit-ups: Males 35+ reps / Females 25+ reps",
            "2.4km run: Males under 13min / Females under 16min",
            "Swimming test preparation (if required by branch)",
          ],
        },
        {
          category: "🧠 Exam Preparation",
          items: [
            "AFPSAT review completed (Verbal, Numerical, Abstract)",
            "Neuro-Psych simulation completed at least twice",
            "Mock exam score of 71+ achieved",
            "Hard difficulty practice at 75%+ accuracy",
            "Flashcard vocabulary drilled (all cards reviewed)",
          ],
        },
        {
          category: "🏥 Medical Requirements",
          items: [
            "Vision: 20/20 correctable (color vision test passed)",
            "No disqualifying heart conditions",
            "No chronic illness or ongoing medication dependency",
            "No history of disqualifying psychiatric conditions",
            "Dental: No major untreated dental problems",
            "Hearing: Normal in both ears",
          ],
        },
        {
          category: "📝 Application Steps",
          items: [
            "Downloaded and completely filled AFP application form",
            "Chose branch of service (Army, Navy, Air Force, Marines, Coast Guard)",
            "Registered for AFPSAT examination date",
            "Arranged transportation to examination venue",
            "Prepared exam day kit: HB pencil, eraser, valid ID, permit",
          ],
        },
      ];

      function renderChecklist() {
        const saved = JSON.parse(localStorage.getItem("afpChecklist") || "{}");
        const container = document.getElementById("checklistItems");
        if (!container) return;

        let totalItems = 0;
        let checkedItems = 0;
        let html = "";

        checklistCategories.forEach((cat, catIdx) => {
          html += `
      <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 16px; border: 1px solid var(--border); box-shadow: 0 2px 8px var(--shadow-soft);">
        <h3 style="color: var(--primary); margin-bottom: 15px; font-size: 1.05rem;">${cat.category}</h3>
    `;
          cat.items.forEach((item, itemIdx) => {
            const key = `${catIdx}_${itemIdx}`;
            const isChecked = saved[key] || false;
            totalItems++;
            if (isChecked) checkedItems++;
            html += `
        <label style="display: flex; align-items: flex-start; gap: 12px; padding: 10px; margin: 5px 0; background: ${isChecked ? "#f0fdf4" : "var(--bg-light)"}; border-radius: 8px; cursor: pointer; border: 1px solid ${isChecked ? "#86efac" : "var(--border)"}; transition: all 0.2s;">
          <input type="checkbox" ${isChecked ? "checked" : ""}
                 onchange="toggleChecklistItem('${key}', this.checked)"
                 style="width: 18px; height: 18px; margin-top: 2px; cursor: pointer; flex-shrink: 0;">
          <span style="color: ${isChecked ? "#15803d" : "var(--text-dark)"}; ${isChecked ? "text-decoration: line-through; opacity: 0.7;" : ""} font-size: 0.95rem; line-height: 1.5;">
            ${item}
          </span>
        </label>
      `;
          });
          html += `</div>`;
        });

        container.innerHTML = html;

        const percent =
          totalItems > 0 ? Math.round((checkedItems / totalItems) * 100) : 0;
        const bar = document.getElementById("checklistBar");
        const pct = document.getElementById("checklistPercent");
        if (bar) bar.style.width = percent + "%";
        if (pct)
          pct.textContent = `${checkedItems}/${totalItems} (${percent}%)`;
      }

      function toggleChecklistItem(key, checked) {
        const saved = JSON.parse(localStorage.getItem("afpChecklist") || "{}");
        saved[key] = checked;
        localStorage.setItem("afpChecklist", JSON.stringify(saved));
        renderChecklist();
      }

      function resetChecklist() {
        localStorage.removeItem("afpChecklist");
        renderChecklist();
        showNotification("✅ Checklist reset!");
      }
      // =============================================
      // 30-DAY STUDY PLAN
      // =============================================
      const studyPlanData = [
        {
          day: 1,
          week: "Week 1: Know Your Level",
          icon: "🎯",
          section: "Mock Exam",
          task: "Take the AFPSAT Full Mock Exam cold — no studying first. This is your baseline score.",
        },
        {
          day: 2,
          week: "Week 1: Know Your Level",
          icon: "📊",
          section: "Performance",
          task: "Review your results. Identify your weakest section (Verbal, Numerical, or Abstract).",
        },
        {
          day: 3,
          week: "Week 1: Know Your Level",
          icon: "📖",
          section: "Tutorials",
          task: "Read the Verbal Ability Tutorial. Take notes on analogy types and vocabulary tips.",
        },
        {
          day: 4,
          week: "Week 1: Know Your Level",
          icon: "✍️",
          section: "Practice",
          task: "Practice Verbal — Easy difficulty. Target 80%+ accuracy before moving up.",
        },
        {
          day: 5,
          week: "Week 1: Know Your Level",
          icon: "📖",
          section: "Tutorials",
          task: "Read the Numerical Ability Tutorial. Review percentages, ratios, and word problems.",
        },
        {
          day: 6,
          week: "Week 1: Know Your Level",
          icon: "✍️",
          section: "Practice",
          task: "Practice Numerical — Easy difficulty. Max 60 seconds per question.",
        },
        {
          day: 7,
          week: "Week 1: Know Your Level",
          icon: "🎮",
          section: "Games / Flashcards",
          task: "REST DAY — Play Math Blitz for light practice. Review 10 flashcard words.",
        },

        {
          day: 8,
          week: "Week 2: Build Core Skills",
          icon: "📖",
          section: "Tutorials",
          task: "Read the Abstract Reasoning Tutorial. Study rotation, progression, and sequence patterns.",
        },
        {
          day: 9,
          week: "Week 2: Build Core Skills",
          icon: "✍️",
          section: "Practice",
          task: "Practice Abstract — Easy difficulty. Remember: only 14.4 seconds per question in the real exam!",
        },
        {
          day: 10,
          week: "Week 2: Build Core Skills",
          icon: "✍️",
          section: "Practice",
          task: "Practice Verbal — Medium difficulty. Focus on reading comprehension and grammar.",
        },
        {
          day: 11,
          week: "Week 2: Build Core Skills",
          icon: "✍️",
          section: "Practice",
          task: "Practice Numerical — Medium difficulty. Work on ratios and multi-step word problems.",
        },
        {
          day: 12,
          week: "Week 2: Build Core Skills",
          icon: "📖",
          section: "Tutorials",
          task: "Read all 3 Neuro-Psych Tutorials. Understand what traits the exam evaluates.",
        },
        {
          day: 13,
          week: "Week 2: Build Core Skills",
          icon: "✍️",
          section: "Practice",
          task: "Practice Neuro-Psych. Answer honestly and check your consistency on similar questions.",
        },
        {
          day: 14,
          week: "Week 2: Build Core Skills",
          icon: "🃏",
          section: "Flashcards",
          task: "REST DAY — Drill all flashcards. Play Pattern Speed Challenge game.",
        },

        {
          day: 15,
          week: "Week 3: Drill Hard Difficulty",
          icon: "🔴",
          section: "Practice",
          task: "Practice Verbal — Hard difficulty. Focus extra time on grammar and idiom questions.",
        },
        {
          day: 16,
          week: "Week 3: Drill Hard Difficulty",
          icon: "🔴",
          section: "Practice",
          task: "Practice Numerical — Hard. Age problems, compound interest, work-rate problems.",
        },
        {
          day: 17,
          week: "Week 3: Drill Hard Difficulty",
          icon: "🔴",
          section: "Practice",
          task: "Practice Abstract — Hard. Focus on Fibonacci, dual alphabet, and combined patterns.",
        },
        {
          day: 18,
          week: "Week 3: Drill Hard Difficulty",
          icon: "🧠",
          section: "Mock Exam",
          task: "Take the full Neuro-Psych Mock Exam. Read each scenario slowly before answering.",
        },
        {
          day: 19,
          week: "Week 3: Drill Hard Difficulty",
          icon: "📊",
          section: "Performance",
          task: "Review your Performance Stats. Which section is still weakest? Drill it today.",
        },
        {
          day: 20,
          week: "Week 3: Drill Hard Difficulty",
          icon: "✍️",
          section: "Practice",
          task: "Practice your weakest section at Hard difficulty. Target 70%+ accuracy.",
        },
        {
          day: 21,
          week: "Week 3: Drill Hard Difficulty",
          icon: "✅",
          section: "AFP Checklist",
          task: "REST DAY — Review your AFP Application Checklist. What documents are still missing?",
        },

        {
          day: 22,
          week: "Week 4: Exam Simulation",
          icon: "⏱️",
          section: "Mock Exam",
          task: "Take AFPSAT Full Mock Exam (2nd attempt). Did your score improve from Day 1?",
        },
        {
          day: 23,
          week: "Week 4: Exam Simulation",
          icon: "📋",
          section: "Review",
          task: "Review your mock answers. Write down every question type you got wrong.",
        },
        {
          day: 24,
          week: "Week 4: Exam Simulation",
          icon: "⚡",
          section: "Practice",
          task: "Speed drill: 15 Abstract questions in under 3 minutes. Train your pattern eyes.",
        },
        {
          day: 25,
          week: "Week 4: Exam Simulation",
          icon: "⚡",
          section: "Practice",
          task: "Speed drill: 20 Verbal questions in under 9 minutes. Build automatic recognition.",
        },
        {
          day: 26,
          week: "Week 4: Exam Simulation",
          icon: "⚡",
          section: "Practice",
          task: "Speed drill: 10 Numerical questions in under 10 minutes — mental math only, no scratch paper!",
        },
        {
          day: 27,
          week: "Week 4: Exam Simulation",
          icon: "⏱️",
          section: "Mock Exam",
          task: "Take AFPSAT Full Mock Exam (3rd attempt, Strict Mode ON). Aim for 75%+.",
        },
        {
          day: 28,
          week: "Week 4: Exam Simulation",
          icon: "💡",
          section: "Flashcards / Tips",
          task: "Review all flashcard words. Study the Tips & Strategies section carefully.",
        },

        {
          day: 29,
          week: "Final Preparation",
          icon: "📄",
          section: "Review + Checklist",
          task: "Light review only. Go over notes on weak areas. Confirm all documents are ready.",
        },
        {
          day: 30,
          week: "Final Preparation",
          icon: "💤",
          section: "Rest",
          task: "REST. Sleep 8 hours. Eat well. Prepare your exam kit. You are ready. Good luck! 🇵🇭",
        },
      ];

      function renderStudyPlan() {
        const container = document.getElementById("studyPlanDays");
        if (!container) return;
        const saved = JSON.parse(localStorage.getItem("afpStudyPlan") || "{}");

        const weeks = {};
        studyPlanData.forEach((day) => {
          if (!weeks[day.week]) weeks[day.week] = [];
          weeks[day.week].push(day);
        });

        let html = "";
        Object.entries(weeks).forEach(([weekName, days]) => {
          html += `<div style="margin-bottom: 25px;">
      <h3 style="color: var(--primary); margin-bottom: 12px; padding: 10px 15px; background: var(--bg-light); border-radius: 8px; border-left: 4px solid var(--primary);">${weekName}</h3>`;
          days.forEach((day) => {
            const isDone = saved[`day_${day.day}`] || false;
            html += `
        <label style="display: flex; align-items: flex-start; gap: 14px; padding: 14px 16px; margin: 8px 0; background: ${isDone ? "#f0fdf4" : "white"}; border-radius: 10px; cursor: pointer; border: 1px solid ${isDone ? "#86efac" : "var(--border)"}; transition: all 0.2s; box-shadow: 0 1px 4px var(--shadow-soft);">
          <input type="checkbox" ${isDone ? "checked" : ""}
                 onchange="toggleStudyDay(${day.day}, this.checked)"
                 style="width: 20px; height: 20px; margin-top: 2px; flex-shrink: 0; cursor: pointer;">
          <div style="flex: 1;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px; flex-wrap: wrap;">
              <span style="font-size: 1.3rem;">${day.icon}</span>
              <strong style="color: ${isDone ? "var(--success)" : "var(--primary)"};">Day ${day.day}</strong>
              <span style="background: var(--accent); color: white; padding: 2px 10px; border-radius: 10px; font-size: 0.78rem; font-weight: 600;">${day.section}</span>
            </div>
            <p style="color: ${isDone ? "#15803d" : "var(--text-dark)"}; font-size: 0.94rem; line-height: 1.6; ${isDone ? "opacity:0.7;" : ""}">${day.task}</p>
          </div>
        </label>`;
          });
          html += `</div>`;
        });

        container.innerHTML = html;
      }

      function toggleStudyDay(dayNumber, checked) {
        const saved = JSON.parse(localStorage.getItem("afpStudyPlan") || "{}");
        saved[`day_${dayNumber}`] = checked;
        localStorage.setItem("afpStudyPlan", JSON.stringify(saved));
        renderStudyPlan();
      }

      function resetStudyPlan() {
        localStorage.removeItem("afpStudyPlan");
        renderStudyPlan();
        showNotification("📅 Study plan reset!");
      }
    </script>
  </body>
</html>
