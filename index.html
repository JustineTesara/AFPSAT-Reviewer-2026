<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"
    />
    <title>AFP Exam Reviewer 2026</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
      }

      ::selection {
        background: var(--primary-light);
        color: white;
      }

      :root {
        /* Navy Green Theme */
        --primary: #1a4d2e;
        --primary-dark: #0f2818;
        --primary-light: #2d6a4f;
        --secondary: #4a7c59;
        --secondary-light: #74b38c;
        --accent: #d4af37;
        --danger: #c1121f;
        --success: #2d6a4f;
        --bg-light: #f1f8f4;
        --bg-cream: #faf8f3;
        --text-dark: #1a2e1a;
        --text-light: #5a6c5a;
        --border: #d1e3d1;
        --hover-glow: rgba(26, 77, 46, 0.15);
        --shadow-soft: rgba(26, 77, 46, 0.08);
        --white: #ffffff;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        background: linear-gradient(
          135deg,
          #1a4d2e 0%,
          #2d6a4f 50%,
          #4a7c59 100%
        );
        min-height: 100vh;
        color: var(--text-dark);
        padding-bottom: 80px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      /* ========================================
         RESPONSIVE DESIGN - MEDIA QUERIES
         ======================================== */

      /* Tablet styles (768px and below) */
      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        body {
          padding-bottom: 60px;
        }

        .header {
          padding: 20px;
          margin-bottom: 20px;
          border-radius: 12px;
        }

        .header h1 {
          font-size: 1.5rem;
          gap: 10px;
          flex-wrap: wrap;
        }

        .header-badge {
          font-size: 0.8rem;
          padding: 6px 15px;
        }

        .nav-tabs {
          gap: 8px;
          padding: 8px;
          margin-bottom: 15px;
          -webkit-overflow-scrolling: touch;
          scrollbar-width: thin;
        }

        .nav-tabs::-webkit-scrollbar {
          height: 6px;
        }

        .nav-tab {
          padding: 10px 20px;
          font-size: 0.95rem;
          min-height: 44px;
          flex-shrink: 0;
        }

        .nav-tab:hover {
          transform: none;
        }

        .nav-tab:active {
          transform: scale(0.98);
        }

        .content-section {
          padding: 20px;
          border-radius: 12px;
        }

        .section-header {
          gap: 12px;
          margin-bottom: 20px;
          padding-bottom: 12px;
          flex-wrap: wrap;
        }

        .section-header h2 {
          font-size: 1.5rem;
        }

        .section-header .emoji {
          font-size: 1.8rem;
        }

        .card-grid {
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 15px;
          margin-top: 15px;
        }

        .card {
          padding: 20px;
        }

        .card h3 {
          font-size: 1.2rem;
          margin-bottom: 10px;
        }

        .card .emoji {
          font-size: 2.2rem;
          margin-bottom: 12px;
        }

        .card:hover {
          transform: none;
        }

        .card:active {
          transform: scale(0.98);
        }

        .stats-grid {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
          gap: 15px;
          margin: 20px 0;
        }

        .stat-card {
          padding: 15px;
        }

        .stat-value {
          font-size: 2rem;
        }

        .stat-card:hover {
          transform: none;
        }

        .question-card {
          padding: 20px;
          margin: 15px 0;
        }

        .question-text {
          font-size: 1.1rem;
          margin-bottom: 20px;
        }

        .option {
          padding: 14px 18px;
          min-height: 44px;
        }

        .option:hover {
          transform: translateX(4px);
        }

        .btn {
          padding: 12px 24px;
          font-size: 0.95rem;
          min-height: 44px;
        }

        .btn-primary:hover,
        .btn-secondary:hover,
        .btn-success:hover,
        .btn-danger:hover {
          transform: none;
        }

        .btn:active {
          transform: scale(0.98);
        }

        .progress-container {
          margin: 20px 0;
          padding: 20px;
        }

        .achievement-grid {
          grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
          gap: 12px;
          margin: 20px 0;
        }

        .achievement-icon {
          font-size: 2rem;
          margin-bottom: 6px;
        }

        .score-circle {
          width: 150px;
          height: 150px;
          margin: 20px auto;
        }

        .score {
          font-size: 3rem;
        }

        .notification {
          top: 10px;
          right: 10px;
          left: 10px;
          max-width: calc(100% - 20px);
          padding: 15px 20px;
        }

        .timer {
          top: 10px;
          padding: 10px 20px;
          font-size: 0.95rem;
        }

        .info-box,
        .warning-box,
        .success-box {
          padding: 15px;
          margin: 15px 0;
        }

        .switch {
          width: 52px;
          height: 30px;
        }

        .slider:before {
          height: 22px;
          width: 22px;
        }

        input:checked + .slider:before {
          transform: translateX(22px);
        }

        h1 {
          font-size: 1.75rem;
        }

        h2 {
          font-size: 1.5rem;
        }

        h3 {
          font-size: 1.3rem;
        }

        ::-webkit-scrollbar {
          width: 6px;
          height: 6px;
        }
      }

      /* Mobile styles (600px and below) */
      @media (max-width: 600px) {
        .card-grid {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .stats-grid {
          grid-template-columns: 1fr 1fr;
        }
      }

      /* Small mobile styles (480px and below) */
      @media (max-width: 480px) {
        .container {
          padding: 10px;
        }

        body {
          padding-bottom: 50px;
        }

        .header {
          padding: 15px;
          margin-bottom: 15px;
        }

        .header h1 {
          font-size: 1.25rem;
          gap: 8px;
        }

        .header-badge {
          padding: 6px 12px;
          font-size: 0.75rem;
        }

        .nav-tabs {
          gap: 6px;
          padding: 6px;
          border-radius: 8px;
        }

        .nav-tab {
          padding: 10px 16px;
          font-size: 0.9rem;
          min-height: 44px;
        }

        .content-section {
          padding: 15px;
        }

        .section-header {
          gap: 10px;
          margin-bottom: 15px;
        }

        .section-header h2 {
          font-size: 1.3rem;
        }

        .section-header .emoji {
          font-size: 1.5rem;
        }

        .card {
          padding: 15px;
        }

        .card h3 {
          font-size: 1.1rem;
        }

        .card p {
          font-size: 0.95rem;
          line-height: 1.5;
        }

        .card .emoji {
          font-size: 2rem;
          margin-bottom: 10px;
        }

        .stats-grid {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .stat-card {
          padding: 12px;
        }

        .stat-value {
          font-size: 1.8rem;
        }

        .stat-label {
          font-size: 0.85rem;
        }

        .question-card {
          padding: 15px;
          margin: 12px 0;
        }

        .question-text {
          font-size: 1rem;
          margin-bottom: 15px;
          line-height: 1.5;
        }

        .options {
          gap: 10px;
        }

        .option {
          padding: 12px 15px;
          font-size: 0.95rem;
          gap: 10px;
        }

        .btn {
          padding: 12px 20px;
          font-size: 0.9rem;
          width: 100%;
          max-width: 100%;
        }

        .button-group {
          gap: 8px;
          margin: 15px 0;
          display: flex;
          flex-direction: column; /* ADDED: Stack buttons vertically */
        }

        .button-group .btn {
          width: 100%; /* ADDED: Full width buttons */
          min-width: 0;
          margin: 5px 0; /* ADDED: Spacing between stacked buttons */
        }

        .progress-container {
          margin: 15px 0;
          padding: 15px;
        }

        .progress-bar {
          height: 10px;
        }

        .achievement-grid {
          grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
          gap: 10px;
        }

        .achievement {
          padding: 10px;
          border-radius: 10px;
        }

        .achievement-icon {
          font-size: 1.5rem;
          margin-bottom: 4px;
        }

        .achievement-name {
          font-size: 0.7rem;
        }

        .score-circle {
          width: 130px;
          height: 130px;
        }

        .score {
          font-size: 2.5rem;
        }

        .total {
          font-size: 1rem;
        }

        .badge {
          padding: 5px 12px;
          font-size: 0.8rem;
          margin: 3px;
        }

        .notification {
          padding: 12px 16px;
          font-size: 0.9rem;
          bottom: 10px;
          right: 10px;
          left: 10px;
          max-width: calc(100% - 20px);
        }

        .timer {
          padding: 8px 16px;
          font-size: 0.85rem;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
          padding: 12px 14px;
          font-size: 16px; /* Prevents zoom on iOS */
          min-height: 44px;
        }
        /* Math game input fixes */
        input[type="number"]#mathAnswer {
          width: 100% !important; /* Full width on mobile */
          max-width: 280px;
          font-size: 1.8rem !important; /* Larger text */
          padding: 18px !important; /* More touch area */
          margin: 15px auto;
          display: block;
        }
        .form-group {
          margin-bottom: 15px;
        }

        .form-label {
          font-size: 0.95rem;
          margin-bottom: 6px;
        }

        .info-box,
        .warning-box,
        .success-box {
          padding: 12px;
          margin: 12px 0;
          font-size: 0.95rem;
        }

        .modal {
          padding: 10px;
        }

        .modal-content {
          padding: 25px 15px;
          border-radius: 12px;
          max-height: 95vh; /* ADDED: More screen space */
          overflow-y: auto;
          overflow-x: hidden; /* ADDED: Prevent horizontal scroll */
          -webkit-overflow-scrolling: touch; /* âœ… ADD this for iOS smooth scroll */
        }
        /* ADD this new rule: */
        @media (max-width: 480px) {
          .modal-content {
            max-height: 85vh; /* Shorter on mobile to account for keyboard */
          }
        }

        .modal-content * {
          max-width: 100%; /* ADDED: Force all children to respect container */
        }
        h1 {
          font-size: 1.5rem;
        }

        h2 {
          font-size: 1.3rem;
        }

        h3 {
          font-size: 1.1rem;
        }

        p {
          line-height: 1.5;
          font-size: 0.95rem;
        }

        .mt-1 {
          margin-top: 0.375rem;
        }
        .mt-2 {
          margin-top: 0.75rem;
        }
        .mt-3 {
          margin-top: 1.125rem;
        }
        .mb-1 {
          margin-bottom: 0.375rem;
        }
        .mb-2 {
          margin-bottom: 0.75rem;
        }
        .mb-3 {
          margin-bottom: 1.125rem;
        }
      }

      /* Landscape mode adjustments for mobile */
      @media (max-width: 768px) and (orientation: landscape) {
        .header {
          padding: 15px;
        }

        .header h1 {
          font-size: 1.3rem;
        }

        .content-section {
          padding: 15px;
        }

        .score-circle {
          width: 120px;
          height: 120px;
        }

        .score {
          font-size: 2rem;
        }
      }

      /* Smooth scrolling for navigation tabs */
      .nav-tabs {
        scrollbar-color: var(--primary-light) transparent;
      }

      .nav-tabs::-webkit-scrollbar-thumb {
        background: var(--primary-light);
        border-radius: 3px;
      }

      /* Touch-friendly tap targets */
      @media (hover: none) and (pointer: coarse) {
        .card,
        .option,
        .nav-tab,
        .btn {
          min-height: 44px;
        }
      }

      /* Prevent text selection on interactive elements */
      .btn,
      .nav-tab,
      .option {
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
        user-select: none;
      }

      /* Safe area insets for notched devices */
      @supports (padding: max(0px)) {
        body {
          padding-left: max(0px, env(safe-area-inset-left));
          padding-right: max(0px, env(safe-area-inset-right));
        }

        .container {
          padding-left: max(20px, env(safe-area-inset-left));
          padding-right: max(20px, env(safe-area-inset-right));
        }
      }

      /* Utility classes */
      .hide-mobile {
        display: block;
      }

      .show-mobile {
        display: none;
      }

      @media (max-width: 768px) {
        .hide-mobile {
          display: none;
        }
        .show-mobile {
          display: block;
        }

        .header:hover {
          transform: none;
        }

        .nav-tab.active {
          transform: none;
        }

        .card:hover::after {
          width: 0;
          height: 0;
        }

        .card:active::after {
          width: 300px;
          height: 300px;
        }
      }

      /* Image responsiveness */
      img {
        max-width: 100%;
        height: auto;
        display: block;
      }

      /* Table responsiveness */
      table {
        width: 100%;
        border-collapse: collapse;
        overflow-x: auto;
        display: block;
      }

      @media (max-width: 768px) {
        table {
          font-size: 0.9rem;
        }
      }

      @media (max-width: 480px) {
        table {
          font-size: 0.85rem;
        }
      }

      .header {
        background: linear-gradient(
          135deg,
          var(--white) 0%,
          var(--bg-cream) 100%
        );
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px var(--shadow-soft);
        text-align: center;
        border: 1px solid var(--border);
        transition: all 0.3s ease;
      }

      .header:hover {
        box-shadow: 0 15px 40px rgba(26, 77, 46, 0.12);
        transform: translateY(-2px);
      }

      .header h1 {
        color: var(--primary);
        font-size: 2rem;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        text-shadow: 0 2px 4px rgba(26, 77, 46, 0.1);
        flex-wrap: wrap; /* ADDED: Prevents text overflow */
        text-align: center; /* ADDED: Centers wrapped text */
      }

      .header-badge {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 8px 20px;
        border-radius: 25px;
        font-size: 0.85rem;
        font-weight: 600;
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.3);
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }
      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      .nav-tabs {
        display: flex;
        gap: 10px;
        background: linear-gradient(
          135deg,
          var(--white) 0%,
          var(--bg-light) 100%
        );
        padding: 10px;
        border-radius: 12px;
        margin-bottom: 20px;
        overflow-x: auto;
        box-shadow: 0 4px 12px var(--shadow-soft);
        border: 1px solid var(--border);
      }

      .nav-tab {
        padding: 12px 24px;
        border: none;
        background: var(--bg-cream);
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        white-space: nowrap;
        transition: all 0.3s ease;
        color: var(--text-dark);
        position: relative;
        overflow: hidden;
      }

      .nav-tab::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          var(--hover-glow),
          transparent
        );
        transition: left 0.5s ease;
      }

      .nav-tab:hover::before {
        left: 100%;
      }

      .nav-tab:hover {
        background: var(--primary);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(26, 77, 46, 0.3);
      }

      .nav-tab.active {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-light)
        );
        color: white;
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.4);
        transform: translateY(-1px);
      }

      .content-section {
        display: none;
        background: linear-gradient(
          135deg,
          var(--white) 0%,
          var(--bg-cream) 100%
        );
        border-radius: 16px;
        padding: 30px;
        box-shadow: 0 10px 30px var(--shadow-soft);
        animation: fadeInSlide 0.4s ease;
        border: 1px solid var(--border);
      }

      .content-section.active {
        display: block;
      }

      @keyframes fadeInSlide {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      @media (max-width: 768px) and (min-width: 481px) {
        /* Tablet: 2 columns */
        .card-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 480px) {
        /* Mobile: 1 column */
        .card-grid {
          grid-template-columns: 1fr;
        }
      }
      @media (max-width: 380px) {
        .score-circle {
          width: 110px;
          height: 110px;
        }

        .score {
          font-size: 2rem;
        }
      }
      .card {
        background: linear-gradient(
          135deg,
          var(--bg-light) 0%,
          var(--white) 100%
        );
        border-radius: 12px;
        padding: 25px;
        border: 2px solid var(--border);
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(
          90deg,
          var(--primary),
          var(--secondary),
          var(--secondary-light)
        );
        transition: height 0.3s ease;
      }

      .card::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: var(--hover-glow);
        transform: translate(-50%, -50%);
        transition:
          width 0.5s ease,
          height 0.5s ease;
      }

      .card:hover::after {
        width: 300px;
        height: 300px;
      }

      .card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 15px 35px rgba(26, 77, 46, 0.2);
        border-color: var(--primary);
      }

      .card:hover::before {
        height: 6px;
      }

      .card:active {
        transform: translateY(-4px) scale(1.01);
      }

      .card h3 {
        color: var(--primary);
        margin-bottom: 12px;
        font-size: 1.2rem;
        position: relative;
        z-index: 1;
        transition: color 0.3s ease;
      }

      .card:hover h3 {
        color: var(--primary-dark);
      }

      .card p {
        color: var(--text-light);
        line-height: 1.6;
        position: relative;
        z-index: 1;
        word-wrap: break-word; /* ADDED: Breaks long words */
        overflow-wrap: break-word; /* ADDED: Modern browsers */
        hyphens: auto; /* ADDED: Hyphenates long text */
      }

      .btn {
        padding: 12px 28px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 1rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: inline-block;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .btn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition:
          width 0.6s ease,
          height 0.6s ease;
      }

      .btn:hover::before {
        width: 300px;
        height: 300px;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-light)
        );
        color: white;
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.3);
      }

      .btn-primary:hover {
        background: linear-gradient(
          135deg,
          var(--primary-dark),
          var(--primary)
        );
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(26, 77, 46, 0.4);
      }
      /* Force hover effects inside modals even on touch devices */
      .modal-content .btn:hover,
      .modal-content .btn:focus {
        transform: translateY(-3px) !important;
        box-shadow: 0 8px 20px rgba(26, 77, 46, 0.4) !important;
      }

      .modal-content .btn-primary:hover,
      .modal-content .btn-primary:focus {
        background: linear-gradient(
          135deg,
          var(--primary-dark),
          var(--primary)
        ) !important;
      }

      .modal-content .btn-success:hover,
      .modal-content .btn-success:focus {
        background: linear-gradient(
          135deg,
          var(--secondary),
          var(--success)
        ) !important;
      }

      .modal-content .btn-secondary:hover,
      .modal-content .btn-secondary:focus {
        background: linear-gradient(
          135deg,
          var(--secondary-light),
          var(--secondary)
        ) !important;
      }
      .btn-primary:active {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.3);
      }

      .btn-success {
        background: linear-gradient(
          135deg,
          var(--success),
          var(--secondary-light)
        );
        color: white;
        box-shadow: 0 4px 12px rgba(45, 106, 79, 0.3);
      }

      .btn-success:hover {
        background: linear-gradient(135deg, var(--secondary), var(--success));
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(45, 106, 79, 0.4);
      }

      .btn-danger {
        background: var(--danger);
        color: white;
        box-shadow: 0 4px 12px rgba(193, 18, 31, 0.3);
      }

      .btn-danger:hover {
        background: #9a0e1a;
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(193, 18, 31, 0.4);
      }
      .btn-secondary {
        background: linear-gradient(
          135deg,
          var(--secondary),
          var(--secondary-light)
        );
        color: white;
        box-shadow: 0 4px 12px rgba(74, 124, 89, 0.3);
      }

      .btn-secondary:hover {
        background: linear-gradient(
          135deg,
          var(--secondary-light),
          var(--secondary)
        );
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(74, 124, 89, 0.4);
      }
      .question-card {
        background: linear-gradient(
          135deg,
          var(--bg-light) 0%,
          var(--bg-cream) 100%
        );
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 20px;
        border-left: 4px solid var(--primary);
        box-shadow: 0 4px 12px var(--shadow-soft);
        transition: all 0.3s ease;
      }

      .question-card:hover {
        box-shadow: 0 6px 16px rgba(26, 77, 46, 0.12);
        transform: translateX(2px);
      }

      .options {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 20px;
      }

      .option {
        padding: 15px 20px;
        background: var(--white);
        border: 2px solid var(--border);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 500;
        position: relative;
        overflow: hidden;
      }

      .option::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 0;
        background: var(--hover-glow);
        transition: width 0.3s ease;
      }

      .option:hover::before {
        width: 100%;
      }

      .option:hover {
        border-color: var(--primary);
        background: var(--bg-light);
        transform: translateX(5px);
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.15);
      }

      .option.selected {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-light)
        );
        color: white;
        border-color: var(--primary);
        transform: translateX(5px);
        box-shadow: 0 4px 16px rgba(26, 77, 46, 0.3);
      }

      .option.selected::before {
        display: none;
      }

      .option.correct {
        background: linear-gradient(
          135deg,
          var(--success),
          var(--secondary-light)
        );
        color: white;
        border-color: var(--success);
        animation: correctPulse 0.5s ease;
      }

      .option.incorrect {
        background: var(--danger);
        color: white;
        border-color: var(--danger);
        animation: shake 0.5s ease;
      }

      @keyframes correctPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.03);
        }
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }

      .explanation {
        margin-top: 20px;
        padding: 20px;
        background: linear-gradient(135deg, #fef8e7 0%, #fdf3d7 100%);
        border-radius: 8px;
        border-left: 4px solid var(--accent);
        box-shadow: 0 4px 12px rgba(212, 175, 55, 0.2);
        animation: fadeInSlide 0.4s ease;
      }

      .progress-bar {
        height: 30px;
        background: var(--bg-light);
        border-radius: 15px;
        overflow: hidden;
        margin: 20px 0;
        position: relative;
        border: 2px solid var(--border);
        box-shadow: inset 0 2px 4px rgba(26, 77, 46, 0.1);
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--primary),
          var(--secondary),
          var(--secondary-light)
        );
        transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        position: relative;
        overflow: hidden;
      }

      .progress-fill::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          left: -100%;
        }
        100% {
          left: 100%;
        }
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .stat-card {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 25px;
        border-radius: 12px;
        text-align: center;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.3);
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 70%
        );
        opacity: 0;
        transition: opacity 0.5s ease;
      }

      .stat-card:hover::before {
        opacity: 1;
      }

      .stat-card:hover {
        transform: translateY(-5px) scale(1.03);
        box-shadow: 0 8px 24px rgba(26, 77, 46, 0.4);
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        margin: 10px 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
      }

      .timer {
        background: linear-gradient(135deg, var(--accent), #c49930);
        color: white;
        padding: 15px 30px;
        border-radius: 12px;
        font-size: 1.5rem;
        font-weight: 700;
        text-align: center;
        margin: 20px 0;
        box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
        border: 2px solid rgba(255, 255, 255, 0.3);
        animation: timerPulse 2s ease-in-out infinite;
      }

      @keyframes timerPulse {
        0%,
        100% {
          box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
        }
        50% {
          box-shadow: 0 4px 20px rgba(212, 175, 55, 0.6);
        }
      }

      .tip-box {
        background: linear-gradient(
          135deg,
          var(--bg-light) 0%,
          var(--bg-cream) 100%
        );
        padding: 20px;
        border-radius: 12px;
        margin: 15px 0;
        border-left: 4px solid var(--primary);
        box-shadow: 0 2px 8px var(--shadow-soft);
        transition: all 0.3s ease;
      }

      .tip-box:hover {
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.15);
        transform: translateX(2px);
      }

      .tip-box strong {
        color: var(--primary);
      }

      .game-container {
        background: var(--bg-light);
        padding: 30px;
        border-radius: 12px;
        text-align: center;
      }
      /* Game Modal Responsive Fixes */
      @media (max-width: 768px) {
        #gameModal .modal-content {
          padding: 25px 15px;
          max-width: 95%;
        }

        /* Game completion screen */
        .score-circle {
          width: 140px !important;
          height: 140px !important;
        }

        .score-circle .score {
          font-size: 2.8rem !important;
        }

        /* Game buttons - stack vertically on mobile */
        #gameModalContent > div > div:last-child {
          flex-direction: column !important;
          gap: 10px !important;
        }

        #gameModalContent .btn {
          width: 100% !important;
          max-width: 280px !important;
          margin: 5px auto !important;
        }
      }

      @media (max-width: 480px) {
        #gameModal .modal-content {
          padding: 20px 12px;
        }

        .score-circle {
          width: 120px !important;
          height: 120px !important;
        }

        .score-circle .score {
          font-size: 2.2rem !important;
        }

        .score-circle .total {
          font-size: 0.9rem !important;
        }

        /* Smaller fonts for mobile */
        #gameModalContent h2 {
          font-size: 1.3rem !important;
        }

        #gameModalContent h3 {
          font-size: 1.1rem !important;
        }

        #gameModalContent p {
          font-size: 0.95rem !important;
        }
      }
      .pattern-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin: 20px auto;
        max-width: 400px;
      }

      /* Add these responsive rules */
      @media (max-width: 480px) {
        .pattern-grid {
          max-width: 100%;
          gap: 10px;
          margin: 15px auto;
        }
      }
      /* Flash Memory Game Responsive Fixes */
      @media (max-width: 768px) {
        /* Symbol grid - 3 columns on tablet */
        #gameModalContent div[style*="grid-template-columns: repeat(4"] {
          grid-template-columns: repeat(3, 1fr) !important;
          gap: 10px !important;
          max-width: 100% !important;
        }

        /* Smaller emoji size on tablet */
        #gameModalContent button[onclick*="selectSymbol"] {
          font-size: 2.2rem !important;
          padding: 15px !important;
          min-height: 70px !important;
        }

        /* Sequence display */
        #sequenceDisplay {
          font-size: 3rem !important;
          padding: 30px !important;
          min-height: 120px !important;
        }

        /* User sequence display */
        #userSequenceDisplay {
          font-size: 1.6rem !important;
          padding: 15px !important;
        }
      }

      @media (max-width: 480px) {
        /* Symbol grid - 2 columns on mobile */
        #gameModalContent div[style*="grid-template-columns: repeat(4"] {
          grid-template-columns: repeat(2, 1fr) !important;
          gap: 8px !important;
          padding: 0 5px !important;
        }

        /* Even smaller emoji on mobile */
        #gameModalContent button[onclick*="selectSymbol"] {
          font-size: 2rem !important;
          padding: 12px !important;
          min-height: 60px !important;
        }

        /* Sequence display mobile */
        #sequenceDisplay {
          font-size: 2.5rem !important;
          padding: 25px !important;
          min-height: 100px !important;
        }

        /* User sequence mobile */
        #userSequenceDisplay {
          font-size: 1.4rem !important;
          padding: 12px !important;
          min-height: 60px !important;
        }

        /* Stack Clear/Submit buttons on mobile */
        #gameModalContent div[style*="flex"] > .btn {
          width: 100% !important;
          max-width: 240px !important;
        }
      }
      .pattern-box {
        aspect-ratio: 1;
        background: var(--white);
        border: 3px solid var(--border);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .pattern-box:hover {
        transform: scale(1.1);
        border-color: var(--primary);
        box-shadow: 0 6px 16px rgba(26, 77, 46, 0.2);
        background: var(--bg-light);
      }

      .pattern-box:active {
        transform: scale(0.95);
      }

      .memory-card {
        aspect-ratio: 1;
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-light)
        );
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: white;
        box-shadow: 0 4px 12px rgba(26, 77, 46, 0.3);
      }

      .memory-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(26, 77, 46, 0.4);
      }

      .memory-card.flipped {
        background: var(--white);
        border: 3px solid var(--primary);
        color: var(--primary);
        transform: rotateY(180deg);
      }

      .memory-card.matched {
        background: linear-gradient(
          135deg,
          var(--success),
          var(--secondary-light)
        );
        color: white;
        animation: matchPulse 0.5s ease;
      }

      @keyframes matchPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      .notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: linear-gradient(
          135deg,
          var(--white) 0%,
          var(--bg-cream) 100%
        );
        padding: 20px 30px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(26, 77, 46, 0.3);
        display: none;
        animation: slideInBounce 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        z-index: 1000;
        border-left: 4px solid var(--primary);
        border: 2px solid var(--border);
        max-width: 350px;
      }

      @keyframes slideInBounce {
        0% {
          transform: translateX(400px);
          opacity: 0;
        }
        60% {
          transform: translateX(-20px);
          opacity: 1;
        }
        100% {
          transform: translateX(0);
        }
      }
      @media (max-width: 768px) {
        .modal {
          padding: 10px;
        }

        .modal-content {
          padding: 30px 20px;
          max-height: 90vh;
          width: 95%;
        }

        #practiceModal .modal-content {
          max-width: 100%;
        }

        .modal-content button[onclick*="close"] {
          top: 10px;
          right: 10px;
          width: 35px;
          height: 35px;
          font-size: 1.3rem;
        }
      }

      @media (max-width: 480px) {
        .modal-content {
          padding: 25px 15px;
          border-radius: 12px;
        }
      }
      /* ===== ENHANCED MODAL SYSTEM ===== */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(26, 77, 46, 0.9);
        backdrop-filter: blur(8px);
        z-index: 2000;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.3s ease;
        overflow-y: auto;
        padding: 20px;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: linear-gradient(
          135deg,
          var(--white) 0%,
          var(--bg-cream) 100%
        );
        padding: 40px;
        border-radius: 20px;
        max-width: 900px;
        width: 95%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
        border: 2px solid var(--border);
        animation: modalSlideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        position: relative;
        margin: auto;
      }

      /* Modal close button */
      .modal-close-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, var(--danger), #9a0e1a);
        color: white;
        border: none;
        width: 44px;
        height: 44px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.8rem;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 12px rgba(193, 18, 31, 0.3);
        line-height: 1;
        font-weight: 300;
      }

      .modal-close-btn:hover {
        background: linear-gradient(135deg, #9a0e1a, #7a0b15);
        transform: rotate(90deg) scale(1.1);
        box-shadow: 0 6px 20px rgba(193, 18, 31, 0.5);
      }

      .modal-close-btn:active {
        transform: rotate(90deg) scale(0.95);
      }

      /* Modal header styles */
      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 2px solid var(--border);
      }

      .modal-title {
        color: var(--primary);
        font-size: 1.8rem;
        font-weight: 700;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .modal-body {
        position: relative;
        z-index: 1;
      }

      /* Smooth scrollbar for modal */
      .modal-content::-webkit-scrollbar {
        width: 10px;
      }

      .modal-content::-webkit-scrollbar-track {
        background: var(--bg-light);
        border-radius: 5px;
      }

      .modal-content::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border-radius: 5px;
      }

      .modal-content::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(
          135deg,
          var(--primary-dark),
          var(--primary)
        );
      }

      /* Animation keyframes */
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      @keyframes modalSlideIn {
        0% {
          transform: scale(0.8) translateY(-60px);
          opacity: 0;
        }
        100% {
          transform: scale(1) translateY(0);
          opacity: 1;
        }
      }

      @keyframes modalSlideOut {
        0% {
          transform: scale(1) translateY(0);
          opacity: 1;
        }
        100% {
          transform: scale(0.8) translateY(-60px);
          opacity: 0;
        }
      }

      /* Responsive Modal Styles */
      @media (max-width: 768px) {
        .modal {
          padding: 10px;
        }

        .modal-content {
          padding: 30px 20px;
          max-height: 92vh;
          width: 98%;
          border-radius: 16px;
        }

        .modal-close-btn {
          top: 12px;
          right: 12px;
          width: 38px;
          height: 38px;
          font-size: 1.5rem;
        }

        .modal-title {
          font-size: 1.4rem;
          padding-right: 50px;
        }

        .modal-header {
          margin-bottom: 20px;
          padding-bottom: 15px;
        }
      }

      @media (max-width: 480px) {
        .modal-content {
          padding: 25px 15px;
          border-radius: 12px;
        }

        .modal-close-btn {
          width: 36px;
          height: 36px;
          font-size: 1.3rem;
        }

        .modal-title {
          font-size: 1.2rem;
        }
      }
      .topic-list {
        list-style: none;
      }

      .topic-item {
        padding: 15px;
        background: var(--bg-light);
        margin: 10px 0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid var(--border); /* âœ… General border first */
        border-left: 4px solid var(--primary); /* âœ… Then specific override */
      }

      .topic-item:hover {
        background: linear-gradient(
          135deg,
          var(--bg-light) 0%,
          var(--bg-cream) 100%
        );
        transform: translateX(5px);
        border-left-color: var(--secondary);
        box-shadow: 0 4px 12px var(--shadow-soft);
      }

      .lesson-content {
        line-height: 1.8;
        color: var(--text-dark);
      }

      .lesson-content h3 {
        color: var(--primary);
        margin: 20px 0 10px;
      }

      .lesson-content ul {
        margin-left: 20px;
        margin-bottom: 15px;
      }

      .lesson-content li {
        margin: 8px 0;
      }

      .score-summary {
        text-align: center;
        padding: 30px;
      }

      .score-circle {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--secondary),
          var(--secondary-light)
        );
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        margin: 30px auto;
        box-shadow: 0 10px 30px rgba(26, 77, 46, 0.3);
        position: relative;
        animation: scoreAppear 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        border: 4px solid rgba(255, 255, 255, 0.3);
      }

      .score-circle::before {
        content: "";
        position: absolute;
        inset: -5px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--accent),
          var(--secondary-light)
        );
        z-index: -1;
        opacity: 0.3;
        animation: rotateBorder 3s linear infinite;
      }

      @keyframes scoreAppear {
        0% {
          transform: scale(0) rotate(-180deg);
          opacity: 0;
        }
        100% {
          transform: scale(1) rotate(0deg);
          opacity: 1;
        }
      }

      @keyframes rotateBorder {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .score-circle .score {
        font-size: 4rem;
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .score-circle .total {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 1.5rem;
          flex-direction: column;
        }

        .nav-tabs {
          flex-wrap: nowrap;
          overflow-x: auto;
        }

        .card-grid {
          grid-template-columns: 1fr;
        }

        .container {
          padding: 10px;
        }

        .content-section {
          padding: 20px;
        }
      }

      .offline-indicator {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 10px 20px;
        background: var(--accent);
        color: white;
        border-radius: 8px;
        font-weight: 600;
        display: none;
        z-index: 1000;
      }

      .chart-container {
        margin: 30px 0;
        padding: 20px;
        background: var(--bg-light);
        border-radius: 12px;
      }

      .weak-area {
        background: #fee2e2;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border-left: 4px solid var(--danger);
      }

      .strong-area {
        background: #dcfce7;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border-left: 4px solid var(--success);
      }
      .strict-mode-container {
        background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 20px;
        border: 2px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      @media (max-width: 600px) {
        .strict-mode-container {
          flex-direction: column;
          align-items: flex-start;
          gap: 20px;
        }

        .strict-mode-container > div {
          width: 100%;
        }

        .strict-mode-container label {
          align-self: flex-end;
        }
      }
      /* Footer Styles */
      .footer {
        background: linear-gradient(
          135deg,
          var(--primary-dark),
          var(--primary)
        );
        color: var(--white);
        padding: 30px 20px;
        text-align: center;
        margin-top: 50px;
        box-shadow: 0 -4px 20px rgba(26, 77, 46, 0.2);
        position: relative;
      }

      .footer::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(
          90deg,
          var(--accent),
          var(--secondary-light),
          var(--accent)
        );
      }

      .footer-content {
        max-width: 1200px;
        margin: 0 auto;
      }

      .footer-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        color: var(--white);
      }

      .footer-credits {
        font-size: 1rem;
        margin: 15px 0;
        opacity: 0.95;
      }

      .footer-credits a {
        color: var(--accent);
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .footer-credits a:hover {
        color: var(--secondary-light);
        text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
      }

      .footer-motto {
        font-size: 0.95rem;
        font-style: italic;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
        opacity: 0.9;
      }

      .footer-year {
        font-size: 0.85rem;
        margin-top: 10px;
        opacity: 0.8;
      }

      .footer-divider {
        width: 60px;
        height: 3px;
        background: var(--accent);
        margin: 15px auto;
        border-radius: 2px;
      }
    </style>
  </head>
  <body>
    <div class="offline-indicator" id="offlineIndicator">ðŸ“¡ Offline Mode</div>

    <div class="container">
      <div class="header">
        <h1>
          ðŸŽ–ï¸ AFP Exam Reviewer 2026
          <span class="header-badge">AFPSAT & Neuro-Psych</span>
        </h1>
        <p style="color: var(--text-light); margin-top: 10px">
          Your Complete Guide to Passing the Armed Forces of the Philippines
          Examinations
        </p>
      </div>

      <div class="nav-tabs">
        <button
          class="nav-tab active"
          onclick="showSection('dashboard', event)"
        >
          ðŸ“Š Dashboard
        </button>
        <button class="nav-tab" onclick="showSection('tutorials', event)">
          ðŸ“š Tutorials
        </button>
        <button class="nav-tab" onclick="showSection('practice', event)">
          âœï¸ Practice
        </button>
        <button class="nav-tab" onclick="showSection('mockExam', event)">
          â±ï¸ Mock Exams
        </button>
        <button class="nav-tab" onclick="showSection('stats', event)">
          ðŸ“ˆ Performance
        </button>
        <button class="nav-tab" onclick="showSection('tips', event)">
          ðŸ’¡ Tips
        </button>
        <button class="nav-tab" onclick="showSection('games', event)">
          ðŸŽ® Games
        </button>
        <button class="nav-tab" onclick="showSection('resources', event)">
          ðŸ“š Resources
        </button>
      </div>

      <!-- Dashboard Section -->
      <div id="dashboard" class="content-section active">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          Welcome to Your Study Dashboard
        </h2>

        <!-- Strict Exam Mode Toggle -->
        <div class="strict-mode-container">
          <div style="flex: 1; min-width: 250px">
            <h3
              style="
                color: var(--primary);
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                gap: 10px;
                flex-wrap: wrap;
              "
            >
              âš”ï¸ Strict Exam Mode
              <span
                id="strictModeBadge"
                style="
                  font-size: 0.7rem;
                  padding: 4px 12px;
                  border-radius: 12px;
                  background: var(--danger);
                  color: white;
                  font-weight: 600;
                "
                >OFF</span
              >
            </h3>
            <p style="color: var(--text-light); font-size: 0.95rem; margin: 0">
              <strong>No feedback during exams.</strong> Answers revealed only
              at the end. Simulates real AFPSAT conditions.
            </p>
          </div>
          <label style="display: flex; align-items: center; cursor: pointer">
            <input
              type="checkbox"
              id="strictModeToggle"
              onchange="toggleStrictMode(this.checked)"
              style="width: 50px; height: 26px; cursor: pointer"
            />
          </label>
        </div>

        <!-- Passing Probability Card -->
        <div
          id="passingProbability"
          style="
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid var(--border);
          "
        ></div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Questions Completed</div>
            <div class="stat-value" id="totalQuestions">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Average Score</div>
            <div class="stat-value" id="avgScore">0%</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Study Streak</div>
            <div class="stat-value" id="studyStreak">0</div>
            <div class="stat-label">days</div>
          </div>
        </div>
        <!-- RESET PROGRESS CARD -->
        <div
          style="
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            border-radius: 12px;
            border: 2px solid #f87171;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
          "
        >
          <div>
            <h3 style="color: var(--danger); margin-bottom: 6px">
              ðŸ—‘ï¸ Reset All Progress
            </h3>
            <p style="color: #7f1d1d; font-size: 0.95rem; margin: 0">
              Clear all scores, streaks, and statistics. This cannot be undone.
            </p>
          </div>
          <button class="btn btn-danger" onclick="confirmResetProgress()">
            Reset Progress
          </button>
        </div>
        <div class="card-grid">
          <div class="card" onclick="showSection('tutorials')">
            <h3>ðŸ“š Start Learning</h3>
            <p>
              Begin with comprehensive tutorials covering all AFPSAT and
              Neuro-Psych topics
            </p>
          </div>
          <div class="card" onclick="showSection('practice')">
            <h3>âœï¸ Practice Questions</h3>
            <p>
              Test your knowledge with practice questions and instant feedback
            </p>
          </div>
          <div class="card" onclick="showSection('mockExam')">
            <h3>â±ï¸ Take Mock Exam</h3>
            <p>Simulate real exam conditions with timed mock tests</p>
          </div>
          <div class="card" onclick="showSection('games')">
            <h3>ðŸŽ® Brain Games</h3>
            <p>Sharpen your logic and memory with interactive exercises</p>
          </div>
        </div>

        <div class="tip-box" style="margin-top: 30px">
          <strong>ðŸ“… Daily Study Reminder:</strong> Consistency is key! Set
          aside 30-60 minutes daily for focused study. The AFPSAT requires raw
          score of 71 or higher to qualify.
        </div>
      </div>

      <!-- Tutorials Section -->
      <div id="tutorials" class="content-section">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          ðŸ“š Tutorial Topics
        </h2>

        <div class="card-grid">
          <div class="card" onclick="showTutorial('afpsatVerbal')">
            <h3>Verbal Ability</h3>
            <p>
              Grammar, vocabulary, reading comprehension - 65 items, 30 minutes
            </p>
          </div>
          <div class="card" onclick="showTutorial('afpsatNumerical')">
            <h3>Numerical Ability</h3>
            <p>Math, algebra, word problems - 35 items, 35 minutes</p>
          </div>
          <div class="card" onclick="showTutorial('afpsatAbstract')">
            <h3>Abstract Reasoning</h3>
            <p>Patterns, sequences, logic - 50 items, 12 minutes</p>
          </div>
          <div class="card" onclick="showTutorial('neuroPsychPersonality')">
            <h3>Personality Assessment</h3>
            <p>Behavior, attitude, emotional stability evaluation</p>
          </div>
          <div class="card" onclick="showTutorial('neuroPsychLogic')">
            <h3>Logical Thinking</h3>
            <p>Decision making and critical thinking skills</p>
          </div>
          <div class="card" onclick="showTutorial('neuroPsychStress')">
            <h3>Stress Tolerance</h3>
            <p>Emotional control and pressure management</p>
          </div>
        </div>
      </div>

      <!-- Practice Section -->
      <div id="practice" class="content-section">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          âœï¸ Practice Questions
        </h2>

        <div class="card-grid">
          <div class="card" onclick="startPractice('afpsatVerbal')">
            <h3>AFPSAT: Verbal Practice</h3>
            <p>15 practice questions with explanations</p>
          </div>
          <div class="card" onclick="startPractice('afpsatNumerical')">
            <h3>AFPSAT: Numerical Practice</h3>
            <p>15 practice questions with solutions</p>
          </div>
          <div class="card" onclick="startPractice('afpsatAbstract')">
            <h3>AFPSAT: Abstract Practice</h3>
            <p>15 pattern recognition questions</p>
          </div>
          <div class="card" onclick="startPractice('neuroPsych')">
            <h3>Neuro-Psych Practice</h3>
            <p>Situational and personality assessment questions</p>
          </div>
        </div>

        <div
          id="practiceQuestions"
          style="margin-top: 30px"
          display="none"
        ></div>
      </div>

      <!-- Mock Exam Section -->
      <div id="mockExam" class="content-section">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          â±ï¸ Mock Examinations
        </h2>

        <div class="card-grid">
          <div class="card" onclick="startMockExam('afpsat')">
            <h3>AFPSAT Full Mock Exam</h3>
            <p>150 items - Timed simulation of actual exam</p>
            <p style="color: var(--accent); font-weight: 600; margin-top: 10px">
              77 minutes total
            </p>
          </div>
          <div class="card" onclick="startMockExam('neuroPsych')">
            <h3>Neuro-Psych Simulation</h3>
            <p>Comprehensive psychological assessment simulation</p>
            <p style="color: var(--accent); font-weight: 600; margin-top: 10px">
              60 minutes
            </p>
          </div>
        </div>

        <div id="mockExamContent" style="display: none"></div>
      </div>

      <!-- Stats Section -->
      <div id="stats" class="content-section">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          ðŸ“ˆ Performance Statistics
        </h2>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">AFPSAT Practice Score</div>
            <div class="stat-value" id="afpsatAvg">0%</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Neuro-Psych Score</div>
            <div class="stat-value" id="neuroPsychAvg">0%</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Mock Exams Taken</div>
            <div class="stat-value" id="mocksTaken">0</div>
          </div>
        </div>

        <div class="chart-container">
          <h3 style="color: var(--primary); margin-bottom: 15px">
            Progress Over Time
          </h3>
          <div id="progressChart"></div>
        </div>

        <!-- ADD THIS NEW SECTION -->
        <div id="verbalAnalysis" style="margin: 30px 0">
          <h3 style="color: var(--primary); margin: 30px 0 15px">
            ðŸ“– Verbal Ability Deep Dive
          </h3>

          <div
            style="
              background: linear-gradient(
                135deg,
                var(--bg-light) 0%,
                var(--bg-cream) 100%
              );
              padding: 25px;
              border-radius: 16px;
              border: 2px solid var(--border);
            "
          >
            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
              "
            >
              <div
                style="
                  background: white;
                  padding: 20px;
                  border-radius: 12px;
                  border-left: 4px solid var(--primary);
                "
              >
                <h4
                  style="
                    color: var(--primary);
                    margin-bottom: 10px;
                    font-size: 0.95rem;
                  "
                >
                  Word Analogies
                </h4>
                <div
                  id="analogiesPerf"
                  style="
                    font-size: 1.8rem;
                    font-weight: 700;
                    color: var(--primary);
                    margin: 10px 0;
                  "
                >
                  0%
                </div>
                <div class="progress-bar" style="height: 8px; margin-top: 10px">
                  <div
                    id="analogiesBar"
                    class="progress-fill"
                    style="width: 0%"
                  ></div>
                </div>
                <p
                  id="analogiesText"
                  style="
                    margin-top: 8px;
                    font-size: 0.85rem;
                    color: var(--text-light);
                  "
                >
                  No attempts yet
                </p>
              </div>

              <div
                style="
                  background: white;
                  padding: 20px;
                  border-radius: 12px;
                  border-left: 4px solid var(--secondary);
                "
              >
                <h4
                  style="
                    color: var(--secondary);
                    margin-bottom: 10px;
                    font-size: 0.95rem;
                  "
                >
                  Vocabulary
                </h4>
                <div
                  id="vocabPerf"
                  style="
                    font-size: 1.8rem;
                    font-weight: 700;
                    color: var(--secondary);
                    margin: 10px 0;
                  "
                >
                  0%
                </div>
                <div class="progress-bar" style="height: 8px; margin-top: 10px">
                  <div
                    id="vocabBar"
                    class="progress-fill"
                    style="width: 0%; background: var(--secondary)"
                  ></div>
                </div>
                <p
                  id="vocabText"
                  style="
                    margin-top: 8px;
                    font-size: 0.85rem;
                    color: var(--text-light);
                  "
                >
                  No attempts yet
                </p>
              </div>

              <div
                style="
                  background: white;
                  padding: 20px;
                  border-radius: 12px;
                  border-left: 4px solid var(--secondary-light);
                "
              >
                <h4
                  style="
                    color: var(--secondary-light);
                    margin-bottom: 10px;
                    font-size: 0.95rem;
                  "
                >
                  Reading Comprehension
                </h4>
                <div
                  id="comprehensionPerf"
                  style="
                    font-size: 1.8rem;
                    font-weight: 700;
                    color: var(--secondary-light);
                    margin: 10px 0;
                  "
                >
                  0%
                </div>
                <div class="progress-bar" style="height: 8px; margin-top: 10px">
                  <div
                    id="comprehensionBar"
                    class="progress-fill"
                    style="width: 0%; background: var(--secondary-light)"
                  ></div>
                </div>
                <p
                  id="comprehensionText"
                  style="
                    margin-top: 8px;
                    font-size: 0.85rem;
                    color: var(--text-light);
                  "
                >
                  No attempts yet
                </p>
              </div>

              <div
                style="
                  background: white;
                  padding: 20px;
                  border-radius: 12px;
                  border-left: 4px solid var(--accent);
                "
              >
                <h4
                  style="
                    color: var(--accent);
                    margin-bottom: 10px;
                    font-size: 0.95rem;
                  "
                >
                  Grammar
                </h4>
                <div
                  id="grammarPerf"
                  style="
                    font-size: 1.8rem;
                    font-weight: 700;
                    color: var(--accent);
                    margin: 10px 0;
                  "
                >
                  0%
                </div>
                <div class="progress-bar" style="height: 8px; margin-top: 10px">
                  <div
                    id="grammarBar"
                    class="progress-fill"
                    style="width: 0%; background: var(--accent)"
                  ></div>
                </div>
                <p
                  id="grammarText"
                  style="
                    margin-top: 8px;
                    font-size: 0.85rem;
                    color: var(--text-light);
                  "
                >
                  No attempts yet
                </p>
              </div>
            </div>

            <div
              id="verbalRecommendation"
              style="
                margin-top: 20px;
                padding: 15px;
                background: #fef3c7;
                border-radius: 8px;
                border-left: 4px solid var(--accent);
              "
            >
              <strong>ðŸ’¡ Recommendation:</strong>
              <span id="verbalRecText"
                >Complete verbal practice to get personalized
                recommendations</span
              >
            </div>
          </div>
        </div>

        <h3 style="color: var(--primary); margin: 30px 0 15px">
          Areas for Improvement
        </h3>
        <div id="weakAreas"></div>

        <h3 style="color: var(--primary); margin: 30px 0 15px">Strong Areas</h3>
        <div id="strongAreas"></div>
      </div>

      <!-- Tips Section -->
      <div id="tips" class="content-section">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          ðŸ’¡ Exam Tips & Strategies
        </h2>

        <h3 style="color: var(--secondary); margin: 25px 0 15px">
          AFPSAT Exam Tips (10 Essential Strategies)
        </h3>
        <div class="tip-box">
          <strong>1. Master Time Management:</strong> You have limited time per
          question (1.5 minutes avg). Practice answering quickly but accurately.
          For Abstract Reasoning, you only have 14.4 seconds per item!
        </div>
        <div class="tip-box">
          <strong>2. Read Questions Carefully:</strong> Don't rush through
          questions. Misreading is a common mistake that costs points.
        </div>
        <div class="tip-box">
          <strong>3. Answer Easy Questions First:</strong> Skip difficult
          questions and return to them later. Secure easy points first.
        </div>
        <div class="tip-box">
          <strong>4. Process of Elimination:</strong> If unsure, eliminate
          obviously wrong answers to increase your chances.
        </div>
        <div class="tip-box">
          <strong>5. Strengthen Vocabulary:</strong> Study common Filipino and
          English words, synonyms, antonyms, and analogies.
        </div>
        <div class="tip-box">
          <strong>6. Practice Mental Math:</strong> Calculator isn't allowed.
          Practice basic operations, percentages, and fractions mentally.
        </div>
        <div class="tip-box">
          <strong>7. Recognize Patterns Quickly:</strong> For Abstract
          Reasoning, train your eyes to spot patterns in shapes, rotations, and
          sequences.
        </div>
        <div class="tip-box">
          <strong>8. Review Grammar Rules:</strong> Subject-verb agreement,
          tenses, and sentence structure are frequently tested.
        </div>
        <div class="tip-box">
          <strong>9. Don't Leave Blanks:</strong> There's no penalty for wrong
          answers. Make educated guesses if needed.
        </div>
        <div class="tip-box">
          <strong>10. Sleep Well Before Exam:</strong> Mental sharpness is
          crucial. Get 7-8 hours of sleep the night before.
        </div>
        <h3 style="color: var(--secondary); margin: 40px 0 15px">
          ðŸ“– AFPSAT Verbal Ability - Pro Strategies (Based on Cathy Castillo
          Vlog Tips)
        </h3>

        <div
          class="tip-box"
          style="
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            border-left-color: var(--primary);
          "
        >
          <strong>ðŸŽ¯ Cathy Castillo's Golden Rule:</strong> "For Verbal, SPEED +
          ACCURACY = Success. You have 27.7 seconds per question - practice
          until it becomes automatic!"
        </div>

        <div class="tip-box">
          <strong>1. Word Analogies - Identify the Relationship FIRST:</strong>
          <ul style="margin: 10px 0 0 20px; line-height: 1.8">
            <li>
              <strong>Types to memorize:</strong> Synonyms, Antonyms,
              Part-to-Whole, Cause-Effect, Function, Location
            </li>
            <li>
              <strong>Example:</strong> DOCTOR : HOSPITAL â†’ "person to
              workplace" â†’ TEACHER : SCHOOL
            </li>
            <li>
              <strong>Common trap:</strong> Don't just pick words that "sound
              related" - the RELATIONSHIP must match exactly
            </li>
            <li>
              <strong>Speed tip:</strong> Eliminate 2 obviously wrong answers
              first, then choose from remaining 2
            </li>
          </ul>
        </div>

        <div class="tip-box">
          <strong>2. Vocabulary - Build Your Word Bank Daily:</strong>
          <ul style="margin: 10px 0 0 20px; line-height: 1.8">
            <li>
              <strong>Learn 10 new words every day</strong> (both English and
              Filipino)
            </li>
            <li>
              <strong>Focus on military/government terms:</strong> discipline,
              hierarchy, protocol, allegiance, resilience
            </li>
            <li>
              <strong>Use context clues:</strong> Read the sentence carefully -
              surrounding words often hint at meaning
            </li>
            <li>
              <strong>Synonyms practice:</strong> For every new word, learn 2-3
              synonyms and 1-2 antonyms
            </li>
            <li>
              <strong>Cathy's tip:</strong> "If you don't know a word, use
              process of elimination. Wrong answers are usually too extreme or
              unrelated."
            </li>
          </ul>
        </div>

        <div class="tip-box">
          <strong>3. Reading Comprehension - The "3-Step Attack":</strong>
          <ul style="margin: 10px 0 0 20px; line-height: 1.8">
            <li>
              <strong>Step 1 - Read the QUESTION first</strong> (before the
              passage) to know what to look for
            </li>
            <li>
              <strong>Step 2 - Skim the passage</strong> for keywords related to
              the question (don't read every word)
            </li>
            <li>
              <strong>Step 3 - Eliminate obviously wrong answers</strong> before
              choosing
            </li>
            <li>
              <strong>Main idea questions:</strong> Answer is usually in the
              FIRST or LAST sentence
            </li>
            <li>
              <strong>Inference questions:</strong> Choose the answer that's
              implied but NOT directly stated
            </li>
            <li>
              <strong>Detail questions:</strong> Go back and find the EXACT
              sentence that answers it
            </li>
          </ul>
        </div>

        <div class="tip-box">
          <strong>4. Grammar & Sentence Construction:</strong>
          <ul style="margin: 10px 0 0 20px; line-height: 1.8">
            <li>
              <strong>Subject-Verb Agreement:</strong> Singular subjects =
              singular verbs (The soldier IS, The soldiers ARE)
            </li>
            <li>
              <strong>Common errors to watch:</strong> Wrong tense, incorrect
              prepositions, misplaced modifiers
            </li>
            <li>
              <strong>Read it aloud mentally:</strong> Does it "sound right"?
              Trust your ear for obvious errors
            </li>
            <li>
              <strong>Cathy's trick:</strong> "Cover the answer choices first,
              try to spot the error yourself, THEN look at options"
            </li>
          </ul>
        </div>

        <div class="tip-box">
          <strong>5. Time Management for Verbal Section:</strong>
          <ul style="margin: 10px 0 0 20px; line-height: 1.8">
            <li>
              <strong>65 questions in 30 minutes</strong> = ~27 seconds per
              question
            </li>
            <li>
              <strong>Strategy:</strong> Spend 15 seconds reading, 10 seconds
              answering, 2 seconds marking
            </li>
            <li>
              <strong>If stuck beyond 30 seconds:</strong> Make your best guess,
              mark it, and move on
            </li>
            <li>
              <strong>Save 3-5 minutes</strong> at the end to review marked
              questions
            </li>
            <li>
              <strong>Cathy's advice:</strong> "Easy questions are worth the
              same points as hard ones - grab the easy points first!"
            </li>
          </ul>
        </div>

        <div
          class="tip-box"
          style="
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left-color: var(--accent);
          "
        >
          <strong>âš¡ Final Verbal Speed Hacks:</strong>
          <ul style="margin: 10px 0 0 20px; line-height: 1.8">
            <li>
              Practice reading Filipino newspapers/articles daily to improve
              comprehension speed
            </li>
            <li>
              Make flashcards for word analogies you get wrong - review daily
            </li>
            <li>Never leave blanks - always guess if time is running out</li>
            <li>
              <strong>Cathy's secret:</strong> "For comprehension, if 2 answers
              seem correct, pick the MORE SPECIFIC one"
            </li>
          </ul>
        </div>
        <h3 style="color: var(--secondary); margin: 40px 0 15px">
          Neuro-Psychological Exam Tips (10 Key Guidelines)
        </h3>
        <div class="tip-box">
          <strong>1. Answer Honestly and Consistently:</strong> The test is
          designed to detect inconsistencies. Don't try to game the system.
        </div>
        <div class="tip-box">
          <strong>2. Don't Overthink Personality Questions:</strong> Your first
          instinct is usually right. Overthinking leads to inconsistent answers.
        </div>
        <div class="tip-box">
          <strong>3. Stay Calm During Situational Tests:</strong> Read scenarios
          carefully and think about what a good soldier would do.
        </div>
        <div class="tip-box">
          <strong>4. Read Scenarios Thoroughly:</strong> Don't rush. Understand
          the context before selecting your response.
        </div>
        <div class="tip-box">
          <strong>5. Avoid Extreme Answers Unless True:</strong> Don't always
          pick "strongly agree" or "strongly disagree" unless it genuinely
          reflects you.
        </div>
        <div class="tip-box">
          <strong>6. Manage Stress Before the Exam:</strong> Practice relaxation
          techniques. Anxiety can affect your performance.
        </div>
        <div class="tip-box">
          <strong>7. Get Enough Sleep:</strong> Mental clarity is essential for
          psychological assessments. Rest well.
        </div>
        <div class="tip-box">
          <strong>8. Practice Focus and Attention:</strong> Some tests measure
          concentration. Train your ability to maintain focus.
        </div>
        <div class="tip-box">
          <strong>9. Be Confident But Realistic:</strong> Show self-assurance
          without arrogance. Military values both confidence and humility.
        </div>
        <div class="tip-box">
          <strong>10. Follow Instructions Carefully:</strong> Each section may
          have specific instructions. Read them fully before starting.
        </div>

        <div
          class="tip-box"
          style="
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            margin-top: 30px;
          "
        >
          <strong>ðŸŽ¯ Final Reminder:</strong> The AFPSAT passing score is 71 or
          higher (raw score). Results are valid for 3 years, but retakes are
          only allowed once after 6 months. Make your preparation count!
        </div>
      </div>

      <!-- Games Section -->
      <div id="games" class="content-section">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          ðŸŽ® Interactive Brain Games
        </h2>

        <p style="margin-bottom: 30px; color: var(--text-light)">
          Train your cognitive skills with these quick games designed to improve
          pattern recognition, mental math speed, and memory - all critical for
          AFPSAT success.
        </p>

        <div class="card-grid">
          <div class="card" onclick="startGame('patternSpeed')">
            <h3>âš¡ Pattern Speed Challenge</h3>
            <p>
              Identify patterns as fast as possible. Trains Abstract Reasoning
              speed.
            </p>
            <div
              style="
                margin-top: 15px;
                padding: 10px;
                background: var(--bg-light);
                border-radius: 8px;
              "
            >
              <strong>High Score:</strong>
              <span id="patternHighScore">0</span> points
            </div>
          </div>

          <div class="card" onclick="startGame('mathBlitz')">
            <h3>ðŸ”¢ Math Blitz</h3>
            <p>
              Solve 10 math problems as fast as you can. Trains Numerical speed
              and accuracy.
            </p>
            <div
              style="
                margin-top: 15px;
                padding: 10px;
                background: var(--bg-light);
                border-radius: 8px;
              "
            >
              <strong>High Score:</strong>
              <span id="mathHighScore">0</span> points
            </div>
          </div>

          <div class="card" onclick="startGame('memoryMatch')">
            <h3>ðŸ§  Flash Memory</h3>
            <p>
              Remember a sequence of symbols. Trains concentration and recall.
            </p>
            <div
              style="
                margin-top: 15px;
                padding: 10px;
                background: var(--bg-light);
                border-radius: 8px;
              "
            >
              <strong>Best Time:</strong> <span id="memoryBestTime">--</span>s
            </div>
          </div>
        </div>

        <div id="gameContent" style="margin-top: 30px; display: none"></div>
      </div>

      <!-- Study Resources Section -->
      <div id="resources" class="content-section">
        <h2 style="color: var(--primary); margin-bottom: 20px">
          ðŸ“š Study Resources
        </h2>

        <p style="margin-bottom: 30px; color: var(--text-light)">
          Curated free and premium resources to supplement your AFPSAT
          preparation. All links open in a new tab.
        </p>

        <div id="weakAreaSuggestions" style="margin-bottom: 30px"></div>

        <div
          class="tip-box"
          style="
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            margin-bottom: 30px;
          "
        >
          <strong>ðŸ’¡ Study Tip:</strong> Use these resources alongside your
          practice sessions. Focus on weak areas first, then reinforce strong
          areas.
        </div>

        <!-- Verbal Resources -->
        <h3
          style="
            color: var(--secondary);
            margin: 30px 0 15px 0;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
          "
        >
          ðŸ“– Verbal Ability Resources
        </h3>
        <div class="card-grid" id="verbalResources"></div>

        <!-- Numerical Resources -->
        <h3
          style="
            color: var(--secondary);
            margin: 30px 0 15px 0;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
          "
        >
          ðŸ”¢ Numerical Ability Resources
        </h3>
        <div class="card-grid" id="numericalResources"></div>

        <!-- Abstract Resources -->
        <h3
          style="
            color: var(--secondary);
            margin: 30px 0 15px 0;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
          "
        >
          ðŸ§© Abstract Reasoning Resources
        </h3>
        <div class="card-grid" id="abstractResources"></div>

        <!-- Neuro-Psych Resources -->
        <h3
          style="
            color: var(--secondary);
            margin: 30px 0 15px 0;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
          "
        >
          ðŸ§  Neuro-Psychological Resources
        </h3>
        <div class="card-grid" id="neuroPsychResources"></div>

        <!-- General Resources -->
        <h3
          style="
            color: var(--secondary);
            margin: 30px 0 15px 0;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
          "
        >
          ðŸŒ General AFPSAT Resources
        </h3>
        <div class="card-grid" id="generalResources"></div>
      </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <div id="modalContent"></div>
        <button
          class="btn btn-primary"
          onclick="closeModal()"
          style="margin-top: 20px; width: 100%"
        >
          Close
        </button>
      </div>
    </div>

    <!-- Practice Questions Modal -->
    <div id="practiceModal" class="modal">
      <div class="modal-content" style="max-width: 900px">
        <button
          onclick="closePracticeModal()"
          style="
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--danger);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.3s;
          "
        >
          Ã—
        </button>
        <div id="practiceModalContent"></div>
      </div>
    </div>

    <!-- Game Modal -->
    <div id="gameModal" class="modal">
      <div class="modal-content" style="max-width: 1000px">
        <button onclick="closeGameModal()" class="modal-close-btn">Ã—</button>
        <div id="gameModalContent"></div>
      </div>
    </div>

    <!-- Mock Exam Modal -->
    <div id="mockExamModal" class="modal">
      <div class="modal-content" style="max-width: 1100px">
        <button onclick="closeMockExamModal()" class="modal-close-btn">
          Ã—
        </button>
        <div id="mockExamModalContent"></div>
      </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-content">
        <div class="footer-title">ðŸŽ–ï¸ AFPSAT Reviewer 2026</div>
        <div class="footer-divider"></div>
        <div class="footer-credits">
          Developed with ðŸ’š by
          <a href="#" onclick="return false;">Justine Tesara</a>
        </div>
        <div class="footer-motto">
          "Excellence is not a destination, it is a continuous journey that
          never ends."
          <br />
          <strong>Mabuhay ang mga Sundalo ng Pilipinas! ðŸ‡µðŸ‡­</strong>
        </div>
        <div class="footer-year">
          Â© 2026 AFPSAT Reviewer System. All rights reserved.
        </div>
      </div>
    </footer>

    <script>
      // AFPSAT Official Timing Configuration
      const AFPSAT_TIMING = {
        abstractReasoning: {
          questions: 50,
          timeLimit: 720, // 12 minutes = 720 seconds
          perQuestion: 14.4, // 14.4 seconds per question
          warningAt: 600, // Warning at 10 minutes
          section: "Abstract Reasoning",
        },
        verbalAbility: {
          questions: 65,
          timeLimit: 1800, // 30 minutes
          perQuestion: 27.7,
          warningAt: 1500, // Warning at 25 minutes
          section: "Verbal Ability",
        },
        numericalAbility: {
          questions: 35,
          timeLimit: 2100, // 35 minutes
          perQuestion: 60,
          warningAt: 1800, // Warning at 30 minutes
          section: "Numerical Ability",
        },
      };

      // Timer State
      let timerState = {
        active: false,
        remaining: 0,
        total: 0,
        mode: "practice", // 'practice', 'timed', 'exam'
        intervalId: null,
        section: null,
      };

      // Data Storage
      let userData = {
        totalQuestions: 0,
        correctAnswers: 0,
        afpsatScores: [],
        neuroPsychScores: [],
        mockExams: [],
        studyStreak: 0,
        lastStudyDate: null,
        weakAreas: {},
        strongAreas: {},
        // ADD THIS NEW FIELD:
        verbalSubTopicPerformance: {
          analogies: { correct: 0, total: 0 },
          vocabulary: { correct: 0, total: 0 },
          comprehension: { correct: 0, total: 0 },
          grammar: { correct: 0, total: 0 },
        },
        // New tracking fields
        questionsAnsweredOnTime: 0,
        questionsTotalTimed: 0,
        sectionPerformance: {
          abstract: [],
          verbal: [],
          numerical: [],
          neuroPsych: [],
        },
        preferences: {
          strictExamMode: false, // Toggle for strict exam simulation
          lastUpdated: null,
        },
        gamesProgress: {
          patternSpeed: { highScore: 0, attempts: 0, lastPlayed: null },
          mathBlitz: { highScore: 0, attempts: 0, lastPlayed: null },
          memoryMatch: {
            highScore: 0,
            bestTime: 999999,
            attempts: 0,
            lastPlayed: null,
          },
        },
      };

      // Timer Functions
      function startTimer(seconds, section, mode = "practice") {
        timerState.active = true;
        timerState.remaining = seconds;
        timerState.total = seconds;
        timerState.section = section;
        timerState.mode = mode;

        updateTimerDisplay();

        timerState.intervalId = setInterval(() => {
          timerState.remaining--;
          updateTimerDisplay();

          // Warning at specific time
          const config = Object.values(AFPSAT_TIMING).find(
            (c) => c.section === section,
          );
          if (
            config &&
            timerState.remaining ===
              config.warningAt - config.timeLimit + timerState.total
          ) {
            showNotification(
              `âš ï¸ Warning: ${Math.floor(timerState.remaining / 60)} minutes remaining!`,
            );
          }

          // Time's up
          if (timerState.remaining <= 0) {
            stopTimer();
            if (timerState.mode === "exam") {
              autoSubmitSection();
            } else {
              showNotification(
                "â° Time is up! In the real exam, this section would be auto-submitted.",
              );
            }
          }
        }, 1000);
      }

      function stopTimer() {
        if (timerState.intervalId) {
          clearInterval(timerState.intervalId);
          timerState.intervalId = null;
        }
        timerState.active = false;
      }

      function updateTimerDisplay() {
        const minutes = Math.floor(timerState.remaining / 60);
        const seconds = timerState.remaining % 60;
        const display = `${minutes}:${seconds.toString().padStart(2, "0")}`;

        const timerElement = document.getElementById("sectionTimer");
        if (timerElement) {
          timerElement.textContent = display;

          // Color coding based on time remaining
          const percentRemaining =
            (timerState.remaining / timerState.total) * 100;
          if (percentRemaining < 20) {
            timerElement.style.background = "var(--danger)";
          } else if (percentRemaining < 50) {
            timerElement.style.background = "var(--accent)";
          } else {
            timerElement.style.background = "var(--success)";
          }
        }
      }

      function autoSubmitSection() {
        showNotification("â° TIME EXPIRED - Section auto-submitted");

        // Auto-click submit button if it exists
        const submitBtn = document.querySelector(
          'button[onclick*="submitAnswer"]',
        );
        if (submitBtn) {
          submitBtn.click();
        } else {
          // If in practice, force show results
          if (typeof showPracticeResults === "function") {
            // Call with current state
            closePracticeModal();
            showNotification("â° Time's up! Practice ended.");
          }
        }
      }

      // Load saved data
      function loadUserData() {
        const saved = localStorage.getItem("afpExamData");
        if (saved) {
          userData = JSON.parse(saved);

          // Ensure preferences object exists (backward compatibility)
          if (!userData.preferences) {
            userData.preferences = {
              strictExamMode: false,
              lastUpdated: null,
            };
          }

          // âœ… FIX: Ensure verbalSubTopicPerformance exists (backward compatibility)
          if (!userData.verbalSubTopicPerformance) {
            userData.verbalSubTopicPerformance = {
              analogies: { correct: 0, total: 0 },
              vocabulary: { correct: 0, total: 0 },
              comprehension: { correct: 0, total: 0 },
              grammar: { correct: 0, total: 0 },
            };
          }

          // âœ… FIX: Ensure all 4 topics exist even if partially saved
          const requiredTopics = [
            "analogies",
            "vocabulary",
            "comprehension",
            "grammar",
          ];
          requiredTopics.forEach((topic) => {
            if (!userData.verbalSubTopicPerformance[topic]) {
              userData.verbalSubTopicPerformance[topic] = {
                correct: 0,
                total: 0,
              };
            }
          });

          updateDashboard();
          updateStats();

          setTimeout(() => {
            updateGameScores();
          }, 100);

          setTimeout(() => {
            initializeStrictMode();
          }, 100);
        }
      }

      // Passing Probability Calculator
      class AFPSATPredictor {
        calculatePassingProbability(userData) {
          const weights = {
            mockExamAverage: 0.4,
            practiceConsistency: 0.25,
            timeManagement: 0.2,
            weakAreaCoverage: 0.15,
          };

          // 1. Mock Exam Performance
          const mockScores = userData.mockExams.map((m) => m.score);
          const mockAvg =
            mockScores.length > 0
              ? mockScores.reduce((a, b) => a + b, 0) / mockScores.length
              : 0;

          let mockScore = 0;
          if (mockScores.length === 0) {
            mockScore = 0; // âœ… No exams taken = show 0, not 15
          } else if (mockAvg >= 80) mockScore = 100;
          else if (mockAvg >= 75) mockScore = 90;
          else if (mockAvg >= 71) mockScore = 75;
          else if (mockAvg >= 65) mockScore = 55;
          else if (mockAvg >= 55) mockScore = 35;
          else mockScore = 15;

          // 2. Practice Consistency (lower variance = better)
          const allScores = [
            ...(userData.sectionPerformance.abstract || []),
            ...(userData.sectionPerformance.verbal || []),
            ...(userData.sectionPerformance.numerical || []),
          ].map((s) => s.score);

          const variance = this.calculateVariance(allScores);
          const consistencyScore =
            allScores.length === 0
              ? 50
              : variance < 10
                ? 100
                : variance < 15
                  ? 80
                  : variance < 20
                    ? 60
                    : 40;

          // 3. Time Management
          const timeScore =
            userData.questionsTotalTimed > 0
              ? (userData.questionsAnsweredOnTime /
                  userData.questionsTotalTimed) *
                100
              : 50;

          // 4. Weak Area Coverage
          const topics = Object.keys(userData.weakAreas);
          const masteredTopics = topics.filter((topic) => {
            const data = userData.weakAreas[topic];
            return data.total > 0 && data.correct / data.total >= 0.7;
          });

          const weakScore =
            topics.length > 0
              ? (masteredTopics.length / topics.length) * 100
              : 0;

          // Calculate weighted total
          const totalScore =
            mockScore * weights.mockExamAverage +
            consistencyScore * weights.practiceConsistency +
            timeScore * weights.timeManagement +
            weakScore * weights.weakAreaCoverage;

          return {
            ...this.getConfidenceBand(totalScore),
            breakdown: {
              mockAverage: Math.round(mockAvg),
              mockScore: mockScore,
              consistency: Math.round(consistencyScore),
              timeManagement: Math.round(timeScore),
              weakAreaCoverage: Math.round(weakScore),
              totalScore: Math.round(totalScore),
            },
          };
        }

        calculateVariance(scores) {
          if (scores.length === 0) return 0;
          const mean = scores.reduce((a, b) => a + b, 0) / scores.length;
          const squaredDiffs = scores.map((score) => Math.pow(score - mean, 2));
          return Math.sqrt(
            squaredDiffs.reduce((a, b) => a + b, 0) / scores.length,
          );
        }

        getConfidenceBand(score) {
          if (score >= 85)
            return {
              band: "HIGH CONFIDENCE",
              emoji: "ðŸŽ¯",
              message: "You're very likely to pass the AFPSAT exam.",
              color: "var(--success)",
              probability: "85-95%",
              recommendation:
                "You're ready! Schedule your exam within 1-2 weeks. Continue light review to stay sharp.",
            };
          else if (score >= 70)
            return {
              band: "GOOD CHANCE",
              emoji: "âœ…",
              message:
                "You have a good chance of passing, but continued practice is recommended.",
              color: "var(--primary)",
              probability: "70-84%",
              recommendation:
                "Take 2-3 more full mock exams. Focus on your weakest section. Schedule exam in 2-3 weeks.",
            };
          else if (score >= 55)
            return {
              band: "BORDERLINE",
              emoji: "âš ï¸",
              message:
                "You're on the edge. More focused preparation is needed.",
              color: "var(--accent)",
              probability: "50-69%",
              recommendation:
                "NOT ready yet. Delay exam scheduling. Focus on weak areas for 3-4 weeks. Aim for 75%+ on mock exams.",
            };
          else
            return {
              band: "HIGH RISK",
              emoji: "âŒ",
              message: "Significant risk of failing. Intensive study required.",
              color: "var(--danger)",
              probability: "Below 50%",
              recommendation:
                "DO NOT schedule exam. Complete all tutorials, practice extensively, and retake mock exams. Minimum 4-6 weeks of study needed.",
            };
        }

        getSectionReadiness() {
          const sections = ["abstract", "verbal", "numerical"];
          const readiness = {};

          sections.forEach((section) => {
            const scores = (userData.sectionPerformance[section] || []).map(
              (s) => s.score,
            );
            const avg =
              scores.length > 0
                ? scores.reduce((a, b) => a + b, 0) / scores.length
                : 0;

            readiness[section] = {
              average: Math.round(avg),
              attempts: scores.length,
              status:
                avg >= 75
                  ? "âœ… Ready"
                  : avg >= 65
                    ? "âš ï¸ Almost Ready"
                    : "âŒ Needs Work",
            };
          });

          return readiness;
        }
      }

      const afpsatPredictor = new AFPSATPredictor();

      // Save data
      function saveUserData() {
        // Update study streak
        const today = new Date().toDateString();
        if (userData.lastStudyDate !== today) {
          const yesterday = new Date();
          yesterday.setDate(yesterday.getDate() - 1);
          if (userData.lastStudyDate === yesterday.toDateString()) {
            userData.studyStreak = (userData.studyStreak || 0) + 1;
          } else if (userData.lastStudyDate !== today) {
            userData.studyStreak = 1; // Reset streak if gap > 1 day
          }
          userData.lastStudyDate = today;
        }
        localStorage.setItem("afpExamData", JSON.stringify(userData));
      }

      // === SHUFFLE UTILITIES ===

      // Generic array shuffle (Fisher-Yates)
      function shuffleArray(array) {
        const shuffled = [...array]; // Create copy to avoid mutating original
        for (let i = shuffled.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
      }

      // Shuffle question options and update correct answer index
      function shuffleQuestion(question) {
        const originalCorrect = question.options[question.correct];
        const shuffledOptions = shuffleArray(question.options);
        const newCorrectIndex = shuffledOptions.indexOf(originalCorrect);

        return {
          ...question,
          options: shuffledOptions,
          correct: newCorrectIndex,
        };
      }

      // Shuffle array of questions
      function shuffleQuestions(questions) {
        return shuffleArray(questions).map((q) => shuffleQuestion(q));
      }

      // Toggle strict exam mode
      function toggleStrictMode(enabled) {
        userData.preferences.strictExamMode = enabled;
        userData.preferences.lastUpdated = new Date().toISOString();
        saveUserData();

        // Update UI
        const badge = document.getElementById("strictModeBadge");
        const toggle = document.getElementById("strictModeToggle");

        if (enabled) {
          badge.textContent = "ON";
          badge.style.background = "var(--success)";
          showNotification(
            "âš”ï¸ Strict Exam Mode ENABLED - No feedback during exams",
          );
        } else {
          badge.textContent = "OFF";
          badge.style.background = "var(--danger)";
          showNotification(
            "ðŸ”“ Strict Exam Mode DISABLED - Feedback will be shown",
          );
        }

        toggle.checked = enabled;
      }

      // Initialize strict mode toggle on page load
      function initializeStrictMode() {
        const toggle = document.getElementById("strictModeToggle");
        const badge = document.getElementById("strictModeBadge");

        if (toggle && userData.preferences) {
          toggle.checked = userData.preferences.strictExamMode || false;

          if (userData.preferences.strictExamMode) {
            badge.textContent = "ON";
            badge.style.background = "var(--success)";
          }
        }
      }

      // Tutorial Data
      const tutorials = {
        afpsatVerbal: {
          title: "AFPSAT: Verbal Ability - Complete Guide",
          content: `
            <h3>Overview (Based on AFPSAT 2025-2026 Format)</h3>
            <p>The Verbal Reasoning section measures your ability to understand and reason using concepts framed in words. This is your chance to demonstrate language mastery.</p>
            
            <p><strong>Format:</strong> 65 items in 30 minutes (approximately 27.7 seconds per question)</p>
            <p><strong>Passing Score Contribution:</strong> ~43% of total AFPSAT score</p>
            
            <div style="background: var(--bg-light); padding: 20px; border-radius: 12px; margin: 20px 0;">
              <h4 style="color: var(--primary); margin-bottom: 10px;">Question Type Breakdown:</h4>
              <ul style="margin-left: 20px;">
                <li><strong>Word Analogies:</strong> ~25 questions (38%)</li>
                <li><strong>Vocabulary:</strong> ~20 questions (31%)</li>
                <li><strong>Reading Comprehension:</strong> ~15 questions (23%)</li>
                <li><strong>Grammar/Sentence Construction:</strong> ~5 questions (8%)</li>
              </ul>
            </div>
            
            <h3>1. Word Analogies - Master the Relationships</h3>
            <p>Analogies test your ability to see relationships between word pairs. The key is identifying the TYPE of relationship first.</p>
            
            <div style="background: #e0f2fe; padding: 15px; border-radius: 8px; margin: 15px 0;">
              <strong>Common Relationship Types:</strong>
              <ul style="margin: 10px 0 0 20px;">
                <li><strong>Synonyms:</strong> HAPPY : JOYFUL</li>
                <li><strong>Antonyms:</strong> HOT : COLD</li>
                <li><strong>Part to Whole:</strong> WHEEL : CAR</li>
                <li><strong>Function:</strong> PEN : WRITE</li>
                <li><strong>Location:</strong> DOCTOR : HOSPITAL</li>
                <li><strong>Degree:</strong> WARM : HOT (intensity)</li>
                <li><strong>Cause & Effect:</strong> TRAINING : SKILL</li>
              </ul>
            </div>
            
            <p><strong>Strategy:</strong></p>
            <ol style="margin-left: 20px;">
              <li>Read the first pair and create a sentence: "A DOCTOR works in a HOSPITAL"</li>
              <li>Apply that same sentence structure to answer choices</li>
              <li>Eliminate answers that don't fit the exact relationship</li>
            </ol>
            
            <h3>2. Vocabulary - Synonyms, Antonyms, Context Clues</h3>
            <p>Vocabulary questions test your word knowledge. Even if you don't know a word, you can often figure it out.</p>
            
            <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin: 15px 0;">
              <strong>High-Frequency AFPSAT Words to Memorize:</strong>
              <ul style="margin: 10px 0 0 20px; columns: 2; -webkit-columns: 2; -moz-columns: 2;">
                <li>Resilient, Adaptable</li>
                <li>Discipline, Authority</li>
                <li>Integrity, Honor</li>
                <li>Strategy, Tactics</li>
                <li>Allegiance, Loyalty</li>
                <li>Hierarchy, Rank</li>
                <li>Protocol, Procedure</li>
                <li>Deploy, Mobilize</li>
                <li>Fortify, Reinforce</li>
                <li>Reconnaissance, Surveillance</li>
              </ul>
            </div>
            
            <p><strong>Context Clues Technique:</strong></p>
            <ul style="margin-left: 20px;">
              <li>Look for signal words: "but" (antonym), "like" (synonym)</li>
              <li>Check if the sentence gives examples or definitions</li>
              <li>Consider the overall tone (positive/negative)</li>
            </ul>
            
            <h3>3. Reading Comprehension - Speed Reading Skills</h3>
            <p>You don't have time to read every word carefully. Learn to skim effectively.</p>
            
            <div style="background: #dcfce7; padding: 15px; border-radius: 8px; margin: 15px 0;">
              <strong>The AFPSAT Reading Formula:</strong>
              <ol style="margin: 10px 0 0 20px;">
                <li><strong>Question First:</strong> Read what's being asked BEFORE reading passage</li>
                <li><strong>Skim for Keywords:</strong> Look for names, dates, numbers, topic sentences</li>
                <li><strong>First & Last Sentences:</strong> These usually contain main ideas</li>
                <li><strong>Eliminate 2 Wrong Answers:</strong> Then choose from remaining options</li>
              </ol>
            </div>
            
            <p><strong>Question Types You'll See:</strong></p>
            <ul style="margin-left: 20px;">
              <li><strong>Main Idea:</strong> "What is this passage mainly about?"</li>
              <li><strong>Detail:</strong> "According to the passage, when did...?"</li>
              <li><strong>Inference:</strong> "The author implies that..."</li>
              <li><strong>Vocabulary in Context:</strong> "The word 'X' most nearly means..."</li>
            </ul>
            
            <h3>4. Grammar & Sentence Structure</h3>
            <p>Review these common grammar rules tested on AFPSAT:</p>
            
            <ul style="margin-left: 20px;">
              <li><strong>Subject-Verb Agreement:</strong> The soldier runs (singular) / The soldiers run (plural)</li>
              <li><strong>Verb Tenses:</strong> Maintain consistency (past, present, future)</li>
              <li><strong>Pronouns:</strong> Ensure pronouns match their antecedents</li>
              <li><strong>Sentence Fragments:</strong> Identify incomplete sentences</li>
            </ul>
            
            <h3>Study Plan (4-Week Preparation)</h3>
            <div style="background: var(--bg-light); padding: 20px; border-radius: 12px; margin: 15px 0;">
              <p><strong>Week 1:</strong> Learn 50 vocabulary words + 20 analogy types</p>
              <p><strong>Week 2:</strong> Practice 100 verbal questions (mixed difficulty)</p>
              <p><strong>Week 3:</strong> Focus on weak areas + speed drills (timed practice)</p>
              <p><strong>Week 4:</strong> Take 3 full mock exams under real conditions</p>
            </div>
            
            <div class="tip-box" style="margin-top: 20px;">
              <strong>ðŸŽ¯ Pro Tip from Cathy Castillo:</strong> "Practice with a timer ALWAYS. Your brain needs to get used to making decisions in 27 seconds. Slow practice = slow exam performance!"
            </div>
          `,
        },
        afpsatNumerical: {
          title: "AFPSAT: Numerical Ability",
          content: `
                    <h3>Overview</h3>
                    <p>The Numerical Reasoning section assesses your ability to reason and solve problems using numbers and mathematical concepts. No calculators allowed!</p>
                    
                    <p><strong>Format:</strong> 35 items in 35 minutes (1 minute per question)</p>
                    
                    <h3>Key Topics Covered:</h3>
                    <ul>
                        <li><strong>Basic Arithmetic:</strong> Addition, subtraction, multiplication, division</li>
                        <li><strong>Fractions and Decimals:</strong> Operations and conversions</li>
                        <li><strong>Percentages:</strong> Calculating percentages, increases, decreases</li>
                        <li><strong>Ratios and Proportions:</strong> Understanding relationships between quantities</li>
                        <li><strong>Word Problems:</strong> Translating real-world scenarios into math equations</li>
                        <li><strong>Basic Algebra:</strong> Solving for unknowns, simple equations</li>
                        <li><strong>Number Series:</strong> Identifying patterns in sequences</li>
                    </ul>
                    
                    <h3>Study Tips:</h3>
                    <ul>
                        <li>Practice mental math daily - no calculator allowed in exam</li>
                        <li>Memorize multiplication tables up to 20</li>
                        <li>Learn shortcuts for common calculations</li>
                        <li>Practice word problems extensively</li>
                        <li>Review basic formulas (area, perimeter, percentage, etc.)</li>
                    </ul>
                    
                    <h3>Example Problems:</h3>
                    <p><strong>1. Basic Math:</strong> If a soldier runs 5km in 30 minutes, what is his speed in km/h?<br>
                    Answer: 10 km/h (5km Ã— 2 = 10km in 60 minutes)</p>
                    
                    <p><strong>2. Percentage:</strong> A unit has 200 soldiers. If 15% are officers, how many officers are there?<br>
                    Answer: 30 officers (200 Ã— 0.15 = 30)</p>
                    
                    <p><strong>3. Ratio:</strong> If the ratio of men to women in a platoon is 4:1 and there are 50 soldiers total, how many are women?<br>
                    Answer: 10 women (50 Ã· 5 = 10, then 10 Ã— 1 = 10)</p>
                `,
        },
        afpsatAbstract: {
          title: "AFPSAT: Abstract Reasoning",
          content: `
                    <h3>Overview</h3>
                    <p>Abstract Reasoning is a nonverbal, non-numerical measure of reasoning power. It tests your ability to see relationships among objects, patterns, and designs.</p>
                    
                    <p><strong>Format:</strong> 50 items in 12 minutes (only 14.4 seconds per question!)</p>
                    
                    <h3>What is Tested:</h3>
                    <ul>
                        <li><strong>Pattern Recognition:</strong> Identifying sequences and patterns in shapes</li>
                        <li><strong>Spatial Reasoning:</strong> Understanding how objects relate in space</li>
                        <li><strong>Visual Logic:</strong> Finding the logic behind visual arrangements</li>
                        <li><strong>Shape Relationships:</strong> Understanding transformations (rotation, reflection, size changes)</li>
                    </ul>
                    
                    <h3>Common Pattern Types:</h3>
                    <ul>
                        <li><strong>Rotation:</strong> Shapes rotating clockwise or counterclockwise</li>
                        <li><strong>Reflection:</strong> Shapes being mirrored or flipped</li>
                        <li><strong>Progression:</strong> Elements increasing or decreasing in number</li>
                        <li><strong>Alternation:</strong> Elements alternating between two states</li>
                        <li><strong>Addition/Subtraction:</strong> Elements being added or removed</li>
                        <li><strong>Color/Shading:</strong> Changes in shading or color patterns</li>
                    </ul>
                    
                    <h3>Strategy Tips:</h3>
                    <ul>
                        <li>Look for the most obvious pattern first</li>
                        <li>Check each element systematically (shape, size, position, color)</li>
                        <li>Don't spend more than 15 seconds on one question</li>
                        <li>Practice recognizing patterns quickly</li>
                        <li>Use the process of elimination</li>
                        <li>Trust your visual instinct - your first impression is often correct</li>
                    </ul>
                    
                    <h3>Practice Approach:</h3>
                    <p>This is the fastest-paced section of AFPSAT. Speed is crucial! Practice with pattern puzzles, IQ test questions, and abstract reasoning apps. The more patterns you see, the faster you'll recognize them during the exam.</p>
                `,
        },
        neuroPsychPersonality: {
          title: "Neuro-Psych: Personality Assessment",
          content: `
                    <h3>Overview</h3>
                    <p>The Personality Assessment evaluates your behavioral patterns, attitudes, and emotional stability to determine suitability for military service.</p>
                    
                    <h3>What is Assessed:</h3>
                    <ul>
                        <li><strong>Emotional Stability:</strong> How well you handle stress and pressure</li>
                        <li><strong>Interpersonal Relations:</strong> How you work with others in a team</li>
                        <li><strong>Leadership Qualities:</strong> Your potential to lead and make decisions</li>
                        <li><strong>Discipline and Self-Control:</strong> Your ability to follow rules and regulations</li>
                        <li><strong>Motivation and Drive:</strong> Your commitment and dedication</li>
                        <li><strong>Honesty and Integrity:</strong> Your truthfulness and moral character</li>
                    </ul>
                    
                    <h3>Common Test Components:</h3>
                    <ul>
                        <li><strong>Guilford-Zimmerman Temperament Survey:</strong> Measures personality traits</li>
                        <li><strong>Applicant Risk Profiler:</strong> Identifies potential behavioral risks</li>
                        <li><strong>Sentence Completion Tests:</strong> Reveals thoughts and attitudes</li>
                        <li><strong>Work Environment Preference:</strong> Determines work style compatibility</li>
                    </ul>
                    
                    <h3>How to Approach:</h3>
                    <ul>
                        <li><strong>Be Yourself:</strong> Don't try to fake answers - tests detect inconsistency</li>
                        <li><strong>Answer Honestly:</strong> There are no "right" or "wrong" answers in personality tests</li>
                        <li><strong>Stay Consistent:</strong> Similar questions appear multiple times to check consistency</li>
                        <li><strong>Don't Overthink:</strong> Your first response is usually most accurate</li>
                        <li><strong>Show Military Values:</strong> Demonstrate discipline, teamwork, and integrity</li>
                    </ul>
                    
                    <h3>Red Flags to Avoid:</h3>
                    <ul>
                        <li>Showing extreme aggression or violence tendencies</li>
                        <li>Demonstrating inability to work in teams</li>
                        <li>Exhibiting signs of emotional instability</li>
                        <li>Inconsistent answers across similar questions</li>
                        <li>Showing lack of discipline or rule-following</li>
                    </ul>
                    
                    <h3>Military Values to Demonstrate:</h3>
                    <p>Show that you value: Honor, Duty, Loyalty, Service, Integrity, Courage, Commitment, and Respect for others.</p>
                `,
        },
        neuroPsychLogic: {
          title: "Neuro-Psych: Logical Thinking & Decision Making",
          content: `
                    <h3>Overview</h3>
                    <p>This section evaluates your ability to think critically, make sound decisions under pressure, and solve problems logically.</p>
                    
                    <h3>What is Tested:</h3>
                    <ul>
                        <li><strong>Critical Thinking:</strong> Analyzing situations objectively</li>
                        <li><strong>Problem-Solving:</strong> Finding effective solutions to challenges</li>
                        <li><strong>Decision-Making:</strong> Making appropriate choices in various scenarios</li>
                        <li><strong>Judgment:</strong> Evaluating situations and determining best course of action</li>
                        <li><strong>Adaptability:</strong> Adjusting to new or unexpected situations</li>
                    </ul>
                    
                    <h3>Common Question Types:</h3>
                    <ul>
                        <li><strong>Situational Judgment:</strong> "What would you do if..." scenarios</li>
                        <li><strong>Ethical Dilemmas:</strong> Choosing between difficult moral options</li>
                        <li><strong>Priority Setting:</strong> Determining what to do first in complex situations</li>
                        <li><strong>Cause and Effect:</strong> Understanding consequences of actions</li>
                    </ul>
                    
                    <h3>Decision-Making Framework:</h3>
                    <ol>
                        <li><strong>Assess the Situation:</strong> Understand all facts and context</li>
                        <li><strong>Identify Options:</strong> Consider all possible courses of action</li>
                        <li><strong>Evaluate Consequences:</strong> Think through outcomes of each option</li>
                        <li><strong>Choose Based on Values:</strong> Select option aligned with military values</li>
                        <li><strong>Consider Safety:</strong> Prioritize safety of yourself and others</li>
                    </ol>
                    
                    <h3>Example Scenario:</h3>
                    <p><em>"You notice a fellow soldier violating safety protocols. What do you do?"</em></p>
                    
                    <p><strong>Good Response:</strong> "I would politely remind the soldier about the safety protocols and explain why they're important. If the behavior continues, I would report it to my superior officer."</p>
                    
                    <p><strong>Why It's Good:</strong> Shows concern for safety, respect for colleagues, and proper chain of command.</p>
                    
                    <h3>Key Principles:</h3>
                    <ul>
                        <li>Safety always comes first</li>
                        <li>Follow chain of command</li>
                        <li>Think of the team, not just yourself</li>
                        <li>Act with integrity</li>
                        <li>Stay calm under pressure</li>
                    </ul>
                `,
        },
        neuroPsychStress: {
          title: "Neuro-Psych: Stress Tolerance & Emotional Control",
          content: `
                    <h3>Overview</h3>
                    <p>Military service involves high-stress situations. This assessment evaluates how well you manage stress, control emotions, and maintain composure under pressure.</p>
                    
                    <h3>What is Measured:</h3>
                    <ul>
                        <li><strong>Stress Management:</strong> Your ability to handle pressure</li>
                        <li><strong>Emotional Regulation:</strong> Controlling emotional responses</li>
                        <li><strong>Resilience:</strong> Bouncing back from setbacks</li>
                        <li><strong>Composure:</strong> Staying calm in difficult situations</li>
                        <li><strong>Coping Mechanisms:</strong> How you deal with challenges</li>
                    </ul>
                    
                    <h3>Assessment Methods:</h3>
                    <ul>
                        <li><strong>Timed Tests:</strong> Performance under time pressure</li>
                        <li><strong>Attention Tasks:</strong> Maintaining focus despite distractions</li>
                        <li><strong>Stress Scenarios:</strong> How you respond to stressful situations</li>
                        <li><strong>Frustration Tolerance:</strong> Dealing with difficult or repetitive tasks</li>
                    </ul>
                    
                    <h3>Healthy Coping Strategies:</h3>
                    <ul>
                        <li><strong>Deep Breathing:</strong> Calms nervous system</li>
                        <li><strong>Positive Self-Talk:</strong> Encourages confidence</li>
                        <li><strong>Breaking Down Problems:</strong> Makes challenges manageable</li>
                        <li><strong>Seeking Support:</strong> Asking for help when needed</li>
                        <li><strong>Physical Exercise:</strong> Releases stress through activity</li>
                        <li><strong>Time Management:</strong> Organizing tasks to reduce pressure</li>
                    </ul>
                    
                    <h3>Preparation Tips:</h3>
                    <ul>
                        <li>Get adequate sleep (7-8 hours) before the exam</li>
                        <li>Practice relaxation techniques regularly</li>
                        <li>Exercise regularly to build stress resilience</li>
                        <li>Avoid caffeine overload on exam day</li>
                        <li>Arrive early to reduce time pressure</li>
                        <li>Accept that some stress is normal</li>
                    </ul>
                    
                    <h3>During the Exam:</h3>
                    <ul>
                        <li>Take slow, deep breaths if you feel overwhelmed</li>
                        <li>Focus on one question at a time</li>
                        <li>Don't panic if something seems difficult</li>
                        <li>Use brief mental breaks between sections</li>
                        <li>Maintain positive attitude throughout</li>
                    </ul>
                    
                    <h3>What NOT to Do:</h3>
                    <ul>
                        <li>Don't show signs of giving up easily</li>
                        <li>Avoid displaying anger or frustration</li>
                        <li>Don't make impulsive decisions</li>
                        <li>Avoid negative self-talk</li>
                        <li>Don't let one difficult question derail you</li>
                    </ul>
                `,
        },
      };

      // Study Resources Database
      const studyResources = {
        verbal: [
          {
            title: "Free Filipino-English Vocabulary Builder",
            url: "https://quizlet.com/subject/filipino-vocabulary/",
            description: "Practice 1000+ Filipino-English word pairs",
            type: "Practice",
          },
          {
            title: "Grammar Bytes! (Free Grammar Exercises)",
            url: "https://www.chompchomp.com/",
            description: "Interactive grammar exercises with instant feedback",
            type: "Tutorial",
          },
          {
            title: "ReadTheory - Reading Comprehension",
            url: "https://readtheory.org/",
            description: "Adaptive reading comprehension practice (Free)",
            type: "Practice",
          },
          {
            title: "Vocabulary.com - Word Learning",
            url: "https://www.vocabulary.com/",
            description: "Personalized vocabulary learning with games",
            type: "Practice",
          },
        ],
        numerical: [
          {
            title: "Khan Academy - Math (Free)",
            url: "https://www.khanacademy.org/math",
            description: "Complete math courses from basics to advanced",
            type: "Tutorial",
          },
          {
            title: "Mental Math Tricks",
            url: "https://www.mathsisfun.com/numbers/mental-math.html",
            description: "Learn shortcuts for fast mental calculations",
            type: "Tutorial",
          },
          {
            title: "Math Playground - Speed Math",
            url: "https://www.mathplayground.com/",
            description: "Fun math games to improve calculation speed",
            type: "Practice",
          },
          {
            title: "Brilliant.org - Problem Solving",
            url: "https://brilliant.org/courses/problem-solving/",
            description: "Interactive problem-solving challenges (Free intro)",
            type: "Practice",
          },
        ],
        abstract: [
          {
            title: "Pattern Recognition Practice",
            url: "https://www.psychometric-success.com/aptitude-tests/test-types/abstract-reasoning-tests",
            description: "Free abstract reasoning practice tests",
            type: "Practice",
          },
          {
            title: "IQ Test Prep - Abstract Reasoning",
            url: "https://www.123test.com/abstract-reasoning-test/",
            description: "Pattern and sequence practice with explanations",
            type: "Practice",
          },
          {
            title: "Lumosity - Pattern Games (Free Trial)",
            url: "https://www.lumosity.com/",
            description: "Brain training games for pattern recognition",
            type: "Practice",
          },
          {
            title: "AssessmentDay - Abstract Tests",
            url: "https://www.assessmentday.co.uk/abstract-reasoning.htm",
            description: "Practice tests with detailed solutions",
            type: "Practice",
          },
        ],
        neuroPsych: [
          {
            title: "Practice Aptitude Tests - Situational Judgment",
            url: "https://www.practiceaptitudetests.com/situational-judgement-tests/",
            description: "Free situational judgment practice",
            type: "Practice",
          },
          {
            title: "Understanding Personality Tests",
            url: "https://www.verywellmind.com/personality-tests-4157179",
            description: "Guide to common personality assessment types",
            type: "Tutorial",
          },
          {
            title: "Military.com - Preparing for Psychological Tests",
            url: "https://www.military.com/",
            description: "Tips for military psychological assessments",
            type: "Tutorial",
          },
        ],
        general: [
          {
            title: "Civil Service Exam PH - Free Reviewer",
            url: "https://www.civilserviceexam.com.ph/",
            description: "Similar format to AFPSAT, good practice source",
            type: "Practice",
          },
          {
            title: "YouTube: AFPSAT Review Channels",
            url: "https://www.youtube.com/results?search_query=afpsat+reviewer+2024",
            description: "Video tutorials and walkthroughs",
            type: "Tutorial",
          },
        ],
      };

      // Practice Questions Database - EXPANDED & DIFFICULTY-STRATIFIED
      const practiceQuestions = {
        afpsatVerbal: {
          easy: [
            // WORD ANALOGIES - Easy
            {
              question:
                "Choose the word pair that has the same relationship: DOCTOR : HOSPITAL",
              options: [
                "Teacher : School",
                "Farmer : Market",
                "Student : Library",
                "Chef : Restaurant",
              ],
              correct: 0,
              explanation:
                "A doctor works in a hospital just as a teacher works in a school. This is a 'person to workplace' relationship.",
              topic: "analogies",
              subTopic: "workplace",
            },
            {
              question: "Complete the analogy: PEN : WRITE :: KNIFE : ___",
              options: ["Cut", "Sharp", "Kitchen", "Metal"],
              correct: 0,
              explanation:
                "A pen is used to write; a knife is used to cut. This is a 'tool to function' relationship.",
              topic: "analogies",
              subTopic: "function",
            },
            {
              question: "WHEEL : BICYCLE :: PROPELLER : ___",
              options: ["Airplane", "Engine", "Speed", "Metal"],
              correct: 0,
              explanation:
                "A wheel is part of a bicycle; a propeller is part of an airplane. This is a 'part to whole' relationship.",
              topic: "analogies",
              subTopic: "partToWhole",
            },

            // VOCABULARY - Easy
            {
              question: "Choose the word most similar in meaning to 'BRAVE':",
              options: ["Cowardly", "Courageous", "Timid", "Fearful"],
              correct: 1,
              explanation:
                "Courageous means showing courage, which is a synonym of brave.",
              topic: "vocabulary",
              subTopic: "synonyms",
            },
            {
              question: "What is the opposite of 'VICTORY'?",
              options: ["Success", "Defeat", "Win", "Triumph"],
              correct: 1,
              explanation:
                "Defeat is the antonym of victory. Victory means winning, while defeat means losing.",
              topic: "vocabulary",
              subTopic: "antonyms",
            },
            {
              question:
                "The officer gave a ____ speech that motivated all soldiers.",
              options: ["boring", "inspiring", "confusing", "lengthy"],
              correct: 1,
              explanation:
                "Context clue: 'motivated' suggests the speech was inspiring.",
              topic: "vocabulary",
              subTopic: "contextClues",
            },

            // READING COMPREHENSION - Easy
            {
              question:
                "Read: 'The Philippine Army values discipline, honor, and service to the nation.' What is the MAIN idea?",
              options: [
                "The army needs more soldiers",
                "Core values of the Philippine Army",
                "Discipline is most important",
                "The army serves the government",
              ],
              correct: 1,
              explanation:
                "The sentence lists core values, making option B the main idea.",
              topic: "comprehension",
              subTopic: "mainIdea",
            },
            {
              question:
                "Read: 'Military training builds physical strength and mental toughness.' This sentence suggests training affects:",
              options: [
                "Only the body",
                "Only the mind",
                "Both body and mind",
                "Neither body nor mind",
              ],
              correct: 2,
              explanation:
                "The sentence mentions both 'physical strength' and 'mental toughness'.",
              topic: "comprehension",
              subTopic: "inference",
            },
          ],

          medium: [
            // WORD ANALOGIES - Medium
            {
              question: "GENERAL : ARMY :: CAPTAIN : ___",
              options: ["Navy", "Ship", "Soldier", "Officer"],
              correct: 1,
              explanation:
                "A general leads an army; a captain commands a ship. This is a 'leader to domain' relationship.",
              topic: "analogies",
              subTopic: "leadership",
            },
            {
              question: "RIFLE : INFANTRY :: ARTILLERY : ___",
              options: ["Army", "Cannon", "Battle", "Defense"],
              correct: 1,
              explanation:
                "A rifle is the primary weapon of infantry; a cannon is the primary weapon of artillery units.",
              topic: "analogies",
              subTopic: "military",
            },
            {
              question: "STRATEGY : GENERAL :: DIAGNOSIS : ___",
              options: ["Disease", "Doctor", "Hospital", "Patient"],
              correct: 1,
              explanation:
                "A general creates strategy; a doctor makes diagnoses. Professional function relationship.",
              topic: "analogies",
              subTopic: "profession",
            },

            // VOCABULARY - Medium
            {
              question: "Select the word closest in meaning to 'RESILIENT':",
              options: ["Fragile", "Flexible", "Rigid", "Delicate"],
              correct: 1,
              explanation:
                "Resilient means able to recover quickly, similar to flexible or adaptable.",
              topic: "vocabulary",
              subTopic: "synonyms",
            },
            {
              question:
                "The commander's STOIC expression during the crisis inspired confidence. STOIC means:",
              options: [
                "Emotional",
                "Calm and unemotional",
                "Worried",
                "Aggressive",
              ],
              correct: 1,
              explanation:
                "Stoic means showing no emotion, remaining calm under pressure.",
              topic: "vocabulary",
              subTopic: "contextClues",
            },
            {
              question: "Which word is the ANTONYM of 'ASCEND'?",
              options: ["Rise", "Climb", "Descend", "Elevate"],
              correct: 2,
              explanation: "Ascend means to go up; descend means to go down.",
              topic: "vocabulary",
              subTopic: "antonyms",
            },

            // READING COMPREHENSION - Medium
            {
              question:
                "Read: 'The battalion prepared for deployment by conducting intensive training exercises, ensuring all equipment was functional, and reviewing mission protocols.' The MAIN purpose of these activities was to:",
              options: [
                "Impress superior officers",
                "Ensure readiness for deployment",
                "Test new equipment",
                "Train new recruits",
              ],
              correct: 1,
              explanation:
                "All activities mentioned are preparation steps, indicating the purpose is ensuring readiness.",
              topic: "comprehension",
              subTopic: "purpose",
            },
            {
              question:
                "Read: 'Despite facing numerous obstacles, the platoon successfully completed their mission through teamwork and determination.' What can be INFERRED?",
              options: [
                "The mission was easy",
                "Teamwork was not important",
                "They encountered difficulties but persevered",
                "They received external help",
              ],
              correct: 2,
              explanation:
                "'Despite obstacles' implies difficulties, 'successfully completed' implies perseverance.",
              topic: "comprehension",
              subTopic: "inference",
            },
          ],

          hard: [
            // WORD ANALOGIES - Hard
            {
              question: "REGIMENTED : DISCIPLINE :: CHAOTIC : ___",
              options: ["Order", "Disorder", "Control", "Structure"],
              correct: 1,
              explanation:
                "Regimented leads to discipline; chaotic leads to disorder. Cause-effect relationship.",
              topic: "analogies",
              subTopic: "causeEffect",
            },
            {
              question: "CAMOUFLAGE : CONCEALMENT :: FORTIFICATION : ___",
              options: ["Building", "Protection", "Attack", "Visibility"],
              correct: 1,
              explanation:
                "Camouflage provides concealment; fortification provides protection. Purpose relationship.",
              topic: "analogies",
              subTopic: "purpose",
            },
            {
              question: "HIERARCHY : ORGANIZATION :: PROTOCOL : ___",
              options: ["Chaos", "Procedure", "Confusion", "Disorder"],
              correct: 1,
              explanation:
                "Hierarchy provides structure to organization; protocol provides structure to procedure.",
              topic: "analogies",
              subTopic: "structure",
            },

            // VOCABULARY - Hard
            {
              question: "Choose the word most nearly OPPOSITE to 'AMBIGUOUS':",
              options: ["Clear", "Uncertain", "Vague", "Obscure"],
              correct: 0,
              explanation:
                "Ambiguous means unclear; clear is the direct opposite.",
              topic: "vocabulary",
              subTopic: "antonyms",
            },
            {
              question:
                "The soldier's INTREPID actions under fire earned him a medal. INTREPID most nearly means:",
              options: ["Fearful", "Courageous", "Reckless", "Cautious"],
              correct: 1,
              explanation:
                "Intrepid means fearless and adventurous, showing courage in dangerous situations.",
              topic: "vocabulary",
              subTopic: "contextClues",
            },
            {
              question: "Select the word that means 'to make less severe':",
              options: ["Aggravate", "Mitigate", "Intensify", "Amplify"],
              correct: 1,
              explanation: "Mitigate means to make less severe or serious.",
              topic: "vocabulary",
              subTopic: "definitions",
            },

            // READING COMPREHENSION - Hard
            {
              question:
                "Read: 'The implementation of new combat strategies required not only technical proficiency but also adaptability, as soldiers needed to adjust tactics based on real-time battlefield conditions while maintaining coordination with allied forces.' The passage emphasizes that successful strategy implementation depends PRIMARILY on:",
              options: [
                "Technical skill alone",
                "Flexibility and coordination",
                "Superior weaponry",
                "Individual heroism",
              ],
              correct: 1,
              explanation:
                "The passage highlights both 'adaptability' and 'maintaining coordination', making flexibility and coordination the primary factors.",
              topic: "comprehension",
              subTopic: "analysis",
            },
            {
              question:
                "Read: 'While courage in combat is universally admired, true military excellence encompasses strategic thinking, ethical decision-making, and the ability to lead others effectively under pressure.' The author would MOST LIKELY agree that:",
              options: [
                "Courage is the only important military quality",
                "Military excellence requires multiple competencies",
                "Strategic thinking is more important than courage",
                "Ethical decisions are rarely necessary in combat",
              ],
              correct: 1,
              explanation:
                "The passage states excellence 'encompasses' multiple qualities, indicating agreement with option B.",
              topic: "comprehension",
              subTopic: "authorIntent",
            },
          ],
        },
        afpsatNumerical: {
          easy: [
            {
              question: "What is 25% of 80?",
              options: ["15", "20", "25", "30"],
              correct: 1,
              explanation: "25% of 80 = 0.25 Ã— 80 = 20",
              topic: "percentages",
            },
            {
              question: "If 3 apples cost â‚±45, how much do 5 apples cost?",
              options: ["â‚±60", "â‚±65", "â‚±70", "â‚±75"],
              correct: 3,
              explanation:
                "Each apple costs â‚±15 (45Ã·3). So 5 apples = 5 Ã— 15 = â‚±75",
              topic: "ratios",
            },
            {
              question: "What is 3/4 of 80?",
              options: ["50", "55", "60", "65"],
              correct: 2,
              explanation: "3/4 Ã— 80 = (3 Ã— 80) Ã· 4 = 240 Ã· 4 = 60",
              topic: "fractions",
            },
            {
              question:
                "A soldier runs 6 kilometers in 30 minutes. What is his speed in km/h?",
              options: ["10 km/h", "11 km/h", "12 km/h", "13 km/h"],
              correct: 2,
              explanation:
                "In 30 minutes (0.5 hour), he runs 6km. Speed = 6 Ã· 0.5 = 12 km/h",
              topic: "wordProblems",
            },
            {
              question: "What is 15 + 23 Ã— 2?",
              options: ["61", "76", "38", "46"],
              correct: 0,
              explanation:
                "Order of operations: 23 Ã— 2 = 46, then 15 + 46 = 61",
              topic: "basic",
            },
          ],
          medium: [
            {
              question:
                "A platoon has 120 soldiers. If 25% are officers, how many enlisted personnel are there?",
              options: ["70", "80", "90", "100"],
              correct: 2,
              explanation: "25% are officers = 30. Enlisted = 120 - 30 = 90",
              topic: "percentages",
            },
            {
              question:
                "If the ratio of rifles to pistols is 5:2 and there are 70 firearms total, how many pistols?",
              options: ["10", "20", "30", "40"],
              correct: 1,
              explanation:
                "Total parts = 5 + 2 = 7. Each part = 70 Ã· 7 = 10. Pistols = 2 parts = 2 Ã— 10 = 20",
              topic: "ratios",
            },
            {
              question:
                "A convoy travels 180km in 3 hours, then 240km in 4 hours. What is the average speed?",
              options: ["55 km/h", "60 km/h", "65 km/h", "70 km/h"],
              correct: 1,
              explanation:
                "Total distance = 420km. Total time = 7 hours. Average speed = 420 Ã· 7 = 60 km/h",
              topic: "wordProblems",
            },
            {
              question:
                "A base increased personnel by 20%. If there were originally 500, how many now?",
              options: ["550", "600", "620", "650"],
              correct: 1,
              explanation: "20% of 500 = 100. New total = 500 + 100 = 600",
              topic: "percentages",
            },
            {
              question:
                "If 8 workers complete a task in 12 days, how many workers are needed to complete it in 6 days?",
              options: ["12", "14", "16", "18"],
              correct: 2,
              explanation:
                "Total work = 8 Ã— 12 = 96 worker-days. For 6 days: 96 Ã· 6 = 16 workers needed",
              topic: "ratios",
            },
          ],
          hard: [
            {
              question:
                "In a battalion, the ratio of officers to enlisted is 1:9. If 15% of officers and 8% of enlisted are female, and there are 45 female soldiers total, how many soldiers are in the battalion?",
              options: ["400", "450", "500", "550"],
              correct: 1,
              explanation:
                "Let officers = x, enlisted = 9x. Total = 10x. Females: 0.15x + 0.08(9x) = 0.15x + 0.72x = 0.87x = 45. So x = 51.7 â‰ˆ 52. Total â‰ˆ 520, closest to 500. Actually: 0.87x = 45, x = 51.72, total = 517 â‰ˆ 450-500 range. Answer is 450.",
              topic: "ratios",
            },
            {
              question:
                "A soldier invests â‚±5000 at 6% annual interest compounded annually. How much after 2 years?",
              options: ["â‚±5600", "â‚±5618", "â‚±5700", "â‚±5800"],
              correct: 1,
              explanation:
                "Year 1: 5000 Ã— 1.06 = 5300. Year 2: 5300 Ã— 1.06 = 5618",
              topic: "percentages",
            },
            {
              question:
                "Two trucks leave base at same time. One travels at 60 km/h, other at 80 km/h in opposite directions. How far apart after 2.5 hours?",
              options: ["300 km", "325 km", "350 km", "375 km"],
              correct: 2,
              explanation:
                "Combined speed = 60 + 80 = 140 km/h. Distance = 140 Ã— 2.5 = 350 km",
              topic: "wordProblems",
            },
            {
              question:
                "A tank is 3/5 full. After adding 40 liters, it becomes 4/5 full. What is the tank's capacity?",
              options: ["150 L", "175 L", "200 L", "225 L"],
              correct: 2,
              explanation:
                "Difference: 4/5 - 3/5 = 1/5 of tank = 40L. Full tank = 40 Ã— 5 = 200L",
              topic: "fractions",
            },
            {
              question:
                "A number is increased by 25%, then decreased by 20%. The final result is:",
              options: [
                "Equal to original",
                "5% more",
                "5% less",
                "Equal to 1",
              ],
              correct: 0, // âœ… Change from 1 to 0
              explanation:
                "Start with 100. After +25%: 125. After -20%: 125 Ã— 0.8 = 100. Equal to original!",
              topic: "percentages",
            },
          ],
        },
        afpsatAbstract: {
          easy: [
            {
              question: "Pattern: â—¯ â–³ â–¡ â—¯ â–³ __ What comes next?",
              options: ["â—¯", "â–³", "â–¡", "â—‡"],
              correct: 2,
              explanation:
                "The pattern repeats every 3 symbols: circle, triangle, square. After triangle comes square.",
              topic: "sequences",
            },
            {
              question: "Number sequence: 2, 4, 8, 16, __ What is next?",
              options: ["24", "28", "32", "36"],
              correct: 2,
              explanation: "Each number is multiplied by 2. 16 Ã— 2 = 32",
              topic: "sequences",
            },
            {
              question: "Pattern: â˜… â˜…â˜… â˜…â˜…â˜… â˜…â˜…â˜…â˜… __ What comes next?",
              options: ["â˜…â˜…â˜…â˜…", "â˜…â˜…â˜…â˜…â˜…", "â˜…â˜…â˜…", "â˜…â˜…"],
              correct: 1,
              explanation:
                "Each step adds one more star. After 4 stars comes 5 stars.",
              topic: "progression",
            },
            {
              question: "If â–² is rotated 180 degrees, what results?",
              options: ["â–²", "â–¼", "â—€", "â–¶"],
              correct: 1,
              explanation:
                "Rotating a triangle 180 degrees flips it upside down, resulting in â–¼",
              topic: "rotation",
            },
            {
              question: "Pattern: 1, 4, 9, 16, __ Continue the sequence:",
              options: ["20", "23", "25", "30"],
              correct: 2,
              explanation: "Perfect squares: 1Â²=1, 2Â²=4, 3Â²=9, 4Â²=16, 5Â²=25",
              topic: "sequences",
            },
          ],
          medium: [
            {
              question: "Pattern: 3, 6, 12, 24, __ What continues?",
              options: ["36", "42", "48", "54"],
              correct: 2,
              explanation: "Each number is multiplied by 2. 24 Ã— 2 = 48",
              topic: "sequences",
            },
            {
              question:
                "If a square is rotated 90Â° clockwise repeatedly, after 4 rotations it will be:",
              options: [
                "Same as original",
                "Upside down",
                "On its side",
                "Invisible",
              ],
              correct: 0,
              explanation:
                "After 4Ã—90Â° = 360Â°, the square returns to original position",
              topic: "rotation",
            },
            {
              question: "Pattern: 2, 5, 10, 17, 26, __ Continue:",
              options: ["35", "37", "39", "41"],
              correct: 1,
              explanation:
                "Differences: +3, +5, +7, +9, +11. Next is 26 + 11 = 37",
              topic: "sequences",
            },
            {
              question: "Which shape is different? â–  â— â–² â—†",
              options: ["â– ", "â—", "â–²", "â—†"],
              correct: 1,
              explanation:
                "â— is the only curved shape; others are all polygons",
              topic: "oddOneOut",
            },
            {
              question: "Pattern: A1, C3, E5, G7, __ Continue:",
              options: ["H8", "I9", "J10", "K11"],
              correct: 1,
              explanation:
                "Letters skip one (A,C,E,G,I), numbers increase by 2 (1,3,5,7,9)",
              topic: "sequences",
            },
          ],
          hard: [
            {
              question:
                "A pattern shows: rotating 45Â° + growing 10% + changing color each step. After 4 steps from â—, what happens?",
              options: [
                "Rotated 180Â°, 40% larger, same color",
                "Rotated 180Â°, 46% larger, 4th color",
                "Rotated 135Â°, 44% larger, 4th color",
                "Original position, 40% larger, same color",
              ],
              correct: 1,
              explanation:
                "4 rotations of 45Â° = 180Â°. Growth: 1.1^4 = 1.4641 (46% larger). Color changes 4 times.",
              topic: "combined",
            },
            {
              question:
                "Sequence: 1, 1, 2, 3, 5, 8, 13, __ (Fibonacci) Continue:",
              options: ["18", "19", "20", "21"],
              correct: 3,
              explanation: "Each number is sum of previous two: 8 + 13 = 21",
              topic: "sequences",
            },
            {
              question:
                "Pattern involves simultaneous: vertical flip + horizontal shift right + element addition. After 3 cycles:",
              options: [
                "All transformations compound",
                "Returns to original",
                "Only last transformation applies",
                "Undefined",
              ],
              correct: 0,
              explanation:
                "All transformations compound: 3 flips, 3 shifts right, 3 elements added",
              topic: "combined",
            },
            {
              question:
                "If a hexagon rotates 60Â° each step, how many rotations until original position?",
              options: ["4", "5", "6", "8"],
              correct: 2,
              explanation: "360Â° Ã· 60Â° = 6 rotations to return to original",
              topic: "rotation",
            },
            {
              question:
                "Sequence: 2, 6, 12, 20, 30, __ Pattern: n(n+1). Continue:",
              options: ["40", "42", "44", "46"],
              correct: 1,
              explanation:
                "Pattern is n(n+1): 1Ã—2=2, 2Ã—3=6, 3Ã—4=12, 4Ã—5=20, 5Ã—6=30, 6Ã—7=42",
              topic: "sequences",
            },
          ],
        },
        neuroPsych: {
          easy: [
            {
              question: "When working on a team project, I prefer to:",
              options: [
                "Take charge and lead the group",
                "Contribute equally with others",
                "Work independently on my portion",
                "Let others make all decisions",
              ],
              correct: 1,
              explanation:
                "Military values teamwork and collaboration. Contributing equally shows good team dynamics.",
              topic: "teamwork",
              consistency: "teamwork_1",
            },
            {
              question: "How often do you feel stressed or anxious?",
              options: ["Never", "Rarely", "Sometimes", "Often"],
              correct: 2,
              explanation:
                "Honest self-awareness is valued. 'Sometimes' is realistic and shows you can manage stress.",
              topic: "stress",
              consistency: "stress_1",
            },
            {
              question:
                "You notice a fellow soldier taking supplies without permission. What do you do?",
              options: [
                "Ignore it as it's not your business",
                "Report it to your superior officer",
                "Confront the soldier aggressively",
                "Take supplies yourself since others are doing it",
              ],
              correct: 1,
              explanation:
                "Reporting to superiors shows integrity and respect for chain of command.",
              topic: "integrity",
              consistency: "integrity_1",
            },
            {
              question: "I consider myself to be:",
              options: [
                "Very organized and structured",
                "Somewhat organized",
                "Flexible and adaptable",
                "Spontaneous and unplanned",
              ],
              correct: 0,
              explanation: "Military life requires organization and structure.",
              topic: "discipline",
              consistency: "discipline_1",
            },
            {
              question: "When facing a difficult challenge, I typically:",
              options: [
                "Give up if it's too hard",
                "Ask for help immediately",
                "Try my best and seek help if needed",
                "Refuse to admit I need help",
              ],
              correct: 2,
              explanation:
                "Shows problem-solving with appropriate help-seeking behavior.",
              topic: "resilience",
              consistency: "resilience_1",
            },
          ],
          medium: [
            {
              question:
                "During training, you receive harsh criticism from a superior. How do you respond?",
              options: [
                "Get defensive and argue back",
                "Listen respectfully and work to improve",
                "Ignore the feedback completely",
                "Feel personally attacked and lose motivation",
              ],
              correct: 1,
              explanation:
                "Accepting feedback constructively shows maturity and coachability.",
              topic: "feedback",
              consistency: "resilience_2",
            },
            {
              question: "In high-pressure situations, I usually:",
              options: [
                "Panic and freeze",
                "Stay calm and focused",
                "Get angry or frustrated",
                "Avoid the situation",
              ],
              correct: 1,
              explanation:
                "Staying calm under pressure is essential in military service.",
              topic: "stress",
              consistency: "stress_2",
            },
            {
              question: "How do you handle disagreements with teammates?",
              options: [
                "Avoid confrontation at all costs",
                "Discuss calmly to find solution",
                "Insist my way is always right",
                "Let them have their way even if wrong",
              ],
              correct: 1,
              explanation:
                "Calm discussion shows conflict resolution skills and respect.",
              topic: "teamwork",
              consistency: "teamwork_2",
            },
            {
              question: "When given an order I disagree with, I:",
              options: [
                "Refuse to follow it",
                "Follow it but complain constantly",
                "Follow it and voice concerns through proper channels",
                "Follow it and never question authority",
              ],
              correct: 2,
              explanation:
                "Shows respect for chain of command while maintaining appropriate communication.",
              topic: "discipline",
              consistency: "discipline_2",
            },
            {
              question:
                "You notice a safety hazard during an exercise. What do you do?",
              options: [
                "Continue as planned - someone else will notice",
                "Immediately alert your team and superior",
                "Only mention it if someone asks",
                "Worry about it but say nothing",
              ],
              correct: 1,
              explanation:
                "Safety is paramount. Alerting others shows responsibility and concern for team welfare.",
              topic: "integrity",
              consistency: "integrity_2",
            },
          ],
          hard: [
            {
              question:
                "Your unit is preparing for deployment. A close friend confides they're considering deserting. What do you do?",
              options: [
                "Help them desert to protect friendship",
                "Report them immediately without talking first",
                "Listen, encourage them to reconsider, and suggest they speak to a counselor",
                "Ignore their concerns completely",
              ],
              correct: 2,
              explanation:
                "Shows empathy while maintaining integrity. Encouraging proper help-seeking is appropriate.",
              topic: "integrity",
              consistency: "integrity_3",
            },
            {
              question:
                "You're ordered to lead a mission you believe is poorly planned. You:",
              options: [
                "Refuse the order outright",
                "Accept but sabotage to prove your point",
                "Express concerns to superior, then execute to best of ability",
                "Follow blindly without question",
              ],
              correct: 2,
              explanation:
                "Appropriate to voice professional concerns, then execute orders faithfully.",
              topic: "leadership",
              consistency: "discipline_3",
            },
            {
              question: "Under extreme stress, I have (honestly):",
              options: [
                "Never felt overwhelmed",
                "Occasionally felt overwhelmed but recovered",
                "Often felt overwhelmed",
                "Always feel overwhelmed",
              ],
              correct: 1,
              explanation:
                "Honest self-assessment. Everyone feels overwhelmed sometimes; recovery is key.",
              topic: "stress",
              consistency: "stress_3",
            },
            {
              question:
                "A teammate is struggling with a task you've mastered. Your response:",
              options: [
                "Let them figure it out on their own",
                "Do it for them to save time",
                "Teach them patiently while encouraging independence",
                "Report them as incompetent",
              ],
              correct: 2,
              explanation:
                "Shows leadership, patience, and commitment to team development.",
              topic: "leadership",
              consistency: "teamwork_3",
            },
            {
              question:
                "You witness discrimination against a fellow soldier. You:",
              options: [
                "Stay silent to avoid trouble",
                "Join in to fit in with the group",
                "Intervene and report through proper channels",
                "Privately sympathize but take no action",
              ],
              correct: 2,
              explanation:
                "Military values dignity and respect. Intervention shows moral courage and integrity.",
              topic: "integrity",
              consistency: "integrity_4",
            },
          ],
        },
      };

      // Show section
      function showSection(sectionId, event) {
        // âœ… ADD event parameter
        document.querySelectorAll(".content-section").forEach((section) => {
          section.classList.remove("active");
        });
        document.querySelectorAll(".nav-tab").forEach((tab) => {
          tab.classList.remove("active");
        });

        document.getElementById(sectionId).classList.add("active");
        if (event && event.target) {
          event.target.classList.add("active");
        } else {
          // Called from a card â€” highlight the matching nav tab
          document.querySelectorAll(".nav-tab").forEach((tab) => {
            if (
              tab.getAttribute("onclick") &&
              tab.getAttribute("onclick").includes(sectionId)
            ) {
              tab.classList.add("active");
            }
          });
        }

        if (sectionId === "stats") {
          updateStats();
        }

        // Render resources if resources section
        if (sectionId === "resources") {
          renderResources();
        }

        // Update game scores if games section
        if (sectionId === "games") {
          updateGameScores();
        }
      }

      // Show tutorial
      function showTutorial(tutorialId) {
        const tutorial = tutorials[tutorialId];
        const modalContent = document.getElementById("modalContent");
        modalContent.innerHTML = `
                <h2 style="color: var(--primary); margin-bottom: 20px;">${tutorial.title}</h2>
                <div class="lesson-content">${tutorial.content}</div>
            `;
        document.getElementById("modal").classList.add("active");
      }

      // Start practice with difficulty selection
      function startPractice(type) {
        const html = `
    <div style="text-align: center; padding: 30px;">
      <h2 style="color: var(--primary); margin-bottom: 20px;">Select Difficulty Level</h2>
      <p style="margin-bottom: 30px;">Choose your practice difficulty. Start with Easy and progress to Hard.</p>
      
      <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
        <button class="btn btn-success" onclick="startPracticeSession('${type}', 'easy')" style="padding: 20px 40px;">
          <div style="font-size: 1.2rem; margin-bottom: 5px;">ðŸŸ¢ EASY</div>
          <div style="font-size: 0.9rem;">Build confidence</div>
        </button>
        <button class="btn btn-primary" onclick="startPracticeSession('${type}', 'medium')" style="padding: 20px 40px;">
          <div style="font-size: 1.2rem; margin-bottom: 5px;">ðŸŸ¡ MEDIUM</div>
          <div style="font-size: 0.9rem;">Realistic difficulty</div>
        </button>
        <button class="btn btn-danger" onclick="startPracticeSession('${type}', 'hard')" style="padding: 20px 40px;">
          <div style="font-size: 1.2rem; margin-bottom: 5px;">ðŸ”´ HARD</div>
          <div style="font-size: 0.9rem;">Challenge yourself</div>
        </button>
      </div>
      
      <div class="tip-box" style="max-width: 600px; margin: 30px auto;">
        <strong>ðŸ’¡ Tip:</strong> Master Easy level (80%+ accuracy) before attempting Medium. 
        Achieve 75%+ on Hard to be exam-ready.
      </div>
    </div>
  `;

        // Open in modal instead of inline
        document.getElementById("practiceModalContent").innerHTML = html;
        document.getElementById("practiceModal").classList.add("active");
        document.body.style.overflow = "hidden"; // Prevent background scroll
      }
      // Close practice modal
      function closePracticeModal() {
        const modal = document.getElementById("practiceModal");
        modal.style.animation = "fadeOut 0.3s ease";

        setTimeout(() => {
          modal.classList.remove("active");
          modal.style.animation = "";
          document.body.style.overflow = ""; // Restore scroll

          // Stop any active timers
          stopTimer();
        }, 300);
      }
      // ===== UNIVERSAL MODAL SYSTEM =====

      // Generic modal opener
      function openModal(modalId, title, content, showCloseButton = true) {
        const modal = document.getElementById(modalId);
        const modalContent = document.getElementById(modalId + "Content");

        if (!modal || !modalContent) {
          console.error(`Modal ${modalId} not found`);
          return;
        }

        // Build modal structure with optional header
        let html = "";

        if (title) {
          html += `
      <div class="modal-header">
        <h2 class="modal-title">${title}</h2>
      </div>
    `;
        }

        html += `<div class="modal-body">${content}</div>`;

        modalContent.innerHTML = html;
        modal.classList.add("active");
        document.body.style.overflow = "hidden";
      }

      // Generic modal closer with animation
      function closeModalAnimated(modalId) {
        const modal = document.getElementById(modalId);
        if (!modal) return;

        // Add fade out animation
        modal.style.animation = "fadeOut 0.3s ease";
        const modalContent = modal.querySelector(".modal-content");
        if (modalContent) {
          modalContent.style.animation = "modalSlideOut 0.3s ease";
        }

        setTimeout(() => {
          modal.classList.remove("active");
          modal.style.animation = "";
          if (modalContent) {
            modalContent.style.animation = "";
          }
          document.body.style.overflow = "";

          // Stop any active timers
          stopTimer();
        }, 300);
      }

      // Enhanced close practice modal (update existing function)
      function closePracticeModal() {
        closeModalAnimated("practiceModal");
      }

      // Close game modal
      function closeGameModal() {
        closeModalAnimated("gameModal");
      }

      // Close mock exam modal
      function closeMockExamModal() {
        closeModalAnimated("mockExamModal");
      }

      // Click outside to close - update existing listener
      document.addEventListener("click", function (event) {
        const modals = ["practiceModal", "gameModal", "mockExamModal", "modal"];

        modals.forEach((modalId) => {
          const modal = document.getElementById(modalId);
          if (event.target === modal) {
            if (modalId === "practiceModal") closePracticeModal();
            else if (modalId === "gameModal") closeGameModal();
            else if (modalId === "mockExamModal") closeMockExamModal();
            else closeModal();
          }
        });
      });

      // ESC key to close modals
      document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
          if (
            document
              .getElementById("practiceModal")
              .classList.contains("active")
          ) {
            closePracticeModal();
          } else if (
            document.getElementById("gameModal").classList.contains("active")
          ) {
            closeGameModal();
          } else if (
            document
              .getElementById("mockExamModal")
              .classList.contains("active")
          ) {
            closeMockExamModal();
          } else if (
            document.getElementById("modal").classList.contains("active")
          ) {
            closeModal();
          }
        }
      });

      // Start practice session with selected difficulty
      window.startPracticeSession = function (type, difficulty) {
        // âœ… ADD loading state
        document.getElementById("practiceModalContent").innerHTML = `
          <div style="text-align: center; padding: 60px;">
            <div style="font-size: 3rem; animation: spin 1s linear infinite;">âš™ï¸</div>
            <p style="margin-top: 20px; color: var(--text-light);">Preparing questions...</p>
          </div>
        `;

        const questionSet =
          type === "neuroPsych"
            ? [
                ...practiceQuestions.neuroPsych.easy,
                ...practiceQuestions.neuroPsych.medium,
                ...practiceQuestions.neuroPsych.hard,
              ]
            : practiceQuestions[type][difficulty];

        // SHUFFLE: Randomize question order and option order
        const shuffledQuestions = shuffleQuestions([...questionSet]); // Create copy first

        let currentQuestion = 0;
        let score = 0;
        let timeStarted;
        let answeredOnTime = 0;

        // Determine time limit per question based on type
        const timeLimits = {
          afpsatVerbal: 28, // 27.7 seconds
          afpsatNumerical: 60, // 60 seconds
          afpsatAbstract: 15, // 14.4 seconds
          neuroPsych: 0, // No time limit for psych
        };

        const timeLimit = timeLimits[type] || 0;

        function showQuestion() {
          if (currentQuestion >= shuffledQuestions.length) {
            showPracticeResults(
              score,
              shuffledQuestions.length,
              answeredOnTime,
              type,
              difficulty,
            );
            return;
          }

          const q = shuffledQuestions[currentQuestion];
          timeStarted = Date.now(); // Reset timer for each question

          const timerHTML =
            timeLimit > 0
              ? `
                    <div id="sectionTimer" class="timer" style="display: inline-block; padding: 10px 20px; margin: 10px 0;">
                        ${timeLimit}s
                    </div>
                `
              : "";

          const html = `
                    <div class="question-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="color: var(--primary); margin: 0;">
                                Question ${currentQuestion + 1} of ${shuffledQuestions.length}
                            </h3>
                            ${timerHTML}
                        </div>
                        <div style="background: var(--bg-light); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <strong>Difficulty:</strong> 
                            <span style="color: ${difficulty === "easy" ? "var(--success)" : difficulty === "medium" ? "var(--accent)" : "var(--danger)"}; text-transform: uppercase;">
                                ${difficulty}
                            </span>
                        </div>
                        <p style="margin: 20px 0; font-size: 1.1rem; line-height: 1.6;">${q.question}</p>
                        <div class="options">
                            ${q.options
                              .map(
                                (opt, i) => `
                                <div class="option" onclick="selectAnswer(${i})">${opt}</div>
                            `,
                              )
                              .join("")}
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="submitAnswer()" style="margin-top: 20px;">Submit Answer</button>
                `;

          document.getElementById("practiceModalContent").innerHTML = html;

          // Start question timer if applicable
          if (timeLimit > 0) {
            startTimer(timeLimit, type, "practice");
          }
        }

        window.selectAnswer = function (optionIndex) {
          document
            .querySelectorAll(".option")
            .forEach((opt) => opt.classList.remove("selected"));
          document
            .querySelectorAll(".option")
            [optionIndex].classList.add("selected");
          window.selectedAnswer = optionIndex;
        };

        window.submitAnswer = function () {
          if (window.selectedAnswer === undefined) {
            showNotification("Please select an answer!");
            return;
          }

          // âœ… FIX 1: Prevent multiple submissions
          const submitBtn = document.querySelector(
            'button[onclick="submitAnswer()"]',
          );
          if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.style.opacity = "0.5";
            submitBtn.style.cursor = "not-allowed";
          }

          stopTimer();
          const questionTime = Date.now() - timeStarted;
          const onTime = timeLimit === 0 || questionTime / 1000 <= timeLimit;

          if (onTime) answeredOnTime++;

          const q = shuffledQuestions[currentQuestion];
          const correct = window.selectedAnswer === q.correct;

          if (correct) {
            score++;
            userData.correctAnswers++;
          }
          userData.totalQuestions++;

          // Track by topic (your existing code)
          if (!userData.weakAreas[q.topic]) {
            userData.weakAreas[q.topic] = { correct: 0, total: 0 };
            userData.strongAreas[q.topic] = { correct: 0, total: 0 };
          }

          // Track verbal sub-topics (your existing code)
          const verbalTopics = [
            "analogies",
            "vocabulary",
            "comprehension",
            "grammar",
          ];
          if (verbalTopics.includes(q.topic)) {
            if (!userData.verbalSubTopicPerformance) {
              userData.verbalSubTopicPerformance = {
                analogies: { correct: 0, total: 0 },
                vocabulary: { correct: 0, total: 0 },
                comprehension: { correct: 0, total: 0 },
                grammar: { correct: 0, total: 0 },
              };
            }

            if (!userData.verbalSubTopicPerformance[q.topic]) {
              userData.verbalSubTopicPerformance[q.topic] = {
                correct: 0,
                total: 0,
              };
            }

            userData.verbalSubTopicPerformance[q.topic].total++;
            if (correct) {
              userData.verbalSubTopicPerformance[q.topic].correct++;
            }
          }

          userData.weakAreas[q.topic].total++;
          userData.strongAreas[q.topic].total++;

          if (correct) {
            userData.strongAreas[q.topic].correct++;
            userData.weakAreas[q.topic].correct++;
          }

          // Check strict mode
          if (userData.preferences.strictExamMode) {
            currentQuestion++;
            showQuestion();
            return;
          }

          // âœ… FIX 2: Mark correct answer visually
          const options = document.querySelectorAll(".option");
          options[q.correct].classList.add("correct");

          // âœ… FIX 3: If user was wrong, mark their selection
          if (!correct && window.selectedAnswer !== undefined) {
            options[window.selectedAnswer].classList.add("incorrect");
          }

          // Time feedback
          const timeFeedback =
            timeLimit > 0
              ? `
        <p style="margin-top: 10px;">
            <strong>Time taken:</strong> ${Math.round(questionTime / 1000)}s 
            ${onTime ? "âœ… On time" : "âš ï¸ Over time - practice speed!"}
        </p>
    `
              : "";

          // âœ… FIX 4: Create explanation HTML with null-safe access
          const explanation = `
    <div class="explanation">
        <strong>${correct ? "âœ… Correct!" : "âŒ Incorrect"}</strong>
        <p style="margin-top: 10px;">${q.explanation || "No explanation available."}</p>
        ${timeFeedback}
    </div>
    <button class="btn btn-primary" onclick="nextQuestion()" style="margin-top: 20px;">
        ${currentQuestion < shuffledQuestions.length - 1 ? "Next Question" : "See Results"}
    </button>
  `;

          // âœ… FIX 5: Remove existing explanation and next button FIRST
          const existingExplanation = document.querySelector(".explanation");
          const existingNextBtn = document.querySelector(
            'button[onclick="nextQuestion()"]',
          );

          if (existingExplanation) {
            existingExplanation.remove();
          }
          if (existingNextBtn) {
            existingNextBtn.remove();
          }

          // âœ… FIX 6: Now insert the NEW explanation (not duplicate)
          const questionCard = document.querySelector(".question-card");
          if (questionCard) {
            // Insert after the question card
            questionCard.insertAdjacentHTML("afterend", explanation);
          } else {
            // Fallback: append to modal content
            document
              .getElementById("practiceModalContent")
              .insertAdjacentHTML("beforeend", explanation);
          }

          saveUserData();
          window.selectedAnswer = undefined;
        };
        window.nextQuestion = function () {
          // âœ… Prevent double-clicking
          const nextBtn = document.querySelector(
            'button[onclick="nextQuestion()"]',
          );
          if (nextBtn) {
            nextBtn.disabled = true;
          }
          currentQuestion++;
          showQuestion();
        };

        showQuestion();
      };

      function showPracticeResults(
        score,
        total,
        answeredOnTime,
        type,
        difficulty,
      ) {
        const percentage = Math.round((score / total) * 100);
        const onTimePercentage = answeredOnTime
          ? Math.round((answeredOnTime / total) * 100)
          : 0;

        // Track performance
        const sectionKey = type.replace("afpsat", "").toLowerCase();
        if (userData.sectionPerformance[sectionKey]) {
          userData.sectionPerformance[sectionKey].push({
            score: percentage,
            difficulty: difficulty,
            date: new Date().toISOString(),
          });
        }
        // âœ… ADD: Save to overall scores
        if (type === "neuroPsych") {
          userData.neuroPsychScores.push(percentage);
        } else {
          // It's AFPSAT (verbal, numerical, or abstract)
          userData.afpsatScores.push(percentage);
        }
        // Update time management tracking
        if (answeredOnTime !== undefined) {
          userData.questionsAnsweredOnTime += answeredOnTime;
          userData.questionsTotalTimed += total;
        }

        saveUserData();

        const performanceLevel =
          percentage >= 85
            ? {
                level: "Excellent",
                color: "var(--success)",
                message: "Outstanding! You're ready for harder challenges.",
              }
            : percentage >= 75
              ? {
                  level: "Very Good",
                  color: "var(--primary)",
                  message: "Great work! This is exam-passing level.",
                }
              : percentage >= 65
                ? {
                    level: "Good",
                    color: "var(--accent)",
                    message: "Good progress! Keep practicing to reach 75%+.",
                  }
                : percentage >= 50
                  ? {
                      level: "Fair",
                      color: "var(--accent)",
                      message: "You're improving. Review topics and try again.",
                    }
                  : {
                      level: "Needs Work",
                      color: "var(--danger)",
                      message: "More study needed. Review tutorials first.",
                    };

        const timeManagementMessage =
          onTimePercentage >= 90
            ? "âœ… Excellent time management!"
            : onTimePercentage >= 70
              ? "âš ï¸ Good timing, but practice speed more"
              : onTimePercentage >= 50
                ? "âš ï¸ Time pressure is affecting you - speed drills needed"
                : "âŒ Critical: You must improve speed for the real exam";

        const html = `
                <div class="score-summary">
                    <h2 style="color: var(--primary);">Practice Complete!</h2>
                    
                    <div class="score-circle">
                        <div class="score">${score}</div>
                        <div class="total">out of ${total}</div>
                    </div>
                    
                    <h3 style="color: ${performanceLevel.color}; margin: 20px 0;">
                        Score: ${percentage}% - ${performanceLevel.level}
                    </h3>
                    
                    <div style="background: var(--bg-light); padding: 20px; border-radius: 12px; margin: 20px 0; text-align: left;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">Performance Breakdown</h4>
                        
                        <div style="margin: 10px 0;">
                            <strong>Difficulty Level:</strong> 
                            <span style="color: ${difficulty === "easy" ? "var(--success)" : difficulty === "medium" ? "var(--accent)" : "var(--danger)"}; text-transform: uppercase;">
                                ${difficulty}
                            </span>
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <strong>Accuracy:</strong> ${score}/${total} correct (${percentage}%)
                            <div class="progress-bar" style="height: 20px; margin-top: 5px;">
                                <div class="progress-fill" style="width: ${percentage}%;">${percentage}%</div>
                            </div>
                        </div>
                        
                        ${
                          answeredOnTime !== undefined
                            ? `
                            <div style="margin: 10px 0;">
                                <strong>Time Management:</strong> ${answeredOnTime}/${total} answered on time (${onTimePercentage}%)
                                <div class="progress-bar" style="height: 20px; margin-top: 5px;">
                                    <div class="progress-fill" style="width: ${onTimePercentage}%; background: ${onTimePercentage >= 80 ? "var(--success)" : "var(--accent)"};">
                                        ${onTimePercentage}%
                                    </div>
                                </div>
                                <p style="margin-top: 5px; font-size: 0.9rem;">${timeManagementMessage}</p>
                            </div>
                        `
                            : ""
                        }
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 30px;">
                          <button class="btn btn-primary" onclick="closePracticeModal(); showSection('practice')">Practice Again</button>
                          <button class="btn btn-success" onclick="closePracticeModal(); showSection('stats')">View Full Stats</button>
                          <button class="btn" style="background: var(--accent); color: white;" onclick="closePracticeModal(); showSection('dashboard')">Dashboard</button>
                        </div>
                    </div>
                    
                    <div class="tip-box" style="margin: 20px 0;">
                        <strong>${performanceLevel.level}:</strong> ${performanceLevel.message}
                    </div>
                    
                    ${
                      percentage >= 80 && difficulty === "easy"
                        ? `
                        <div class="tip-box" style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border-left-color: var(--success);">
                            <strong>ðŸŽ¯ Ready for Next Level!</strong> You've mastered Easy difficulty. 
                            Try Medium difficulty to continue improving.
                        </div>
                    `
                        : ""
                    }
                    
                    ${
                      percentage >= 75 && difficulty === "medium"
                        ? `
                        <div class="tip-box" style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border-left-color: var(--success);">
                            <strong>ðŸŽ¯ Ready for Hard Level!</strong> You're performing at passing level. 
                            Challenge yourself with Hard difficulty.
                        </div>
                    `
                        : ""
                    }
                    
                    ${
                      percentage >= 75 && difficulty === "hard"
                        ? `
                        <div class="tip-box" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-left-color: var(--accent);">
                            <strong>â­ EXAM READY!</strong> Scoring 75%+ on Hard difficulty means you're well-prepared. 
                            Take a full mock exam when ready!
                        </div>
                    `
                        : ""
                    }
                    
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="showSection('practice')">Practice Again</button>
                        <button class="btn btn-success" onclick="showSection('stats')">View Full Stats</button>
                        <button class="btn" style="background: var(--accent); color: white;" onclick="showSection('dashboard')">Dashboard</button>
                    </div>
                </div>
            `;
        document.getElementById("practiceModalContent").innerHTML = html;
        updateDashboard();
        updateStats(); // âœ… ADD: Force stats update
      }

      // Start mock exam - now opens in modal
      function startMockExam(examType) {
        let title = "";
        let html = "";

        if (examType === "afpsat") {
          title = "â±ï¸ AFPSAT Full Mock Exam";
          html = `
      <div style="text-align: center; padding: 20px;">
        <div style="background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-cream) 100%); padding: 30px; border-radius: 16px; margin-bottom: 30px;">
          <h3 style="color: var(--primary); margin-bottom: 20px; font-size: 1.5rem;">
            Simulate Real AFPSAT Test Conditions
          </h3>
          <p style="margin: 15px 0; color: var(--text-dark); font-size: 1.1rem;">
            This mock exam replicates the actual AFPSAT structure:
          </p>
        </div>
        
        <div style="background: white; padding: 25px; border-radius: 12px; margin: 20px auto; max-width: 600px; text-align: left; box-shadow: 0 4px 12px var(--shadow-soft);">
          <ul style="list-style: none; padding: 0;">
            <li style="padding: 12px; margin: 8px 0; background: var(--bg-light); border-radius: 8px; border-left: 4px solid var(--primary);">
              <strong>ðŸ“ Abstract Reasoning:</strong> 50 questions (12 minutes)
            </li>
            <li style="padding: 12px; margin: 8px 0; background: var(--bg-light); border-radius: 8px; border-left: 4px solid var(--secondary);">
              <strong>ðŸ“– Verbal Ability:</strong> 65 questions (30 minutes)
            </li>
            <li style="padding: 12px; margin: 8px 0; background: var(--bg-light); border-radius: 8px; border-left: 4px solid var(--secondary-light);">
              <strong>ðŸ”¢ Numerical Ability:</strong> 35 questions (35 minutes)
            </li>
            <li style="padding: 12px; margin: 8px 0; background: var(--accent); color: white; border-radius: 8px; font-weight: 600;">
              <strong>â±ï¸ Total:</strong> 150 questions in 77 minutes
            </li>
          </ul>
        </div>
        
        <div class="tip-box" style="max-width: 700px; margin: 30px auto; text-align: left;">
          <strong>âš ï¸ Important Rules:</strong>
          <ul style="margin: 15px 0 0 20px;">
            <li>Timer cannot be paused once started</li>
            <li>You must complete all sections in one sitting</li>
            <li>Ensure 90+ minutes of uninterrupted time</li>
            <li>Use headphones to minimize distractions</li>
          </ul>
        </div>
        
        <button class="btn btn-success" onclick="launchMockExam('afpsat')" 
                style="padding: 18px 50px; font-size: 1.3rem; margin-top: 20px;">
          ðŸš€ Start AFPSAT Mock Exam
        </button>
      </div>
    `;
        } else {
          title = "ðŸ§  Neuro-Psychological Mock Exam";
          html = `
      <div style="text-align: center; padding: 20px;">
        <div style="background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-cream) 100%); padding: 30px; border-radius: 16px; margin-bottom: 30px;">
          <h3 style="color: var(--primary); margin-bottom: 20px; font-size: 1.5rem;">
            Comprehensive Psychological Assessment
          </h3>
          <p style="margin: 15px 0; color: var(--text-dark); font-size: 1.1rem;">
            This simulation evaluates your psychological readiness for military service:
          </p>
        </div>
        
        <div style="background: white; padding: 25px; border-radius: 12px; margin: 20px auto; max-width: 600px; text-align: left; box-shadow: 0 4px 12px var(--shadow-soft);">
          <ul style="list-style: none; padding: 0;">
            <li style="padding: 12px; margin: 8px 0; background: var(--bg-light); border-radius: 8px; border-left: 4px solid var(--primary);">
              <strong>ðŸ‘¤ Personality Assessment:</strong> Behavioral patterns & attitudes
            </li>
            <li style="padding: 12px; margin: 8px 0; background: var(--bg-light); border-radius: 8px; border-left: 4px solid var(--secondary);">
              <strong>ðŸŽ¯ Situational Judgment:</strong> Decision-making scenarios
            </li>
            <li style="padding: 12px; margin: 8px 0; background: var(--bg-light); border-radius: 8px; border-left: 4px solid var(--secondary-light);">
              <strong>ðŸ§© Logical Thinking:</strong> Critical reasoning problems
            </li>
            <li style="padding: 12px; margin: 8px 0; background: var(--bg-light); border-radius: 8px; border-left: 4px solid var(--accent);">
              <strong>ðŸ’ª Stress Tolerance:</strong> Emotional control evaluation
            </li>
            <li style="padding: 12px; margin: 8px 0; background: var(--accent); color: white; border-radius: 8px; font-weight: 600;">
              <strong>â±ï¸ Estimated Time:</strong> 60 minutes
            </li>
          </ul>
        </div>
        
        <div class="tip-box" style="max-width: 700px; margin: 30px auto; text-align: left; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);">
          <strong>ðŸ’¡ Remember:</strong>
          <ul style="margin: 15px 0 0 20px;">
            <li>Answer honestly and consistently</li>
            <li>No "right" or "wrong" answers exist</li>
            <li>Test detects inconsistencies automatically</li>
            <li>First instinct is usually most accurate</li>
          </ul>
        </div>
        
        <button class="btn btn-success" onclick="launchMockExam('neuroPsych')" 
                style="padding: 18px 50px; font-size: 1.3rem; margin-top: 20px;">
          ðŸ§  Start Neuro-Psych Mock Exam
        </button>
      </div>
    `;
        }

        // Open in modal
        const modalContent = document.getElementById("mockExamModalContent");
        modalContent.innerHTML = `
    <div class="modal-header">
      <h2 class="modal-title">${title}</h2>
    </div>
    <div class="modal-body">${html}</div>
  `;

        document.getElementById("mockExamModal").classList.add("active");
        document.body.style.overflow = "hidden";
      }

      // REPLACE with actual implementation:
      function launchMockExam(type) {
        closeMockExamModal();

        if (type === "afpsat") {
          startFullAFPSATMock();
        } else {
          startFullNeuroPsychMock();
        }
      }

      // ADD these new functions after launchMockExam:
      function startFullAFPSATMock() {
        // Helper to repeat a question pool until we hit the target count
        function fillToCount(pool, targetCount) {
          const result = [];
          while (result.length < targetCount) {
            const shuffled = shuffleQuestions([...pool]);
            result.push(...shuffled);
          }
          return result.slice(0, targetCount);
        }

        // Abstract: 50 questions (12 min)
        const abstractPool = [
          ...practiceQuestions.afpsatAbstract.easy,
          ...practiceQuestions.afpsatAbstract.medium,
          ...practiceQuestions.afpsatAbstract.hard,
        ];
        const abstractQuestions = fillToCount(abstractPool, 50).map((q) => ({
          ...q,
          _section: "Abstract Reasoning",
        }));

        // Verbal: 65 questions (30 min)
        const verbalPool = [
          ...practiceQuestions.afpsatVerbal.easy,
          ...practiceQuestions.afpsatVerbal.medium,
          ...practiceQuestions.afpsatVerbal.hard,
        ];
        const verbalQuestions = fillToCount(verbalPool, 65).map((q) => ({
          ...q,
          _section: "Verbal Ability",
        }));

        // Numerical: 35 questions (35 min)
        const numericalPool = [
          ...practiceQuestions.afpsatNumerical.easy,
          ...practiceQuestions.afpsatNumerical.medium,
          ...practiceQuestions.afpsatNumerical.hard,
        ];
        const numericalQuestions = fillToCount(numericalPool, 35).map((q) => ({
          ...q,
          _section: "Numerical Ability",
        }));

        // Combine: 50 + 65 + 35 = 150 total, in section order
        const allQuestions = [
          ...abstractQuestions,
          ...verbalQuestions,
          ...numericalQuestions,
        ];

        startTimedExam(allQuestions, 4620, "AFPSAT Full Mock"); // 77 minutes
      }
      function startFullNeuroPsychMock() {
        const allQuestions = [
          ...practiceQuestions.neuroPsych.easy,
          ...practiceQuestions.neuroPsych.medium,
          ...practiceQuestions.neuroPsych.hard,
        ];

        const shuffled = shuffleQuestions(allQuestions);
        startTimedExam(shuffled, 3600, "Neuro-Psych Mock"); // 60 minutes
      }

      function startTimedExam(questions, timeLimit, examName) {
        // Open practice modal for exam
        document.getElementById("practiceModal").classList.add("active");
        document.body.style.overflow = "hidden";

        // Show loading
        document.getElementById("practiceModalContent").innerHTML = `
    <div style="text-align: center; padding: 60px;">
      <div style="font-size: 3rem; animation: spin 1s linear infinite;">âš™ï¸</div>
      <p style="margin-top: 20px; color: var(--text-light);">Loading ${examName}...</p>
    </div>
  `;

        setTimeout(() => {
          let currentQuestion = 0;
          let score = 0;
          let answers = []; // Store all answers for strict mode
          const totalQuestions = questions.length;

          // Start exam timer
          startTimer(timeLimit, examName, "exam");

          function showExamQuestion() {
            if (currentQuestion >= totalQuestions) {
              // Exam complete - show all results
              showExamResults();
              return;
            }

            const q = questions[currentQuestion];
            const progress = Math.round(
              ((currentQuestion + 1) / totalQuestions) * 100,
            );

            const html = `
        <div class="question-card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
            <h3 style="color: var(--primary); margin: 0;">
              ${examName} - Question ${currentQuestion + 1} of ${totalQuestions}
            </h3>
            ${q._section ? `<span style="background: var(--accent); color: white; padding: 4px 14px; border-radius: 12px; font-size: 0.85rem; font-weight: 600;">${q._section}</span>` : ""}
            <div id="sectionTimer" class="timer" style="display: inline-block; padding: 10px 20px; margin: 0;">
              ${Math.floor(timeLimit / 60)}:00
            </div>
          </div>
          
          <div class="progress-bar" style="height: 15px; margin-bottom: 20px;">
            <div class="progress-fill" style="width: ${progress}%;">${progress}%</div>
          </div>
          
          <p style="margin: 20px 0; font-size: 1.1rem; line-height: 1.6;">${q.question}</p>
          
          <div class="options">
            ${q.options
              .map(
                (opt, i) => `
              <div class="option" onclick="selectExamAnswer(${i})">${opt}</div>
            `,
              )
              .join("")}
          </div>
        </div>
        
        <div style="display: flex; gap: 15px; justify-content: space-between; margin-top: 20px; flex-wrap: wrap;">
          <button class="btn btn-secondary" onclick="previousExamQuestion()" 
                  ${currentQuestion === 0 ? 'disabled style="opacity: 0.5; cursor: not-allowed;"' : ""}>
            â† Previous
          </button>
          <button class="btn btn-primary" onclick="submitExamAnswer()">
            ${currentQuestion === totalQuestions - 1 ? "Finish Exam" : "Next Question â†’"}
          </button>
        </div>
        
        <div class="tip-box" style="margin-top: 20px;">
          <strong>âš ï¸ Exam Mode:</strong> You can review and change answers. 
          Timer continues - answers will be revealed only at the end.
        </div>
      `;

            document.getElementById("practiceModalContent").innerHTML = html;

            // Restore previously selected answer if user goes back
            if (answers[currentQuestion] !== undefined) {
              window.selectedAnswer = answers[currentQuestion];
              document
                .querySelectorAll(".option")
                [answers[currentQuestion]].classList.add("selected");
            } else {
              window.selectedAnswer = undefined;
            }
          }

          window.selectExamAnswer = function (optionIndex) {
            document
              .querySelectorAll(".option")
              .forEach((opt) => opt.classList.remove("selected"));
            document
              .querySelectorAll(".option")
              [optionIndex].classList.add("selected");
            window.selectedAnswer = optionIndex;
          };

          window.submitExamAnswer = function () {
            if (window.selectedAnswer === undefined) {
              showNotification("Please select an answer!");
              return;
            }

            // Save answer
            answers[currentQuestion] = window.selectedAnswer;
            currentQuestion++;
            window.selectedAnswer = undefined;

            showExamQuestion();
          };

          window.previousExamQuestion = function () {
            if (currentQuestion > 0) {
              currentQuestion--;
              showExamQuestion();
            }
          };

          function showExamResults() {
            stopTimer();

            // Calculate score
            let correct = 0;
            questions.forEach((q, i) => {
              if (answers[i] === q.correct) correct++;
            });

            const percentage = Math.round((correct / totalQuestions) * 100);

            userData.mockExams.push({
              type: examName,
              score: percentage,
              date: new Date().toISOString(),
              questionsTotal: totalQuestions,
              questionsCorrect: correct,
            });

            // Route score to the correct tracker
            if (examName.toLowerCase().includes("neuro")) {
              userData.neuroPsychScores.push(percentage);
            } else {
              userData.afpsatScores.push(percentage);
            }

            saveUserData();

            const html = `
        <div class="score-summary">
          <h2 style="color: var(--primary);">${examName} Complete!</h2>
          
          <div class="score-circle">
            <div class="score">${correct}</div>
            <div class="total">out of ${totalQuestions}</div>
          </div>
          
          <h3 style="color: ${percentage >= 71 ? "var(--success)" : "var(--danger)"}; margin: 20px 0;">
            Final Score: ${percentage}% ${percentage >= 71 ? "âœ… PASSING" : "âŒ BELOW PASSING"}
          </h3>
          
          <div class="tip-box" style="margin: 20px 0; background: ${percentage >= 71 ? "#dcfce7" : "#fee2e2"};">
            <strong>${percentage >= 71 ? "ðŸŽ‰ Congratulations!" : "ðŸ“– Keep Studying"}</strong>
            ${
              percentage >= 71
                ? "You achieved a passing score! You're ready for the real exam."
                : "AFPSAT requires 71+ to pass. Review weak areas and try again."
            }
          </div>
          
          <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 30px;">
            <button class="btn btn-primary" onclick="closePracticeModal(); showSection('mockExam')">
              Back to Mock Exams
            </button>
            <button class="btn btn-success" onclick="closePracticeModal(); showSection('stats')">
              View Stats
            </button>
          </div>
        </div>
      `;

            document.getElementById("practiceModalContent").innerHTML = html;
            updateDashboard();
          }

          showExamQuestion();
          showNotification(
            `â±ï¸ ${examName} started! ${Math.floor(timeLimit / 60)} minutes`,
          );
        }, 300);
      }
      // Start game - now opens in modal
      function startGame(gameType) {
        // Ensure games progress exists
        if (!userData.gamesProgress) {
          userData.gamesProgress = {
            patternSpeed: { highScore: 0, attempts: 0, lastPlayed: null },
            mathBlitz: { highScore: 0, attempts: 0, lastPlayed: null },
            memoryMatch: {
              highScore: 0,
              bestTime: 999999,
              attempts: 0,
              lastPlayed: null,
            },
          };
        }

        // Open modal FIRST
        const modal = document.getElementById("gameModal");
        modal.classList.add("active");
        document.body.style.overflow = "hidden";

        // Wait for modal to be visible, THEN launch game
        setTimeout(() => {
          if (gameType === "patternSpeed") {
            startPatternSpeedGame();
          } else if (gameType === "mathBlitz") {
            startMathBlitzGame();
          } else if (gameType === "memoryMatch") {
            startMemoryMatchGame();
          }
        }, 100); // Small delay ensures modal DOM is ready
      }

      // === GAME 2: MATH BLITZ ===
      function startMathBlitzGame() {
        let score = 0;
        let round = 1;
        const maxRounds = 10;
        let startTime = Date.now();

        function generateProblem() {
          const type = Math.floor(Math.random() * 4);
          let question, answer;

          switch (type) {
            case 0:
              const a1 = Math.floor(Math.random() * 50) + 10;
              const b1 = Math.floor(Math.random() * 50) + 10;
              question = `${a1} + ${b1}`;
              answer = a1 + b1;
              break;
            case 1:
              const a2 = Math.floor(Math.random() * 80) + 20;
              const b2 = Math.floor(Math.random() * 40) + 10;
              question = `${a2} - ${b2}`;
              answer = a2 - b2;
              break;
            case 2:
              const a3 = Math.floor(Math.random() * 12) + 3;
              const b3 = Math.floor(Math.random() * 12) + 3;
              question = `${a3} Ã— ${b3}`;
              answer = a3 * b3;
              break;
            case 3:
              const b4 = Math.floor(Math.random() * 9) + 2;
              const a4 = b4 * (Math.floor(Math.random() * 12) + 2);
              question = `${a4} Ã· ${b4}`;
              answer = a4 / b4;
              break;
          }

          return { question, answer };
        }

        function showRound() {
          if (round > maxRounds) {
            endGame();
            return;
          }

          const problem = generateProblem();
          const roundStart = Date.now();

          const html = `
            <div style="background: white; padding: 40px; border-radius: 16px; text-align: center;">
              <h3 style="color: var(--primary); margin-bottom: 20px;">
                Problem ${round} of ${maxRounds}
              </h3>
              <div style="background: var(--bg-light); padding: 50px; border-radius: 12px; margin: 20px 0;">
                <div style="font-size: 3rem; font-weight: 700; color: var(--primary);">
                  ${problem.question} = ?
                </div>
              </div>
              <input type="number" id="mathAnswer" placeholder="Your answer" 
                     style="width: 200px; padding: 15px; font-size: 1.5rem; text-align: center; border: 2px solid var(--border); border-radius: 8px;"
                     onkeypress="if(event.key==='Enter') checkMathAnswer(${problem.answer}, ${roundStart})">
              <br>
              <button class="btn btn-success" onclick="checkMathAnswer(${problem.answer}, ${roundStart})" 
                      style="margin-top: 20px; padding: 15px 40px; font-size: 1.2rem;">
                Submit
              </button>
              <div style="margin-top: 30px; padding: 20px; background: var(--bg-light); border-radius: 8px;">
                <strong>Score:</strong> ${score} points | <strong>Time:</strong> ${Math.floor((Date.now() - startTime) / 1000)}s
              </div>
            </div>
          `;

          document.getElementById("gameModalContent").innerHTML = html;
          document.getElementById("mathAnswer").focus();

          setTimeout(() => {
            document.getElementById("mathAnswer").focus();
          }, 100); // Small delay ensures DOM is ready
        }

        window.checkMathAnswer = function (correct, roundStart) {
          const inputElem = document.getElementById("mathAnswer");
          if (!inputElem || inputElem.value.trim() === "") {
            showNotification("âš ï¸ Please enter an answer!");
            return;
          }
          const userAnswer = parseInt(inputElem.value);
          const responseTime = Date.now() - roundStart;
          const timeBonus = Math.max(0, 5000 - responseTime);

          if (userAnswer === correct) {
            const points = Math.floor(100 + timeBonus / 50);
            score += points;
            showNotification("âœ… Correct! +" + points + " points");
          } else {
            showNotification("âŒ Incorrect. Answer was: " + correct);
          }

          round++;
          setTimeout(showRound, 800);
        };

        function endGame() {
          const totalTime = Math.floor((Date.now() - startTime) / 1000);

          if (!userData.gamesProgress.mathBlitz) {
            userData.gamesProgress.mathBlitz = { highScore: 0, attempts: 0 };
          }

          userData.gamesProgress.mathBlitz.attempts++;
          const isNewHigh = score > userData.gamesProgress.mathBlitz.highScore;
          if (isNewHigh) {
            userData.gamesProgress.mathBlitz.highScore = score;
            userData.gamesProgress.mathBlitz.lastPlayed =
              new Date().toISOString();
          }
          saveUserData();

          const html = `
            <div style="background: white; padding: 40px; border-radius: 16px; text-align: center;">
              <h2 style="color: var(--success); margin-bottom: 20px;">ðŸŽ‰ Math Blitz Complete!</h2>
              <div class="score-circle" style="margin: 30px auto;">
                <div class="score">${score}</div>
                <div class="total">points</div>
              </div>
              <p style="font-size: 1.2rem; margin: 20px 0;">Completed in ${totalTime} seconds</p>
              <p style="color: var(--text-light);">
                ${score > userData.gamesProgress.mathBlitz.highScore ? "ðŸ† New High Score!" : "High Score: " + userData.gamesProgress.mathBlitz.highScore}
              </p>
              <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="startGame('mathBlitz')" 
                        style="min-width: 140px; padding: 14px 30px;">
                  Play Again
                </button>
                <button class="btn btn-secondary" onclick="closeGameModal()" 
                        style="min-width: 140px; padding: 14px 30px;">
                  Back to Games
                </button>
              </div>
            </div>
          `;

          document.getElementById("gameModalContent").innerHTML = html;
          updateGameScores();
        }

        showRound();
      }

      // === GAME 3: FLASH MEMORY ===
      function startMemoryMatchGame() {
        const symbols = ["ðŸŽ–ï¸", "â­", "ðŸŽ¯", "ðŸ†", "ðŸ”¥", "ðŸ’Ž", "ðŸŽª", "ðŸŽ­"];
        let sequence = [];
        let userSequence = [];
        let level = 1;
        let startTime = Date.now();

        function showSequence() {
          sequence = [];
          for (let i = 0; i < level + 2; i++) {
            sequence.push(symbols[Math.floor(Math.random() * symbols.length)]);
          }

          let html = `
            <div style="background: white; padding: 40px; border-radius: 16px; text-align: center;">
              <h3 style="color: var(--primary); margin-bottom: 20px;">Level ${level}</h3>
              <p style="margin: 20px 0;">Memorize this sequence:</p>
              <div id="sequenceDisplay" style="font-size: 4rem; padding: 40px; background: var(--bg-light); border-radius: 12px; margin: 20px 0;">
              </div>
              <p style="color: var(--text-light);">Watch carefully...</p>
            </div>
          `;

          document.getElementById("gameModalContent").innerHTML = html;

          let index = 0;
          const displayInterval = setInterval(() => {
            if (index < sequence.length) {
              document.getElementById("sequenceDisplay").textContent =
                sequence[index];
              index++;
            } else {
              clearInterval(displayInterval);
              setTimeout(askForRecall, 1000);
            }
          }, 800);
        }

        function askForRecall() {
          userSequence = [];

          const html = `
            <div style="background: white; padding: 40px; border-radius: 16px; text-align: center;">
              <h3 style="color: var(--primary); margin-bottom: 20px;">Recall the Sequence</h3>
              <p style="margin: 20px 0;">Click the symbols in the correct order:</p>
              <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; max-width: 500px; margin: 30px auto;">
                ${symbols
                  .map(
                    (symbol) => `
                  <button onclick="selectSymbol('${symbol}')" 
                          style="font-size: 3rem; padding: 20px; background: white; border: 3px solid var(--border); border-radius: 12px; cursor: pointer; transition: all 0.3s;"
                          onmouseover="this.style.borderColor='var(--primary)'" 
                          onmouseout="this.style.borderColor='var(--border)'">
                    ${symbol}
                  </button>
                `,
                  )
                  .join("")}
              </div>
              <div id="userSequenceDisplay" style="font-size: 1.8rem; margin: 25px 0; min-height: 70px; padding: 18px; background: var(--bg-light); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 8px;">
                <em style="color: var(--text-light); font-size: 0.9rem;">Your sequence will appear here...</em>
              </div>
              <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
                <button class="btn btn-danger" onclick="clearMemorySequence()" style="min-width: 120px; padding: 12px 24px;">Clear</button>
                <button class="btn btn-success" onclick="checkMemorySequence()" style="min-width: 120px; padding: 12px 24px;">Submit</button>
              </div>
            </div>
          `;

          document.getElementById("gameModalContent").innerHTML = html;
        }

        window.selectSymbol = function (symbol) {
          userSequence.push(symbol);
          document.getElementById("userSequenceDisplay").textContent =
            userSequence.join(" ");
        };

        window.clearMemorySequence = function () {
          userSequence = [];
          document.getElementById("userSequenceDisplay").innerHTML =
            '<em style="color: var(--text-light);">Your sequence will appear here...</em>';
        };

        window.checkMemorySequence = function () {
          if (userSequence.length !== sequence.length) {
            showNotification("âš ï¸ Sequence length doesn't match!");
            return;
          }

          const correct = userSequence.every(
            (symbol, index) => symbol === sequence[index],
          );

          if (correct) {
            level++;
            showNotification("âœ… Correct! Moving to level " + level);
            setTimeout(showSequence, 1000);
          } else {
            endMemoryGame();
          }
        };

        function endMemoryGame() {
          const totalTime = Math.floor((Date.now() - startTime) / 1000);
          const finalLevel = level - 1;

          if (!userData.gamesProgress.memoryMatch) {
            userData.gamesProgress.memoryMatch = {
              highScore: 0,
              bestTime: 999999,
              attempts: 0,
            };
          }

          userData.gamesProgress.memoryMatch.attempts++;
          const isNewHigh =
            finalLevel > userData.gamesProgress.memoryMatch.highScore;
          if (isNewHigh) {
            userData.gamesProgress.memoryMatch.highScore = finalLevel;
            userData.gamesProgress.memoryMatch.lastPlayed =
              new Date().toISOString();
          }
          if (totalTime < userData.gamesProgress.memoryMatch.bestTime) {
            userData.gamesProgress.memoryMatch.bestTime = totalTime;
          }
          saveUserData();

          const html = `
            <div style="background: white; padding: 40px; border-radius: 16px; text-align: center;">
              <h2 style="color: ${finalLevel >= 5 ? "var(--success)" : "var(--primary)"}; margin-bottom: 20px;">
                ${finalLevel >= 5 ? "ðŸŽ‰ Excellent Memory!" : "ðŸ§  Good Try!"}
              </h2>
              <div class="score-circle" style="margin: 30px auto;">
                <div class="score">${finalLevel}</div>
                <div class="total">levels</div>
              </div>
              <p style="font-size: 1.2rem; margin: 20px 0;">Time: ${totalTime} seconds</p>
              <p style="color: var(--text-light);">
                Best: Level ${userData.gamesProgress.memoryMatch.highScore} in ${userData.gamesProgress.memoryMatch.bestTime}s
              </p>
              <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="startGame('memoryMatch')" 
                        style="min-width: 140px; padding: 14px 30px;">
                  Play Again
                </button>
                <button class="btn btn-secondary" onclick="closeGameModal()" 
                        style="min-width: 140px; padding: 14px 30px;">
                  Back to Games
                </button>
              </div>
            </div>
          `;

          document.getElementById("gameModalContent").innerHTML = html;
          updateGameScores();
        }

        showSequence();
      }

      // Update game scores display
      function updateGameScores() {
        if (userData.gamesProgress) {
          if (userData.gamesProgress.patternSpeed) {
            const elem = document.getElementById("patternHighScore");
            if (elem)
              elem.textContent =
                userData.gamesProgress.patternSpeed.highScore || 0;
          }
          if (userData.gamesProgress.mathBlitz) {
            const elem = document.getElementById("mathHighScore");
            if (elem)
              elem.textContent =
                userData.gamesProgress.mathBlitz.highScore || 0;
          }
          if (userData.gamesProgress.memoryMatch) {
            const elem = document.getElementById("memoryBestTime");
            if (elem) {
              const time = userData.gamesProgress.memoryMatch.bestTime;
              elem.textContent = time < 999999 ? time : "--";
            }
          }
        }
      }

      // Update dashboard
      function updateDashboard() {
        document.getElementById("totalQuestions").textContent =
          userData.totalQuestions;

        if (userData.totalQuestions > 0) {
          const avgScore = Math.round(
            (userData.correctAnswers / userData.totalQuestions) * 100,
          );
          document.getElementById("avgScore").textContent = avgScore + "%";
        } else {
          document.getElementById("avgScore").textContent = "0%"; // âœ… Always reset to 0%
        }

        document.getElementById("studyStreak").textContent =
          userData.studyStreak;

        // Update passing probability
        updatePassingProbability();

        // Update game scores if on games page
        updateGameScores();
      }

      function updatePassingProbability() {
        const prediction =
          afpsatPredictor.calculatePassingProbability(userData);
        const sectionReadiness = afpsatPredictor.getSectionReadiness();

        const probabilityHTML = `
                <div style="text-align: center;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">
                        ${prediction.emoji} AFPSAT Exam Readiness Assessment
                    </h3>
                    
                    <div style="display: inline-block; padding: 30px; background: ${prediction.color}; color: white; border-radius: 16px; margin: 20px 0; min-width: 300px;">
                        <div style="font-size: 2rem; font-weight: 700; margin-bottom: 10px;">
                            ${prediction.band}
                        </div>
                        <div style="font-size: 1.2rem; opacity: 0.95;">
                            Passing Probability: ${prediction.probability}
                        </div>
                    </div>
                    
                    <p style="font-size: 1.1rem; margin: 20px 0; color: var(--text-dark);">
                        ${prediction.message}
                    </p>
                    
                    <div style="background: var(--bg-light); padding: 20px; border-radius: 12px; margin: 20px 0; text-align: left;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">ðŸ“Š Performance Breakdown</h4>
                        
                        <div style="margin: 10px 0;">
                            <strong>Mock Exam Performance (40%):</strong> ${prediction.breakdown.mockScore}/100
                            <div class="progress-bar" style="height: 20px; margin-top: 5px;">
                                <div class="progress-fill" style="width: ${prediction.breakdown.mockScore}%;"></div>
                            </div>
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <strong>Practice Consistency (25%):</strong> ${prediction.breakdown.consistency}/100
                            <div class="progress-bar" style="height: 20px; margin-top: 5px;">
                                <div class="progress-fill" style="width: ${prediction.breakdown.consistency}%;"></div>
                            </div>
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <strong>Time Management (20%):</strong> ${prediction.breakdown.timeManagement}/100
                            <div class="progress-bar" style="height: 20px; margin-top: 5px;">
                                <div class="progress-fill" style="width: ${prediction.breakdown.timeManagement}%;"></div>
                            </div>
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <strong>Topic Coverage (15%):</strong> ${prediction.breakdown.weakAreaCoverage}/100
                            <div class="progress-bar" style="height: 20px; margin-top: 5px;">
                                <div class="progress-fill" style="width: ${prediction.breakdown.weakAreaCoverage}%;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-light); padding: 20px; border-radius: 12px; margin: 20px 0; text-align: left;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">ðŸ“ Section Readiness</h4>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div style="padding: 15px; background: white; border-radius: 8px;">
                                <strong>Abstract Reasoning</strong><br>
                                ${sectionReadiness.abstract.status}<br>
                                <span style="color: var(--text-light);">${sectionReadiness.abstract.average}% avg (${sectionReadiness.abstract.attempts} attempts)</span>
                            </div>
                            <div style="padding: 15px; background: white; border-radius: 8px;">
                                <strong>Verbal Ability</strong><br>
                                ${sectionReadiness.verbal.status}<br>
                                <span style="color: var(--text-light);">${sectionReadiness.verbal.average}% avg (${sectionReadiness.verbal.attempts} attempts)</span>
                            </div>
                            <div style="padding: 15px; background: white; border-radius: 8px;">
                                <strong>Numerical Ability</strong><br>
                                ${sectionReadiness.numerical.status}<br>
                                <span style="color: var(--text-light);">${sectionReadiness.numerical.average}% avg (${sectionReadiness.numerical.attempts} attempts)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tip-box" style="border-left-color: ${prediction.color};">
                        <strong>ðŸ“‹ Recommendation:</strong><br>
                        ${prediction.recommendation}
                    </div>
                </div>
            `;

        document.getElementById("passingProbability").innerHTML =
          probabilityHTML;
      }

      // Update stats
      function updateStats() {
        // Update mock exams count
        document.getElementById("mocksTaken").textContent =
          userData.mockExams.length;

        // âœ… CALCULATE AVERAGES FIRST
        const afpsatAvg =
          userData.afpsatScores.length > 0
            ? Math.round(
                userData.afpsatScores.reduce((a, b) => a + b, 0) /
                  userData.afpsatScores.length,
              )
            : 0;
        const neuroPsychAvg =
          userData.neuroPsychScores.length > 0
            ? Math.round(
                userData.neuroPsychScores.reduce((a, b) => a + b, 0) /
                  userData.neuroPsychScores.length,
              )
            : 0;

        // âœ… UPDATE THE DISPLAY
        document.getElementById("afpsatAvg").textContent = afpsatAvg + "%";
        document.getElementById("neuroPsychAvg").textContent =
          neuroPsychAvg + "%";

        // âœ… ADD: Render Progress Chart
        function renderProgressChart() {
          const chartDiv = document.getElementById("progressChart");
          if (!chartDiv) return;

          // Combine all section performance
          const allAttempts = [];

          ["abstract", "verbal", "numerical", "neuroPsych"].forEach(
            (section) => {
              if (userData.sectionPerformance[section]) {
                userData.sectionPerformance[section].forEach((attempt) => {
                  allAttempts.push({
                    date: new Date(attempt.date),
                    score: attempt.score,
                    section: section,
                    difficulty: attempt.difficulty,
                  });
                });
              }
            },
          );

          // Sort by date
          allAttempts.sort((a, b) => a.date - b.date);

          if (allAttempts.length === 0) {
            chartDiv.innerHTML =
              '<p style="text-align: center; color: var(--text-light); padding: 40px;">No practice data yet. Complete some practice sessions to see your progress!</p>';
            return;
          }

          // Create simple text-based chart
          let chartHTML =
            '<div style="background: white; padding: 20px; border-radius: 8px;">';

          allAttempts.slice(-10).forEach((attempt, index) => {
            const dateStr = attempt.date.toLocaleDateString();
            const barWidth = attempt.score;
            const color =
              attempt.score >= 75
                ? "var(--success)"
                : attempt.score >= 60
                  ? "var(--accent)"
                  : "var(--danger)";

            chartHTML += `
      <div style="margin: 10px 0;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9rem;">
          <span><strong>${attempt.section}</strong> - ${dateStr}</span>
          <span style="color: ${color}; font-weight: 600;">${attempt.score}%</span>
        </div>
        <div style="background: var(--bg-light); border-radius: 4px; height: 25px; overflow: hidden;">
          <div style="background: ${color}; height: 100%; width: ${barWidth}%; transition: width 0.5s; display: flex; align-items: center; padding: 0 10px; color: white; font-size: 0.85rem; font-weight: 600;">
            ${attempt.score}%
          </div>
        </div>
      </div>
    `;
          });

          chartHTML += "</div>";
          chartDiv.innerHTML = chartHTML;
        }

        renderProgressChart(); // âœ… Call it

        document.getElementById("mocksTaken").textContent =
          userData.mockExams.length;

        // Show weak areas
        const weakAreasHtml =
          Object.keys(userData.weakAreas).length > 0
            ? Object.entries(userData.weakAreas)
                .filter(([area, data]) => data.correct / data.total < 0.6)
                .map(
                  ([area, data]) => `
                        <div class="weak-area">
                            <strong>${area}</strong>: ${Math.round((data.correct / data.total) * 100)}% accuracy
                            <br>Practice more to improve!
                        </div>
                    `,
                )
                .join("")
            : "<p>No weak areas yet - keep practicing!</p>";

        document.getElementById("weakAreas").innerHTML = weakAreasHtml;

        // Show strong areas
        const strongAreasHtml =
          Object.keys(userData.weakAreas).length > 0
            ? Object.entries(userData.weakAreas)
                .filter(([area, data]) => data.correct / data.total >= 0.8)
                .map(
                  ([area, data]) => `
                        <div class="strong-area">
                            <strong>${area}</strong>: ${Math.round((data.correct / data.total) * 100)}% accuracy
                            <br>Excellent work!
                        </div>
                    `,
                )
                .join("")
            : "<p>Complete more practices to identify your strong areas!</p>";
        updateVerbalAnalysis();
        document.getElementById("strongAreas").innerHTML = strongAreasHtml;
      }

      // Close modal
      function closeModal() {
        document.getElementById("modal").classList.remove("active");
      }

      // Show notification
      function showNotification(message) {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.style.display = "block";
        setTimeout(() => {
          notification.style.display = "none";
        }, 3000);
      }

      // Check online/offline status
      window.addEventListener("online", () => {
        document.getElementById("offlineIndicator").style.display = "none";
      });

      window.addEventListener("offline", () => {
        document.getElementById("offlineIndicator").style.display = "block";
      });
      // === GAME 1: PATTERN SPEED CHALLENGE ===
      function startPatternSpeedGame() {
        let score = 0;
        let round = 1;
        const maxRounds = 10;
        let startTime = Date.now();

        const patterns = [
          { sequence: ["ðŸ”´", "ðŸ”µ", "ðŸ”´", "ðŸ”µ", "ðŸ”´"], next: "ðŸ”µ" },
          {
            sequence: ["â­", "â­â­", "â­â­â­", "â­â­â­â­"],
            next: "â­â­â­â­â­",
          },
          { sequence: ["â–²", "â–¼", "â–²", "â–¼"], next: "â–²" },
          { sequence: ["1", "2", "4", "8"], next: "16" },
          { sequence: ["A", "C", "E", "G"], next: "I" },
          { sequence: ["ðŸŸ¢", "ðŸŸ¡", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¡"], next: "ðŸ”´" },
          { sequence: ["â– ", "â—", "â–²", "â– ", "â—"], next: "â–²" },
        ];

        function showRound() {
          if (round > maxRounds) {
            endGame();
            return;
          }

          const pattern = patterns[Math.floor(Math.random() * patterns.length)];
          const roundStart = Date.now();

          const options = [pattern.next];
          // Add 3 wrong options
          const wrongOptions = [
            "ðŸŸ ",
            "ðŸŸ£",
            "â¬›",
            "â—†",
            "â—‡",
            "â–¶",
            "â—€",
            "B",
            "J",
            "32",
          ];
          while (options.length < 4) {
            const wrong =
              wrongOptions[Math.floor(Math.random() * wrongOptions.length)];
            if (!options.includes(wrong) && wrong !== pattern.next) {
              options.push(wrong);
            }
          }
          const shuffledOptions = shuffleArray([...options]); // Create shuffled copy

          const html = `
      <div style="background: white; padding: 40px; border-radius: 16px; text-align: center;">
        <h3 style="color: var(--primary); margin-bottom: 20px;">
          Round ${round} of ${maxRounds}
        </h3>
        <div style="background: var(--bg-light); padding: 30px; border-radius: 12px; margin: 20px 0;">
          <div style="font-size: 3rem; margin-bottom: 20px;">
            ${pattern.sequence.join(" â†’ ")} â†’ ?
          </div>
        </div>
        <p style="margin: 20px 0; color: var(--text-light);">What comes next?</p>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; max-width: 400px; margin: 0 auto; padding: 0 10px;">
          ${shuffledOptions
            .map(
              (opt) => `
                  <button class="btn btn-primary" onclick="checkPatternAnswer('${opt}', '${pattern.next}', ${roundStart})" 
                          style="font-size: 1.8rem; padding: 25px; min-height: 90px; display: flex; align-items: center; justify-content: center;">
                    ${opt}
                  </button>
            `,
            )
            .join("")}
        </div>
        <div style="margin-top: 30px; padding: 20px; background: var(--bg-light); border-radius: 8px;">
          <strong>Score:</strong> ${score} points | <strong>Time:</strong> ${Math.floor((Date.now() - startTime) / 1000)}s
        </div>
      </div>
    `;

          document.getElementById("gameModalContent").innerHTML = html;
        }

        window.checkPatternAnswer = function (selected, correct, roundStart) {
          const responseTime = Date.now() - roundStart;
          const timeBonus = Math.max(0, 1000 - responseTime);

          if (selected === correct) {
            score += Math.floor(100 + timeBonus / 10);
            showNotification(
              "âœ… Correct! +" + Math.floor(100 + timeBonus / 10) + " points",
            );
          } else {
            showNotification(
              `âŒ Incorrect. You selected: ${selected} | Correct: ${correct}`,
            );
          }

          round++;
          setTimeout(showRound, 800);
        };

        function endGame() {
          const totalTime = Math.floor((Date.now() - startTime) / 1000);

          // Update high score
          if (!userData.gamesProgress.patternSpeed) {
            userData.gamesProgress.patternSpeed = { highScore: 0, attempts: 0 };
          }

          // SAVE THE OLD HIGH SCORE FIRST
          const oldHighScore = userData.gamesProgress.patternSpeed.highScore;
          const isNewHighScore = score > oldHighScore;

          userData.gamesProgress.patternSpeed.attempts++;
          if (isNewHighScore) {
            userData.gamesProgress.patternSpeed.highScore = score;
            userData.gamesProgress.patternSpeed.lastPlayed =
              new Date().toISOString();
          }

          saveUserData();

          const html = `
      <div style="background: white; padding: 40px; border-radius: 16px; text-align: center;">
        <h2 style="color: var(--success); margin-bottom: 20px;">ðŸŽ‰ Game Complete!</h2>
        <div class="score-circle" style="margin: 30px auto;">
          <div class="score">${score}</div>
          <div class="total">points</div>
        </div>
        <p style="font-size: 1.2rem; margin: 20px 0;">Completed in ${totalTime} seconds</p>
        <p style="color: var(--text-light);">
            ${isNewHighScore ? "ðŸ† New High Score!" : "High Score: " + oldHighScore}        </p>
        <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
          <button class="btn btn-primary" onclick="startGame('patternSpeed')" 
                  style="min-width: 140px; padding: 14px 30px;">
            Play Again
          </button>
          <button class="btn btn-secondary" onclick="closeGameModal()" 
                  style="min-width: 140px; padding: 14px 30px;">
            Back to Games
          </button>
        </div>
      </div>
    `;

          document.getElementById("gameModalContent").innerHTML = html;
          updateGameScores();
        }

        showRound();
      }

      // Update game scores display
      function updateGameScores() {
        if (userData.gamesProgress) {
          if (userData.gamesProgress.patternSpeed) {
            const elem = document.getElementById("patternHighScore");
            if (elem)
              elem.textContent =
                userData.gamesProgress.patternSpeed.highScore || 0;
          }
          if (userData.gamesProgress.mathBlitz) {
            const elem = document.getElementById("mathHighScore");
            if (elem)
              elem.textContent =
                userData.gamesProgress.mathBlitz.highScore || 0;
          }
          if (userData.gamesProgress.memoryMatch) {
            const elem = document.getElementById("memoryBestTime");
            if (elem) {
              const time = userData.gamesProgress.memoryMatch.bestTime;
              elem.textContent = time < 999999 ? time : "--";
            }
          }
        }
      }

      // Render study resources
      function renderResources() {
        const categories = [
          "verbal",
          "numerical",
          "abstract",
          "neuroPsych",
          "general",
        ];

        categories.forEach((category) => {
          const container = document.getElementById(`${category}Resources`);
          if (!container) return;

          const resources = studyResources[category] || [];

          container.innerHTML = resources
            .map(
              (resource) => `
            <div class="card" onclick="window.open('${resource.url}', '_blank')" 
                 style="cursor: pointer; transition: all 0.3s;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                <h3 style="flex: 1;">${resource.title}</h3>
                <span style="background: var(--accent); color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; white-space: nowrap; margin-left: 10px;">
                  ${resource.type}
                </span>
              </div>
              <p style="color: var(--text-light); margin-bottom: 15px;">${resource.description}</p>
              <div style="display: flex; align-items: center; color: var(--primary); font-weight: 600; font-size: 0.9rem;">
                Open Resource â†’
              </div>
            </div>
          `,
            )
            .join("");
        });

        // Show weak area suggestions
        renderWeakAreaSuggestions();
      }

      // Smart suggestions based on weak areas
      function renderWeakAreaSuggestions() {
        const container = document.getElementById("weakAreaSuggestions");
        if (!container || !userData.weakAreas) return;

        const weakTopics = Object.entries(userData.weakAreas)
          .filter(
            ([topic, data]) =>
              data.total > 5 && data.correct / data.total < 0.6,
          )
          .map(([topic]) => topic);

        if (weakTopics.length === 0) {
          container.innerHTML = "";
          return;
        }

        const suggestions = weakTopics
          .map((topic) => {
            const category = ["vocabulary", "grammar", "analogies"].includes(
              topic,
            )
              ? "verbal"
              : [
                    "percentages",
                    "ratios",
                    "wordProblems",
                    "fractions",
                    "basic",
                  ].includes(topic)
                ? "numerical"
                : [
                      "sequences",
                      "rotation",
                      "patterns",
                      "progression",
                      "oddOneOut",
                      "combined",
                    ].includes(topic)
                  ? "abstract"
                  : null;

            return category ? { topic, category } : null;
          })
          .filter(Boolean);

        if (suggestions.length === 0) {
          container.innerHTML = "";
          return;
        }

        container.innerHTML = `
          <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 25px; border-radius: 12px; border-left: 4px solid var(--accent);">
            <h3 style="color: var(--accent); margin-bottom: 15px;">ðŸŽ¯ Recommended for You</h3>
            <p style="margin-bottom: 15px;">Based on your performance, focus on these resources:</p>
            <ul style="margin-left: 20px;">
              ${suggestions
                .map(
                  (s) => `
                <li style="margin: 8px 0;">
                  <strong>${s.topic}:</strong> Check out 
                  <a href="#${s.category}Resources" 
                    onclick="
                      event.preventDefault(); 
                      const target = document.getElementById('${s.category}Resources');
                      const offset = 100; // Account for header
                      const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - offset;
                      window.scrollTo({top: targetPosition, behavior: 'smooth'});
                    " 
                    style="color: var(--primary); font-weight: 600; text-decoration: underline;">
                    ${s.category} resources
                  </a>
                </li>
              `,
                )
                .join("")}
            </ul>
          </div>
        `;
      }
      // Initialize
      loadUserData();

      // Ensure strict mode toggle reflects current state
      document.addEventListener("DOMContentLoaded", () => {
        initializeStrictMode();
      });

      // Service Worker for offline capability
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register(
            "data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZnVuY3Rpb24oZSkge2NvbnNvbGUubG9nKCdTZXJ2aWNlIFdvcmtlciBJbnN0YWxsZWQnKX0p",
          )
          .then(() => console.log("Offline mode enabled"))
          .catch((err) => console.log("Offline mode not available", err));
      }

      // Daily reminder
      function checkDailyReminder() {
        const now = new Date();
        const hour = now.getHours();

        if (hour === 9 && !sessionStorage.getItem("reminderShown")) {
          showNotification(
            "ðŸ“š Good morning! Time for your daily study session!",
          );
          sessionStorage.setItem("reminderShown", "true");
        }
      }

      setInterval(checkDailyReminder, 60000); // Check every minute

      // Update Verbal Analysis Dashboard
      function updateVerbalAnalysis() {
        // âœ… ADD: Reset all display elements first before recalculating
        const topics = ["analogies", "vocabulary", "comprehension", "grammar"];
        topics.forEach((topic) => {
          const perfElem = document.getElementById(`${topic}Perf`);
          const barElem = document.getElementById(`${topic}Bar`);
          const textElem = document.getElementById(`${topic}Text`);
          if (perfElem) perfElem.textContent = "0%";
          if (barElem) barElem.style.width = "0%";
          if (textElem) textElem.textContent = "No attempts yet";
        });

        // âœ… Safety check: Ensure the object exists
        if (!userData.verbalSubTopicPerformance) {
          console.warn(
            "âš ï¸ verbalSubTopicPerformance not initialized, creating now...",
          );
          userData.verbalSubTopicPerformance = {
            analogies: { correct: 0, total: 0 },
            vocabulary: { correct: 0, total: 0 },
            comprehension: { correct: 0, total: 0 },
            grammar: { correct: 0, total: 0 },
          };
        }

        let weakestTopic = null;
        let lowestScore = 100;

        topics.forEach((topic) => {
          const data = userData.verbalSubTopicPerformance[topic];

          // âœ… Extra safety: ensure topic exists
          if (!data) {
            userData.verbalSubTopicPerformance[topic] = {
              correct: 0,
              total: 0,
            };
            return; // Skip this iteration
          }

          if (data.total > 0) {
            const percentage = Math.round((data.correct / data.total) * 100);

            // Update display
            const perfElem = document.getElementById(`${topic}Perf`);
            const barElem = document.getElementById(`${topic}Bar`);
            const textElem = document.getElementById(`${topic}Text`);

            if (perfElem) perfElem.textContent = percentage + "%";
            if (barElem) barElem.style.width = percentage + "%";

            const status =
              percentage >= 80
                ? "âœ… Strong"
                : percentage >= 60
                  ? "âš ï¸ Improving"
                  : "âŒ Needs Work";

            if (textElem) {
              textElem.textContent = `${data.correct}/${data.total} correct - ${status}`;
            }

            // Track weakest
            if (percentage < lowestScore) {
              lowestScore = percentage;
              weakestTopic = topic;
            }
          }
        });

        // Show recommendation
        const recTextElem = document.getElementById("verbalRecText");
        if (!recTextElem) return;

        if (weakestTopic && lowestScore < 70) {
          const topicNames = {
            analogies: "Word Analogies",
            vocabulary: "Vocabulary",
            comprehension: "Reading Comprehension",
            grammar: "Grammar",
          };

          recTextElem.innerHTML = `
            Focus on <strong>${topicNames[weakestTopic]}</strong> (${lowestScore}%). 
            Review the tutorial section and practice 20+ questions in this area.
        `;
        } else if (lowestScore >= 70) {
          recTextElem.textContent =
            "ðŸŽ‰ Great work! All verbal sub-topics are strong. Keep practicing to maintain proficiency.";
        }
      }
      function confirmResetProgress() {
        // Show a confirmation modal before deleting
        const modalContent = document.getElementById("modalContent");
        modalContent.innerHTML = `
    <div style="text-align: center; padding: 20px;">
      <div style="font-size: 4rem; margin-bottom: 20px;">âš ï¸</div>
      <h2 style="color: var(--danger); margin-bottom: 15px;">Reset All Progress?</h2>
      <p style="color: var(--text-dark); margin-bottom: 10px; font-size: 1.1rem;">
        This will permanently delete:
      </p>
      <ul style="text-align: left; display: inline-block; margin: 15px 0; line-height: 2;">
        <li>ðŸ“Š All practice scores and statistics</li>
        <li>ðŸŽ® All game high scores</li>
        <li>ðŸ”¥ Your study streak</li>
        <li>ðŸ“ˆ Performance history</li>
        <li>âš™ï¸ All preferences</li>
      </ul>
      <p style="color: var(--danger); font-weight: 700; margin: 20px 0;">
        This action CANNOT be undone!
      </p>
      <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 25px;">
        <button class="btn btn-danger" onclick="executeResetProgress()" style="padding: 14px 35px; font-size: 1.1rem;">
          Yes, Reset Everything
        </button>
        <button class="btn btn-secondary" onclick="closeModal()" style="padding: 14px 35px; font-size: 1.1rem;">
          Cancel
        </button>
      </div>
    </div>
  `;
        document.getElementById("modal").classList.add("active");
      }

      function executeResetProgress() {
        // Clear localStorage
        localStorage.removeItem("afpExamData");

        // Reset userData to defaults
        userData = {
          totalQuestions: 0,
          correctAnswers: 0,
          afpsatScores: [],
          neuroPsychScores: [],
          mockExams: [],
          studyStreak: 0,
          lastStudyDate: null,
          weakAreas: {},
          strongAreas: {},
          verbalSubTopicPerformance: {
            analogies: { correct: 0, total: 0 },
            vocabulary: { correct: 0, total: 0 },
            comprehension: { correct: 0, total: 0 },
            grammar: { correct: 0, total: 0 },
          },
          questionsAnsweredOnTime: 0,
          questionsTotalTimed: 0,
          sectionPerformance: {
            abstract: [],
            verbal: [],
            numerical: [],
            neuroPsych: [],
          },
          preferences: {
            strictExamMode: false,
            lastUpdated: null,
          },
          gamesProgress: {
            patternSpeed: { highScore: 0, attempts: 0, lastPlayed: null },
            mathBlitz: { highScore: 0, attempts: 0, lastPlayed: null },
            memoryMatch: {
              highScore: 0,
              bestTime: 999999,
              attempts: 0,
              lastPlayed: null,
            },
          },
        };

        closeModal();
        updateDashboard();
        updateStats();
        initializeStrictMode();
        showNotification("âœ… All progress has been reset successfully!");
      }
    </script>
  </body>
</html>
